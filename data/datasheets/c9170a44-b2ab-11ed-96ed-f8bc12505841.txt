[{'role': 'system', 'content': 'You are a technical specialist with expertise in electronics. Your task is to analyze datasheets for electronic components and provide a concise summary of the product’s key characteristics and specifications. In addition, you need to gather textual information about the component, including its description and typical applications.Instructions:    Identify the correct component in the datasheet using the provided product code.    Summarize key parameters, including:        Voltage ratings        Current ratings        Power consumption        Operating temperature range        Package type        Special features or notes (if applicable)        Moisture Sensetive Level JEDEC J-STD-020E    Provide a short description of the component, including what it is (e.g., transistor, microcontroller, sensor) and its primary function.    Explain typical applications for the component (e.g., power management, signal processing, data storage, etc.).    Be thorough and accurate: Ensure the information corresponds specifically to the product code, as some datasheets cover multiple variants.Your goal is to create a clear and accurate technical summary that includes both key specifications and a description of what the component is used for.'}, {'role': 'user', 'content': "Give me information about the component of ADE7880ACPZ-RL production of ANALOG DEVICES from the text: Polyphase Multifunction Energy Metering IC \nwith Harmonic Monitoring\nData Sheet ADE7880\n \n Rev. C  Document Feedback \nInformation furnished by Analog Devices is believed to be accurate and reliable. However, no \nresponsibility is assumed by Analog Devices for its use, nor for any infringements of patents or other \nrights of third parties that may result from its use. Specifications subject to change without notice. No license is granted by implication or otherwise under any patent or patent rights of Analog Devices. Trademarks and registered trademarks are the property of their respective owners.   \n \nOne Technology Way, P.O. Box 9106, Norwood, MA 02062-9106, U.S.A.\nTel: 781.329.4700 ©2011–2014 Analog Devices, Inc. All rights reserved. Technical Support  www.analog.com   FEATURES \nHighly accurate; supports IEC 62053-21, IEC 62053-22,  \nIEC 62053-23, EN 50470-1, EN 50470-3, ANSI C12.20, and \nIEEE1459 standards \nSupports IEC 61000-4-7 Class I and Class II accuracy \nspecification \nCompatible with 3-phase, 3-wire or 4-wire (delta or wye), \nand other 3-phase services \nSupplies rms, active, reactive, and apparent powers, power \nfactor, THD, and harmonic distortion of all harmonics within 2.8 kHz pass band on all phases \nSupplies rms and harmonic distortions of all harmonics \nwithin 2.8 kHz pass band on neutral current \nLess than 1% error in harmonic current and voltage rms, \nharmonic active and reactive powers over a dynamic range of 2000 to 1 at T\nA = 25°C \nSupplies total (fundamental and harmonic) active and \napparent energy and fundamental active/reactive energy on each phase and on the overall system  \nLess than 0.1% error in active and fundamental reactive \nenergy over a dynamic range of 1000 to 1 at T\nA = 25°C \nLess than 0.2% error in active and fundamental reactive \nenergy over a dynamic range of 5000 to 1 at T A = 25°C \nLess than 0.1% error in voltage and current rms over a \ndynamic range of 1000 to 1 at T A = 25°C \nBattery supply input for missing neutral operation Wide supply voltage operation: 2.4 V to 3.7 V Reference: 1.2 V (drift 20 ppm/°C typical) with external \noverdrive capability \n40-lead lead frame chip scale package (LFCSP), Pb-free, pin-\nfor-pin compatible with ADE7854, ADE7858 , ADE7868 and \nADE7878  \nAPPLICATIONS \nEnergy metering systems Power quality monitoring Solar inverters Process monitoring Protective devices GENERAL DESCRIPTION \nThe ADE78801 is a high accuracy, 3-phase electrical energy \nmeasurement IC with serial interfaces and three flexible pulse \noutputs. The ADE7880  device incorporates second-order sigma-\ndelta (Σ-Δ) analog-to-digital converters (ADCs), a digital integrator, reference circuitry, and all of the signal processing required to perform the total (fundamental and harmonic) active, \nand apparent energy measurements, rms calculations, as well as \nfundamental-only active and reactive energy measurements. In addition, the ADE7880  computes the rms of harmonics on the \nphase and neutral currents and on the phase voltages, together with the active, reactive and apparent powers, and the power factor and harmonic distortion on each harmonic for all phases. \nTotal harmonic distortion (THD) is computed for all currents \nand voltages. A fixed function digital signal processor (DSP) executes this signal processing. The DSP program is stored in the internal ROM memory.  \nThe ADE7880  is suitable for measuring active, reactive, and \napparent energy in various 3-phase configurations, such as wye  \nor delta services with, both, three and four wires. The ADE7880  \nprovides system calibration features for each phase, that is, rms offset correction, phase calibration, and gain calibration. The CF1, CF2, and CF3 logic outputs provide a wide choice of  power information: total active powers, apparent powers, or the sum of the current rms values, and fundamental active and reactive powers. \nThe ADE7880  contains waveform sample registers that allow \naccess to all ADC outputs. The devices also incorporate power \nquality measurements, such as short duration low or high voltage detections, short duration high current variations, line voltage period measurement, and angles between phase voltages and currents. Two serial interfaces, SPI and I\n2C, can be used to \ncommunicate with the ADE7880 . A dedicated high speed \ninterface, the high speed data capture (HSDC) port, can be used in conjunction with I\n2C to provide access to the ADC outputs \nand real-time power information. The ADE7880  also has two \ninterrupt request pins, IRQ0  and IRQ1 , to indicate that an enabled \ninterrupt event has occurred. Three specially designed low power modes ensure the continuity of energy accumulation when the \nADE7880  is in a tampering situation. The ADE7880 is available \nin the 40-lead LFCSP , Pb-free package, pin-for-pin compatible \nwith ADE7854 , ADE7858 , ADE7868 , and ADE7878  devices. \n \n1 Protected by U.S. Patent 8,01 0,304 B2. Other patents pending. \n \nADE7880  Data Sheet  \n \nTABLE OF CONTENTS  \nFeatures  .............................................................................................. 1 \nApplications  ....................................................................................... 1 \nGeneral Description  ......................................................................... 1 \nRevision History  ............................................................................... 3 \nFunctional Block Diagram  .............................................................. 4 \nSpecifications  ..................................................................................... 5 \nTiming Characteristics  ................................................................ 8 \nAbsolute Maximum Ratings  .......................................................... 11 \nThermal Resistance  .................................................................... 11 \nESD Caution  ................................................................................ 11 \nPin Configuration and Function Descriptions  ........................... 12 \nTypical Performance Characteristics  ........................................... 14 \nTest Circuit  ...................................................................................... 19 \nTerminology  .................................................................................... 20 \nPower Management  ........................................................................ 21 \nPSM0 —Normal Power Mode (All Parts)  ................................ 21 \nPSM1 —Reduced Power Mode.................................................. 21 \nPSM2 —Low Power Mode  ......................................................... 21 \nPSM3 —Sleep Mode (All Parts)  ................................................ 22 \nPower -Up Procedure  .................................................................. 24 \nHardware Reset  ........................................................................... 25 \nSoftware Reset Functionality  .................................................... 25 \nTheory of Operation  ...................................................................... 26 \nAnalog Inputs  .............................................................................. 26 \nAnalog -to-Digital Conversion  .................................................. 26 \nCurrent Channel ADC ............................................................... 27 \ndi/dt Current Sensor and Digital Integrator  ............................... 29 \nVoltage Channel ADC  ............................................................... 30 \nChanging Phase Voltage Data Path  .......................................... 31 Power Quality Measurements  ................................................... 32 \nPhase Compensation  ................................................................. 37 \nReference Circuit  ........................................................................ 39 \nDigital Signal Processor  ............................................................. 39 \nRoot Mean Square  Measurement  ............................................. 41 \nActive Power Calculation  .......................................................... 45 \nFundamental Reactive Power Calculation  .............................. 51 \nApparent Power Calculation  ..................................................... 55 \nPower Factor Calculation  .......................................................... 58 \nHarmonics Calculations  ............................................................ 58 \nWaveform Sampling Mode  ....................................................... 66 \nEnergy -to-Frequency Conversion ............................................ 66 \nNo Load Condition  .................................................................... 71 \nChecksum Register ..................................................................... 73 \nInterrupts  ..................................................................................... 74 \nSerial Interfaces  .......................................................................... 75 \nADE7880 Quick Setup As Energy Meter  ................................ 82 \nLayout Guidelines ....................................................................... 83 \nCrystal Circuit  ............................................................................ 84 \nADE7880 Evaluation Board  ...................................................... 84 \nDie Version  .................................................................................. 84 \nSilicon Anomaly  ............................................................................. 85 \nADE7880 Functionality Issues  ................................................. 85 \nFunctionality Issues  .................................................................... 85 \nSection 1. ADE7880 Functionality Issues  ............................... 86 \nRegisters List  ................................................................................... 87 \nOutline Dimensions  ..................................................................... 107 \nOrdering Guide  ........................................................................ 107 \n \nRev. C | Page 2  of 107 \nData Sheet  ADE7880  \n \nREVISION HISTORY  \n12/14— Rev. B to Rev. C  \nChanges to P i n  E P,  Table 7  ............................................................. 13 \nChanges to Configuring Harmonic Calculations Update  \nRate Section  ...................................................................................... 66 \nChange to Address 0x43 C7, Table 30  ........................................... 88 \nChanges to Bit 19, Table 36  ............................................................ 94 \nChanges to Bit 19, Table 38  ............................................................ 97 \n \n8/14—Rev. A to Rev. B  \nChange  to Features Section  .............................................................. 1 \nChanges to Patent Footnote  ............................................................. 1 \nChanges to Functional Block Diagram  .......................................... 4 \nChanges to Table 1  ............................................................................ 5 \nChanges to Data Hold Time Parameter, Table 2 , and Figure 2  ... 8 \nChan ges to Pin 5 and Pin 24, Table 7, and Figure 6  ................... 12 \nChanges to Figure 16 and Figure 18 ............................................. 15 \nChanges to Figure 20 and Figure 24 Caption  .............................. 16 \nMoved Figure 29 and Figure 30 ..................................................... 18 \nChanges to Test Circuit Section and Figure 32  ........................... 19 \nChanges to Terminology Section  .................................................. 20 \nChanges  to PSM2 —Low Power Mode Section  ........................... 21 \nAdded Figure 34; Renumbered Sequentially  ............................... 22 \nChange to Power -Up Procedure Section and Figure 35  ............ 24 \nChanges to Figure 42 and Figure 43 ............................................. 28 \nChanges to Figure 48 and Figure 50; Added Figure 49  .............. 30 \nChanges to Changing Phase Volt age Data Path Section and \nFigure 5 1 ........................................................................................... 31 \nChanges to Power Quality Measurements Section and  \nFigure 5 2 ........................................................................................... 32 \nChanged ADC MAX = 5,928,256,  to ADC MAX = 5,326,737,  \nNeutral Current Mismatch Section ............................................... 37 \nAdded Figure 6 4 .............................................................................. 38 \nChanges to Reference Circuit Section and Digit al Signal \nProcessor Section  ............................................................................ 39 \nChan ges to Current RMS Calculation Section  ............................ 41 \nChanges to Voltage RMS Offset Compensation Section ,  \nVoltage RMS in 3 -Phase , 3-Wire Delta Configurations Section , \nand Active Power Calculation Section  ......................................... 45 \nChanges to Figure 76  ...................................................................... 46 \nChanges to Fundamental Active Power Calculation Section  ... 47 \nAdded Managing Change in Fundamental Line Frequency \nSection  .............................................................................................. 47 \nChanges to Figure 78  ...................................................................... 49 \nChanges to Active Energy Accumulation Modes Section  ......... 50 \nChanges to Fundamental Reactive Power Calculation Secti on \nand Equation 3 5 ............................................................................... 51 \nChanges to Fundamental Reactive Energy Accumulation  \nModes Section  .................................................................................. 54 \nChanges to Apparent Power Calculation Section  ....................... 55 \nChanges to Apparent Energy Accumulation Mode s Section  \nand Figure 83 ................................................................................... 57 Changes to Power  Factor Calculation Section a nd Harmonics \nCalculation s Section  ....................................................................... 58 \nChanges to Figure 85  ...................................................................... 60 \nChanges to Energy -to-Frequency Conversion Section  .............. 66 \nChanges to Checksum Register Section, Equation 5 4, and \nFigure 100 ......................................................................................... 73 \nChanges to Table 24  ........................................................................ 75 \nChanges to I2C-Compatible Interface Section  ............................ 76 \nChanges to Figure 109  .................................................................... 80 \nChanges to ADE7880 Quick Setup as Energy Meter Section  ... 82 \nAdded Layout Guidelines Section ................................................. 83 \nAdded Crystal Circuit Section  ...................................................... 84 \nChanges to Silicon Anomaly Section, Table 26, and Table 27  ... 85 \nChanges to Table 30  ........................................................................ 87 \nChanges to Table 33  ........................................................................ 90 \nChanges to Bit 19, Table 3 6 ............................................................ 94 \nChanges to Bit 19, Table 38  ............................................................ 97 \nChanges to Table 42  ........................................................................ 99 \nChanges to Table 45  ...................................................................... 101 \nChanges to Table 50  ...................................................................... 104 \nChanges to Bits[4:3 ], Table 54  ..................................................... 106 \n 3/12— Rev. 0 to Rev. A  \nRemoved References to + N (Plus Noise) and changed VTHDN \nto VTHD and ITHDN to ITHD  .................................. Throughout  \nChanges to  Reactive Energy Management Parameter in Table 1  4 \nChanges to Figure 6  ........................................................................ 11 \nChanges to Table 7  .......................................................................... 12 \nChanges to Phase Compensation Section  .................................... 36 \nChanges to Equation 13  ................................................................. 39 \nChanges to Equation 33  ................................................................. 49 \nChanges to Fundamental React ive Ene rgy Calculation  \nSection  .............................................................................................. 51 \nChanges to Figure 80  ...................................................................... 55 \nChanges to Figure 85  ...................................................................... 62 \nChanges to Energy Registers and CF Outputs for Various Accumulation Modes  Section  ....................................................... 67 \nChanges to Figure 95  ...................................................................... 69 \nChanges to No Load Condition  Section  ...................................... 69 \nChanges to Equation 53  ................................................................. 71 \nChanges to Figure 100  .................................................................... 74 \nChanges to Figure 101 and to Figure 102 .................................... 75 \nChanges to SPI -Compatible Interface Section  ............................ 76 \nChan ges to HSDC Interface Section ............................................. 78 \nChanges to Figure 109 and to Figure 110 .................................... 80 \nChanges to Silicon Anomaly Section  ........................................... 81 \nChanges to Table 48  ........................................................................ 99 \nChanges to Table 52  ...................................................................... 101 \n \n10/11— Revision 0: Initial Version  \n \nRev. C | Page 3  of 107 \nADE7880  Data Sheet  \n \nFUNCTIONAL BLOCK DIAGRAM  \nPGA1PGA1PGA1\nPGA3PGA3PGA3APHCA L\nHPF\nNIGAINHPFEN OF\nCONFIG3DIGITAL\nINTEGRATOR\nHPFHPFPOR LDO LDO\nX2 AIRMS\nLPF\nX2\nX2AVRMS\nLPF\nLPFAPGAIN\nLPFNIRMSNIRMSOSAPGAIN AFVAROSAPGAIN AFWATTOSAPGAIN AWATTOSAVRMSOS27AIRMSOS\n27\nDFCCF1DEN\n:\nDFCCF2DEN\n:\nDFCCF3DEN\n:5 24 26 25 17 4\n7\n8\n9\n2212\n13\n14\n19\n18\n3937383632293534333227\n28\n236RESET REFIN/OUT VDD AGND AVDD DVDD DGND\nCLKIN\nCLKOUT\nIAP\nIAN\nVAP\nIBP\nIBN\nVBP\nICP\nICN\nVCP\nVNPM0\nPM1\nCF1\nCF2/HREADY\nCF3/HSCLK\nIRQ0\nIRQ1\nSCLK/SCL\nMOSI/SDA\nMISO/HSD\nSS/HSAHSDCI2CSPI/I 2CADE7880\nADC\nADC\nADC\nADC\nADC\nADC\nPGA215\n16INP\nINNADCTOTAL/FUNDAMENTAL ACTIVE ENERGIES\nFUNDAMENTAL REACTIVE ENERGY\nAPPARENT ENERGY\nVOLTAGE CURRENT RMS\nHARMONIC INFORMATION CALCULATION\nFOR PHASE B\n(SEE PHASE A FOR DETAILED DATA PATH)\nTOTAL/FUNDAMENTAL ACTIVE ENERGIES\nFUNDAMENTAL REACTIVE ENERGY\nAPPARENT ENERGY\nVOLTAGE/CURRENT RMS\nHARMONIC INFORMATION CALCULATION\nFOR PHASE C\n(SEE PHASE A FOR DETAILED DATA PATH)\nCOMPUTATIONAL BLOCK FOR HARMONIC\nINFORMATION ON NEUTRAL CURRENT\nDIGITAL SIGNAL\nPROCESSORCOMPUTATIONAL\nBLOCK FOR\nHARMONIC\nINFORMATION ON\nPHASE A CURRENT\nAND VOLTAGECOMPUTATIONAL\nBLOCK FOR\nFUNDAMENTAL\nACTIVE AND\nREACTIVE POWERPHASE A,\nPHASE B,\nAND\nPHASE C\nDATAHPFEN OF\nCONFIG3HPFEN OF\nCONFIG3DIGITAL\nINTEGRATOR1.2V\nREF\n10193-001AIGAIN\nAVGAIN\n \nFigure 1. ADE7880  Functional Block Diagram  \n \nRev. C | Page 4  of 107 \nData Sheet  ADE7880  \n \nSPECIFICATIONS \nVDD = 3.3 V ± 10%, AG ND = DGND = 0 V , on -chip reference, CLKIN = 16.384 MHz, T MIN to T MAX = −40°C to +85°C, T TYP = 25°C.  \nTable 1.  \nParameter1, 2 Min  Typ  Max  Unit  Test Conditions/Comments  \nACTIVE  ENERGY  MEASUREMENT       \nActive  Energy  Measurement Error  \n(per Phase)       \nTotal Active Energy   0.1  % Over a dynamic range of 1000 to 1,  \nPGA = 1, 2, 4; integrator off , pf = 1, gain \ncompensation only \n  0.2  %  Over a dynamic range of 5000 to 1,  \nPGA = 1, 2, 4; integrator off , pf = 1 \n  0.1  % Over a dynamic  range of 500 to 1,  \nPGA = 8, 16; integrator on, pf  = 1, gain \ncompensation only \n  0.2  % Over a dynamic range of 2000 to 1,  \nPGA = 8, 16; integrator on, pf  = 1 \nFundamental Active Energy   0.1  % Over a dynamic range of 1000 to 1,  \nPGA = 1, 2, 4; integrato r off, pf = 1, gain \ncompensation only \n  0.2  % Over a dynamic range of 5000 to 1,  \nPGA = 1, 2, 4; integrator off, pf = 1 \n  0.1  % Over a dynamic range of 500 to 1,  PGA = 8, 16; integrator on, pf  = 1, gain \ncompensation only \n  0.2  % Over a dynamic range  of 2000 to 1,  \nPGA = 8, 16; integrator on, pf  = 1 \nAC Power Supply Rejection     VDD = 3.3 V + 120 mV rms/120 Hz,  \nIPx = VPx = ±100 mV rms  \nOutput Frequency Variation   0.01   %   \nDC Power Supply Rejection     VDD = 3.3 V ± 330 mV dc  \nOutput Frequency Var iation   0.01   %   \nTotal Active Energy Measurement \nBandwidth ( −3 dB)  3.3  kHz   \nREACTIVE ENERGY MEASUREMENT       \nReactive Energy Measurement Error  \n(per Phase)       \nFundamental Reactive Energy   0.1  % Over a dynamic range of 1000 to 1,  \nPGA = 1, 2,  4; integrator off, pf = 0, gain \ncompensation only \n  0.2  % Over a dynamic range of 5000 to 1,  \nPGA = 1, 2, 4;  integrator off, pf  = 0 \n  0.1  % Over a dynamic range of 500 to 1,  \nPGA = 8, 16; integrator on, pf  = 0, gain \ncompensation only \n  0.2  % Over a dynamic range of 2000 to 1,  PGA = 8, 16; integrator on, pf  = 0 \nAC Power Supply Rejection     VDD = 3.3 V + 120 mV rms/120 Hz,  \nIPx = VPx = ± 100 mV rms  \nOutput Frequency Variation   0.01   %  \nDC Power Supply Rejection      VDD = 3.3 V ± 330 mV dc  \nOutput Frequency Variation   0.01   %   \nFundamental Reactive Energy \nMeasurement Bandwidth ( −3 dB)  3.3  kHz   \nRev. C | Page 5  of 107 \nADE7880  Data Sheet  \n \nParameter1, 2 Min  Typ  Max  Unit  Test Conditions/Comments  \nRMS MEASUREMENTS  (PSM0 Mode)       \nI RMS  and V RMS  Measurement \nBandwidth ( −3 dB)  3.3  kHz  \nI RMS  and V RMS  Measurement Error   0.1  %  Over a dynamic range of 1000 to 1,  \nPGA = 1 \nMEAN ABSOLUTE VALUE (MAV) \nMEASUREMENT (PSM1 Mode)       \nI MAV  Measurement Bandwidth   260  Hz  \nI MAV  Measurement Error   0.5  % Over a dynamic range of 100 to 1,  PGA = 1, 2, 4, 8 \nHARMONIC MEASUREMENTS       \nBandwidth ( −3 dB)  3.3  kHz  \nNo attenuation Pass B and   2.8  kHz  \nFundamental Line F requency , fL  45  66 Hz Voltage signal must have amplitudes greater than 100 mV peak at ADC stage. \nSet the SELFREQ bit of COMPMODE \nregister based on the frequency . See the \nManaging Change in Fundamental Line \nFrequency  section  for details . \nMax imum Number of H armonics3   \n\uf8fa\n\uf8fb\uf8f9\n\uf8ef\n\uf8f0\uf8ee\nLf2800   \nAbsolute M aximum Number of \nHarmonics    63   \nHarmonic R MS Measurement Error   1  % Instantaneous reading accuracy over a \ndynamic range of 1000 to 1 for harmonics \nof frequencies within the pass band; after the initial 750 ms settling time; PGA  = 1 \n     Accuracy over a dynamic range of 2000:1 \nfor harmonics of frequencies within the \npass band ; average of 10 readings at \n128 ms update rate, after the initial \n750 ms setting time; PGA = 1 \nHarmonic Active/Reactive Power \nMeasurement Error   1  % Instantaneous reading accuracy over a dynamic range of 1000 to 1 for harmonics of frequencies within the pass band; after the initial 750 ms settling time; PGA  = 1 \n     Accuracy over a dynamic range of 2000:1 \nfor harmonics of frequencies within the pass band; average of 5 readings at 128 ms update rate, after the initial \n750 ms setting time; PGA = 1 \nANALOG INPUTS       \nMaximum Signal Levels    ±500  mV peak  PGA = 1, differential or single -ended inputs  \nbetween the following pins: IAP and IAN, IBP and IBN, ICP and ICN, INP and INN; \nsingle -ended inputs between the following  \npins: VAP and VN, VBP and VN, VCP and VN \nInput Impedance (DC)       \nIAP, IAN, IBP, IBN, ICP, ICN, VAP, VBP, \nand VCP Pins  490   kΩ  \nVN Pin  170   kΩ  \nADC Offset   −35  mV  PGA = 1, uncalibrated error, see the Terminology  section . Scales inversely \nproportional to th e other PGA gains  \nGain Error  ±4  %  External 1.2 V reference  \nRev. C | Page 6  of 107 \nData Sheet  ADE7880  \n \nParameter1, 2 Min  Typ  Max  Unit  Test Conditions/Comments  \nWAVEFORM SAMPLING      Sampling CLKIN/2048, 16.384 MHz/2048 \n= 8 kSPS  \nCurrent and Voltage Channels      See the Waveform Sampling Mode  \nsection  \nSigna l-to-Noise Ratio, SNR   72  dB  PGA = 1, fundamental frequency = 45 Hz \nto 65 Hz, see the Terminology  section  \nSignal -to-Noise -and -Distortion Ratio, \nSINAD   72   dB PGA = 1, fundamental frequency = 45 Hz \nto 65 Hz, see  the Terminology  section  \nBandwidth (−3 dB)   3.3  kHz  \nTIME INTERVAL BETWEEN PHASES       \nMeasurement Error   0.3  Degrees  Line frequency = 45 Hz to 65 Hz, HPF on  \nCF1, CF2, CF3 PULSE OUTPUTS       \nMaximum Output F requency   68.818   kHz WTHR = VARTHR = VATHR = 3  \nDuty Cycle   50  % If CF1, CF2, or CF3 frequency > 6.25 Hz \nand CFDEN is even and > 1  \n  (1 + 1/CFDEN) × \n50  % If CF1, CF2, or CF3 frequency > 6.25 Hz and CFDEN is odd and > 1  \nActive Low Pulse Width   80  ms If CF1, CF2, or CF3 frequency < 6.25 Hz  \nJitter   0.04   % For CF1, CF2, or CF3 frequency = 1 Hz and nominal phase currents are larger than \n10% of full scale  \nREFERENCE INPUT       \nREF IN/OUT  Input Voltage Range  1.1  1.3 V Minimum = 1.2 V − 8%; maximum =  \n1.2 V + 8%  \nInput Capacitance    10 pF   \nON-CHIP REFERENCE      Nominal 1.2 V at the REF IN/OUT  pin at  \nTA = 25°C  \nPSM0 and PSM1 Modes       \nTemperature Coefficient  −50 ±20 +50 ppm/°C  Drift across the entire temperature range \nof −40°C to +85° C is calculated with \nreference to 25°C; see the Reference \nCircuit  section for more details  \nCLKIN      See the Crystal Circuit  section for more \ndetails  \nInput Clock Frequency  16.22  16.384  16.55  MHz   \nLOGIC INPUTS—MOSI/SDA, SCLK/SCL, SS, \nRESET , PM0, AND PM1       \nInput High Voltage, V INH 2.4    V  VDD = 3.3 V  \nInput Current, I IN   82 nA Input  = VDD = 3.3 V \nInput Low Voltage, V INL   0.8 V  VDD = 3.3 V  \nInput Current, I IN   −7.3 µA  Input  = 0, VDD  = 3.3 V \nInput Capacitance, C IN   10 pF   \nLOGIC OUTPUTS —IRQ0 , IRQ1 , AND \nMISO/HSD      VDD = 3.3 V  \nOutput High Voltage, V OH  3.0   V  ISOURCE  = 800 µA  \nOutput Low Voltage, V OL    0.4 V  ISINK = 2 mA \nCF1, CF2, CF3/HSCLK       \nOutput High Voltage, V OH  2.4    V  ISOURCE  = 500 µA \nOutput Low Voltage, V OL    0.4 V  ISINK = 8 mA \nPOWER SUPPLY      For specified performance  \nPSM0 Mode       \nVDD Pin  2.97   3.63  V  Minimum = 3.3 V −  10%; maximum =  \n3.3 V + 10%  \nIDD   25 28 mA   \nRev. C | Page 7  of 107 \nADE7880 Data Sheet\n \nRev. C | Page 8 of 107 Parameter1, 2 Min Typ Max Unit  Test Conditions/Comments  \nPSM1 and PSM2 Modes       \nVDD Pin 2.4  3.7 V  \nIDD      \nPSM1 Mode  5.3 5.8 mA  \nPSM2 Mode  0.2 0.27 mA  \nPSM3 Mode     For specified performance \nVDD Pin 2.4  3.7 V  \nIDD in PSM3 Mode  1.8 6 μA   \n \n1 See the Typical Performance  Characteristics section. \n2 See the Terminology section for a definition of the parameters. \n3 \uf0fa\n\uf0fb\uf0f9\n\uf0ea\n\uf0eb\uf0e9\nLf2800 means the whole number of the division. \n \nTIMING CHARACTERISTICS \nVDD = 3.3 V ± 10%, AGND = DGND = 0 V , on-chip reference, CLKIN = 16.384 MHz, T MIN to T MAX = −40°C to +85°C. Note that dual \nfunction pin names are referenced by the relevant function only within the timing tables and diagrams (see the Pin Configuratio n and \nFunction Descriptions section for full pin mnemonics and descriptions). \nTable 2. I2C-Compatible Interface Timing Parameter \n  Standard Mode Fast Mode  \nParameter  Symbol  Min Max Min Max Unit  \nSCL Clock Frequency fSCL 0 100 0 400 kHz \nHold Time (Repeated) Start Condition tHD;STA  4.0  0.6  μs \nLow Period of SCL Clock tLOW 4.7  1.3  μs \nHigh Period of SCL Clock tHIGH 4.0  0.6  μs \nSet-Up Time for Repeated Start Condition tSU;STA  4.7  0.6  μs \nData Hold Time tHD;DAT  0.1 3.45 0.1 0.9 μs \nData Setup Time tSU;DAT  250  100  ns \nRise Time of Both SDA and SCL Signals tR  1000 20 300 ns \nFall Time of Both SDA and SCL Signals tF  300 20 300 ns \nSetup Time for Stop Condition tSU;STO  4.0  0.6  μs \nBus Free Time Between a Stop and Start Condition tBUF 4.7  1.3  μs \nPulse Width of Suppressed Spikes tSP N/A1   50 ns \n \n1 N/A means not applicable. \n \ntF\ntF\ntHD;DATtHD;STA\ntHIGHtSU;STAtSU;DAT\ntFtHD;STA tSP\ntSU;STOtFtBUF\ntLOWSDA\nSCL\nSTART\nCONDITIONREPEATED START\nCONDITIONSTOP\nCONDITIONSTART\nCONDITION\n10193-002 \nFigure 2. I2C-Compatible In terface Timing \n \n \nData Sheet ADE7880\n \nRev. C | Page 9 of 107 Table 3. SPI Interface Timing Parameters \nParameter Symbol Min Max Unit \nSS to SCLK Edge tSS  50  ns \nSCLK Period  0.4 40001 μs \nSCLK Low Pulse Width tSL 175  ns \nSCLK High Pulse Width tSH 175  ns \nData Output Valid After SCLK Edge tDAV  100 ns \nData Input Setup Time Before SCLK Edge tDSU 100  ns \nData Input Hold Time After SCLK Edge tDHD 5  ns \nData Output Fall Time tDF  20 ns \nData Output Rise Time tDR  20 ns \nSCLK Rise Time tSR  20 ns \nSCLK Fall Time tSF  20 ns \nMISO Disable After SS  Rising Edge tDIS  200 ns \nSS High After SCLK Edge tSFS 0  ns \n \n1 Guaranteed by design. \n \nMSB LSB\nLSB ININTERMEDIATE BITS\nINTERMEDIATE BITStSFS\ntDIStSS\ntSL\ntDFtSH\ntDHDtDAV\ntDSUtSR tSF\ntDR\nMSB IN MOSIMISOSCLKSS\n10193-003 \nFigure 3. SPI Interface Timing \nADE7880  Data Sheet  \n \nTable 4. HSDC Interface Timing Parameter  \nParameter  Symbol  Min  Max  Unit  \nHSA to H SCLK  Edge  tSS 0  ns \nHSCLK Period   125  ns \nHSCLK Low Pulse Width  tSL 50  ns \nHSCLK High Pulse Width  tSH 50  ns \nData Output Valid After HSCLK Edge  tDAV  40 ns \nData Output Fall Time  tDF  20 ns \nData Output Rise Time  tDR  20 ns \nHSCLK Rise Time  tSR  10 ns \nHSCLK Fall Time  tSF  10 ns \nHSD Disable After HSA Rising Edge  tDIS 5  ns \nHSA High After HSCLK Edge  tSFS 0  ns \nMSB LSB INTERMEDIATE BITStSFS\ntDIStSS\ntSL\ntDFtSHtDAVtSR tSF\ntDRHSDHSCLKHSA\n10193-004 \nFigure 4. HSDC Interface Timing  \n \n2mA IOL\n800µA IOH1.6VTO OUTPUT\nPINCL\n50pF\n10193-005 \nFigure 5. Load Circuit for Timing Specifications  \n \n \n \n \nRev. C | Page 10 of 107 \nData Sheet ADE7880\n \nRev. C | Page 11 of 107 ABSOLUTE MAXIMUM RATINGS \nTA = 25°C, unless otherwise noted. \nTable 5.  \nParameter1 Rating \nVDD to AGND −0.3 V to +3.7 V \nVDD to DGND −0.3 V to +3.7 V \nAnalog Input Voltage to AGND, IAP , IAN, \nIBP , IBN, ICP , ICN, VAP , VBP , VCP , VN −2 V to +2 V \nAnalog Input Voltage to INP and INN −2 V to +2 V \nReference Input Voltage to AGND −0.3 V to VDD + 0.3 V \nDigital Input Voltage to DGND  −0.3 V to VDD + 0.3 V \nDigital Output Voltage to DGND −0.3 V to VDD + 0.3 V \nOperating Temperature   \nIndustrial Range −40°C to +85°C  \nStorage Temperature Range −65°C to +150°C \nJunction Temperature 150°C \nLead Temperature (Soldering, 10 sec) 300°C \n \n1 Regarding the temperature profile used in soldering RoHS Compliant Parts, \nAnalog Devices, Inc. advises that reflow profiles conform to J-STD 20 from \nJEDEC. Refer to JEDEC website for the latest revision. Stresses at or above those listed under Absolute Maximum \nRatings may cause permanent damage to the product. This is a \nstress rating only; functional operation of the product at these or any other conditions above those indicated in the operational section of this specification is not implied. Operation beyond the maximum operating conditions for extended periods may affect product reliability. \nTHERMAL RESISTANCE \nθJA is specified equal to 29.3°C/W; θ JC is specified equal to \n1.8°C/W . \nTable 6. Thermal Resistance \nPackage Type θJA θ JC Unit \n40-Lead LFCSP 29.3 1.8 °C/W \n \nESD CAUTION \n \n \n \n \n \nADE7880 Data Sheet\n \nRev. C | Page 12 of 107 PIN CONFIGURATION AND FU NCTION DESCRIPTIONS \n \nNOTES\n1. NC = NO CONNECT.\n2. CREATE A SIMILAR PAD ON THE PCB UNDER THE\n    EXPOSED PAD. SOLDER THE EXPOSED PAD TO\n    THE PAD ON THE PCB TO CONFER MECHANICAL\n    STRENGTH TO THE PACKAGE. CONNECT THE\n    PADS TO AGND AND DGND.\n11NC\n12IBN\n13ICP\n15INP\n17REFIN/O\nUT\n16INN\n18VN\n19VCP\n20NC\n14ICNNC\nPM0\nPM1\nRESET\nDVDD\nDGND\nIAP\nIAN\nIBP\nNCVAPAVDDAGNDVDDCLKINCLKOUTIRQ0NC\nVBP\nNC\n33\nCF134\nCF2/HREADY35\nCF3/HSCLK36\nSCLK/SCL37\nM\nISO/HSD38\nM\nOSI/SDA39\nSS/HSA40\nNC32\nIRQ131\nNC\n1\n2\n3\n4\n5\n6\n7\n8\n9\n102324252627282930\n22\n21ADE7880\nTOP VIEW\n(Not to Scale)\n10193-006 \nFigure 6. Pin Configuration \nTable 7. Pin Function Descriptions \nPin No.  Mnemonic Description  \n1, 10, 11, 20, \n21, 30, 31, 40 NC No Connect. Do not connect to these pins. These pins are not connected internally.  \n2 PM0 Power Mode Pin 0. This pin, combined with PM1, defines the power mode of the ADE7880, as \ndescribed in Table 8. \n3 PM1 Power Mode Pin 1. This pin defines the power mode of the ADE7880  when combined with PM0, as \ndescribed in Table 8. \n4 RESET  Reset Input, Active Low. In PSM0 mode, this pin must stay low for at least 10 μs to trigger a \nhardware reset.  \n5 DVDD  2.5 V Output of the Digital Low Dropout (LDO) Regulato r. Decouple this pin with a 4.7 μF capacitor \nin parallel with a ceramic 220 nF capacitor. Do not connect external active circuitry to this pin. \n6 DGND  Ground Reference. This pin provides the ground reference for the digital circuitry.  \n7, 8 IAP , IAN  Analog Inputs for Current Channel A. This channe l is used with the current transducers and is \nreferenced in this data sheet as Current Channel A.  These inputs are fully differential voltage inputs \nwith a maximum differential level of ±0.5 V. This channel also has an internal PGA equal to the ones on Channel B and Channel C.  \n9, 12 IBP , IBN Analog Inputs for Current Channel B. This channe l is used with the current transducers and is \nreferenced in this data sheet as Current Channel B. These inputs are fully differential voltage inputs \nwith a maximum differential level of ±0.5 V. This channel also has an internal PGA equal to the ones \non Channel C and Channel A. \n13, 14 ICP , ICN Analog Inputs for Current Channel C. This channe l is used with the current transducers and is \nreferenced in this data sheet as Current Channel C.  These inputs are fully differential voltage inputs \nwith a maximum differential level of ±0.5 V. This channel also has an internal PGA equal to the ones on Channel A and Channel B. \n15, 16 INP , INN Analog Inputs for Neutral Current Channel N. This channel is used with the current transducers and \nis referenced in this data sheet as Current Chan nel N. These inputs are fully differential voltage \ninputs with a maximum differential level of ±0.5 V.  This channel also has an  internal PGA, different \nfrom the ones found on the A, B, and C channels.  \n17 REF IN/OUT   This pin provides access to the on-chip voltage reference. The on-chip reference has a nominal \nvalue of 1.2 V. An external reference source with 1.2 V ± 8% can also be connected at this pin. In \neither case, decouple this pin to AGND with a 4.7 μF capacitor in parallel with a ceramic 100 nF capacitor. After reset, the on-chip reference is enabled. \nData Sheet  ADE7880  \n \nPin No.  Mnemonic  Description  \n18, 19,  22, 23  VN, VCP , VBP , VAP   Analog Inputs for the Voltage Channel. This channel is used with the voltage transducer and is \nreferenced as the voltage channel in this data sheet . These inputs are single -ended voltage inputs \nwith a maximum signal lev el of ±0.5 V with respect to VN for specified operation. This channel also \nhas an internal PGA.  \n24 AVDD  2.5 V Output of the Analog Low Dropout (LDO) Regulator. Decouple this pin with a 4.7 μF capacitor \nin parallel with a ceramic 220 nF capacitor. Do not  connect external active circuitry to this pin.  \n25 AGND  Ground Reference. This pin provides the ground reference for the analog circuitry. Tie this pin to the \nanalog ground plane or to the quietest ground reference in the system. Use t his quiet ground \nreference for all analog circuitry, for example, antialiasing filters, current, and voltage transducers.  \n26 VDD Supp ly Voltage. This pin provides the supply voltage. In PSM0 (normal power mode) , maintain  the \nsupply voltage at 3.3 V ± 10% for specified oper ation. In PSM1 (reduced power mode), PSM2 (low \npower mode) , and PSM3 (sleep mode), when th e ADE7880 is supplied from a battery, maintain the \nsupply voltage between 2.4  V and 3.7 V. Decouple this pin to DGND with a 10 µF capacitor in parallel \nwith  a ceramic 100  nF capacitor.  \n27 CLKIN Master Clock. An external clock can be provided at this logic input. Alternatively, a parallel resonant \nAT-cut crystal can be connected across CLKIN and CLKOUT to pr ovide a clock source for the ADE7880 . \nThe clock frequency for specified operation is 16.384 MHz. Use c eramic load capacitors of a few tens \nof picofarad with the gate oscillator circuit. Refer to the data sheet of the crystal manufacturer for \nload capacitance requirements.  \n28 CLKOUT  A crystal can be connected across this pin and CLKIN (as previously described with Pin 27 in this \ntable) to provide a clock source for the ADE7880 .  \n29, 32  IRQ0 , IRQ1   Interrupt Request Outputs. These are active low logic outputs. See the Interrupts  section for a \ndetailed presentation of the event s that can trigger interrupts.  \n33, 34, 35 CF1,  CF2/HREADY , \nCF3/HSCLK  Calibration Frequency (CF) Logic Outputs. These outputs p rovide power information based on the \nCF1SEL[2:0], CF2SEL[2:0], and CF3SEL[2:0] bits in the CFMODE register. These outputs are us ed for  \noperational and calibration purposes. The full -scale  output frequency can be scaled by writing to \nthe CF1DEN, CF2DEN, and CF3DEN registers, respectively (see the Energy -to-Frequency Conversion  \nsection). CF2 is multiplexed  with the HREADY signal generated by the harmonic calculations block. \nCF3 is multiplexed with the serial clock output of the HSDC port.  \n36 SCLK/SCL  Serial Clock Input for SPI Port/Serial Clock Input for I2C Port. All serial data transfers are synchronized  \nto this clock (see the Serial Interfaces  section). This pin has a Schmidt trigger input for use with a \nclock source that has a slow edge transition time, for example, optoisolator outputs.  \n37 MISO/HSD  Data Out for SPI Port/Data Out for HSDC Port.  \n38 MOSI/SDA  Data In for SPI Port/Data Out for I2C Port.  \n39 SS/HSA  Slave Select for SPI Port /HSDC Port Active.  \nEP Exposed Pad  Create a similar pad on the PCB under the exposed pad. Solder the exposed pad to the pad on  the \nPCB to confer mechanical strength to the package. C onnect the pads to AGND  and  DGND . \n \nRev. C | Page 13 of 107 \nADE7880  Data Sheet  \n \nTYPICAL PERFORMANCE CHARACTERISTICS \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 1.0\n–40°C, PF = 1.0+85°C, PF = 1.0\n10193-100 \nFigure 7. Total Active Energy Error as Percentage of Reading (Gain = +1, \nPower Factor = 1) over Temperature with Internal Reference and  \nIntegrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)GAIN = +1\nGAIN = +2\nGAIN = +4\nGAIN = +8\nGAIN = +16\n10193-101 \nFigure 8. Total Active Energy Error as Percentage of Reading over Gain with \nInternal Reference and Integrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n45 47 49 51 53 55 57 59 61 63 65ERROR (%)\nLINE FREQUENCY (Hz)PF = +1.0\nPF = +0.5\nPF = –0.5\n10193-102 \nFigure 9. Total Active Energy Error as Percentage of Reading (Gain  = +1) over \nFrequency with Internal Reference and Integrator Off  0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)VDD = 2.97V\nVDD = 3.30V\nVDD = 3.63V\n10193-103 \nFigure 10. Total Active Energy Error as Percentage of Reading (Gain  = +1) \nover Power Supply with Internal Reference and Integrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 1.0\n–40°C, PF = 1.0+85°C, PF = 1.0\n10193-104 \nFigure 11. Total Active Energy Error as Percentage of Reading (Gain  = +16) \nover Temperature with Internal Reference and Integrator On  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 1.0\n–40°C, PF = 1.0+85°C, PF = 1.0\n10193-105 \nFigure 12. Fundamental Active Energy Error as Percentag e of Reading  \n(Gain  = +1, Power Factor = 1) over Temperature with Internal Reference and \nIntegrator Off  \nRev. C | Page 14 of 107 \nData Sheet  ADE7880  \n \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)GAIN = +1\nGAIN = +2\nGAIN = +4\nGAIN = +8\nGAIN = +16\n10193-106 \nFigure 13. Fundamental Active Energy Error as Percentage of Reading over \nGain with Internal Reference and Integrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)VDD = 2.97V\nVDD = 3.30V\nVDD = 3.63V\n10193-107 \nFigure 14. Fundamental Active Energy Error as Percentage of Reading  \n(Gain  = +1) over Power Supply with Internal Reference and Integrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 1.0\n–40°C, PF = 1.0+85°C, PF = 1.0\n10193-108 \nFigure 15. Fundamental Active Energy Error as Percentage o f Reading  \n(Gain  = +1) over Temperature with Internal Reference and Integrator On  0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 0\n–40°C, PF = 0+85°C, PF = 0\n10193-109 \nFigure 16. Fundamental Reactive Energy Error as Percentage of Reading \n(Gain  = +1, Power Factor = 0) over Temperature with Internal Reference and \nIntegrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)GAIN = +1\nGAIN = +2\nGAIN = +4\nGAIN = +8\nGAIN = +16\n10193- 110\n \nFigure 17. Fundamental Reactive Energy Error as Percentage of Reading over \nGain with Internal Reference and Integrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n45 47 49 51 53 55 57 59 61 63 65ERROR (%)\nLINE FREQUENCY (Hz)\n10193- 111PF = 0\nPF = +0.866\nPF = –0.866\n \nFigure 18. Fundamental Reactive Energy Error as Percentage o f Reading \n(Gain  = +1) over Frequency with Internal Reference and Integrator Off  \nRev. C | Page 15 of 107 \nADE7880  Data Sheet  \n \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)VDD = 2.97V\nVDD = 3.30V\nVDD = 3.63V\n10193- 112\n \nFigure 19. Fundamental Reactive Energy Error as Percentage of Reading \n(Gain  = +1) over Power Supply with Internal Reference and Integrator Off  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 0\n–40°C, PF = 0+85°C, PF = 0\n10193- 113\n \nFigure 20. Fundamental Reactive Energy Error as Percentage of Reading \n(Gain  = +16) over Temperature with Internal Reference and Integrator On  \n0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 1.0\n–40°C, PF = 1.0+85°C, PF = 1.0\n10193- 114\n \nFigure 21. I RMS Error as Percentage of Reading (Gain  = +1) over \nTemperature with Internal Reference and Integrator Off  0.5\n–0.5–0.3–0.10.10.3\n0.01 0.1 1 10 100ERROR (%)\nPERCENTAGE OF FULL-SCALE CURRENT (%)+25°C, PF = 1.0\n–40°C, PF = 1.0+85°C, PF = 1.0\n10193- 115\n \nFigure 22. V RMS Error as a Percentage of Reading (Gain  = +1) over \nTemperature with Internal Reference \n5\n–45–40–35–30–25–20–15–10–50\n0 636057545148454239363330272421181512963GAIN ERROR\n(% ERROR RELATIVE TO FUNDAMENTAL)\nHARMONIC ORDER (55Hz FUNDAMENTAL)\n10193- 116\n \nFigure 23. Harmonic I RMS Error as a Percentage of Reading over Harmonic \nOrder, 63 Harmonics, 55  Hz Fundamental, 30 Averages per Reading, 750  ms \nSettling time, 125  µs Update Rate  \n6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193- 117\n \nFigure 24. Harmonic I RMS Error as a Percentage of Reading (Gain  = +1),  \n51 Harmoni cs, 55  Hz Fundamental, Single Reading, 750  ms Settling T ime; \n125 µs Update Rate  \nRev. C | Page 16 of 107 \nData Sheet  ADE7880  \n \n6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193- 118\n \nFigure 25. Harmonic I RMS Error as Percentage of Reading (Gain  = +1),  \n51 Harmonics, 55 Hz Fundamental, 10 Averages per Reading, 750  ms \nSettling Time, 125  µs Update Rate  \n6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193- 119\n \nFigure 26. Harmonic Active Power Error as  Percentage of Reading  \n(Gain  = +1), 51 Harmonics, 55 Hz Fundamental, Single Reading,  \n750  ms Settling Time, 125  µs Update Rate  6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193-120 \nFigure 27. Harmonic Active Power Error as  Percentage of Reading  \n(Gain  = +1), 51 Harmonics, 55 Hz Fundamental, 10 Averages per Reading, \n750  ms Settling Time, 125  µs Update Rate  \n6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193-121 \nFigure 28. Harmonic Reactive Power Error as  Percentag e of Reading  \n(Gain  = +1), 51 Harmonics, 55 Hz Fundamental, Single Reading, 750  ms \nSettling Time, 125  µs Update Rate  \nRev. C | Page 17 of 107 \nADE7880  Data Sheet  \n \n6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193-122 \nFigure 29. Harmonic Reactive Power Error as  Percentage of Reading  \n(Gain  = +1), 51 Harmonics, 55 Hz F undament al, 10 Averages per Reading, \n750  ms Settling Time, 125  µs Update Rate  \n6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193-123 \nFigure 30. Harmonic Apparent Power Error as Percentage of Reading  \n(Gain  = +1), 51 Harmonics, 55 Hz Fundamental, Single Reading,  \n750  ms Settling Time, 125  µs Update Rate  6\n–6–4–2024\n0.01 0.1 1 10 100MEASUREMENT ERROR (% of Reading)\nPERCENTAGE OF FULL-SCALE CURRENT (%)\n10193-124 \nFigure 31. H armonic Apparent Power Error as  Percentage of Reading  \n(Gain  = +1), 51 Harmonics, 55 Hz Fundamental, 10 Averages per Reading, \n750  ms Settling Time, 125  µs Update Rate  \n \n \n \n \n \n \n  \n \n \n \nRev. C | Page 18 of 107 \nData Sheet  ADE7880  \n \nTEST CIRCUIT  \nIn Figure 32, the PM1 and PM0 pins are pulled up internally to VDD. Select the mode of operation by using a microcontroller to \nprogrammatically change the pin values. See the Power Management  section for details . \nSAME AS\nCF2PM00.22µF 4.7µF\nMOSI/SDA\nMISO/HSD\nSCLK/SCL\nCF3/HSCLK\nCF2\nCF1\nREF IN/OUT\nCLKOUT\nCLKINPM1\nRESET\nIAP\nIAN\nIBP\nIBN\nICP\nICN\nVN\nVCP\nVBP\nVAP2\n233\n4\n7\n8\n9\n12\n13\n14\n18\n19\n2239\n38\n37\n36\n35\n34\n33\n32\n29\n17\n28\n27ADE788024 26 5AVDD\nVDD\nDVDD\n6 25DGND\nAGND0.22µF 4.7µF\n0.1µF 4.7µF++ +0.1µF 10µF+\nSAME AS\nVCP\nSAME AS\nVCPSAME AS\nIAP, IANSAME AS\nIAP, IAN\n2.2nF 1kΩ1kΩ1kΩ10kΩ\n1kΩ 2.2nF3.3V3.3V\n1µF\n2.2nF2.2nFSS/HSA\nIRQ1\nIRQ0\n10193-0071.5kΩ3.3V\nCL2\nCL116.384MHz 5MΩ\n \nFigure 32. Test Circuit   \n \n \nRev. C | Page 19 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 20 of 107 TERMINOLOGY \nMeasurement Error \nThe error associated with the energy measurement made by the \nADE7880  is defined by  \nMeasurement Error  = \n% 1007880\uf0b4\uf02d\nEnergy TrueEnergy True ADE by Registered Energy(1) \nPower Supply Rejection (PSR) \nThis quantifies the ADE7880  measurement error as a percen-\ntage of reading when the power supplies are varied. For the ac PSR measurement, a reading at nominal supplies (3.3 V) is taken. A second reading is obtained with the same input signal \nlevels when an ac signal (120 mV rms at 100 Hz) is introduced \nonto the supplies. Any error introduced by this ac signal is expressed as a percentage of reading (see the Measurement \nError definition). \nFor the dc PSR measurement, a reading at nominal supplies \n(3.3 V) is taken. A second reading is obtained with the same input signal levels when the power supplies are varied ±10%. \nAny error introduced is expressed as a percentage of the \nreading. \nADC Offset  \nADC offset refers to the dc offset associated with the analog inputs to the ADCs. It means that with the analog inputs connected to AGND, the ADCs still see a dc analog input signal. The magnitude of the offset depends on the gain and \ninput range selection. The high-pass filter (HPF) removes the \noffset from the current and voltage channels; therefore, the \npower calculation remains unaffected by this offset. \nGain Error \nThe gain error in the ADCs of the ADE7880  is defined as the \ndifference between the measured ADC output code (minus the offset) and the ideal output code (see the Current Channel ADC \nsection and the Voltage Channel ADC section). The difference \nis expressed as a percentage of the ideal code.  \nCF Jitter \nThe period of pulses at one of the CF1, CF2, or CF3 pins is continuously measured. The maximum, minimum, and average \nvalues of four consecutive pulses are computed as follows: Maximum  = max (Period\n0, Period 1, Period 2, Period 3) \nMinimum  = min(Period 0, Period 1, Period 2, Period 3) \nAverage  = 43 2 1 0 Period Period Period Period \uf02b \uf02b \uf02b \nThe CF jitter is then computed as \n% 100\uf0b4\uf02d\uf03dAverageMinimum MaximumCFJITTER  (2) \nSignal-to-Noise Ratio (SNR) \nSNR is the ratio of the rms value of the actual input signal to the rms sum of all other spectral components below 3.3 kHz, excluding harmonics and dc. The input signal contains only the fundamental component. The spectral components are calculated over a 2 sec window. The value for SNR is expressed in decibels. \nSignal-to-Noise-and-Distortion (SINAD) Ratio \nSINAD is the ratio of the rms value of the actual input signal to the \nrms sum of all other spectral components below 3.3 kHz, including harmonics but excluding dc. The input signal contains only the fundamental component. The spectral components are calculated over a 2 sec window. The value for SINAD is expressed in decibels. \nHarmonic Power Measurement Error \nTo measure the error in the harmonic active and reactive power \ncalculations made by the ADE7880 , the voltage channel is supplied \nwith a signal comprising a fundamental and one harmonic component with amplitudes equal to 250 mV . The current channel is supplied with a signal comprising a fundamental with amplitude of 50 mV and one harmonic component of the \nsame index as the one in the voltage channel. The amplitude of \nthe harmonic is varied from 250 mV , down to 250 μV , 2000 times \nlower than full scale.  \nThe error is defined by \nMeasurement Error  = \n% 1007880\uf0b4\uf02d\nPower TruePower True ADE by Registered Power (3) \n  \n  \nData Sheet  ADE7880  \n \nPOWER MANAGEMENT  \nThe ADE7880 has four modes of operation, determined by the \nstate of the PM0 and PM1 pins  (see Table 8). These pins provide \ncomplete control of the ADE7880 operation and can easily be \nconnected to an external microprocessor I/O. The PM0 and \nPM1 pins have int ernal pull -up resistors. See Table 10 and Table 11 \nfor a list of actions that are recommended  before and after setting \na new power mode.  \nTable 8. Power Supply Modes  \nPower Supp ly Modes  PM1  PM0  \nPSM0, Normal Power Mode  0 1 \nPSM1, Reduced Power Mode  0 0 \nPSM2, Low Power Mode  1 0 \nPSM3, Sleep Mode  1 1 \nPSM0 —NORMAL POWER MODE  (ALL PARTS)  \nIn PSM0 mode, the ADE7880 is fully functional. For the ADE7880 \nto enter this mode , the PM0 pin is set to high, and the PM1 pin \nis set to low . If the ADE7880 is in PSM1, PSM2, or PSM3 mode \nand is switched into PSM0 mode, then all control registers take \nthe default values with the exception of the threshold register,  \nLPOILVL, which is used in PSM2 mode , and the CONFIG2 \nregister, both of which maintain their values.  \nThe ADE7880 signals  the end of the transition period by triggering  \nthe IRQ1  interrupt pin low and setting Bit  15 (RSTDONE) in the \nSTATUS1 register to 1. This bit is 0 during the transi tion period \nand becomes 1 when the transition is finished. The status bit is \ncleared and the IRQ1  pin is set back to high by writing to the \nSTATUS1 register with the corresponding bit set to 1. Bit 15 \n(RSTDONE) in the interrupt mask regis ter does not have any \nfunctionality attached even if the IRQ1  pin goes low when Bit  15 \n(RSTDONE) in the STATUS1 register is set to 1. This makes the \nRSTDONE interrupt unmaskable.  \nPSM1 —REDUCED POWER MODE  \nIn the reduced power mode, PSM1, t he ADE7880 measures  the \nmean absolute values (mav) of  the 3 -phase currents and store s \nthe results in the AIMAV , BIMAV , and CIMAV 20- bit registers. \nThis mode is useful in missing neutral cases in which the voltage \nsupply of the ADE7880 is provided by an external battery. The \nserial ports, I2C or SPI, are enabled in this mode ; the active port \ncan be used to read the AIMAV , BIMAV , and CIM AV registers. \nDo not  read any of the other registers as their values are not \nguaranteed  in this mode. Similarly, the ADE7880 does not take a  \nwrite operation  into account by in this mode.  \nIn summar y, in this mode, it is not recommended to access any \nregister other than AIMAV , BIMAV , and CIMAV . The circuit that computes  the rms estimates is also active during PSM0; \ntherefore, its calibration  can be completed in either PSM0 mode \nor in PSM1 mode. Note that the ADE7880 does not provide any \nregister to store or process the corrections resulting from the  \ncalibration process. The external microprocessor store s the gain \nvalues  in connection with th ese measurements and use s them during PSM1 (see the  Current Mean Absolute Value Calculation  \nsectio n for more details on the xIMAV registers).  \nThe 20 -bit mean absolute value measurements done in PSM1, \nalthough also available in PSM0, are different from the rms meas -\nurements  of phase currents and voltages executed only in PSM0 \nand stored in the HxIRMS and HxVRMS 24 -bit registers. See \nthe Current Mean Absolute Value Calculation  section for details.  \nIf the  ADE7880 is set in PSM1 mode after being  in PSM0  mode , \nthe ADE7880 begin s the mean absolute value calculations without  \nany delay. The xIMAV registers are accessible at any time; however, \nif the ADE7880 is set in PSM1 mode after being  in PSM2 or  \nPSM3 modes, the ADE7880 signals  the start of the mean absolute \nvalue computations by triggering the \nIRQ1  pin low. The xIMAV \nregisters can be accessed only after this moment.  \nPSM2 —LOW POWER MODE   \nIn the low power mode, PSM2, the ADE7880 compare s all \nphase currents against a threshold for a period of 0.02 × (LPLINE [4:0]  + 1) seconds, independent of the line frequency. \nLPLINE [4:0]  are Bits[7:3] of the LPOILVL register (see Table  9).  \nTable 9. LPOILVL Register  \nBit  Mnemonic  Default  Description  \n[2:0]  LPOIL [2:0]  111 Threshold is put at a value \ncorresponding to full scale \nmultiplied by LPOIL/8  \n[7:3]  LPLINE [4:0]  00000  The measurement period is \n(LPLINE [4:0]  + 1)/50 sec  \nThe threshold is derived from Bits[2:0] (LPOIL [2:0] ) of the \nLPOILVL register as LPOIL[2:0] /8 of full scale. Every  time  \none phase current becomes greater than the threshold, a \ncounter i s incremented. If every phase counter remains belo w \nLPLIN E[4:0]  + 1 at the end of the measurement period, then \nthe IRQ0  pin is triggered low. If a single phase counter becomes \ngreater or equal to LPLINE[4:0] + 1 at the end of the measurement  \nperiod, the IRQ1  pin is triggered l ow. Figure 33 illustrates how \nthe ADE7880 behave s in PSM2 mode when LPLINE [4:0]  = 2 \nand LPOIL[2:0] = 3. The test period is three 50  Hz cycles (60  ms), \nand the Phase A cu rrent rises above the LPOIL [2:0]  threshold three \ntimes. At the end of the test period, the IRQ1  pin is triggered low .  \nPHASE\nCOUNTER = 1PHASECOUNTER = 2PHASECOUNTER = 3LPLINE[4:0] = 2\nIRQ1IA CURRENTLPOIL[2:0]\nTHRESHOLD\n10193-008 \nFigure 33. PSM2 Mode Triggering IRQ  Pin for LPLINE[4:0] = 2 (50  Hz Systems)  \nRev. C | Page 21 of 107 \nADE7880  Data Sheet  \n \nVREFIxP\nIxN\nTAMPER\nINDICATION+Vp-p\n–V p-p\n–V p-p/2–V p-p/2+Vp-p/2\n+Vp-p/2\nPEAKDETECTCIRCU ITIxP–IxN\nIxP(a)\n(b)\n10193-134 \nFigure 34. PSM2 Low Power Mode Peak Detection  \nThe PSM2 level threshold comparison works based on a peak \ndetection methodology. The peak detect circuit makes the comparison based on the positive terminal current channel input, I\nAP, IBP, and I CP (see Figure 34). In case of differential \ninputs being applied to the current channels, Figure 34 shows \nthe differential antiphase signals at each of the cu rrent input \nterminals, I xP and I xN, and the net differential current, I xP − I xN. \nThe I2C or SPI port is not functional during this mode. The PSM2  \nmode reduces the power consumption required to monitor the currents when there is no voltage input and the vol tage supply \nof the ADE7880 is provided by an external battery. If the IRQ0  \npin is triggered low at the end of a measurement period,  it signifies  \nall phase currents stayed below threshold and , therefore , there is \nno current flowing through the system. At this point, the external  \nmicroprocessor sets the ADE7880 into sleep mode PSM3. If the \nIRQ1  pin is tr iggered low at the end of the measurement period, \nit signifies that at least one current input is above the defined \nthreshold and current is flowing through the system, although \nno voltage is present at the ADE7880 pins. This situation is often  \ncalled missing neutral and is considered a tampering situation, \nat which point the external microprocessor set s the ADE7880 \ninto PSM1 mode, measu res the mean absolute values of phase \ncurrents, and integrate s the energy  based on their values and the \nnominal voltage.  \nIt is recommended to use the ADE7880 in PSM2 mode when \nBits[2:0] (PGA1 [2:0]) of the Gain register are equal to 1 or 2. \nThese bits represent the gain in the current channel  data path . It \nis not recommended to use the ADE7880 in PSM2 mode when \nthe PGA1 [2:0] bits are equa l to 4, 8, or 16.  \nPSM3 —SLEEP MODE  (ALL PARTS)  \nIn sleep  mode, the ADE7880 has most of its  internal circuits \nturned off and the current consumption is at its lowest level. The I\n2C, HSDC, and SPI po rts are not functiona l during this \nmode, and the RESET , SCLK/SCL, MOSI/SDA, and SS/HSA pins \nmust  be set high.  \nTable 10. Power Modes and Related Characteristics  \nPower Mode  All Registers1 LPOILVL, CONFIG2  I2C/SPI  Functionality  \nPSM0      \nState After Hardware Reset  Set to default  Set to default  I2C enabled  All circuits are active and DSP is in idle \nmode . \nState After Software Reset  Set to default  Unchanged  Active serial port  is \nunchanged if lock -in \nprocedure has been \npreviously executed  All circuits are active and DSP is in idle \nmode.  \nPSM1 Not available  PSM0 values retained  Enabled  Current mean absolute values are \ncomputed and the results are stored \nin the AIMAV, BIMAV, and CIMAV registers. The I\n2C or SPI serial port  is \nenabled  with limited functionality. \nPSM2  Not available  PSM0 values retained  Disabled  Compares phase currents against the \nthreshold set in LPOILVL. Triggers \nIRQ0 or IRQ1  pins accordingly. The \nserial p orts are not available.  \nPSM3  Not available  PSM0 values retained  Disabled  Internal circuits shut down and the \nserial ports are not available.  \n1 Setting for all registers except the  LPOILVL and CONFIG2 registers.  \nRev. C | Page 22 of 107 \nData Sheet  ADE7880  \n \nTable 11. Recommen ded Actions When Changing Power Modes  \nInitial Power \nMode  Before Setting Next  \nPower Mode  Next Power Mode  \nPSM0  PSM1  PSM2  PSM3  \nPSM0  Stop DSP by setting the \nRun register  = 0x0000   Current mean absolute \nvalues (mav) computed \nimmediately  Wait until the  IRQ0  \nor IRQ1  pin is \ntriggered \naccordingly  No action \nnecessary  \nDisable HSDC by clearing \nBit 6 (HSD CEN) to 0 in the \nCONFIG register  xIMAV registers can  be \naccessed immediately  \nMask interrupts by setting MASK0 = 0x0 and  \nMASK1 = 0x0   \nErase interrupt status flags in the STATUS0 and STATUS1 \nregister s  \nPSM1  No action necessary  Wait until  the IRQ1  pin \nis triggered low   Wait until  the IRQ0  \nor IRQ1  pin is \ntriggered \naccordingly  No action \nnecessary  \nPoll the STATUS1 \nregister until Bit 15 \n(RSTDONE) is set to 1  \nPSM2 No action necessary  Wait until  the IRQ1  pin \nis triggered low  Wait until  the IRQ1  pin \ntriggered low   No action neces sary  \nPoll the STATUS1 \nregister until Bit 15 \n(RSTDONE) is set to 1  Current mean absolute \nvalues compute at this \nmoment  \n xIMAV registers may be accessed from this \nmoment  \nPSM3  No action necessary  Wait until the IRQ1  pin \nis trigger ed low  Wait until  the IRQ1  pin is \ntriggered low  Wait until  the IRQ0  \nor IRQ1  pin is \ntriggered accordingly   \nPoll the STATUS1 \nregister  until Bit 15 \n(RSTDONE) is set to 1  Current mav  circuit \nbegins compu tations at \nthis time  \n xIMAV  registers c an be \naccessed from this \nmoment  \n \nRev. C | Page 23 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 24 of 107 POWER-UP PROCEDURE \nPOR TIMER\nTURNED ONMICROPROCESSOR\nMAKES THE\nCHOICE BETWEEN\nI2C AND SPIRSTDONE\nINTERRUPT\nTRIGGERED~40ms ~26ms0V3.3V – 10%\n2.0V ± 10%ADE7880\nPSM0 READY\n10193-009MICROPROCESSOR\nSETS PM1 PIN TO 0;\nAPPLY VDD TO CHIPADE7880\nFULLY\nPOWERED UPVDD\n \nFigure 35. Power-Up Procedure  \nThe ADE7880  contains an on-chip power supply monitor that \nsupervises the power supply (VDD). At power-up, the device is \ninactive until VDD reaches 2.0 V ± 10%. When VDD crosses this threshold, the power supply monitor keeps the device in the \ninactive state for an additional 26 ms to allow VDD to rise to \n3.3 V − 10%, the minimum recommended supply voltage.  \nThe PM0 and PM1 pins have internal pull-up resistors, but it is \nnecessary to set the PM1 pin to Logic 0, either through a micro-controller or by grounding the PM1 pin externally, before powering up the chip. The PM0 pin can remain open as it is held high, due to the internal pull-up resistor. This ensures that the ADE7880  \nalways powers up in PSM0 (normal) mode. The time from the chip being powered up completely to all functionality being enabled is about 40 ms (see Figure 35). It is necessary to ensure that the RESET\n pin is held high during the entire power-up procedure.  \nIf PSM0 mode is the only desired power mode, the PM1 pin can be tied to ground externally. When the ADE7880  enters PSM0 \nmode, the I\n2C port is the active serial port. To use the SPI port, \ntoggle the SS/HSA pin three times from high to low. \nTo lock I2C as the active serial port, set Bit 1 (I2C_LOCK) of the \nCONFIG2 register to 1. From this moment, the device ignores \nspurious toggling of the SS/HSA pin, and a switch to the SPI \nport is no longer possible. \nIf SPI is the active serial port, any write to the CONFIG2 register \nlocks the port, and a switch to the I2C port is no longer possible. \nTo use t he I2C port, the ADE7880  must be powered down or the \ndevice must be reset by setting the RESET  pin low. After the serial \nport is locked, the serial port selection is maintained when the \ndevice changes from one PSMx power mode to another. \n    Immediately after entering PSM0  mode, all registers in the \nADE7880  are set to their default values, including the \nCONFIG2 and LPOILVL registers. \nThe ADE7880  signals the end of the transition period by pulling \nthe IRQ1\n interrupt pin low and setting Bit 15 (RSTDONE) in \nthe STATUS1 register to 1. This bit is cleared to 0 during the \ntransition period and is set to 1 when the transition ends. \nWriting the STATUS1 register with the RSTDONE bit set to 1 \nclears the status bit and returns the IRQ1  pin high. Because \nRSTDONE is an unmaskable interrupt, Bit 15 (RSTDONE) in the STATUS1 register must be cancelled for the IRQ1\n pin to \nreturn high. Wait until the IRQ1  pin goes low before accessing \nthe STATUS1 register to test the state of the RSTDONE bit. At \nthis point, as a good programming practice, cancel all other \nstatus flags in the STATUS1 and STATUS0 registers by writing \nthe corresponding bits with 1. \nInitially, the DSP is in idle mode and, therefore, does not execute \nany instructions. This is the moment to initialize all registers in the ADE7880 . See the Digital Signal Processor section for the \nproper procedure to initialize all registers and start the metering. \nIf the supply voltage, VDD, falls lower than 2.0 V ± 10%, the \nADE7880  enters an inactive state, which means that no \nmeasurements or computations are executed. \nIf the RESET\n pin is held low while the IC powers up or if the \npower-up sequence timing cannot be maintained as per \nFigure 35, perform the following sequence of write operations \nprior to starting the DSP (setting the RUN register to 0x01), to \nensure that the modulators are reset properly.  \n1. 8-bit write: 0xAD is written at Address 0xE7FE. \n2. 8-bit write: 0x14 is written at Address 0xE7E2. \n3. Wait 200 μs. \n4. 8-bit write: 0xAD is written at Address 0xE7FE. \n5. 8-bit write: 0x04 is written at Address 0xE7E2. \n \nData Sheet  ADE7880  \n \nHARDWARE RESET  \nThe ADE7880 has a RESET  pin. If the ADE7880 is in PSM0 \nmode and the RESET  pin is set low, then the ADE7880 enters \nthe hardware reset state. The ADE7880 must be in PSM0 mode \nfor a hardware reset to be considered. Setting the RESET  pin \nlow while the ADE7880 is in PSM1, PSM2, and PSM3 modes \ndoes not have any effect.  \nIf the ADE7880 is in PSM0 mode and the RESET  pin is toggled \nfrom high to low and then back to high after at least 10 µs, all the \nregisters are set to their default values, including the CONFIG2  and \nLPOILVL registers. The ADE7880 signals the end of the transition \nperiod by triggering  the IRQ1  interrupt pin  low and setting Bit 15 \n(RSTDONE) in the STATUS1 register to 1. This bit is 0 during the  \ntransition period and bec omes 1 when the transition ends. The \nstatus bit is cleared and the IRQ1  pin is returned hig h by writing \nto the STATUS1 register with the corresponding bit set to 1.   \nAfter a hardware reset, the DSP is in idle mode, which means it \ndoes not execute any instruction.  \nBecause  the I2C port is the default serial port of the  ADE7880 , it \nbecomes  active after a reset state. If SPI is the port used by the \nexternal microprocessor, the procedure to enable it must be \nrepeated immediately after the RESET  pin is toggled back to \nhigh (see the Serial Interfaces  section for details).  \nAt this point, it is recommended to initialize all of the ADE7880 \nregisters and then write 0x0001 into the R un register  to start the \nDSP . See the Digital Signal Processor  section for details on the \nRun register.  SOFTWARE RESET FUNCT IONALITY  \nBit 7 (SWRST) in the CONFIG register manages the soft ware \nreset functionality in PSM0 mode. The default val ue of this bit is 0. \nIf this bit is set to 1, then the ADE7880 enter s the software  reset \nstate. In this state, almost all internal registers are set to their default value s. In addition, the choice of wh ich serial port, I\n2C or \nSPI, is in use remains unchanged  if the lock -in procedure has \nbeen executed previously (see the Serial Interfaces  section for \ndetails) . The registers that maintain their values despite the \nSWRST bit  being set to 1 are the CONFIG2 and LPOILVL  \nregisters. When the software reset ends, Bit 7 (SWRST) in the \nCONFIG  register  is cleared to 0, the IRQ1  interrupt pin is set \nlow, and Bit 15 (RSTDONE) in the STATUS1 register is set to 1. \nThis b it is 0 during the transition period and becomes 1 when \nthe transition ends. The status bit is cleared and the IRQ1  pin is \nset back high by writing to the STATUS1 register with the \ncorresponding bit set to 1.  \nAfter a software reset ends, the DSP is in idle mode, which means  it \ndoes not execute any instruction. As a good programming  practice, \nit is recommended to initialize all the ADE7880 registers and \nthen write 0x0001 into the R un register to start the DSP (see the \nDigital Signal Processor  section for details on the R un register).  \nSoftware reset functionality is not available in PSM1, PSM2, or \nPSM3 mode.  \n \nRev. C | Page 25 of 107 \nADE7880  Data Sheet  \n \nTHEORY OF OPERATION \nANALOG INPUTS  \nThe ADE7880 has seven analog inputs forming current and  \nvoltage channels . The current channels consist of four pairs of \nfully differential voltage inputs: IAP and IAN, IBP and IBN, ICP \nand ICN, and INP and I NN. These voltage input pairs have a \nmaximum differential signal of ±0.5  V.   \nThe maximum signal level on analog inputs for the IxP/IxN  \npair is also ±0.5 V with respect to AGND. The maximum \ncommon -mode signal allowed on the inputs is ±25 mV . Figure 36 \nprese nts a schematic of the input for the current channels and \ntheir relation to the maximum common -mode voltage.  \nIAP, IBP,\nICP, OR INP\nIAN, IBN,\nICN, OR INNVCM V2V1+500mV\nVCMV1+ V2DIFFERENTIAL INPUT\nV1 + V 2 = 500mV MAX PEAK\nCOMMON MODE\nVCM = ±25mV MAX\n–500mV\n10193-010 \nFigure 36. Maximum Input Level, Current Channels, Gain = 1  \nAll inputs have a programmable ga in amplifier (PGA) with a \npossible gain selection of 1, 2, 4, 8, or 16. The gain of IA, IB, and IC inputs is set in Bits[2:0] (PGA1[2:0]) of the Gain register. \nThe gain of the IN input is set in Bits[5:3] (PGA2[2:0]) of the \nGain register; thus, a different  gain from the IA, IB, or IC inputs \nis possible. See Table 43 for details on the G ain register. \nThe voltage channel has three single -ended voltage inputs: V AP , \nVBP , and VCP . These single -ended voltage inputs have a maximum  \ninput v oltage of ±0.5 V with respect to VN. T he maximum signal  \nlevel on analog inputs for VxP and VN is also ±0.5 V with respect  \nto AGND. The maximum common -mode signal allowed on the \ninputs is ±25 mV . Figure 37 presents a schematic of  the volta ge \nchannels inputs and their relation to the maximum common -\nmode voltage.  \nK × V INGAIN\nSELECTION\nIxN, VNIxP, VyP\nVIN\nNOTES\n1. x = A, B, C, N\n    y = A, B, C.\n10193-012 \nFigure 37. Maximum Input Level, Voltage Channels, Gain = 1  \nAll inputs have a programmable gain with a possible gain \nselection of 1, 2, 4, 8, or 16. To set the gain, use Bits[8:6] \n(PGA3[2:0]) in the Gain register (see Table 43). \nFigure 38 shows how the gain selection from the G ain register \nworks in both current and voltage channels.  VAP, VBP,\nOR VCP\nVNVCMV1+500mV\nVCMV1DIFFERENTIAL INPUT\nV1 + V 2 = 500mV MAX PEAK\nCOMMON MODE\nVCM = ±25mV MAX\n–500mV\n10193-0 11\n \nFigure 38. PGA in Current and Voltage Channels  \nANALOG -TO-DIGITAL CONVERSION  \nThe ADE7880 has seven sigma -delta ( Σ-Δ) analog -to-digital \nconverters (ADCs). In PSM0 mode, all ADCs are active. In \nPSM1 mode, only the ADCs that measure the Phase A, Phase B, \nand Phase  C currents are active. The ADCs that  measure the \nneutral current and the A, B, and C phase voltages are turned off. In PSM2 and PSM3 modes, the ADCs are powered down to minimize power consumption.  \nFor simplicity, the block diagram in Figure 39 shows a first -order  \nΣ-Δ ADC. The converter is composed of the Σ -Δ modulator \nand the digital low -pass filter.  \n24R\nC+\n–CLKIN/16\nDIGITAL\nLOW-PASS\nFILTERINTEGRATOR\nVREF\n1-BIT DACLATCHED\nCOMPARATORANALOG\nLOW-PASS FILTER\n.....10100101.....+\n–\n10193-013 \nFigure 39. First -Order Σ-∆ ADC  \nA Σ-Δ modulator converts the input signal into a continuous \nserial stream of 1s and 0s at a rate determined b y the sampling \nclock. In the ADE7880, the sampling clock is  equal to 1.024 MHz  \n(CLKIN/16). The 1 -bit DAC in the feedback loop is driven by \nthe serial data stream. The DAC output is subtracted fro m the \ninput signal. If the loop gain is high enough, the average value of the DAC output (and , therefore , the bit stream) can approach \nthat of the input signal level. For any given input value in a single  \nsampling interval, the data from the 1 -bit ADC is virtually mean -\ningless . Only when a large number of samples are  averaged is a \nmeaningful result obtained. This averaging is carried out in the second part of the ADC, the digital low -pass filter. By averaging \na large number of bits from the modulator, the l ow-pass filter \ncan produce 24 -bit data -words that are proportional to the \ninput signal level.  \nRev. C | Page 26 of 107 \nData Sheet ADE7880\n \nRev. C | Page 27 of 107 The Σ-Δ converter uses two techniques to achieve high resolu-\ntion from what is essentially a 1-bit conversion technique. The first is oversampling. Oversampling means that the signal is sampled at a rate (frequency) that is many times higher than  \nthe bandwidth of interest. For example, the sampling rate in  \nthe ADE7880  is 1.024 MHz, and the bandwidth of interest is \n40 Hz to 3.3 kHz. Oversampling has the effect of spreading the quantization noise (noise due to sampling) over a wider bandwidth. With the noise spread more thinly over a wider \nbandwidth, the quantization noise in the band of interest is \nlowered, as shown in Figure 40. However, oversampling alone is not efficient enough to improve the signal-to-noise ratio (SNR) in the band of interest. For example, an oversampling factor of 4 is required just to increase the SNR by a mere 6 dB (1 bit). To keep the oversampling ratio at a reasonable level, it is possible to \nshape the quantization noise so that the majority of the noise \nlies at the higher frequencies. In the Σ-Δ modulator, the noise is shaped by the integrator, which has a high-pass-type response for the quantization noise. This is the second technique used to achieve high resolution. The result is that most of the noise is at \nthe higher frequencies where it can be removed by the digital \nlow-pass filter. This noise shaping is shown in Figure 40. \nNOISESIGNAL\nNOISESIGNAL03 . 3 4 5 1 2\nFREQUENCY (kHz)\nHIGH RESOLUTION\nOUTPUT FROMDIGITAL LPF1024\n03 . 3 4 5 1 2\nFREQUENCY (kHz)1024DIGITAL FILTER\nSHAPED NOISEANTIALIAS FILTE\nR\n(RC)\nSAMPLINGFREQUENCY\n10193-014 \nFigure 40. Noise Reduction Due to Oversampling and \nNoise Shaping in the Analog Modulator \nAntialiasing Filter \nFigure 39 also shows an analog low-pass filter (RC) on the input \nto the ADC. This filter is placed outside the ADE7880 , and its role \nis to prevent aliasing. Aliasing is an artifact of all sampled systems \nas shown in Figure 41. Aliasing means that frequency components in the input signal to the ADC, which are higher than half the sampling rate of the ADC, appear in the sampled signal at a \nfrequency below half the sampling rate. Frequency components \nabove half the sampling frequency (also known as the Nyquist frequency, that is, 512 kHz) are imaged or folded back down \nbelow 512 kHz. This happens with all ADCs regardless of the architecture. In the example shown, only frequencies near the sampling frequency, that is, 1.024 MHz, move into the band of interest for metering, that is, 40 Hz to 3.3 kHz. To attenuate the high frequency (near 1.024 MHz) noise and prevent the distortion of the band of interest, a low-pass filter (LPF) must be introduced. \nFor conventional current sensors, it is recommended to use one \nRC filter with a corner frequency of 5 kHz for the attenuation to be sufficiently high at the sampling frequency of 1.024 MHz. The 20 dB per decade attenuation of this filter is usually sufficient to eliminate the effects of aliasing for conventional current sensors. \nHowever, for a di/dt sensor such as a Rogowski coil, the sensor \nhas a 20 dB per decade gain. This neutralizes the 20 dB per decade attenuation produced by the LPF. Therefore, when using a di/dt sensor, take care to offset the 20 dB per decade gain. One simple approach is to cascade one additional RC filter, thereby \nproducing a −40 dB per decade attenuation. \nALIASING EFFECTSSAMPLING\nFREQUENCY\nIMAGE\nFREQUENCIES0 3.3 4 512\nFREQUENCY (kHz)1024\n10193-015 \nFigure 41. Aliasing Effects  \nADC Transfer Function \nAll ADCs in the ADE7880  are designed to produce the same \n24-bit signed output code for the same input signal level. With a \nfull-scale input signal of 0.5 V and an internal reference of 1.2 V , \nthe ADC output code is nominally 5,326,737 (0x514791) and usually varies for each ADE7880  around this value. The code \nfrom the ADC can vary between 0x800000 (−8,388,608) and 0x7FFFFF (+8,388,607); this is equivalent to an input signal \nlevel of ±0.787 V . However, for specified performance, do not \nexceed the nominal range of ±0.5 V; ADC performance is \nguaranteed only for input signals lower than ±0.5 V . \nCURRENT CHANNEL ADC \nFigure 42 shows the ADC and signal processing path for Input \nIA of the current channels (it is the same for IB and IC). The \nADC outputs are signed twos complement 24-bit data-words and are available at a rate of 8 kSPS (thousand samples per \nsecond). With the specified full-scale analog input signal  \nof ±0.5V , the ADC produces its maximum output code value. Figure 42 shows a full-scale voltage signal applied to the differ-ential inputs (IAP and IAN). The ADC output swings between −5,326,737 (0xAEB86F) and +5,326,737 (0x514791). Note that these are nominal values and every ADE7880  varies around \nthese values. The input, IN, corresponds to the neutral current of a 3-phase system. If no neutral line is present, connect this input to AGND. The data path of the neutral current is similar \nto the path of the phase currents as shown in Figure 43. \n \nADE7880  Data Sheet  \n \nAIGAIN[23:0]DSP\nREFERENCE HPFEN BIT\nCONFIG3[0]DIGITAL\nINTEGRATORINTEN BIT\nCONFIG[0]\nTOTAL/FUNDAMENTAL\nACTIVE AND REACTIVE\nPOWER CALCULATIONCURRENT PEAK,\nOVERCURRENT\nDETECT\nIAWV WAVEFORM\nSAMPLE REGISTERCURRENT RMS (IRMS)\nCALCULATION\nHPFADC PGA1IAPZX DETECTION\nPGA1 BITS\nGAIN[2:0]\n×1, ×2, ×4, ×8, ×16\nVIN\nVINIAN\nANALOG INPUT RANGE0x514791 =\n+5,326,737ZX SIGNALDATA RANGE\n0V\n0xAEB86F =\n–5,326,737\nCURRENT CHANNEL\nDATA RANGE\n+0.5V/GAIN\n–0.5V/GAIN0VLPF1\n10193-0160x514791 =\n+5,326,737\n0V\n0xAEB86F =\n–5,326,737\n \nFigure 42. Current Channel Signal Path   \n \nNIGAIN[23:0]DSP\nREFERENCE HPFEN BIT\nCONFIG3[0]DIGITAL\nINTEGRATORININTEN BIT\nCONFIG3[3]\nINWV WAVEFORM\nSAMPLE REGISTERCURRENT RMS (IRMS)\nCALCULATION\nHPFADC PGA2IAPPGA2 BITS\nGAIN[5:3]\n×1, ×2, ×4, ×8, ×16\nVIN\nIAN\n10193-017 \nFigure 43. Neutral Current Signal Path  \nCurrent Waveform Gain Registers  \nThere is a multiplier in the signal path of each phase and neutral  \ncurrent. The cu rrent waveform can be changed by ±100% by \nwriting a correspond ing twos complement number to the 24 -bit \nsigned current waveform gain registers (AIGAIN, BIGAIN,  \nCIGAIN, and NIGAIN). For example, if 0x400000 is written to \nthose registers, the ADC output is sc aled up by 50%.  To s cale \nthe input by −50%, write 0xC00000 to the registers. Equation 4  \ndescribes mathematically the function of the current waveform gain registers. \nCurrent Waveform = \n\uf8f7\uf8f7\n\uf8f8\uf8f6\n\uf8ec\uf8ec\n\uf8ed\uf8eb+×2321Register Gain Currentof ContentOutput ADC  (4) \nChanging the content of the AIGAIN, BIGAIN, CIGAIN, or \nINGA IN registers affects all calculations based on its current; \nthat is, it affects the corresponding phase active/reactive/  \napparent energy and current rms calculation. In addition, waveform samples scale accordingly.  \nNote that the serial ports of the ADE7880 work on 32 -, 16-, or \n8-bit words, and the DSP works on 28 bits. The 24 -bit AIGAIN, \nBIGAIN, CIGAIN , and NIGAIN registers are accessed as 32 -bit \nregisters with the four  most significant bits (MSBs) padded with \n0s and sign extended to 28 bits. See Figure 44 for details.  31 2827 2423 0\n24-BIT NUMBER 0000\nBITS[27:24] ARE\nEQUAL TO BIT 23BIT 23 IS A SIGN BIT\n10193-018 \nFigure 44. 24 -Bit xIGAIN Transmitted as 32 -Bit Words  \nCurrent Channel HPF  \nThe ADC outputs can contain a dc offset. This offset can create errors in power and rms calculations. High -pass filters (HPFs) \nare placed in the signal path of the phase and neutral currents and of the phase voltages. If enabled, the HPF eliminates any dc offset on the current channel. All filters are implem ented in the \nDSP and, by de fault, they are all enabled: Bit 0 (HPFEN) of the \nCONFIG3 [7:0]  register is set to 1. All filters are disabled by \nsetting Bit 0 (HPFEN) to 0.  \nRev. C | Page 28 of 107 \nData Sheet  ADE7880  \n \nCurrent Channel Sampling  \nThe waveform samples of the current channel are taken at the \noutput of HPF and stored in  the 24 -bit signed registers, IAW V,  \nIBWV , ICWV , and INWV  at a rate of 8 kSPS. All power and rms \ncalculations remain uninter rupted  during this process. Bit  17 \n(DREADY) in the STATUS0 register is set when the IAWV , IBWV , \nICWV , and  INWV  registers are available to be read using the I2C \nor SPI serial port . Setting Bit 17 (DREADY) in the MASK0 \nregister enables an interrupt to be set when the DREADY flag is set. See the Digital Signal Processor  section for more  details on \nBit DREADY .  \nAs stated  in the Current Waveform Gain Registers  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8-bit words . \nWhen the IAW V,  I BW V,  ICWV , and INWV  24-bit signed \nregisters are read from the ADE7880, they are transmitted sign \nextended to 32  bits. See Figure 45 for details.  \n31 24 2322 0\n24-BIT SIGNED NUMBER\nBITS[31:24] ARE\nEQUAL TO BIT 23BIT 23 IS A SIGN BIT\n10193-019 \nFigure 45. 24 -Bit IxWV Register Transmitted as 32- Bit Signed Word  \nThe ADE7880 contains  a high speed data capture (HSDC) port \nthat is specially designed to provide fast access to the waveform \nsamp le registers. See the  HSDC Interface  section for more details.  \ndi/dt CUR RENT SENSOR AND DIGIT AL INTEGRATOR  \nThe di/dt sensor detects changes in the magnetic field caused by \nthe ac current. Figure 46 show s the principle of a di/dt current \nsensor.  \nMAGNETIC FIELD CREATED BY CURRENT\n(DIRECTLY PROPORTIONAL TO CURRENT)\n+  EMF (ELECTROMOTIVE FORCE)\n–  INDUCED BY CHANGES IN\nMAGNETIC FLUX DENSITY (di/dt)\n10193-020 \nFigure 46. Principle of a di/dt Current Sensor \nThe flux density of a magnetic field induced by a current is \ndirectly proportional to the magnitude of the current. The changes in the magnetic flux density passing through a conductor loop generate an electromotive force (EMF) between the two ends of the loop. The EMF is a voltage signal that is propor -\ntional to the di/dt of the current. The voltage output from the di/dt current sensor is de termined by the mutual inductance \nbetween the current carrying conductor and the di/dt sensor.  \nDue to the di/dt sensor, the current signal needs to be filtered before it can be used for power measurement. On each phase and neutral current data path , there are  built -in digital integrator s to \nrecover the current signal from the di/dt sensor. The digital  \nintegrators placed on the phase currents data  paths are independent \nof the digital integrator placed in the neutral current data path. This allows for using a  different current sensor to measure the neutral \ncurrent (for example a current transformer) from the current sensors used to measure  the phase currents (for example di/dt  \nsensors). The digital integrators are managed by Bit 0 (INTEN) of the CONFIG registe r and by Bit 3 (ININT EN) of the CONFIG3 \nregister. Bit 0 (INTEN) of the CONFIG register manages the  \nintegrators in the phase current channels. Bit 3 (ININT EN) of the \nCONFIG3 register  manages the integrator in the neutral current \nchannel. When the INTEN bit is 0 (default) , all integrators in the \nphase current channels are disabled. When INTEN bit is 1, the  \nintegrators in the phase currents data  paths are enabled.  When the \nININTEN bit is 0 (default), the integrator in the neutral current channel is disabled. W hen the ININTEN bit is 1, the integrator in \nthe neutral current channel is enabled.   \nFigure 47 and Figure 48 show the magnitude and phase \nresponse of the digital integrator. \nNote that the integrator has  a −20 dB/dec attenuation and \napproximately −90° phase shift. When combined with a di/dt sensor, the resulting magnitude and pha se response is a flat gain \nover the frequency band of interest. However, the di/dt sensor has a 20 dB/dec gain associated with i t and generates significant \nhigh frequency noise. At least a  second order antialiasing filter \nis needed to avoid noise aliasing back in the band of interest when  the ADC is sampling (see the Antialiasing Filter  section).  \n50\n0\n–50\n–100–500MAGNITUDE (dB) PHASE (Degrees)\n0 500 1000 1500 2000 2500 3000 3500 4000\nFREQUENCY (Hz)0.01 0.1 1 10 100 1000\nFREQUENCY (Hz)\n10193-021 \nFigur e 47. Combined Gain and Phase Response of the  \nDigital Integrator \nThe DICOEFF 24 -bit signed register is used in the digital \nintegrator algorithm. At power -up or after a reset, its value is \n0x000000. Before turning on the integrator , this register must be \ninitialized with 0x FFF8000. DICOEFF is not used when the \nintegrator is turned off and can remain at 0x000000 in that case.  \nRev. C | Page 29 of 107 \nADE7880  Data Sheet  \n \n–30–15\n–20\n–25\n–89.96\n–89.97\n–89.98\n–89.99MAGNITUDE (dB) PHASE (Degrees)\n30 35 40 45 50 55 60 65 70\nFREQUENCY (Hz)30 35 40 45 50 55 60 65 70\nFREQUENCY (Hz)\n10193-022 \nFigure 48. Combined Gain and Phase Response of the  \nDigital Integrator ( 30 Hz to 7 0 Hz) when DICOEFF is Set to 0x00000000  \n–30–15\n–20\n–25\n–80\n–82\n–84\n–86MAGNITUDE (dB) PHASE (Degrees)\n30 35 40 45 50 55 60 65 70\nFREQUENCY (Hz)30 35 40 45 50 55 60 65 70\nFREQUENCY (Hz)\n10193-349 \nFigure 49. Combined Gain and Phase Response of the  \nDigital Integrator ( 30 Hz to 70 Hz)  when DICOEFF is Set to 0x0FFF8000  As stated in the Current Waveform Gain Reg isters  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words.  \nSimilar to the registers shown in Figure 44, the DICOEFF 24 -bit \nsigned register is a ccessed as a 32 -bit register with four MSBs \npadded with 0s and sign extended to 28 bits, which practically \nmeans it is transmitted equal to 0x 0FFF8000.  \nWhen the digital integrator is switched off, the ADE7880 can  \nbe used directly with a conventional current sensor, such as  a current transformer (CT).  \nVOLTAGE CHANNEL ADC  \nFigure 50 shows the ADC and signal processing chain for \nInput  V A in the voltage channel. The VB and V C channels  \nhave similar processing chains. The ADC outputs are signed twos complement 24 -bit words and are available at a rate of \n8 kSPS. With the specified full -scale analog input signal of  \n±0.5 V , the ADC produces its maximum output code value.  Figure 50 shows  a full- scale voltage signal b eing applied to the \ndifferential inputs  (V A and VN). The ADC output swings \nbetween − 5,326,737 (0xAEB86F)  and + 5,326,737 (0x514791) . \nNote these are nominal values and every ADE7880 varies \naround these values.  \n \n \n \nREFERENCEDSP\nTOTAL/FUNDAMENTAL\nACTIVE AND REACTIVE\nPOWER CALCULATIONVOLTAGE PEAK,\nOVERVOLTAGE,\nSAG DETECT\nVAWV WAVEFORM\nSAMPLE REGISTERCURRENT RMS (VRMS)\nCALCULATION\nADC PGA3VAP\nZX DETECTIONPGA3 BITS\nGAIN[8:6]\n×1, ×2, ×4, ×8, ×16\nVIN\nVINVN\nANALOG INPUT RANGE0x514791 =\n+5,326,737\n0V\n0xAEB86F =\n–5,326,737VOLTAGE CHANNEL\nDATA RANGE\n0x514791 =\n+5,326,737\n0V\n0xAEB86F =\n–5,326,737ZX SIGNAL\nDATA RANGE+0.5V/GAIN\n–0.5V/GAIN0VLPF1\n10193-023AVGAIN[23:0]HPFEN BIT\nCONFIG3[0]\nHPF\n \nFigure 50. Voltage Channel Data Path  \n \nRev. C | Page 30 of 107 \nData Sheet  ADE7880  \n \nVoltage Waveform Gain Registers  \nThere is a multiplier in the  signal path of each phase voltage. \nThe voltag e waveform can be changed by ±100% by writing  \na correspond ing twos complement number to the 24 -bit signed \nvoltage  waveform gain registers (AVGAIN, B VGAIN, and \nCVGAIN). For example, if 0x400000 is written to those registers , \nthe ADC output is scaled up by 50%. To scale the input by −50%,  \nwrite 0xC00000 to the registers. Equation  5 describes mathe -\nmatically the function of the current waveform gain registers.  \nVoltage Waveform = \n\uf8f7\uf8f7\n\uf8f8\uf8f6\n\uf8ec\uf8ec\n\uf8ed\uf8eb+×2321Register Gain Voltageof ContentOutput ADC  (5) \nChanging the content of the AVGAIN, BVGAIN, and CVGAIN  \nregisters affects all calculations based on its voltage; that is, it \naffects the corresponding phase active/reactive/apparent energy \nand voltage rms calculation. In addition, waveform samples are scaled accordingly.  \nAs stated  in the Current Waveform Gain Registers  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words , \nand the DSP works on 28 bits. As presented in Figure 44, the \nAVGAIN, BVGAIN, and CVGAIN registers are accessed as 32-bit registers with four MSBs padded with 0s and sign \nextended to 28 bits.  \nVoltage Channel HPF  \nAs explained in the Current Channel HPF  section, the ADC \noutputs can con tain a dc offset that can create errors in power \nand rms calculations. HPFs are placed in the signal path of the phase voltages, similar to the ones in the current channels. B it 0 \n(HPFEN) of CONFIG3 register can enable or disable the filters.  \nSee the Current Channel HPF  section for more details.  \nVoltage Channel Sampling  \nThe waveform samples of the voltage  channel are taken at the \noutput of HPF and stored into VAWV , VBWV ,  and VCWV  \n24-bit signed registers at a rate of 8 kSPS. All p ower and rms \ncalculations remain uninterrupted during this process. Bit 17 \n(DREADY) in the STATUS0  register is set when the  VAW V,  \nVBWV , and VCWV registers are available to be read using the  \nI2C or SPI serial port . Setting Bit 17 (DREADY) in the MASK0  \nregis ter enables an interrupt to be set when the DREADY flag is \nset. See the Digital Signal Processor  section for more details on \nBit DREADY .  \nAs stated  in the Current Waveform Gain Registers  section , the \nseria l ports of the ADE7880 work on 32 -, 16-, or 8 -bit words. \nSimilar to registers pres ented in Figure 45, the VAW V,  V BW V,  \nand VCWV 24 -bit signed registers are transmitted sign \nextended to 32 bits.  \nThe ADE7880 contain s an HSDC port e specially designed to \nprovide fast access to the waveform sample registers. See the \nHSDC Interface  section f or more details.  CHANGING PHASE VOLTAGE DATA PATH \nThe ADE7880 can direct one phase voltage input to the  \ncomputational data  path of another phase. For example, Phase  A \nvoltage can be introduced in  the Phase B compu tational  data  path , \nwhich means all powers computed by the ADE7880 in Phase  B \nare based on Phase A voltage and Phase B current.  \nBits[9:8] (VTOIA[1:0]) of the CONFIG  register man age which \nphase voltage is directed to the Phase A computational data path.  If \nVTOIA[1:0] = 00 (default value), the Phase A voltage is directed to the Phase A computational data path. If VTOIA[1:0] = 01, \nthe Phase B voltage is directed to the Phase A compu tational \ndata path. If VTOIA[1:0] = 10, the Phase C voltage is directed \nto the Phase A computational data path. If VTOIA[1:0] = 11,  \nthe ADE7880 behaves as if VTOIA[1:0] = 00.  \nBits[11:10] (VTOIB[ 1:0]) of the CONFIG register manage \nwhich phase voltage is directed to the Phase B computational data path. If VTOIB[1:0] = 00 (default value), the Phase B \nvoltage is directed to the Phase B computational data path.  \nIf VTOIB[1:0] = 01, the Phase C voltage  is directed to the \nPhas e B computational data path. If VTOIB[1:0] = 10, the Phase A \nvoltage is directed to the  Phase B computational data path. If \nVTOIB[1:0] = 11, the ADE7880  behaves as if VTOI B[1:0] = 00.  \nBits[13:12] (VTOIC[1:0]) of the CONFIG register manage \nwhich phase voltage is directed to the Phase C computational data path . If VTOIC[1:0] = 00 (default value), the Phase C \nvoltage is directed to the Phase C computational data path, if \nVTOIC [1:0] = 01, the Phase A voltage is directed to the Phase C \ncomputational data path. If VTOIC[1:0] = 10, the Phase B \nvoltage is directed to the Phase C computational data path. If \nVTOIC[1:0] = 11, the ADE7880  behaves as if VTOIC[1:0] = 00.  \nIA\nVA\nIB\nVB\nIC\nVCPHASE A\nCOMPUTATIONAL\nDATAPATH\nPHASE B\nCOMPUTATIONAL\nDATAPATH\nPHASE C\nCOMPUTATIONAL\nDATAPATHVTOIA[1:0] = 10,\nPHASE A VOLTAGE\nDIRECTED\nTO PHASE B\nVTOIB[1:0] = 10,\nPHASE B VOLTAGE\nDIRECTED\nTO PHASE C\nVTOIC[1:0] = 10,\nPHASE C VOLTAGE\nDIRECTED\nTO PHASE ACPHCALBPHCALAPHCAL\n10193-024 \nFigure 51. Phase Voltages Used in Different Data  Paths  \nFigure 51 presents the case in which the Phase A voltage is used \nin the Phase B data  path, the Phase B voltage is used in the Phase C  \ndata path, and the Phase C voltage is used in the Phase A data  path. \nRev. C | Page 31 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 32 of 107 POWER QUALITY MEASUREMENTS \nZero-Crossing Detection \nThe ADE7880  has a zero-crossing (ZX) detection circuit on the \nphase current and voltage channels. The neutral current data \npath does not contain a zero-crossing detection circuit. Zero-crossing events are used as a time base for various power quality \nmeasurements and in the calibration process.  \nThe output of LPF1 is used to generate zero crossing events. \nThe low-pass filter is intended to eliminate all harmonics of \n50 Hz and 60 Hz systems, and to help identify the zero-crossing \nevents on the fundamental components of both current and \nvoltage channels.  \nThe digital filter has a pole at 80 Hz and is clocked at 256 kHz. \nAs a result, there is a phase lag between the analog input signal (one of IA, IB, IC, V A, VB, and VC) and the output of LPF1. The error in ZX detection is 0.0703° for 50 Hz systems (0.0843° \nfor 60 Hz systems). The phase lag response of LPF1 results in a \ntime delay of approximately 31.4° or 1.74 ms (at 50 Hz) between its input and output. The overall delay between the zero crossing on the analog inputs and ZX detection obtained after LPF1 is about 39.6° or 2.2 ms (at 50 Hz). The ADC and HPF introduce \nthe additional delay. The LPF1 cannot be disabled to assure a \ngood resolution of the ZX detection. Figure 52 shows how the \nzero-crossing signal is detected.  \nVPEAK\nVPEAK  × 0.855REFERENCE\nGAIN[23:0]HPFEN BIT\nCONFIG3[0]DSP\nHPFPGA ADCIA, IB, IC,\nOR\nVA, VB, VC\nZX\nDETECTIONLPF1\nIA, IB, IC\nOR\nVA, VB, VC39.6° OR 2.2ms @ 50Hz\n0VZX ZXZX\nZX\nLPF1 OUTPUT\n10193-025 \nFigure 52. Zero-Crossing Detection on Voltage and Current Channels \nTo provide further protection from noise, input signals to the \nvoltage channel with amplitude lower than 10% of full scale do \nnot generate zero-crossing events at all. The Current Channel ZX \ndetection circuit is active for all input signals independent of their \namplitudes. \nThe ADE7880  contains six zero-crossing detection circuits, one \nfor each phase voltage and current channel. Each circuit drives \none flag in the STATUS1 register. If a circuit placed in the Phase A voltage channel detects one zero-crossing event, Bit 9 (ZXV A) in the STATUS1 register is set to 1.  \nSimilarly, the Phase B voltage circuit drives Bit 10 (ZXVB), the \nPhase C voltage circuit drives Bit 11 (ZXVC), and circuits placed  in the current channel drive Bit 12 (ZXIA), Bit 13 (ZXIB), and Bit 14 (ZXIC) in the STATUS1 register. If a ZX detection bit is \nset in the MASK1 register, the IRQ1\n interrupt pin is driven low \nand the corresponding status flag is set to 1. The status bit is cleared and the IRQ1  pin is set to high by writing to the STATUS1 \nregister with the status bit set to 1. \nZero-Crossing Timeout \nEvery zero-crossing detection circuit has an associated timeout \nregister. This register is loaded with the value written into the \n16-bit ZXTOUT register and is decremented (1 LSB) every \n62.5 μs (16 kHz clock). The register is reset to the ZXTOUT \nvalue every time a zero crossing is detected. The default value of this register is 0xFFFF. If the timeout register decrements to 0 before a zero crossing is detected, one of Bits[8:3] of the STATUS1 register is set to 1. Bit 3 (ZXTOV A), Bit 4 (ZXTOVB), and Bit 5 \n(ZXTOVC) in the STATUS1 register refer to Phase A, Phase B, \nand Phase C of the voltage channel; Bit 6 (ZXTOIA), Bit 7 (ZXTOIB), and Bit 8 (ZXTOIC) in the STATUS1 register refer \nto Phase A, Phase B, and Phase C of the current channel.  \nIf a ZXTOIx or ZXTOVx bit is set in the MASK1 register, the \nIRQ1\n interrupt pin is driven low when the corresponding status bit \nis set to 1. The status bit is cleared and the IRQ1  pin is returned to \nhigh by writing to the STATUS1 register with the status bit set to 1. \nThe resolution of the ZXOUT register is 62.5 μs (16 kHz clock) \nper LSB. Thus, the maximum timeout period for an interrupt is \n4.096 sec: 216/16 kHz. \nFigure 53 shows the mechanism of the zero-crossing timeout \ndetection when the voltage or the current signal stays at a fixed \ndc level for more than 62.5 μs × ZXTOUT μs. \n16-BIT INTERNAL\nREGISTER VALUE\nZXTOUT\nVOLTAGE\nOR\nCURRENT\nSIGNAL\nIRQ1 INTERRUPT PINZXZOxy FLAG IN\nSTATUS1[31:0], x = V, A\ny = A, B, C0V\n10193-026 \nFigure 53. Zero-Crossing Timeout Detection \nPhase Sequence Detection \nThe ADE7880  has on-chip phase sequence error detection \ncircuits. This detection works on phase voltages and considers \nonly the zero crossings determined by their negative-to-positive transitions. The regular succession of these zero-crossing events is Phase A followed by Phase B followed by Phase C (see Figure 55). If the sequence of zero-crossing events is, instead, Phase A followed \nby Phase C followed by Phase B, then Bit 19 (SEQERR) in the \nSTATUS1 register is set.  \nData Sheet ADE7880\n \nRev. C | Page 33 of 107 If Bit 19 (SEQERR) in the MASK1 register is set to 1 and a \nphase sequence error event is triggered, the IRQ1  interrupt pin \nis driven low. The status bit is cleared and the IRQ1  pin is set \nhigh by writing to the STATUS1 register with the Status Bit 19 \n(SEQERR) set to 1. \nThe phase sequence error detection circuit is functional only \nwhen the ADE7880 is connected in a 3-phase, 4-wire, three voltage \nsensors configuration (Bits[5:4], CONSEL[1:0] in the ACCMODE register, set to 00). In all other configurations, only two voltage \nsensors are used; therefore, it is not recommended to use the \ndetection circuit. In these cases, use the time intervals between phase voltages to analyze the phase sequence (see the Time \nInterval Between Phases section for details).  \nFigure 54 presents the case in which Phase A voltage is not \nfollowed by Phase B voltage but by Phase C voltage. Every time a negative-to-positive zero crossing occurs, Bit 19 (SEQERR) in the STATUS1 register is set to 1 because such zero crossings on \nPhase C, Phase B, or Phase A cannot come after zero crossings \nfrom Phase A, Phase C, or respectively, Phase B zero crossings.  \nZX B ZX CPHASE C PHASE B PHASE A\nA, B, C PHASE\nVOLTAGES AFTER\nLPF1\nBIT 19 (SEQERR) IN\nSTATUS1 REGISTER\nIRQ1ZX A\nSTATUS1[19] SET TO 1 STATUS1[19] CANCELLED\nBY A WRITE TO THE\nSTATUS1 REGISTER WITH\nSEQERR BIT SET\n10193-027 \nFigure 54. SEQERR Bit Set to 1 When Phase A Voltage Is Followed by  \nPhase C Voltage  \nOnce a phase sequence error is detected, the time measurement \nbetween various phase voltages (see the Time Interval Between \nPhases section) can help to identify which phase to consider with another phase current in the computational data path. Bits[9:8] (VTOIA[1:0]), Bits[11:10] (VTOIB[1:0]), and Bits[13:12] (VTOIC[1:0]) in the CONFIG register can be used \nto direct one phase voltage to the data path of another phase. \nSee the Changing Phase Voltage Data Path section for details. \nTime Interval Between Phases \nThe ADE7880  has the capability to measure the time delay \nbetween phase voltages, between phase currents, or between \nvoltages and currents of the same phase. The negative-to-positive \ntransitions identified by the zero-crossing detection circuit are used as start and stop measuring points. Only one set of such measurements is available at one time, based on Bits[10:9] \n(ANGLESEL[1:0]) in the COMPMODE register.  ZX C ZX BPHASE B PHASE C PHASE A\nZX A\n10193-028 \nFigure 55. Regular Succession of Phase A, Phase B, and Phase C  \nWhen the ANGLESEL[1:0] bits are set to 00, the default value, \nthe delays between voltages and currents on the same phase are \nmeasured. The delay between Phase A voltage and Phase A \ncurrent is stored in the 16-bit unsigned ANGLE0 register (see Figure 56 for details). In a similar way, the delays between voltages and currents on Phase B and Phase C are stored in the \nANGLE1 and ANGLE2 registers, respectively. \nPHASE A\nCURRENT\nANGLE0PHASE A\nVOLTAGE\n10193-029 \nFigure 56. Delay Between Phase A Voltage and Phase A Current Is  \nStored in the ANGLE0 Register \nWhen the ANGLESEL[1:0] bits are set to 01, the delays between \nphase voltages are measured. The delay between Phase A voltage and Phase C voltage is stored into the ANGLE0 register. The delay between Phase B voltage and Phase C voltage is stored in \nthe ANGLE1 register, and the delay between Phase A voltage \nand Phase B voltage is stored in the ANGLE2 register (see \nFigure 57 for details). \nWhen the ANGLESEL[1:0] bits are set to 10, the delays between \nphase currents are measured. Similar to delays between phase voltages, the delay between Phase A and Phase C currents is stored into the ANGLE0 register, the delay between Phase B and \nPhase C currents is stored in the ANGLE1 register, and the \ndelay between Phase A and Phase B currents is stored into the \nANGLE2 register (see Figure 57 for details). \nPHASE B PHASE C PHASE A\nANGLE2\nANGLE0ANGLE1\n10193-030 \nFigure 57. Delays Between Ph ase Voltages (Currents)  \nThe ANGLE0, ANGLE1, and ANGLE2 registers are 16-bit \nunsigned registers with 1 LSB corresponding to 3.90625 μs (256 kHz clock), which means a resolution of 0.0703° (360° × 50 Hz/256 kHz) for 50 Hz systems and 0.0843° (360° × 60 Hz/ \nADE7880 Data Sheet\n \nRev. C | Page 34 of 107 256 kHz) for 60 Hz systems. The delays between phase voltages \nor phase currents are used to characterize how balanced the load is. The delays between phase voltages and currents can be used to compute the power factor on each phase, as shown in the following Equation 6: \ncosφ\nx = cos\n\uf0fa\uf0fa\n\uf0fb\uf0f9\n\uf0ea\uf0ea\n\uf0eb\uf0e9 \uf0b4\uf0b4kHz 256360LINEfANGLEx\uf06f\n (6) \nwhere fLINE = 50 Hz or 60 Hz. \nHowever, the ADE7880  computes the power factor based on the \npowers as described in the Power Factor Calculation section. \nPeriod Measurement \nThe ADE7880  provides the period measurement of the line in \nthe voltage channel. The period of each phase voltage is \nmeasured and stored in three different registers, APERIOD, \nBPERIOD, and CPERIOD. The period registers are 16-bit unsigned registers and update every line period. Because of the LPF1 filter (see Figure 52), a settling time of 30 ms to 40 ms is \nassociated with this filter before the measurement is stable. \nThe period measurement has a resolution of 3.90625 μs/LSB \n(256 kHz clock), which represents 0.0195% (50 Hz/256 kHz) \nwhen the line frequency is 50 Hz and 0.0234% (60 Hz/256 kHz) \nwhen the line frequency is 60 Hz. The value of the period registers for 50 Hz networks is approximately 5120 (256 kHz/50 Hz) and for 60 Hz networks is approximately 4267 (256 kHz/60 Hz). The length of the registers enables the measurement of line frequencies as low as 3.9 Hz (256 kHz/2\n16). The period registers are stable at \n±1 LSB when the line is established and the measurement does \nnot change. \nThe following equations can be used to compute the line period \nand frequency using the period registers: \n\uf05b\uf05dsec3 E 256:0] PERIOD[15TL\uf03d  (7) \n] Hz [3 E 256\n:0] PERIOD[15fL\uf03d  (8) \nPhase Voltage Sag Detection \nThe ADE7880  can be programmed to detect when the absolute \nvalue of any phase voltage drops below or grows above a certain \npeak value for a number of half-line cycles. The phase where this event takes place and the state of the phase voltage relative to the threshold is identified in Bits[14:12] (VSPHASE[x]) of the PHSTATUS register. An associated interrupt is triggered \nwhen any phase drops below or grows above a threshold. This \ncondition is illustrated in Figure 58. \nFigure 58 shows Phase A voltage falling below a threshold that \nis set in the sag level register (SAGLVL) for four half-line cycles (SAGCYC = 4). When Bit 16 (SAG) in the STATUS1 register is set to 1 to indicate the condition, Bit VSPHASE[0] in the PHSTATUS register is also set to 1 because the phase A voltage is below \nSAGLVL. The microcontroller then writes back STATUS1 register with Bit 16 (SAG) set to 1 to erase the bit and bring IRQ1\n interrupt \npin back high. Then the phase A voltage stays above the SAGLVL \nthreshold for four half-line cycles (SAGCYC = 4). The Bit 16 (SAG) in STATUS1 register is set to 1 to indicate the condition and the bit \nVSPHASE[0] in the PHSTATUS register is set back to 0.  \nBits VSPHASE[1] and VSPHASE[2] relate to the sag events on \nPhase B and Phase C in the same way: when Phase B or Phase C voltage stays below SAGLVL, they are set to 1. When the phase voltages are above SAGLVL, they are set to 0. \nPHASE A VOLTAGE\nBIT 16 (SAG) IN\nSTATUS1[31:0]\nVSPHASE[0] =\nPHSTATUS[12]FULL SCALE\nSAGLVL[23:0]\nSAGCYC[7:0] = 0x4PHASE B VOLTAGE\nVSPHASE[1] =\nPHSTATUS[13]IRQ1 PINSTATUS1[16] CANCELLED BY\nA WRITE TO STATUS1[31:0]WITH SAG BIT SET\nPHSTATUS[12] SET TO 1\nBECAUSE PHASE A\nVOLTAGE WAS BELOW\nSAGLVL FOR SAGCYCHALF LINE CYCLES\nPHSTATUS[12] CLEARED\nTO 0 BECAUSE PHASE A\nVOLTAGE WAS ABOVE\nSAGLVL FOR SAGCYCHALF LINE CYCLESSTATUS[16] SET TO 1\nPHSTATUS[13] SET TO 1IRQ1 PIN GOES HIGH\nBECAUSE STATUS1[16]\nCANCELLED BY A WRITE\nTO STATUS[31:0] WITH SAGBIT SETSAGCYC[7:0] = 0x4\n10193-031 \nFigure 58. SAG Detection \nThe SAGCYC register represents the number of half-line cycles \nthe phase voltage must remain below or above the level indicated \nin the SAGLVL register to trigger a SAG interrupt; 0 is not a valid number for SAGCYC. For example, when the sag cycle (SAGCYC[7:0]) contains 0x07, the SAG flag in the STATUS1 register is set at the end of the seventh half line cycle for which \nthe line voltage falls below the threshold. If Bit 16 (SAG) in \nMASK1 is set, the IRQ1\n interrupt pin is driven low in case of a \nsag event in the same moment the Status Bit 16 (SAG) in \nSTATUS1 register is set to 1. The SAG status bit in the STATUS1 \nregister and the IRQ1  pin is returned to high by writing to the \nSTATUS1 register with the status bit set to 1.  \nNote that the internal zero-crossing counter is always active. By \nsetting the SAGLVL register, the first sag detection result is, therefore, not executed across a full SAGCYC period. Writing to the SAGCYC register when the SAGLVL register is already initia-lized resets the zero-crossing counter, thus ensuring that the first sag detection result is obtained across a full SAGCYC period. \n \n \nData Sheet ADE7880\n \nRev. C | Page 35 of 107 The recommended procedure to manage sag events is the \nfollowing: \n1. Enable sag interrupts in the MASK1 register by setting \nBit 16 (SAG) to 1. \n2. When a sag event happens, the IRQ1  interrupt pin goes \nlow and Bit 16 (SAG) in the STATUS1 is set to 1. \n3. The STATUS1 register is read with Bit 16 (SAG) set to 1. \n4. The PHSTATUS register is read, identifying on which \nphase or phases a sag event happened. \n5. The STATUS1 register is written with Bit 16 (SAG) set to 1. \nImmediately, the sag bit is erased. \nSag Level Set \nThe content of the SAGLVL[23:0] sag level register is compared to \nthe absolute value of the output from HPF . Writing 5,326,737 \n(0x5A7540) to the SAGLVL register puts the SAG detection level at full scale (see the Voltage Channel ADC section), thus; the sag event is triggered continuously. Writing 0x00 or 0x01 \nputs the sag detection level at 0, therefore, the sag event is never \ntriggered.  \n0000  0000 24-BIT NUMBER31 24 23 0\n10193-03 2\n \nFigure 59. SAGLVL Register Transmitted as a 32-Bit Word \nAs stated in the Current Waveform Gain Registers section, the \nserial ports of the ADE7880  work on 32-, 16-, or 8-bit words. \nThe SAGLVL register is accessed as a 32-bit register with eight \nMSBs padded with 0s. See Figure 59 for details. \nPeak Detection \nThe ADE7880  records the maximum absolute values reached by \nthe voltage and current channels over a certain number of half-\nline cycles and stores them into the less significant 24 bits of the \nVPEAK and IPEAK 32-bit registers.  \nThe PEAKCYC register contains the number of half-line cycles \nused as a time base for the measurement. The circuit uses the zero-crossing points identified by the zero-crossing detection circuit. Bits[4:2] (PEAKSEL[2:0]) in the MMODE register select \nthe phases upon which the peak measurement is performed. Bit 2 \nselects Phase A, Bit 3 selects Phase B, and Bit 4 selects Phase C. Selecting more than one phase to monitor the peak values decreases proportionally the measurement period indicated in the PEAKCYC register because zero crossings from more \nphases are involved in the process. When a new peak value is \ndetermined, one of Bits[26:24] (IPPHASE[2:0] or VPPHASE[2:0]) in the IPEAK and VPEAK registers is set to 1, identifying the phase that triggered the peak detection event. For example, if a peak value has been identified on Phase A current, Bit 24 \n(IPPHASE[0]) in the IPEAK register is set to 1. If next time a \nnew peak value is measured on Phase B, Bit 24 (IPPHASE[0])  of the IPEAK register is cleared to 0, and Bit 25 (IPPHASE[1]) of the IPEAK register is set to 1. Figure 60 shows the \ncomposition of the IPEAK and VPEAK registers. PEAK DETECTED\nON PHASE C0000031 27 26 25 24 23 0\n24-BIT UNSIGNED NUMBER\nPEAK DETECTED\nON PHASE AIPPHASE/VPPHASE BITS\nPEAK DETECTED\nON PHASE B\n10193-033 \nFigure 60. Composition of IPEAK[31:0] and VPEAK[31:0] Registers \nPHASE A\nCURRENT\nPHASE B\nCURRENTBIT 24\nOF IPEAK\nBIT 25\nOF IPEAKPEAK VALUE WRITTEN INTO\nIPEAK AT THE END OF FIRST\nPEAKCYC PERIOD\nEND OF FIRSTPEAKCYC = 16 PERIOD\nBIT 24 OF IPEAKCLEARED TO 0 AT\nTHE END OF SECOND\nPEAKCYC PERIOD\nBIT 25 OF IPEAKSET TO 1 AT THEEND OF SECONDPEAKCYC PERIODEND OF SECONDPEAKCYC = 16 PERIOD\nPEAK VALUE WRITTEN INTO\nIPEAK AT THE END OF\nSECOND PEAKCYC PERIOD\n10193-034 \nFigure 61. Peak Level Detection \nFigure 61 shows how the ADE7880  records the peak value on the \ncurrent channel when measurements on Phase A and Phase B are \nenabled (Bit PEAKSEL[2:0] in the MMODE register are 011). PEAKCYC is set to 16, meaning that the peak measurement cycle is four line periods. The maximum absolute value of Phase A is the greatest during the first four line periods (PEAKCYC = 16), \nso the maximum absolute value is written into the less signifi-\ncant 24 bits of the IPEAK register, and Bit 24 (IPPHASE[0]) of the IPEAK register is set to 1 at the end of the period. This bit remains at 1 for the duration of the second PEAKCYC period of four line cycles. The maximum absolute value of Phase B is the \ngreatest during the second PEAKCYC period; therefore, the \nmaximum absolute value is written into the less significant 24 bits of the IPEAK register, and Bit 25 (IPPHASE[1]) in the \nIPEAK register is set to 1 at the end of the period. \nAt the end of the peak detection period in the current channel, \nBit 23 (PKI) in the STATUS1 register is set to 1. If Bit 23 (PKI) \nin the MASK1 register is set, the IRQ1\n interrupt pin is driven low \nat the end of the PEAKCYC period, and Status Bit 23 (PKI) in \nthe STATUS1 register is set to 1. In a similar way, at the end of \nthe peak detection period in the voltage channel, Bit 24 (PKV) in \nthe STATUS1 register is set to 1. If Bit 24 (PKV) in the MASK1 \nregister is set, the IRQ1  interrupt pin is driven low at the end of \nPEAKCYC period and Status Bit 24 (PKV) in the STATUS1 \nADE7880 Data Sheet\n \nRev. C | Page 36 of 107 register is set to 1. To find the phase that triggered the interrupt, \none of either the IPEAK or VPEAK registers is read immediately after reading the STATUS1 register. Next, the status bits are \ncleared, and the IRQ1\n pin is set to high by writing to the \nSTATUS1 register with the status bit set to 1.  \nNote that the internal zero-crossing counter is always active. By \nsetting Bits[4:2] (PEAKSEL[2:0]) in the MMODE register, the first peak detection result is, therefore, not executed across a full \nPEAKCYC period. Writing to the PEAKCYC register when the \nPEAKSEL[2:0] bits are set resets the zero-crossing counter, thereby ensuring that the first peak detection result is obtained \nacross a full PEAKCYC period. \nOvervoltage and Overcurrent Detection \nThe ADE7880  detects when the instantaneous absolute value \nmeasured on the voltage and current channels becomes greater \nthan the thresholds set in the OVLVL and OILVL 24-bit unsigned registers. If Bit 18 (OV) in the MASK1 register is set, \nthe IRQ1\n interrupt pin is driven low in case of an overvoltage \nevent. There are two status flags set when the IRQ1  interrupt \npin is driven low: Bit 18 (OV) in the STATUS1 register and one \nof Bits[11:9] (OVPHASE[2:0]) in the PHSTATUS register to identify the phase that generated the overvoltage. The Status  \nBit 18 (OV) in the STATUS1 register and all Bits[11:9] \n(OVPHASE[2:0]) in the PHSTATUS register are cleared, and \nthe IRQ1\n pin is set to high by writing to the STATUS1 register \nwith the status bit set to 1. Figure 62 presents overvoltage \ndetection in the Phase A voltage. \nOVLVL[23:0]\nBIT 18 (OV) OF\nSTATUS1\nBIT 9 (OVPHASE)\nOF PHSTATUSPHASE A\nVOLTAGE CHANNELOVERVOLTAGE\nDETECTED\nSTATUS1[18] AND\nPHSTATUS[9]\nCANCELLED BY A\nWRITE OF STATUS1\nWITH OV BIT SET.\n10193-035 \nFigure 62. Overvoltage Detection Whenever the absolute instantaneous value of the voltage goes \nabove the threshold from the OVLVL register, Bit 18 (OV) in the STATUS1 register and Bit 9 (OVPHASE[0]) in the PHSTATUS register are set to 1. Bit 18 (OV) of the STATUS1 register and \nBit 9 (OVPHASE[0]) in the PHSTATUS register are cancelled \nwhen the STATUS1 register is written with Bit 18 (OV) set to 1.  \nThe recommended procedure to manage overvoltage events is \nthe following: \n1. Enable OV interrupts in the MASK1 register by setting \nBit 18 (OV) to 1. \n2. When an overvoltage event happens, the IRQ1\n interrupt \npin goes low. \n3. The STATUS1 register is read with Bit 18 (OV) set to 1. \n4. The PHSTATUS register is read, identifying on which phase or phases an overvoltage event happened. \n5. The STATUS1 register is written with Bit 18 (OV) set to 1. In this moment, Bit OV is erased and also all Bits[11:9] (OVPHASE[2:0]) of the PHSTATUS register. \nIn case of an overcurrent event, if Bit 17 (OI) in the MASK1 register \nis set, the IRQ1\n interrupt pin is driven low. Immediately, Bit 17 \n(OI) in the STATUS1 register and one of Bits[5:3] (OIPHASE[2:0]) \nin the PHSTATUS register, which identify the phase that generated \nthe interrupt, are set. To find the phase that triggered the interrupt, \nthe PHSTATUS register is read immediately after reading the STATUS1 register. Next, Status Bit 17 (OI) in the STATUS1 register and Bits[5:3] (OIPHASE[2:0]) in the PHSTATUS \nregister are cleared and the IRQ1\n pin is set to high by writing \nto the STATUS1 register with the status bit set to 1. The process \nis similar with overvoltage detection. \nOvervoltage and Overcurrent Level Set \nThe content of the overvoltage (OVLVL), and overcurrent, \n(OILVL) 24-bit unsigned registers is compared to the absolute \nvalue of the voltage and current channels. The maximum value of these registers is the maximum value of the HPF outputs: \n+5,326,737 (0x514791). When the OVLVL or OILVL register is \nequal to this value, the overvoltage or overcurrent conditions are never detected. Writing 0x0 to these registers signifies the overvoltage or overcurrent conditions are continuously detected, \nand the corresponding interrupts are permanently triggered. \nAs stated in the Current Waveform Gain Registers section, the \nserial ports of the ADE7880  work on 32-, 16-, or 8-bit words. \nSimilar to the register presented in Figure 59, OILVL and OVLVL registers are accessed as 32-bit registers with the eight \nMSBs padded with 0s. \nData Sheet  ADE7880  \n \nNeutral Current Mismatc h \nIn 3-phase systems, the neutral current is equal to the algebraic \nsum of t he phase currents  \nIN(t) = I A(t) + I B(t) + I C(t) \nIf there is a mismatch between these two quantities, then a \ntamper situation may have occurred in the system.  \nThe ADE7880 compute s the sum of the p hase currents adding \nthe content of the IAWV , IBWV , and ICWV registers, and \nstoring the result into the ISUM 28- bit signed register: I SUM(t) = \nIA(t) + I B(t) + I C(t). ISUM is computed every 125 µs (8 kHz \nfrequency), the rate at which the current samples are available , \nand B it 17 (DREADY) in the STATUS0  register is used to signal \nwhen the ISUM register can  be read. See the Digital Signal \nProcessor  section for more details on Bit  DR EADY.  \nTo recover I SUM(t) value from the ISUM register , use the \nfollowing equation : \nFS\nMAXSUM IADCISUM[27:0]t I × =)(  \nwhere:  \nADC MAX = 5,326,737, the ADC o utput when the input is at \nfull scale.  \nIFS is the full -scale ADC phase current.  \nNote that the ADE7880 also computes the rms of ISUM and \nstores it into NIRMS  register when Bit 2 (INSEL) in CONFIG 3 \nregister is set to 1 (see Current RMS Calculation  section for \ndetails).  \nThe ADE7880 compute s the difference between the absolute \nvalues of ISUM and the neutral current from the INWV \nregister, take  its absolute value and compare  it against the \nISUMLVL threshold.  \nIf \nISUMLVL INWV ISUM ≤− ,  \nthen it is assumed that the neutral curren t is equal to the sum  \nof the phase currents , and the system functions correctly.  \nIf  \nISUMLVL INWV ISUM >− ,  \na tamper situation may have occurred, and Bit 20 (MISMTCH) \nin the STATUS1 register is  set to 1. An interrupt attached to the \nflag can be enabled  by setting Bit 20 (MISMTCH) in the MASK1  \nregister. If enabled, the IRQ1  pin is set low when Status Bit \nMISMTCH is set to 1. The status bit is cleared and  the IRQ1  pin \nis set back to high by writing to the STATUS1 regist er with Bit 20 \n(MISMTCH) set to 1.  \nIf ISUMLVL INWV ISUM ≤ − , then MISMTCH = 0 \nIf ISUMLVL INWV ISUM >− , then MISMTCH = 1 \nISUMLVL, the positive threshold used in the process, is a 24 -bit \nsigned register. Because it is used in a comparison with an absolute  value, always set ISUMLVL as a positive number, somewhere between 0x00000 and 0x7FFFFF. ISUMLVL uses the same scale \nof the current ADCs outputs, so writing +5,326,737 (0x514791) to the ISUMLVL register puts the mismatch detection level at full scale; see the Current Channel  ADC  section for details. \nWriting 0x000000, the default value, or a negative value, signifies the MISMTCH event is always triggered. The right \nvalue for the application must  be written into the  ISUMLVL \nregister after power -up or after a hardware/software reset to \navoid continuously triggering MISMTCH events.  \nAs stated  in the Current Waveform Gain Registers  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words \nand the DSP works on 28 bits. As presented in Figure 63, ISUM, \nthe 28 -bit signed register, is accessed as a 32 -bit register with the \nfour most significant bits  padded with 0s.  \n31 2827\nBIT 27 IS A SIGN BIT0\n28-BIT SIGNED NUMBER 0000\n10193-036 \nFigure 63. The ISUM[27:0] Register is Transmitted As a 32 -Bit Word  \nSimilar to the registers presented in Figure 44, the ISUMLVL \nregister is accessed as a 32 -bit register with four most significant \nbits padded with 0s and sign extended to 28 bits.  \nPHASE COMPENSATION  \nAs described in the Current Channel  ADC  and Voltage Channel \nADC  sections, the data  path for both current and voltages  is the \nsame. The phase error between current and voltage signals \nintroduced by the ADE7880 is negligible. However, the ADE7880 \nmust w ork with transducers that may have inherent phase \nerrors. For example, a current transformer (CT) with a phase error of 0.1° to 3° is not uncommon. These phase errors can \nvary from part to part, and they must be corrected to perform \naccurate power calculat ions.  \nThe errors associated with phase mismatch are particularly noticeable at low power factors. The  ADE7880 provides a \nmeans of digitally calibrating these small phase errors. The ADE7880 allows a small time delay or time advance to be \nintroduced into the signal processing chain to compensate for \nthe small phase errors.  \nThe phase calibration registers (APHCAL, BPHCAL, and  \nCPHCAL)  are 10-bit registers that can vary the time advance \nin the v oltage channel signal path from  −374.0 µs  to +61.5 μs. \nNegative values written to the PHCAL registers represent a time \nadvance whereas positive values r epresent a time delay. One LSB  \nis equivalent to 0.976 µs of time delay or time advance (clock \nrate of 1.024 MHz). With a line frequency  of 60 Hz, this gives \na phase resolution of 0.0211° (360° × 60 Hz/1.024 MHz) at  the \nfundamental. This corresponds to a total correction range of \n−8.079° to +1.329° at 60 Hz. At 50 Hz, the correction range is  \n−6.732° to +1.107° and the resolution is 0.0176°  (360° × 50 Hz/ \n1.024 MHz) . \nRev. C | Page 37 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 38 of 107 Given a phase error of x degrees, measured using the phase \nvoltage as the reference, the corresponding LSBs are computed dividing x by the phase resolution (0.0211°/LSB for 60 Hz and 0.0176°/LSB for 50 Hz). Results between −383 and +63 only are \nacceptable; numbers outside this range are not accepted. If the \ncurrent leads the voltage, the result is negative and the absolute value is written into the PHCAL registers. If the current lags the voltage, the result is positive and 512 is added to the result \nbefore writing it into xPHCAL. \nAPHCAL , BPHCAL , or CPHCAL  \n=\n\uf0ef\uf0ef\n\uf0fe\uf0ef\uf0ef\n\uf0fd\uf0fc\n\uf0ef\uf0ef\n\uf0ee\uf0ef\uf0ef\n\uf0ed\uf0ec\n\uf03e \uf02b\uf0a3\n0 , 512_0 ,_\nxresolution phasexxresolution phasex\n (9) \nFigure 65 illustrates how the phase compensation is used to remove \nx = −1° phase lead in IA of the current channel from the external current transducer (equivalent of 55.5 μs for 50 Hz systems). To \ncancel the lead (1°) in the current channel of Phase A, a phase lead must be introduced into the corresponding voltage channel. Using Equation 8, APHCAL is 57 least significant bits, rounded \nup from 56.8. The phase lead is achieved by introducing a time \ndelay of 55.73 μs into the Phase A current.  \nAs stated in the Current Waveform Gain Registers section, the \nserial ports of the ADE7880  work on 32-, 16-, or 8-bit words. As \nshown in Figure 64, APHCAL, BPHCAL, and CPHCAL 10-bit registers are accessed as 16-bit registers with the six MSBs \npadded with 0s. \n0000 0015 10 9 0\nxPHCAL\n10193-03 7\n \nFigure 64. xPHCAL Registers Communicated As 16-Bit Registers \n \n \nPHASE\nCALIBRATION\nAPHCAL = 57\nADC PGA3VAP\nVA\nVNADC PGA1IAP\nIA\nIAN\nPHASE COMPENSATION\nACHI EVED DELAYING\nIA BY 56µs\n50Hz1°\nVAIA\nVAIA\n10193-038 \nFigure 65. Phase Calibration on Voltage Channels \n \nData Sheet ADE7880\n \nRev. C | Page 39 of 107 REFERENCE CIRCUIT \nThe nominal reference voltage at the REF IN/OUT  pin is 1.2 V . This \nis the reference voltage used for the ADCs in the ADE7880 . Use a \ntypical external reference voltage of 1.2 V to overdrive the REF IN/OUT  \npin. Calculate the temperature coefficient of the internal voltage \nreference based on the endpoint method. To calculate the drift \nover temperature, measure and compare the values of the voltage reference at endpoints (−40°C and +85°C) to the reference value at 25°C to obtain the slope of the temperature coefficient curve. \nFigure 66 is a typical representation of the drift over temperature.  \n+85°C+25°C\n–40°CREFERENCE V OLTAGE\nTEMPERATURE (°C)AB\nCTYPICALLY\n+20ppm/°CTYPICALLY–20ppm/°C\n10193-165 \nFigure 66. Internal Voltage Reference Temperature Drift \nFigure 66 shows that independent consideration of two regions \nis necessary for accurate analysis of the drift over temperature, \nas follows: \n\uf0b7 Considering the region between Point A and Point B, the \nreference value increases with increase in temperature; thus, the curve has a positive slope from A to B. This results in a positive temperature coefficient in this region. \n\uf0b7 Considering the region between Point B and Point C, the slope of the curve is negative because the voltage reference decreases with an increase in temperature; thus, this region of the curve has a negative temperature coefficient.  \nThe general relationship between the absolute value of the \nvoltage reference at a particular endpoint temperature and the \ntemperature coefficient for that region of the curve is explained \nby the following two equations:  \nV\nREF (−40°C) = V REF (+25°C)  × \uf028\uf029\uf0f7\uf0f8\uf0f6\uf0e7\uf0e8\uf0e6 \uf0b0 \uf02d \uf0b0 \uf02d \uf061\uf02b610C 25 C 401c \nVREF ( 85°C) = V REF (25°C) × \uf028\uf029\uf0f7\n\uf0f8\uf0f6\uf0e7\n\uf0e8\uf0e6 \uf0b0 \uf02d \uf0b0 \uf061\uf02b610C 25 C 851h \nwhere αc and αh are cold and hot temperature coefficients, \nrespectively, calculated by: \n\uf028\uf029 C 25 C 40  \nC) 25 (C) 25 ( C) 40 (\n\uf0b0 \uf02d \uf0b0 \uf02d\uf02d\n\uf03d \uf061\uf0b0 \uf02b\uf0b0 \uf02b \uf0b0 \uf02d\nREFREF REF\ncVV V\n× 106 ppm/°C \n\uf028\uf029 C 25 C 85  \nC) (25C) (25 C) 85 (\n\uf0b0 \uf02d \uf0b0\uf02d\n\uf03d \uf061\uf0b0\uf0b0 \uf0b0\nREFREF REF\nhVV V\n× 106 ppm/°C \nTo find the typical, maximum, and minimum temperature \ncoefficients as listed in the Specifications section, data based on \nthe end-point method is collected on ICs spread out over different lots. Each IC has a temperature coefficient curve that \ndiffers slightly from any other, which necessitates the trimming of all devices based on a carefully chosen single voltage reference value. Though the absolute value of the reference voltage at \n25°C differs from one device to another in mV range, the drift \nover temperature in a particular device always remains within \nthe maximum limits, as stated in the Specifications section. \nBecause the reference is used for all ADCs, any x% drift in the \nreference results in a 2x% deviation of the meter accuracy. The reference drift resulting from temperature changes is usually very small and, typically, much smaller than the drift of other \ncomponents on a meter. Alternatively, calibrate the meter at \nmultiple temperatures. \nThe ADE7880  use the internal voltage reference when Bit 0 \n(EXTREFEN) in the CONFIG2 register is cleared to 0 (the default \nvalue); the external voltage reference is used when the bit is set to 1. Set the CONFIG2 register during the PSM0 mode; its value is \nmaintained during the PSM1, PSM2, and PSM3 power modes. \nDIGITAL SIGNAL PROCESSOR \nThe ADE7880  contains a fixed function digital signal processor \n(DSP) that computes all powers and rms values. It contains \nprogram memory ROM and data memory RAM.  \nThe program used for the power and rms computations is stored \nin the program memory ROM and the processor executes it every \n8 kHz. The end of the computations is signaled by setting Bit 17 (DREADY) to 1 in the STATUS0 register. An interrupt attached to this flag can be enabled by setting Bit 17 (DREADY) in the \nMASK0 register. If enabled, the IRQ0\n pin is set low and Status \nBit DREADY is set to 1 at the end of the computations. The status bit is cleared and the IRQ0\n pin is set to high by writing to the \nSTATUS0 register with Bit 17 (DREADY) set to 1. \nThe registers used by the DSP are located in the data memory \nRAM, at addresses between 0x4380 and 0x43BE. The width of this memory is 28 bits. A two-stage pipeline is used when write \noperations to the data memory RAM are executed. This means \ntwo things: when only one register needs to be initialized, write it two more times to ensure the value has been written into RAM. When two or more registers need to be initialized, write the last register in the queue two more times to ensure the value is written into RAM. \nAs explained in the Power-Up Procedure section, at power-up \nor after a hardware or software reset, the DSP is in idle mode. \nNo instruction is executed. All the registers located in the data memory RAM are initialized at 0, their default values and they can be read/written without any restriction. The Run register, used to start and stop the DSP , is cleared to 0x0000. The Run \nregister needs to be written with 0x0001 for the DSP to start \ncode execution. It is recommended to first initialize all ADE7880  \nregisters located in the data memory RAM with their desired values. Next, write the last register in the queue two additional times to flush the pipeline and then write the Run register with \nADE7880  Data Sheet  \n \n0x0001.  In this way, the DSP starts the computations from a \ndesired configuration.  \nTo protect the integrity of the data stored in the data memory RAM \nof the DSP (between Address 0x4380 and Address 0x43BE),  a writ e \nprotection mechanism is available. By default, the protection is \ndisabled and registers placed between 0x4380 and 0x43BE can \nbe written without restriction. When the protection is enabled, no writes to these registers are allowed. Registers can be always \nread, without restriction, independent of the write protection state. To enable the protection, write 0xAD to an internal 8 -bit \nregister located at A ddress 0xE7FE, followed by a write of 0x80 \nto an internal 8 -bit register located at A ddress 0xE7E3. To dis able \nthe protection, write 0xAD to an internal 8 -bit register located \nat Address 0xE7FE, followed by a  write of 0x00 to an internal 8 -bit \nregister located at A ddress 0xE7E3. It is recommended to enable \nthe write protection before starting the DSP . If any d ata memory \nRAM based register needs to be changed, simply disable the protection, change the value and then enable back the protection.  \nThere is no need to stop the DSP in order to change these registers.  \nTo disable the protection, write 0xAD to an interna l 8-bit register  \nlocated at Address 0xE7FE, followed by a write of 0x00 to an \ninternal 8 -bit register located at Address 0xE7E3.  \nUse the following procedure to initialize the ADE7880 registers \nat power -up: \n1. Select the PGA gains in the phase currents, voltages, and \nneutral current channels: Bits [2:0] (PGA1), Bits [5:3] \n(PGA2) and Bits [8:6] (PGA3) in the Gain register.  \n2. If Rogowski coils are used, enable the digital integrators in \nthe phase and neu tral currents: Bit 0 (INTEN) set to 1 in \nCONFIG register. Initialize DICOEFF register to 0xFF8000 before setting the INTEN bit in the CONFIG register.  \n3. If f\nn is between 55 Hz and 66 Hz, set Bit 14 (SELFREQ) in \nCOMPMODE register.  \n4. Initialize all the other dat a memory RAM registers. Write \nthe last register in the queue three times to ensure that its \nvalue is written into the RAM.  \n5. Initialize WTHR, V ARTHR, V ATHR, VLEVEL and VNOM registers based on Equation 26, Equation 37, \nEquation 44, Equation 2 2, and Equation 4 2, respectively.  \n6. Initialize CF1DEN, CF2DEN, and CF3DEN based on Equation 49.  7. Enable the data memory RAM protection by writing 0xAD to an internal 8 -bit register located at Address 0xE7FE \nfollowed by a write of 0x80 to an internal 8 -bit register \nlocated at  Address 0xE7E3.  \n8. Read back all data memory RAM registers to ensure that \nthey initialized with the desired values. In the unlikely case \nthat one or more registers d oes not initia lize correctly, disable \nthe protection by writing 0xAD to an  internal 8 -bit reg ister \nlocated at Address  0xE7FE, followed by a write of 0x00 to an  \ninternal 8 -bit register located at Address  0xE7E3. Reinitialize  \nthe registers, and write the last register in the queue three \ntimes. Enable the write protection by writing 0xAD to an intern al 8-bit register located at Address 0xE7FE, followed \nby a write of 0x80 to an internal 8 -bit register located at \nAddress  0xE7E3.  \n9. Start the DSP by setting Run  = 1. \n10. Read the energy registers xW ATTHR, xV AHR, xFW ATTHR,  \nand xFV ARHR to erase their content and s tart energy \naccumulation from a known state.  \n11. Enable the CF1, CF2 and CF3 frequency converter outputs by clearing bits 9, 10 and 11 (CF1DIS, CF2DIS, and CF3DIS) to 0 in CFMODE register.  \nThere is no obvious reason to stop the DSP if the ADE7880 is \nmaintained in PSM0 normal mode. All ADE7880 registers, \nincluding ones located in the data memory RAM, can be modified without stopping the DSP .  However, to stop the DSP , \nwrite 0x0000 into the Run register . To re start the DSP , follow \none of the following procedures:  \n• If the ADE7880 registers located in the data memory RAM \nhave not been m odified, write 0x0001 into the Run register  to \nstart the DSP .  \n• If the ADE7880 registers located in the data memory RAM \nhave to be modified, first execute a software or a hardware \nreset, initializ e all ADE7880 registers at desired values, enable  \nthe write protection and then write 0x0001 into the R un \nregister  to start the DSP .  \nAs mentioned in the Power Management  section, when the \nADE7880 switch out of PSM0 power mode, it is recommended  to \nstop the DSP by writing 0x0000 into the Run register (see Table 10 \nand Table 11 for the  recommended actions when changing \npower modes ). \n \n \n \n \n \n \n \n   \n \n \n  \n \n \n \nRev. C | Page 40 of 107 \nData Sheet  ADE7880  \n \nROOT MEAN SQUARE MEA SUREMENT  \nRoot mean square (rms) is a measurement of the magnitude of \nan ac signal. Its definition can be both practical and mathematical.  \nDefin ed practically, the rms value assigned to an ac signal is the \namount of dc required to produce an equivalent amount of \npower in the load. Mathematically, the rms value of a conti -\nnuous signal f(t) is defined as \n()dttftrmsF∫=t\n02 1 (10) \nFor time sampling  signals, rms calculation involves squaring the \nsignal, taking the average, and obtaining the square root.  \n[]∑\n==N\nNnfNrmsF\n12 1 (11) \nEquation 10 implies that for signals containing harmonics, the \nrms calculation contains the contribution of all harmonics , not \nonly the fundamental. The ADE7880 uses two different methods  \nto calcul ate rms values. The first one is very accurate and is active  \nonly in PSM0 mode. The second one is less accurate, uses t he \nestimation of the mean absolute value (mav) measurement, and \nis active in PSM0 and PSM1 modes .  \nThe ADE7880 also computes the rms values of various funda -\nmental and harmonic components of phas e currents, phase \nvoltages and neutral current as part of the harmonic calculations block. Refer to the Harmonics Calculations section for details.  \nThe first method is to low- pass filter the square of the input \nsignal (LPF) and take the square root of the result (see Figure 68).  \nIf \n()k\nkk tk F tf γ+ω =∑∞\n=sin2 )(\n1 (12) \nthen,  \n()() ∑∑∑\n∞\n≠=∞\n=∞\n=\nγ+ω×γ+ω××++γ+ω −=\nmkmkm k m kkk k\nkk\ntm tk FFtk F F tf\n1,12\n12 2\nsin sin 2 2)2 2cos( )(\n (13) \nAfter the LPF and the execution of the square root, the rms \nvalue of f(t) is obtained by  \n∑∞\n==\n12\nkkF F  (14) \nThe rms calculation based on this method is simultaneously \nprocessed on all seven analog input channels. Each result is \navailable in the 24 -bit registers: AIRMS, BIRMS, CIRMS, \nAVRMS, BVRMS, CVRMS, and NIRMS .  \n \n \n \n The second  method computes the abso lute value of the input \nsigna l and then filters it to extract its dc component. It computes  \nthe absolute mean value of the input. If the input signal in \nEquation 1 6 has a fundamental component  only, its average \nvalue is  \n\uf8fa\uf8fa\uf8fa\n\uf8fb\uf8f9\n\uf8ef\uf8ef\uf8ef\n\uf8f0\uf8ee\nω××−ω××= ∫ ∫T\nT1T\n1 DC dtt F dtt F\nTF\n22\n0) sin( 2 ) sin( 21 \n1 DC F F ××π= 22 \nThe ca lculation based on this method is simultaneously processed  \nonly on the three phase currents. Each result is available in the 20-bit registers AIMAV , BMAV , and CMAV . Note that the \nproportionality between mav and rms values is maintained for the fundamental com ponents only. If harmonics are present in the \ncurrent channel, the mean absolute value is no longer  \nproportional to rms.  \nCurrent RMS Calculation  \nThis section presents the first approach to compute the rms \nvalues of all phase and neutral currents. The ADE7880 also \ncomputes the rms of the sum of the instantaneous values of the \nphase currents  if Bit 2 (INSEL) in the CONFIG3 register is set \nto 1. Note that th e instantaneous value of  the sum is stored into \nISUM register presented in the Neutral Current Mismatch  section.  \nIn 3-phase four wired  systems that only require sensing the phase  \ncurrents , this value provides a measure of the neutral curr ent. \nFigure 68 shows the detail of the signal processing chain for the \nrms calculation on one of the phases of the current channel. The  \ncurrent channel rms value is processed from the samples used in the current channel. The cur rent rms values are signed 24- bit \nvalues and they are stored into the AIRMS, BIRMS, CIRMS, NIRMS  registers. The update rate of the current rms measurement  \nis 8 kHz.  If Bit 2 (INSEL) of the CONFIG3 register is 0 (default), \nthe NIRMS register contains the rm s value of the neutral current.  \nIf the INSEL bit is 1, the NIRMS register contains the rms value \nof the sum of the instantaneous values of the phase currents.   \nWith the specified full -scale analog input signal of 0.5 V , the \nADC produces an output code that  is approximately ± 5,326,737. \nThe equivalent rms value of a full -scale sinusoidal signal is \n3,766,572 (0x39792C) , independent of the line frequency. If \nthe integrator is enabled, that is, when Bit 0 (INTEN) in the \nCONFIG  register is set to 1, the equivalen t rms value of a full -\nscale sinusoidal signal at 50 Hz is 3,759,718 (0x395E66) and at 60 Hz is  3,133,207 (0x2FCF17) . \n \n \n \n \n  \nRev. C | Page 41 of 107 \nADE7880  Data Sheet  \n \nThe accuracy of the current rms is typically 0.1% error from  \nthe full-scale input down to 1/1000 of the full -scale input when \nPGA = 1. Additionally, this measurement has a bandwidth of  \n3.3 kHz. It is recommended to read the rms registers synchronous \nto the voltage zero crossings to ensure stability. The IRQ1  inter -\nrupt can be used to indicate when a zero crossing has  occurred \n(see the Interrupts  section). Table 12 shows the settling time for \nthe I  rms measurement, which is the time it takes for the rms  \nregister to settle within 99.5% of the input to  the current channel \nwhen starting from 0 to full scale. However, during the IC  \npower -up and DSP reset cases, it typically takes about 1.3  seconds  \nfrom the moment the RUN register is set to 0x01 for a FS/1000 \nsignal to be 99.5% settled. \n \n \n Table 12. Settling Time for I rms  Measurement  \nIntegrator Status  50 Hz Input Signals  60 Hz Input Signals  \nIntegrator Off  580 ms 580 ms \nIntegrator On  700 ms 700 ms \nAs stated  in the Current Waveform Gain Registers  section, the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words. \nSimilar to the register presented in  Figure 67, the AIRMS, \nBIRMS, CIRMS , NIRMS  24-bit signed register s are accessed as \n32-bit registers with the eight MSBs padded with 0s . \n \n31 24 23 0\n24-BIT NUMBER 0000 0000\n10193-039 \nFigure 67. 24 -Bit AIRMS, BIRMS, CIRMS and NIRMS R egisters Transmitted as \n32-Bit Words  \n \n0xAEB86F =\n–5,326,7370x514791 =\n5,326,737\n0VCURRENT SIGNAL FROM\nHPF OR INTEGRATOR\n(IF ENABLED) LPFx227xIRMSOS[23:0]\nxIRMS[23:0]\n10193-040 \nFigure 68. Current RMS Signal Processing  \n \nRev. C | Page 42 of 107 \nData Sheet  ADE7880  \n \nCurrent RMS Offset Compensation  \nThe ADE7880 incorporate s a current rms offset compensation \nregister for each phase: AIRMSOS, BIRMSOS, CIRMSOS , and \nNIRMSOS. These are 24 -bit signed registers tha t are used to \nremove offsets in the current rms calculations. An offset can \nexist in the rms calculation due to input noises that are integrated  \nin the dc component of i2(t). The current rms offset register is  \nmultiplied by 128 and added to the squared cur rent rms before the \nsquare root is executed.  Assuming that the maximum value from \nthe current rms calculation is 3,766,572 with full -scale ac inputs  \n(50 Hz), one LSB of the current rms offset represents 0.000 45%  \n1001 3767/128 37672×\uf8f7\uf8f8\uf8f6\uf8ec\uf8ed\uf8eb− +\n \nof the rms measurem ent at 60  dB down from full scale. Conduct \noffset calibration at low current; avoid using currents equal to zero for this purpose.  \nIRMSOS rmsI rmsI ×+ = 1282\n0  (15) \nwhere I rms 0 is the rms measurement without offset correction.  \nAs stated  in the Current Waveform Gain Registers  section, the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words \nand the DSP works on 28 bits. Similar to the register presented in Figure 44, the AIRMSOS, BIRMSOS, CIRMSOS, and \nNIRMSOS 24 -bit signed registers are accessed as 32 -bit registers \nwith four MSBs padded with 0s and sign extended to 28 bits.  \nCurrent Mean Absolute Value Calculation  \nThis section presents the s econd approach to estimate the rms \nvalues of all phase currents using the mean absolute value (mav) method. This approach is used in PSM1 mode, to allow energy \naccumulation based on current rms values when the missing neutral case demonstrates to be a tamp er attack. This data  path \nis active also in PSM0 mode to allow for its gain calibration. The gain is used in the external microprocessor during PSM1 mode. The mav value of the neutral current is not computed using this method.  Figu re 69 shows the details of the signal \nprocessing chain for the mav calc ulation on one of the phases \nof the current channel.  \nCURRENT SIGNAL\nCOMING FROM ADCxIMAV[23:0]\nHPF LPF|X|\n10193-041 \nFigure 69. Current MAV Signal Processing for PSM1 Mode  \nThe cur rent channel mav value is processed from t he samples \nused in the current channel waveform sampling mode. The samples are passed through a high- pass filter to eliminate the \neventual dc offsets introduced by the ADCs and the absolute \nvalues are computed. The outputs of this block are then filtered \nto obtain the average. The current mav values are unsigned 20 -bit \nvalues and they are stored in the AIMAV , BIMAV , and CIMAV \nregisters. The update rate of this mav measurement is 8  kHz.  207000207500208000208500209000209500210000210500211000211500212000\n45 50 55\nFREQUENCY (Hz)LSB\n60 65\n10193-042 \nFigure 70. xIMAV  Register Values at Full Scale, 45 Hz to 65 Hz Line \nFrequencies  \nThe mav values of full -scale sinusoidal signals of 50 Hz and \n60 Hz are 209,686 and 210,921, respectively. As seen in Figure 70, \nthere is a 1.25% variation between the mav estimate at 45  Hz \nand the o ne at 65 Hz for full -scale sinusoidal inputs. The accuracy \nof the current mav is typically 0.5% error from the full -scale \ninput down to 1/100 of the full -scale input. Additionally, this  \nmeasurement has a bandwidth of 3.3  kHz. The settling time for \nthe current mav  measurement, that is the time it takes for the \nmav register to reflect the value at the input to the current channel within 0.5% error , is 500 ms. However, during the first \nmeasurement after entering this mode, it takes a longer time to \nsettle  to the correct value.  \nAs stated  in the Current Waveform Gain Registers  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words. As \npresented in Figure 71, the AIMAV , BIMAV , and CIMAV 20- bit \nunsigned registers are accessed as 32 -bit registers with the 12 MSBs  \npadded with 0s.  \n31 2019 0\n20-BIT UNSIGNED NUMBER 0000 0000 0000\n10193-043 \nFigure 71. xIMAV Registers Transmitted as 32 -Bit Registers  \nCurrent MAV Gain and Offset Compensation  \nThe current rms values stored in the AIMAV , BIMAV , and CIMAV  \nregisters can be calibrated using gain and offset coefficients corresponding  to each phase.  Calculate the gains in PSM0 mode \nby supplying the ADE7880 with nominal currents. The offsets \ncan be estimated by supplying the ADE7880 with low currents, \nusually equal to the minimum value at which the accuracy is \nrequired. Every time the external microcontroller reads the \nAIMAV , BIMAV , and CIMAV registers, it uses these coefficients \nstored in its memory to correct them.  \nRev. C | Page 43 of 107 \nADE7880  Data Sheet  \n \nVoltage Channel RMS Calculation  \nFigure 72 shows t he detail of the signal processing chain for the \nrms calculation on one of the phases of the voltage channel. The \nvoltage channel rms value is processed from the samples used in the voltage channel. The voltage rms values are signed 24 -bit \nvalues and they a re stored into the R egisters AVRMS , BVRMS, \nand CVRMS. The update rate of the current rms measurement is 8 kHz.  \nWith the specified full -scale analog input signal of 0.5 V , the \nADC produces an output code that is approximately ± 5,326,737.  \nThe equivalent rms value of a full -scale sinusoidal signal is \n3,766,572 (0x39792C) , independent of the line frequency.  \nThe accuracy of the voltage rms is typically 0.1% error from the full-scale input down to 1/1000 of the full- scale input. Additionally, this measurement has  a bandwidth of 3.3  kHz. It is recommended  \nto read the rms registers synchronous to the voltage zero crossings \nto ensure stability. The \nIRQ1  interrupt can be used to indicate \nwhen a zero crossing has occurred (see the Interrupts  section).  \nThe V  rms measurement sett ling time is 580 ms for both 50 Hz \nand 60 Hz input signals. The V  rms measurement settling time \nis the time it takes for the rms register to reflect the value at the \ninput to the voltage channel when sta rting from 0.  \nAs stated in the Current Waveform Gain Registers  section,  the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words. \nSimilar to the register present ed in  Figure 59, the AVRMS, \nBVRMS, and CVRMS 24 -bit signed registers are accessed as \n32-bit registers with the eight MSBs padded with 0s.  \n0xAEB86F =\n–5,326,7370x14791 =\n+5,326,737\n0VVOLTAGE SIGNAL\nFROM HPFLPFx227xVRMSOS[23:0]\nxVRMS[23:0]\n10193-044 \nFigure 72. Voltage RMS Signal Processing  \n \nRev. C | Page 44 of 107 \nData Sheet ADE7880\n \nRev. C | Page 45 of 107 Voltage RMS Offset Compensation \nThe ADE7880  incorporates voltage rms offset compensation \nregisters for each phase: AVRMSOS, BVRMSOS, and CVRMSOS. \nThese are 24-bit signed registers used to remove offsets in the \nvoltage rms calculations. An offset can exist in the rms calcula-tion due to input noises that are integrated in the dc component of V\n2(t). The voltage rms offset register is multiplied by 128 and \nadded to the squared voltage rms before the square root is executed. \nAssuming that the maximum value from the voltage rms calcu-\nlation is 3,766,572 with full-scale ac inputs (50 Hz), one LSB of \nthe current rms offset represents 0.00045%  \n\uf028 \uf029100 1 3767 / 128 37672\uf0b4 \uf02d \uf02b  \nof the rms measurement at 60 dB down from full scale. Conduct \noffset calibration at low current; avoid using voltages equal to \nzero for this purpose.  \nVRMSOS rms V rms V \uf0b4 \uf02b \uf03d1282\n0  (16) \nwhere V rms 0 is the rms measurement without offset correction.  \nAs stated in the Current Waveform Gain Registers section, the \nserial ports of the ADE7880  work on 32-, 16-, or 8-bit words \nand the DSP works on 28 bits. Similar to registers presented in Figure 44, the AVRMSOS, BVRMSOS, and CVRMSOS 24-bit \nregisters are accessed as 32-bit registers with the four most \nsignificant bits padded with 0s and sign extended to 28 bits. \nVoltage RMS in 3-Phase, 3-Wire Delta Configurations \nIn 3-phase 3-wire delta configurations, Phase B is considered the \nground of the system, and Phase A and Phase C voltages are measured relative to it. This configuration is chosen using \nCONSEL bits equal to 01 in ACCMODE register (see Table 15 for all configurations where the ADE7880  may be used). In this \nsituation, all Phase B active, reactive, and apparent powers are 0.  \nIn this configuration, the ADE7880  computes the rms value of the \nline voltage between Phase A and Phase C and stores the result \ninto BVRMS register. BVGAIN and BVRMSOS registers may be \nused to calibrate BVRMS register computed in this configuration.  \nThe apparent power computation, in 3-wire and 4-wire delta \nconfigurations, will be incorrect, because the line to line \nvoltages are treated as phase voltages by the IC. To get the equivalent wye-configuration apparent power, a scaling factor needs to be applied. Refer to the Three Phase Configurations section of the AN-639 Application Note , Analog Devices Energy \n(ADE) Products: Frequently Asked Questions (FAQ),  for details. \nACTIVE POWER CALCULATION \nThe ADE7880  computes the total active power on every phase. \nTotal active power considers in its calculation all fundamental and harmonic components of the voltages and currents. In addition, the ADE7880  computes the fundamental active power, \nthe power determined only by the fundamental components of \nthe voltages and currents. The ADE7880  also computes the harmonic active powers, the \nactive powers determined by the harmonic components of the \nvoltages and currents. See the Harmonics Calculations section \nfor details. \nTotal Active Power Calculation \nElectrical power is defined as the rate of energy flow from source \nto load, and it is given by the product of the voltage and current \nwaveforms. The resulting waveform is called the instantaneous power signal, and it is equal to the rate of energy flow at every instant of time. The unit of power is the watt or joules/sec. If an \nac system is supplied by a voltage, v(t), and consumes the current, \ni(t), and each of them contains harmonics, then \nsin 2 ) (\n1\uf0e5\uf0a5\n\uf03d\uf03d\nkkV t v (kωt + φ k) (17) \n\uf028\uf029k\nkk t k I t i\uf067 \uf02b \uf077 \uf03d\uf0e5\uf0a5\n\uf03dsin 2 ) (\n1 \nwhere: \nVk, Ik are rms voltage and current, respectively, of each \nharmonic. φ\nk, γk are the phase delays of each harmonic. \nThe instantaneous power in an ac system is  \np(t) = v(t) × i(t) =\uf0e5\uf0a5\n\uf03d1kk kI Vcos(φk – γk) −\uf0e5\uf0a5\n\uf03d1kk kI Vcos(2kωt  + φ k + γ k) \n+\uf0e5\uf0a5\n\uf0b9\uf03d\nm km kmkI V\n1 ,{cos[( k − m )ωt + φ k – γm] – cos[( k + m )ωt + φ k + γ m]}  \n (18) \nThe average power over an integral number of line cycles (n) is \ngiven by the equation in Equation 19. \nP = \uf028\uf029\uf0e5\uf0f2\uf0a5\n\uf03d\uf03d\n1 01\nkk knT\nI V dt t pnTcos(φk – γk) (19) \nwhere: \nT is the line cycle period.  \nP is referred to as the total active or total real power.  \nNote that the total active power is equal to the dc component of the instantaneous power signal p(t) in Equation 18, that is,  \n\uf0e5\uf0a5\n\uf03d1kk kI Vcos(φk – γk) \nThis is the equation used to calculate the total active power in the ADE7880  for each phase. The equation of fundamental active \npower is obtained from Equation 18 with k = 1, as follows: \nFP = V\n1I1 cos( φ1 – γ1) (20) \n \n    \nADE7880  Data Sheet  \n \nFigure 76 shows how the ADE7880 computes the total active \npower on each phase. First, it multiplies the current and voltage \nsignals in each phase. Next, it extracts the dc component of the instantaneous power signal in each phase (A, B, and C) using \nLPF2, the low -pass filter.  \nIf the phase currents and voltages contain only the fundamental \ncomponent, are in phase (that is , φ\n1 = γ1 = 0), and they correspond  \nto full -scale ADC inputs, then multiplying them results in an \ninstantaneous power signal that has a dc component, V 1 × I 1, \nand a sinusoidal component, V 1 × I 1 cos(2ωt); Figure 73 shows \nthe correspond ing waveforms.  \n \nINSTANTANEOUS\nPOWER SIGNAL\nINSTANTANEOUS\nACTIVE POWER\nSIGNAL: V rms ×I rmsp(t)= V rms × I rms – V rms × I rms × cos(2ωt)\n0x339CBBC =\n54,119,356\nV rms × I rms\n0x19CE5DE =\n27,059,678\n0x000 0000\ni(t) = √2× I rms × sin(ωt)\nv(t) = √2× V rms × sin(ωt)\n10193-046 \nFigure 73. Active Power Calculation  \nBecause LPF2 does not have an ideal brick wall frequency response, the active power signal has some ripple due to the instantaneous power signal. This ripple is sinusoidal and h as a \nfrequency equal to twice the line frequency. Because the ripple is sinusoidal in nature, it is removed when the active power \nsignal is integrated over time to calculate the energy.  Bit 1 \n(LPFSEL) of CONFIG3 register selects the LPF2 strength. If \nLPFSE L is 0 (default), the settling time is 650  ms and the ripple \nattenuation is 65 dB. If LPFSEL is 1, the settling time is 1300  ms \nand the ripple attenuation is 128  dB. Figure 74 shows the \nfrequency response of LPF2 when LPFSEL is 0 and Figure 75 \nshows the frequency response of LPF2 when LPFSEL is 1.  \nThe ADE7880 stores  the instantaneous total phase active \np owe r s  i nt o  t h e  AWAT T,  BWAT T,  a n d  C WAT T  re gisters. The ir \nequation  is \n∑∞\n=××=\n1k FSk\nFSk\nII\nVVxWATT cos(φk – γk) × PMAX  × 421 (21) where:  \nVFS, IFS are the rms values of the phase voltage and current when \nthe ADC inputs are at full scale. \nPMAX  = 27,059,678 it is the instantaneous power c omputed \nwhen the ADC inputs are at full scale and in phase.   \nThe xW ATT[23:0] waveform registers can be accessed using \nvarious serial ports. Refer to the Waveform Sampling Mode  \nsection for more details.  \n0\n–5\n–10\n–15\n–20\n–25\n0.1 1 3 10\nFREQUENCY (Hz)MAGNITUDE (dB)\n10193-172 \nFigure 74. Frequency Response of the LPF Used  to Filter Instantaneous Power \nin Each Phase W hen the LPFSEL Bit of CONFIG3 is 0 ( Default)  \n \n0\n–10\n–20\n–30\n–40\n0.1 1 10\nFREQUENCY (Hz)MAGNITUDE (dB)\n10193-173 \nFigure 75. Frequency Response of the LPF Used  to Filter Instantaneous Power \nin Each Phase when the LPFSEL Bit of CONFIG3 is 1   \n \nINSTANTANEOUS\nPHASE A\nACTIVE POWERHPFEN BIT\nCONFIG3[0]\nHPF\nDIGITAL SIGNAL PROCESSORAIGAIN\nAVGAINHPFEN BIT\nCONFIG3[0]INTEN BIT\nCONFIG[0]\nLPSEL BIT\nCONFIG3[1]HPF\nVAIA\nLPFAPGAIN AWATTOS\nAPHCAL\n24AWATT :\n10193-045 \nFigure 76. Total Active Power Data Path  \nRev. C | Page 46 of 107 \nData Sheet  ADE7880  \n \nFundamental Active Power Calculation  \nThe ADE7880 computes the fundamental active power usi ng  \na proprietary algorithm that requires some initializations function \nof the freq uency of the network and its nominal voltage measured \nin the voltage channel. Bit 14 (SELFREQ) in the COMPMODE \nregister must be set according to the frequency of the network  in \nwhich the ADE7880 is connected. If the network frequency is \nbetween 45 Hz and 55 Hz, clear this bit to 0 (the def ault value). If \nthe network fre quency is between 55 Hz and 66 Hz, set this bit  to 1. \nIn addition, initialize the VLEVEL 2 8-bit signed register based \non the following  equation : \n6104××=\nnFS\nVVVLEVEL  (22) \nwhere:  \nVFS is the rms value of the phase voltages when the ADC inputs \nare at full scale.  \nVn is the rms nominal value of the phas e voltage.  \nThe VLEVEL register is a 28 -bit signed register and is zero \npadded to 32 bits.  \nTable 13 presents the settling time for the fundamental active \npower measurement.  \nTable 13. Settling Time for Fundam ental Active Power  \nInput Signals  \n63% PMAX  100% PMAX  \n375 ms 875 ms \nManaging Change in Fundamental Line Frequency  \nThe ADE7880 has a very accurate method for tracking changes in \nline frequency up  to 10  Hz. Typical changes in line frequency are \nvery slow. However, in some calibration or testing scenarios, the line frequency can change abruptly. It is recommended to keep \nchanges in the line frequency within ±5 Hz at any one transition. \nTo cover a wi de frequency range from 45 Hz to 66 Hz, it is \nnecessary to ensure that the SELFREQ bit of the COMPMODE \nregister is changed according to the line frequency .  \nThe following two scenarios are  examples on how to manage \nthe SELFREQ bit and how to change  the lin e frequency . \nExample 1: Consider the scenario where the user plans to calibrate the IC at 50 Hz and then at 60 Hz. In such a case, t he \nfollowing steps  must be followed  in sequential order . \n1. Apply a 50 Hz line frequency . \n2. Keep the SELFREQ bit of the COMPMODE register at 0.  \n3. Calibrate the IC.  \n4. Apply a 60 Hz line frequency . \n5. Immediately, set the SELFREQ bit of the COMPMODE register  \nto 1. It is essential to complete this step immediately  after \nStep 4.  \n6. Wait for 10 seconds. This waiting period depends on how rapidly the frequency change from 50 Hz to 60 Hz takes place. For an instant change, the typical settling time for fundamental frequency based computations is 10 seconds. For a more gradual change, the waiting period is  shorte r.  \n7. Calibrate the IC.  \nExample 2: Consi der the scenario where the user plans to \nevaluate the performance of the IC  at 45 Hz and at 65 Hz. In \nsuch a case, t he following steps  must be followed  in sequential \norder . \n1. Apply a 45 Hz line frequency . \n2. Keep the SELFREQ bit of the COMPMODE register at 0.  \n3. Evaluate the IC.  \n4. Apply a 50 Hz line frequency . \n5. Wait for 10 seconds.  \n6. Apply a 65 Hz line frequency . \n7. Immediately  set the SELFREQ bit of the COMPMODE register  \nto 1. It is essential to complete this step immediately  after \nStep 6.  \n8. Wait for 10 seconds.  \n9. Evaluate th e IC.  \nActive Power Gain Calibration  \nNote that the average active power result from the LPF2 output in each phase can be sc aled by ±100% by writing to the  watt gain  \n24-bit register  of the phase  (APGAIN, BP GAIN, C PGAIN ). The \nxPGAIN registers are placed on da ta paths of all powers computed  \nby the ADE7880: total active powers, fundamental active and reactive powers and apparent powers. This is possible because \nall power data  paths have identical overa ll gains. Therefore, to \ncompensate the gain errors in various powers data  paths it is \nsufficient to analyze only one power data path, for example , the \ntotal active power, calculate the correspondent APGAIN, \nBPGAIN and CPGAIN registers , and all the power da ta paths \nare gain compensated.   \nThe power  gain registers are twos complement, signed registers \nand have a resolution of 2\n−23/LSB. Equation 2 3 describes \nmathematically the function of the power  gain registers. \n\uf8f7\uf8f7\n\uf8f8\uf8f6\n\uf8ec\uf8ec\n\uf8ed\uf8eb+×=\n2321 2gister Gain PowerOutput LPFData Power Average\nRe  (23) \nThe output is scale d by −50% by writing 0xC00000 to the watt \ngain registers, and it is increased by +50% by writing 0x400000 \nto them. These registers ar e used to calibrate the active , reactive \nand apparent  power (or energy) calculation for each phase.  \nAs stated in the Current Waveform Gain Registers  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words , \nand the DSP works on 28 bits. Similar to registers presented in Figure 44, the APGAIN, BP GAIN, and CPGAIN  24-bit signed \nregisters are accessed as 32 -bit registers with the four MSBs \npadded with 0s and sign extended to 28 bits.  \nRev. C | Page 47 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 48 of 107 Active Power Offset Calibration \nThe ADE7880  incorporates a watt offset 24-bit register on each \nphase and on each active power. The AW ATTOS, BW ATTOS, \nand CW ATTOS registers compensate the offsets in the total \nactive power calculations, and the AFW ATTOS, BFW ATTOS, and CFWATTOS registers compensate offsets in the fundamental active power calculations. These are signed twos complement, 24-bit registers that are used to remove offsets in the active \npower calculations. An offset can exist in the power calculation \ndue to crosstalk between channels on the PCB or in the chip itself. One LSB in the active power offset register is equivalent to 1 LSB in the active power multiplier output. With full-scale current and voltage inputs, the LPF2 output is PMAX = \n27,059,678. At −80 dB down from the full scale (active power \nscaled down 10\n4 times), one LSB of the active power offset \nregister represents 0.0369% of PMAX.  \nAs stated in the Current Waveform Gain Registers section, the \nserial ports of the ADE7880  work on 32-, 16-, or 8-bit words \nand the DSP works on 28 bits. Similar to registers presented in Figure 44, the AW ATTOS, BW ATTOS, CW ATTOS, AFWATTOS, \nB F WAT T O S ,  a nd  C F WAT T O S  2 4 - bit  s i g n e d  re g i st e r s  a re  a c c e s s e d  \nas 32-bit registers with the four MSBs padded with 0s and sign \nextended to 28 bits. \nSign of Active Power Calculation \nThe average active power is a signed calculation. If the phase \ndifference between the current and voltage waveform is  \nmore than 90°, the average power becomes negative. Negative \npower indicates that energy is being injected back on the grid. The ADE7880  has sign detection circuitry for active power \ncalculations. It can monitor the total active powers or the fundamental active powers. As described in the Active Energy \nCalculation section, the active energy accumulation is performed \nin two stages. Every time a sign change is detected in the energy accumulation at the end of the first stage, that is, after the energy accumulated into the internal accumulator reaches the WTHR register threshold, a dedicated interrupt is triggered. The sign of each phase active power can be read in the PHSIGN register.  Bit 6 (REV APSEL) in the ACCMODE register sets the type of active power being monitored. When REVAPSEL is 0, the default value, the total active power is monitored. When \nREVAPSEL is 1, the fundamental active power is monitored. \nBits[8:6] (REV APC, REV APB, and REV APA, respectively) in the \nSTATUS0 register are set when a sign change occurs in the power \nselected by Bit 6 (REV APSEL) in the ACCMODE register.  \nBits[2:0] (CWSIGN, BWSIGN, and AWSIGN, respectively) in \nthe PHSIGN register are set simultaneously with the REV APC, \nREV APB, and REV APA bits. They indicate the sign of the power. When they are 0, the corresponding power is positive. \nWhen they are 1, the corresponding power is negative. \nBit REV APx of STATUS0 and Bit xWSIGN in the PHSIGN \nregister refer to the total active power of Phase x, the power type \nbeing selected by Bit 6 (REV APSEL) in the ACCMODE register. \nInterrupts attached to Bits[8:6] (REV APC, REV APB, and \nREVAPA, respectively) in the STATUS0 register can be enabled \nby setting Bits[8:6] in the MASK0 register. If enabled, the IRQ0\n \npin is set low, and the status bit is set to 1 whenever a change of \nsign occurs. To find the phase that triggered the interrupt, the PHSIGN register is read immediately after reading the STATUS0 \nregister. Next, the status bit is cleared and the IRQ0\n pin is returned \nto high by writing to the STATUS0 register with the corresponding \nbit set to 1. \nActive Energy Calculation \nAs previously stated, power is defined as the rate of energy flow. \nThis relationship can be expressed mathematically as \ndtdEnergyPower\uf03d  (24) \nConversely, energy is given as the integral of power, as follows: \n\uf028\uf029dt t p Energy\uf0f2\uf03d  (25) \n \n \nINTERNAL\nACCUMULATOR\nTHRESHOLDHPFEN BIT\nCONFIG3[0]\nHPF\nDIGITAL SIGNAL PROCESSORAIGAIN\nAVGAINHPFEN BIT\nCONFIG3[0]INTEN BIT\nCONFIG[0]\nHPF\nVAIA\nLPFAPGAIN AWATTOS\nAPHCAL\n24AWATT :\nWTHR34 27 26 0\n032-BIT REGISTERAWATTHR[31:0]REVAPA BIT IN\nSTATUS0[31:0]\n10193-049 \nFigure 77. Total Active Energy Accumulation \nData Sheet ADE7880\n \nRev. C | Page 49 of 107 The ADE7880  achieves the integration of the active power signal \nin two stages (see Figure 77). The process is identical for both \ntotal and fundamental active powers. The first stage accumulates the instantaneous phase total or fundamental active power at \n1.024MHz, although they are computed by the DSP at 8 kHz \nrate. Every time a threshold is reached, a pulse is generated and the threshold is subtracted from the internal register. \nThe sign of the energy in this moment is considered the sign  \nof the active power (see the Sign of Active Power Calculation \nsection for details). The second stage consists of accumulating the pulses generated at the first stage into internal 32-bit accu-\nmulation registers. The content of these registers is transferred \nto watt-hour registers, xW ATTHR and xFW ATTHR, when \nthese registers are accessed. \nTHRESHOLD\n1 PULSE = 1LSB OF WATTHR[31:0]FIRST STAGE OF\nACTIVE POWER\nACCUMULATION\nPULSES\nGENERATED\nAFTER FIRST\nSTAGE\n10193-050 \nFigure 78. Active Power Accumulation Inside the DSP  \nFigure 78 explains this process. The threshold is formed by \nconcatenating the WTHR 8-bit unsigned register to 27 bits \nequal to 0. It is introduced by the user and is common for total and fundamental active powers on all phases. Its value depends on how much energy is assigned to one LSB of watt-hour regis-ters. Supposing a derivative of Wh [10\nn Wh], n as an integer, is \ndesired as one LSB of the xW ATTHR register, WTHR is \ncomputed using the following equation: \n27210 3600\n\uf0b4 \uf0b4\uf0b4 \uf0b4 \uf0b4\uf03d\nFS FSn\nS\nI Uf PMAXWTHR  (26) \nwhere: \nPMAX  = 27,059,678 = 0x19CE5DE as the instantaneous power \ncomputed when the ADC inputs are at full scale. f\nS = 1.024 MHz, the frequency at which every instantaneous \npower computed by the DSP at 8 kHz is accumulated. U\nFS, IFS are the rms values of phase voltages and currents when \nthe ADC inputs are at full scale.  \nWTHR register is an 8-bit unsigned number, so its maximum \nvalue is 28 − 1. Its default value is 0x3. Avoid values lower than \n3, that is, 2 or 1, and never use 0 as the threshold must be a non-\nzero value. \nThis discrete time accumulation or summation is equivalent to \nintegration in continuous time following the description in \nEquation 27. \n\uf028\uf029 \uf028\uf029\n\uf0fe\uf0fd\uf0fc\n\uf0ee\uf0ed\uf0ec\uf0b4 \uf03d \uf03d\uf0e5 \uf0f2\uf0a5\n\uf03d\uf0ae00 TLim\nnT nT p dt t p Energy  (27) where:  \nn is the discrete time sample number. \nT is the sample period.  \nIn the ADE7880 , the total phase active powers are accumulated \nin the AWATTHR, BWATTHR, and CWATTHR 32-bit signed registers, and the fundamental phase active powers are accumu-lated in the AFW ATTHR, BFW ATTHR, and CFW ATTHR 32-bit signed registers. The active energy register content can roll over \nto full-scale negative (0x80000000) and continue increasing in \nvalue when the active power is positive. Conversely, if the active power is negative, the energy register underflows to full-scale \npositive (0x7FFFFFFF) and continues decreasing in value. \nThe ADE7880  provides a status flag to signal when one of the \nxW ATTHR and xFW ATTHR registers is half full. Bit 0 (AEHF) \nin the STATUS0 register is set when Bit 30 of one of the xW ATTHR \nregisters changes, signifying one of these registers is half full. If \nthe active power is positive, the watt-hour register becomes half full when it increments from 0x3FFF FFFF to 0x4000 0000. If the active power is negative, the watt-hour register becomes half full when it decrements from 0xC000 0000 to 0xBFFF FFFF. \nSimilarly, Bit 1 (FAEHF) in STATUS0 register, is set when Bit 30 \nof one of the xFW ATTHR registers changes, signifying one of \nthese registers is half full. \nSetting Bits[1:0] in the MASK0 register enable the FAEHF and \nAEHF interrupts, respectively. If enabled, the IRQ0\n pin is set \nlow and the status bit is set to 1 whenever one of the energy \nregisters, xW ATTHR (for the AEHF interrupt) or xFW ATTHR (for the FAEHF interrupt), become half full. The status bit is \ncleared and the IRQ0\n pin is set to logic high by writing to the \nSTATUS0 register with the corresponding bit set to 1. \nSetting Bit 6 (RSTREAD) of the LCYCMODE register enables a \nread-with-reset for all watt-hour accumulation registers, that is, \nthe registers are reset to 0 after a read operation. \nIntegration Time Under Steady Load \nThe discrete time sample period (T) for the accumulation register \nis 976.5625 ns (1.024MHz frequency). With full-scale sinusoidal \nsignals on the analog inputs and the watt gain registers set to 0x00000, the average word value from each LPF2 is PMAX = \n27,059,678 = 0x19CE5DE. If the WTHR register threshold is set \nat 3, its minimum recommended value, the first stage accumulator \ngenerates a pulse that is added to watt-hour registers every \nsec 531 . 1410 024 . 12 3\n627\n\uf06d \uf03d\uf0b4 \uf0b4\uf0b4\nPMA X \nThe maximum value that can be stored in the watt-hour \naccumulation register before it overflows is 231 − 1 or \n0x7FFFFFFF. The integration time is calculated as \nTime = 0x7FFF,FFFF × 14.531 μs = 8 hr 40 min 6 sec (28) \n \n \nADE7880 Data Sheet\n \nRev. C | Page 50 of 107 Active Energy Ac cumulation Modes \nThe active power is accumulated in each watt-hour \naccumulation 32-bit register (AW ATTHR, BW ATTHR, \nC WAT T H R ,  A F WAT T H R ,  B F WAT T H R ,  a n d  C F WAT T H R )  \naccording to the configuration of Bit 5 and Bit 4 (CONSEL bits) in the ACCMODE register. The various configurations are \ndescribed in Table 14. \nTable 14. Inputs to Watt-Hour Accumulation Registers \nCONSEL  AWAT THR BWAT THR  CWAT THR \n00  VA × IA  VB × IB  VC × IC  \n01 VA × IA VB × IB  \nVB = VA – VC1 VC × IC \n10  VA × IA  VB × IB  VC × IC \n  VB = −VA − VC  \n11  VA × IA  VB × IB  VC × IC  \n  VB = −VA  \n1 In a 3-phase three wire case  (CONSEL[1:0] = 01), the ADE7880  computes the \nrms value of the line voltage between Phase A and Phase C and stores the \nresult into BVRMS register (see the Voltage RMS in 3-Phase, 3-Wire Delta \nConfigurations section) . Consequently, the ADE7880  computes powers \nassociated with Phase B that do not ha ve physical meaning. To avoid any \nerrors in the frequency output pins (CF1, CF2, or CF3) related to the powers associated with Phase B, disable the contribution of Phase B to the energy-to-\nfrequency converters by setting bits TERMSEL1[1] or TERMSEL2[1] or TERMSEL3[1] \nto 0 in the COMPMODE register (see the Energy-to-Frequency Conversion \nsection). \nDepending on the polyphase meter service, choose the appro-\npriate formula to calculate the active energy. The American \nANSI C12.10 standard defines the different configurations of \nthe meter. Table 15 describes which mode to choose in these \nvarious configurations. \nTable 15. Meter Form Configuration \nANSI Meter Form Configuration CONSEL  \n5S/13S 3-wire delta 01 \n6S/14S 4-wire wye 10 \n8S/15S 4-wire delta 11 \n9S/16S 4-wire wye 00 \nBits[1:0] (W ATTACC[1:0]) in the ACCMODE register determine \nhow the active power is accumulated in the watt-hour registers \nand how the CF frequency output can be generated as a function of the total and fundamental active powers. See the \nEnergy-to-Frequency Conversion section for details. \nThe apparent power computation, in 3-wire and 4-wire delta \nconfigurations, will be incorrect, because the line to line voltages are treated as phase voltages by the IC. To get the \nequivalent wye-configuration apparent power, a scaling factor \nneeds to be applied. Refer to the Three Phase Configurations section of AN-639 Application Note , Analog Devices Energy \n(ADE) Products: Frequently Asked Questions (FAQ) , for details. \nLine Cycle Active Energy Accumulation Mode \nIn line cycle energy accumulation mode, the energy accumula-\ntion is synchronized to the voltage channel zero crossings such that active energy is accumulated over an integral number of \nhalf line cycles. The advantage of summing the active energy over an integer number of line cycles is that the sinusoidal compo-nent in the active energy is reduced to 0. This eliminates any ripple in the energy calculation and allows the energy to be accumulated accurately over a shorter time. By using the line \ncycle energy accumulation mode, the energy calibration can be \ngreatly simplified, and the time required to calibrate the meter can be significantly reduced. In line cycle energy accumulation mode, the ADE7880  transfers the active energy accumulated in the \n32-bit internal accumulation registers into the xW ATHHR or \nxFW ATTHR registers after an integral number of line cycles, as \nshown in Figure 79. The number of half line cycles is specified \nin the LINECYC register. \nThe line cycle energy accumulation mode is activated by setting \nBit 0 (LW ATT) in the LCYCMODE register. The energy accu-mulation over an integer number of half line cycles is written to the watt-hour accumulation registers after LINECYC number of half line cycles is detected. When using the line cycle accumulation \nmode, the Bit 6 (RSTREAD) of the LCYCMODE register must \nbe set to Logic 0 because the read with reset of watt-hour registers \nis not available in this mode. \nPhase A, Phase B, and Phase C zero crossings are, respectively, \nincluded when counting the number of half line cycles by setting Bits[5:3] (ZXSEL[x]) in the LCYCMODE register. Any combi-nation of the zero crossings from all three phases can be used \nfor counting the zero crossing. Select only one phase at a time \nfor inclusion in the zero crossings count during calibration. \nZERO-\nCROSSING\nDETECTION\n(PHASE A)\nZERO-\nCROSSING\nDETECTION\n(PHASE B)CALIBRATION\nCONTROL\nZERO-\nCROSSING\nDETECTION\n(PHASE C)LINECYC[15:0]\nAWATTHR[31:0]ZXSEL[0] IN\nLCYCMODE[7:0]\nZXSEL[1] IN\nLCYCMODE[7:0]\nZXSEL[2] IN\nLCYCMODE[7:0]\nOUTPUT\nFROM\nLPF2APGAIN AWATTOS\nINTERNAL\nACCUMULATOR\nTHRESHOLD32-BIT\nREGISTER\nWTHR34 27 26 0\n0\n10193-051 \nFigure 79. Line Cycle Active Energy Accumulation Mode \nThe number of zero crossings is specified by the LINECYC 16-bit \nunsigned register. The ADE7880  can accumulate active power \nfor up to 65,535 combined zero crossings. Note that the internal zero-crossing counter is always active. By setting Bit 0 (LW ATT) in the LCYCMODE register, the first energy accumulation result is, therefore, incorrect. Writing to the LINECYC register when \nData Sheet  ADE7880  \n \nthe LW ATT bit is set resets the zero -crossing counter, thus \nensuring that the first energy accumulation result is accurate.  \nAt the end of an energy calibration cycle, Bit 5 (LENERGY) in \nthe STATUS0 register is set. If the corresponding mask bit in \nthe MASK0  interrupt mask register is enabled, the IRQ0  pin \nalso goes active low. The status bit is cleared and the IRQ0  pin is \nset to high again by writing to the STATUS0 register with the corresponding bit set to 1.  \nBecause the active power is integrated on an integer number of \nhalf-line cycles in this mode, the sinusoidal components are \nreduced to 0, eliminating any ripple in the en ergy calculation. \nTherefore, total energy accumulated using the line cycle accumulation mode is  \n()∑ ∫∞\n=+\n= =\n1kkknTt\ntIV nT dttp e cos(φk – γk) (29) \nwhere nT is the accumulation time.  \nNote that line cycle active energy accumulation uses the same signal path as the acti ve energy accumulation. The LSB size of \nthese two methods is equivalent.  \nFUNDAMENTAL REACTIVE POWER CALCU LATION  \nThe ADE7880 computes the fundamental reactive power, the \npower determined only by the fundamental components of the \nvoltages and currents.  \nThe ADE7880 also computes the harmonic reactive powers, the \nreactive powers determined by the harmonic components of the voltages and curr ents. See Harmonics Calculations  section for \ndetails. A load that contains a reactive element (inductor or \ncapacitor) produces a phase difference between the applied ac voltage and the resulting current. The power associated wit h \nreactive elements  is called reactive power, and its unit is V AR. \nReactive power is defined as the product of the voltage and current waveforms when  all harmonic components of one of these \nsignals are phase shifted by 90°.  \nEquation 31 is an example of  the instantaneous reactive power \nsignal in an ac system when the phase of the current channel is \nshifted by +90°.  \n∑∞\n==\n12 )(\nkkV tv sin(kωt + φk) (30) \n()k\nkk tk I ti γ+ω =∑∞\n=sin2 )(\n1 (31) \n\uf8f7\uf8f8\uf8f6\uf8ec\uf8ed\uf8eb π+γ+ω =∑∞\n= 2sin2 )('\n1k\nkktk I ti  \nwhere i’(t) is the current waveform with all harmoni c \ncomponents phase shifted by 90°.  \nNext, the instantaneous reactive  power , q(t),  can be expressed as  \nq(t) = v(t) × iʹ(t) (32) ∑∞\n=×=\n12 )(\nkkkIV tq sin(kωt + φk) × sin(kωt  + γk + 2π) + \n∑∞\n≠=\nmkmkmkIV\n1,× 2sin( kωt + φk) × sin(mωt  + γm + 2π) \nNote that q (t) can be rewritten as  \n∑∞\n==\n1)(\nkkkIV tq {cos(φk − γk − 2π) − cos (2 kωt + φk + γk + 2π)} + \n∑∞\n≠=\nmkmkmkIV\n1,{cos[(k – m)ωt + φ k − γk − 2π]− \ncos[(k + m)ωt + φ k + γk + 2π]} (33) \nThe average total reactive power over an integral number of line \ncycles (n) is shown  in Equation 3 4. \n()∫∑∞\n== =nT\nkkkIV dttqnTQ\n0 11cos(φk – γk − 2π) (34) \n∑∞\n==\n1kkkIV Q sin(φk – γk) \nwhere :  \nT is the period of the line cycle.  \nQ is referred to as the total reactive power. Note that the total \nreactive power is equal to the dc component of the instantaneous  \nreactive power signal q(t)  in Equation 32, that is,  \n∑∞\n=1kkkIV  sin(φk – γk) \nThis is the relationship used to calculate the total reactive power \nfor each phase. The instantaneous reactive power signal, q(t), is gener ated by multiplying each harmonic of the voltage signals \nby the 90° phase -shifted corresponding harmonic of the c urrent \nin each phase.  \nThe expression of fundamental reactive power is obtained from Equation 33 with k = 1, as follows: \nFQ = V\n1I1 sin(φ 1 – γ1) \nThe ADE7880 computes the fundamental reactive power using \na proprietary algorithm that requires some initialization function of the frequency of the network and its nominal voltage measured  \nin the voltage channel. These initializations are introduced in the Active Power Calculation  section and are common for both \nfundamental active and reactive powers.  \nThe ADE7880 store s the instantaneous fundamental  phase reactive  \npowers into the AFV AR, BFV AR, and CFV AR registers.  Their \nequation  is \n××=\nFS FS II\nVVxFVAR1 1sin(φ1 – γ1) × PMAX  × 421 (35) \nwhere:  \nVFS, IFS are the rms values of the phase voltage and current when \nthe ADC inputs are at full scale. \nRev. C | Page 51 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 52 of 107 PMAX  = 27,059,678, the instantaneous power computed when \nthe ADC inputs are at full scale and in phase. \nThe xFV AR waveform registers are not mapped with an address \nin the register space and can be accessed only through HSDC \nport in the waveform sampling mode (see Waveform Sampling \nMode section for details). Fundamental reactive power information is also available through the harmonic calculations \nof the ADE7880  (see Harmonics Calculations section for details).  \nTable 16 presents the settling time for the fundamental reactive \npower measurement, which is the time it takes the power to reflect the value at the input of the ADE7880 . \nTable 16. Settling Time for Fundamental Reactive Power \nInput Signals \n63% PMAX 100% PMAX \n375 ms 875 ms \nBit 14 (SELFREQ) in the COMPMODE register must be set \naccording to the frequency of the network in which the ADE7880 \nis connected. If the network frequency is between 45 Hz and 55 Hz, \nclear this bit to 0 (the default value). If the network frequency is \nbetween 55 Hz and 66 Hz, set this bit to 1. In addition, initialize \nthe VLEVEL, 28-bit signed register based on Equation 22. \nRefer to the Managing Change in Fundamental Line Frequency \nsection for details on how to manage changes in line frequency. \n Fundamental Reactive Power Gain Calibration \nThe average fundamental reactive power in each phase can be \nscaled by ±100% by writing to one of the phase’s V AR gain 24-bit \nregister (APGAIN, BPGAIN, or CPGAIN). Note that these \nregisters are the same gain registers used to compensate the other powers computed by the ADE7880 . See the Active Power Gain \nCalibration section for details on these registers. \nFundamental Reactive Power Offset Calibration \nThe ADE7880  provides a fundamental reactive power offset \nregister on each phase. The AFV AROS, BFV AROS, and CFV AROS registers compensate the offsets in the fundamental reactive power calculations. These are signed twos complement, 24-bit registers that are used to remove offsets in the fundamental reactive power \ncalculations. An offset can exist in the power calculation due to \ncrosstalk between channels on the PCB or in the chip itself. The resolution of the registers is the same as for the active power \noffset registers (see the Active Power Offset Calibration section).  \nAs stated in the Current Waveform Gain Registers section, the \nserial ports of the ADE7880  work on 32-, 16-, or 8-bit words \nand the DSP works on 28 bits. Similar to the registers presented \ni n  Fi g u re  4 4 ,  t h e  A F VA R O S ,  B F VA R O S ,  an d  C F VA R O S  2 4 - bit  \nsigned registers are accessed as 32-bit registers with the four \nMSBs padded with 0s and sign extended to 28 bits. \nINTERNAL\nACCUMULATOR\nTHRESHOLDHPFEN BIT\nCONFIG3[0]\nHPF\nDIGITAL SIGNAL PROCESSORAVGAINHPFEN BIT\nCONFIG3[0]DIGITAL\nINTEGRATOR\nHPF\nVAIA\nFUNDAMENTAL\nREACTIVE\nPOWER\nALGORITHMAPGAIN AFVAROS\nAPHCAL\n24AFVAR :\nVARTHR34 27 26 0\n032-BIT REGISTERAFVARHR[31:0]REVFRPA BIT IN\nSTATUS0[31:0]\n10193-052AIGAIN\n \nFigure 80. Fundamental Reactive Energy Accumulation \n \n \nData Sheet  ADE7880  \n \nSign of Fundamental Reactive Power Calculation  \nNote that the fundamental reactive pow er is a signed calculation.  \nTable 17 summarizes the relationship between the phase difference  \nbetween the voltage and the current and the sign of the resulting  \nreactive power calculation.  \nThe ADE7880 has sign detection circuitry for reactive power  \ncalculations that can monitor the fundamental reactive powers. \nAs described in the Fundamental Reactive Energy Calculation  \nsection, the reactive ener gy accumulation is executed in two \nstages. Every time a sign change is detected in the energy \naccumulation at the end of the first stage, that is, after the energy \naccumulated into the internal accumulator  reaches the V ARTHR \nregister threshold, a dedicated  interrupt is triggered. The sign of \neach phase reactive power can be read in the PHSIGN register.  \nBits[12:10] (REV FRPC, REV FRPB, and REV FRPA, respect -\ntively) in the STATUS0  register are set when a sign change \noccurs in the fundamental reactive power.  \nBits[6:4] (CFV ARSIGN, BFV ARSIGN, and AFV ARSIGN,  \nrespectively)  in the PHSIGN register are set simultaneously  with \nthe REV FRPC, RE VFRPB, and REV FRPA bits. They indicate the \nsign of the fundamental reactive power. When they are 0, the \nreactive power is positive . When they are 1, the reactive power \nis negative. \nBit REV FRPx of the STATUS0  register and Bit xF VA R SI G N  i n  \nthe PHSIGN register refer to the reactive power of Phase x.  \nSetting Bits[12:10] in the MASK0 register enables the REVFRPC , \nREV FRPB, and REV FRPA inte rrupts, respectively. If enabled, \nthe IRQ0  pin is set low and the status bit is set to 1 whenever a \nchange of sign occurs. To find the phase that triggered the  \ninterrupt, the PHSIGN register is read immediately after read -\ning the STATUS0 register. Next, the status bit is cleared and the  \nIRQ0  pin is set to high by writing to the STATUS0 register with \nthe corresponding bit set to 1.  \nTable 17. Sign of Reactive Power Calculation  \nΦ1 Sign of Reactive Pow er \nBetween 0 to +180  Positive  \nBetween −180 to 0  Negative  \n1 Φ is defined as the phase angle of the voltage signal minus the current \nsignal; that is, Φ  is positi ve if the load is inductive and negative if the load is \ncapacitive.  \nFundamental Reactive E nergy Calculation  \nFundamental r eactive energy is defined as the integral of \nfundamental reactive power.  \nReactive Energy  = ∫q(t)dt  (36) \n Similar to active power, the ADE7880 achieve s the integrat ion \nof the reactive power signal in two stages (see Figure 80).  \n• The first stage accumulates the instantaneous phase \nfundamental reactive power at 1.024  MHz, although they \nare computed by the DSP at 8  kHz rate. Every time a thre shold  \nis reached, a pulse is generated and the threshold is subtracted  \nfrom the internal register. The sign of the energy in this \nmoment is considered the sign of the reactive power (see \nthe Sign of Fundamental Reactive Power Calcu lation  \nsection for details).  \n• The second stage consists in accumulating the pulses generated  \nafter the first stage into internal 32 -bit accumulation registers.  \nThe content of these registers is transferred to the var -hour \nregisters (xFV ARHR) when these reg isters are accessed. \nAFW ATTHR, BFW ATTHR, and CFW ATTHR represent phase fundamental reactive energies.  \nFigure 80 explains this process. The threshold is formed by \nconcatenating the V ARTHR 8 -bit unsigned register to 27 bits \nequal t o 0 and i t is introduced by the user . Its value depends on \nhow much energy is assigned to one LSB of var -hour  registers. \nSupposing a derivative of a v olt ampere reactive hour (varh)  \n[10\nn varh] where n is an integer, is desired as one LSB of the \nV ARHR regis ter, the V ARTHR register can be computed using \nthe following equation:  \n27210 3600\n×××××=\nFS FSn\ns\nI Uf PMAXVARTHR\n (37) \nwhere:  \nPMAX  = 27,059,678 = 0x19CE5DE, the instantaneous power \ncomputed when the ADC inputs are at full scale.  \nfS = 1.024 MHz, the frequency at which every in stantaneous \npower computed by the DSP at 8  kHz is accumulated.  \nUFS, IFS are the rms values of phase voltages and currents when \nthe ADC inputs are at full scale.  \nV ARTHR register is an 8 -bit unsigned number, so its maximum \nvalue is 28 − 1. Its default value  is 0x3.  Avoid, v alues lower than \n3, that is , 2 or 1 , and never use 0 as the threshold must be a non -\nzero value.  \nThis discrete time accumulation or summation is equivalent to  \nintegration in continuous time, shown in Equation 3 8: \n() ()\n\uf8fe\uf8fd\uf8fc\n\uf8f3\uf8f2\uf8f1× == ∑ ∫∞\n=→00TLim\nnT nTq dttq ergy ReactiveEn  (38) \nwhere:  \nn is the discrete time sample number.  \nT is the sample period.  \nRev. C | Page 53 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 54 of 107 On the ADE7880 , the fundamental phase reactive powers are \naccumulated in the AFV ARHR, BFV ARHR, and CFV ARHR 32-bit \nsigned registers. The reactive energy register content can roll over to full-scale negative (0x80000000) and continue increasing in \nvalue when the reactive power is positive. Conversely, if the reactive \npower is negative, the energy register underflows to full-scale positive (0x7FFFFFFF) and continues to decrease in value. \nThe ADE7880  provides a status flag to signal when one of the \nxFV ARHR registers is half full. Bit 3 (FREHF) in the STATUS0 \nregister is set when Bit 30 of one of the xFV ARHR registers changes, signifying one of these registers is half full. If the reactive \npower is positive, the var-hour register becomes half full when it \nincrements from 0x3FFF FFFF to 0x4000 0000. If the reactive power is negative, the var-hour register becomes half full when \nit decrements from 0xC000 0000 to 0xBFFF FFFF .  \nSetting Bit 3 in the MASK0 register enables the FREHF interrupt. \nIf enabled, the IRQ0\n pin is set low and the status bit is set to 1 \nwhenever one of the energy registers, xFV ARHR, becomes half full. The status bit is cleared and the IRQ0\n pin is set to high by \nwriting to the STATUS0 register with the corresponding bit set to 1. \nSetting Bit 6 (RSTREAD) of the LCYCMODE register enables a \nread-with-reset for all var-hour accumulation registers, that is, \nthe registers are reset to 0 after a read operation. \nIntegration Time Under Steady Load \nThe discrete time sample period (T) for the accumulation \nregister is 976.5625 ns (1.024 MHz frequency). With full-scale \nsinusoidal signals on the analog inputs and a 90° phase difference between the voltage and the current signal (the largest possible reactive power), the average word value representing the reactive \npower is PMAX = 27,059,678 = 0x19CE5DE. If the V ARTHR \nthreshold is set at 3, its minimum recommended value, the first stage accumulator generates a pulse that is added to var-hour \nregisters every  \nμsec 531 . 1410 024 . 12 3\n627\n\uf03d\uf0b4 \uf0b4\uf0b4\nPMA X \nThe maximum value that can be stored in the var-hour \naccumulation register before it overflows is 231 − 1 or \n0x7FFFFFFF. The integration time is calculated as \nTime = 0x7FFF,FFFF × 14.531 μs = 8 hr 40 min 6 sec (39) \nFundamental Reactive Energy Accumulation Modes \nThe fundamental reactive power accumulated in each var-hour \naccumulation 32-bit register (AFV ARHR, BFV ARHR, and CFV ARHR) depends on the configuration of Bits[5:4] \n(CONSEL[1:0]) in the ACCMODE register, in correlation with the watt-hour registers. The different configurations are described in Table 18. Note that IA\n’/IB’/IC’ are the phase-\nshifted current waveforms. \n Table 18. Inputs to Var-Ho ur Accumulation Registers \nCONSEL[1:0] AFVARHR  BFVARHR  CFVARHR  \n00  VA × IA’  VB × IB’  VC × IC’  \n01  VA × IA’ VB × IB’  \nVB = VA − VC1 VC × IC’ \n10  VA × IA’  VB × IB’ VC x IC’  \n  VB = −VA − VC  \n11  VA × IA’  VB × IB’ VC × IC’  \n  VB = −VA  \n \n1 In a 3-phase three wire case  (CONSEL[1:0] = 01), the ADE7880  computes the \nrms value of the line voltage between phases A and C and stores the result \ninto BVRMS register (see the Voltage RMS in 3-Phase, 3-Wire Delta Configurations section) . Consequently, the ADE7880  computes powers \nassociated with Phase B that do not ha ve physical meaning. To avoid any \nerrors in the frequency output pins (CF1, CF2, or CF3) related to the powers \nassociated with Phase B, disable the contribution of Phase B to the energy to \nfrequency converters by setting bits TERMSEL1[1] or TERMSEL2[1] or TERMSEL3[1] to 0 in COMPMODE register (see the Energy-to-Frequency \nConversion section). \nBits[3:2] (V ARACC[1:0]) in the ACCMODE register determine \nhow the reactive power is accumulated in the var-hour registers \nand how the CF frequency output can be generated function of total and fundamental active and reactive powers. See the Energy-\nto-Frequency Conversion section for details. \nThe apparent power computation, in 3-wire and 4-wire delta \nconfigurations, will be incorrect, because the line to line \nvoltages are treated as phase voltages by the IC. To get the \nequivalent wye-configuration apparent power, a scaling factor needs to be applied. Refer to the Three Phase Configurations section of AN-639 Application Note , Analog Devices Energy \n(ADE) Products: Frequently Asked Questions (FAQ) , for details. \nLine Cycle Reactive Energy Accumulation Mode \nAs mentioned in the Line Cycle Active Energy Accumulation \nMode section, in line cycle energy accumulation mode, the \nenergy accumulation can be synchronized to the voltage channel zero crossings so that reactive energy can be \naccumulated over an integral number of half line cycles. \nIn this mode, the ADE7880  transfers the reactive energy \naccumulated in the 32-bit internal accumulation registers into \nthe xFV ARHR registers after an integral number of line cycles, \nas shown in Figure 81. The number of half line cycles is \nspecified in the LINECYC register. \nThe line cycle reactive energy accumulation mode is activated by \nsetting Bit 1 (LV AR) in the LCYCMODE register. The fundamental reactive energy accumulated over an integer number of half line cycles or zero crossings is available in the var-hour accumulation registers after the number of zero crossings specified in the \nLINECYC register is detected. When using the line cycle \naccumulation mode, set Bit 6 (RSTREAD) of the LCYCMODE register to Logic 0 because a read with the reset of var-hour \nregisters is not available in this mode. \nData Sheet ADE7880\n \nRev. C | Page 55 of 107 ZERO-\nCROSSING\nDETECTION\n(PHASE A)\nZERO-\nCROSSING\nDETECTION\n(PHASE B)CALIBRATION\nCONTROL\nZERO-\nCROSSING\nDETECTION\n(PHASE C)LINECYC[15:0]\nAFVARHR[31:0]ZXSEL[0] IN\nLCYCMODE[7:0]\nZXSEL[1] IN\nLCYCMODE[7:0]\nZXSEL[2] IN\nLCYCMODE[7:0]\nOUTPUT FROM\nFUNDAMENTAL REACTIVE\nPOWER ALGORITHMAPGAIN AFVAROS\nINTERNAL\nACCUMULATOR\nTHRESHOLD32-BIT\nREGISTER\nVARTHR34 27 26 0\n0\n10193-053 \nFigure 81. Line Cycle Fundamental Reactive Energy Accumulation Mode \nPhase A, Phase B, and Phase C zero crossings are, respectively, \nincluded when counting the number of half line cycles by setting Bits[5:3] (ZXSEL[x]) in the LCYCMODE register. Any \ncombination of the zero crossings from all three phases can be \nused for counting the zero crossing. Select only one phase at a \ntime for inclusion in the zero-crossings count during calibration. \nFor details on setting the LINECYC register and Bit 5 \n(LENERGY) in the MASK0 interrupt mask register associated with the line cycle accumulation mode, see the Line Cycle \nActive Energy Accumulation Mode section. \nAPPARENT POWER CALCULATION \nApparent power is defined as the maximum active power that \ncan be delivered to a load. One way to obtain the apparent power is by multiplying the voltage rms value by the current \nrms value (also called the arithmetic apparent power). \nS = V rms  × I rms (40) \nwhere: \nS is the apparent power. \nV rms  and I rms  are the rms voltage and current, respectively.  \nThe ADE7880  computes the arithmetic apparent power on each \nphase. Figure 82 illustrates the signal processing in each phase \nfor the calculation of the apparent power in the ADE7880 . \nBecause V rms and I rms contain all harmonic information, the \napparent power computed by the ADE7880  is total apparent \npower. The ADE7880 computes fundamental and harmonic \napparent powers determined by the fundamental and harmonic \ncomponents of the voltages and currents. See the Harmonics \nCalculations section for details.  \nThe ADE7880  stores the instantaneous phase apparent powers \ninto the AV A, BV A, and CV A registers. Their equation is \n421\uf0b4 \uf0b4 \uf0b4 \uf03d PMAXII\nUUxVA\nFS FS (41) \nwhere: \nU, I are the rms values of the phase voltage and current. \nUFS, IFS are the rms values of the phase voltage and current when \nthe ADC inputs are at full scale. \nPMAX  = 27,059,678, the instantaneous power computed when \nthe ADC inputs are at full scale and in phase. \nThe xV A[23:0] waveform registers may be accessed using \nvarious serial ports. Refer to the Waveform Sampling Mode section for more details. \nThe ADE7880  can compute the apparent power in an alternative \nway by multiplying the phase rms current by an rms voltage \nintroduced externally. See the Apparent Power Calculation \nUsing VNOM section for details. \nINTERNAL\nACCUMULATOR\nTHRESHOLDDIGITAL SIGNAL\nPROCESSORAPGAIN\n24AVA :\nVATHR34 27 26 0\n032-BIT REGISTERAVAHR[31:0]AIRMS\nAVRMS\n10193-054 \nFigure 82. Apparent Power Data Flow  and Apparent Energy Accumulation \n \nADE7880  Data Sheet  \n \nApparent Power Gain Calibration  \nThe average apparent power result in each phase can be scaled \nby ±100% by writing to one of the phase’s P GAIN 24- bit \nregister s (APGAIN, BP GAIN , or C PGAIN). Note that these \nregisters are the same gain registers used to compensate the \nother powers computed by the ADE7880. See the Active Power \nGain Calibration  section for de tails on these registers.  \nApparent Power Offset Calibration  \nEach rms measurement includes an offset compensation register   \nto calibrate and eliminate the dc component in the rms value \n(see the Root Mean Square Measurement  section) . The voltage \nand current rms values are multiplied together in the apparent power signal processing . As no additional offsets are created in \nthe multiplication of the rms values, there is no specific offset \ncompensation in the apparent  power signal proces sing. The offset \ncompensation of the apparent  power measurement in each phase is  \naccomplished  by calibrating each individual rms measurement.  \nApparent Power Calculation Using VNOM  \nThe ADE7880 can compute the apparent power by multiplying \nthe phase rms current by an rms voltage introduced externally in the VNOM 24 -bit signed register.  \nWhen one of Bits[13:11] (VNOMCEN, VNOMBEN, or VNOMAEN) in the COMPMODE register is set to 1, the \napparent power in  the corresponding phase (Phase x for \nVNOMxEN) is computed in this way. When the VNOMxEN \nbits are cleared to 0, the default value, then the arithmetic apparent  \npower is computed.  When the VNOMxEN bit is set to 1, the \napplied voltage input in the correspond ing phase is ignored \nand all corresponding rms voltage instances are replaced by \nthe value in the VNOM register.  \nThe VNOM register contains a number determined by V , the \ndesired nominal phase rms voltage , and V\nFS, the rms value of \nthe phase voltage when th e ADC inputs are at full scale:  \n572,766,3×=\nFSVVVNOM  (42) \nwhere V is the nominal phase rms voltage.  \nAs stated  in the Current Waveform Gain Registers , the serial \nports of the ADE7880 work on 32 -, 16-, or 8 -bit words. Similar \nto the register presented in  Figure 59, the VNOM 24 -bit sign ed \nregister is accessed as a 32 -bit register with the eight MSBs \npadded with 0s.  \nApparent Energy Calculation  \nAppa rent energy is defined as the integral of apparent power.  \nApparent Energy  = ∫s(t)dt (43) \nSimilar to active and reactive powers, the ADE7880 achieve s \nthe integration of the apparent power signal i n two stages (see \nFigure 82). The first stage accumulates the instantaneous \napparent power at 1.024 MHz, although they are computed by \nthe DSP at 8  kHz rate. Every time a threshold is reached, a pulse \nis generated and the threshold is subtracted from the internal register. The second stage consists in accumulating the pulses \ngenerated after the first stage into internal 32 -bit accumulation \nregisters. The content of these registers is transferred to the V A -\nhour reg isters, xV AHR, when these registers are accessed.  \nFigure 82 illustrates this process. The threshold is formed by the \nVAT H R  8 -bit unsigned register concatenated to 27 bits equal to \n0. It is introduced by the user and is common f or all phase total \nactive and fundamental powers. Its value depends on how much energy is assigned to one LSB of V A -hour registers. When a \nderivative of apparent energy (V Ah) [10\nn V Ah], where n is an \ninteger, is desired as one LSB of the xV AHR register, th e  x VAT H R  \nregister can be computed using the following equation:  \n27210 3600\n×××××=\nFS FSn\ns\nI Uf PMAXVATHR\n (44) \nwhere:  \nPMAX  = 27,059,678 = 0x19CE5DE, the instantaneous power \ncomputed when the ADC inputs are at full scale.  \nfS = 1.024 MHz, the frequency at which every instantan eous \npower computed by the DSP at 8  kHz is accumulated.  \nUFS, IFS are the rms values of phase voltages and currents when \nthe ADC inputs are at full scale.  \nThe V ATHR register is an 8 -bit unsigned number, so its \nmaximum value is 28 − 1. Its default value is 0x3.  Avoid v alues \nlower than 3, that is , 2 or 1 ; never use  0 as the threshold must be \na non -zero value.  \nThis discrete time accumulation or summation is equivalent to \nintegration in continuous time following the description in \nEqua tion 4 5. \n() ()\n\uf8fe\uf8fd\uf8fc\n\uf8f3\uf8f2\uf8f1× == ∑ ∫∞\n=→00TLim\nnT nTs dtts ergy ApparentEn  (45) \nwhere:  \nn is the discrete time sample number.  \nT is the sample period.  \nIn the ADE7880, the phase apparent powers are accumulated in t h e  AVA H R ,  BVA H R ,  an d  C VA H R 32 -bit signed registers. The \napparent energy register content can roll over to full -scale negative  \n(0x80000000) and continue increasing  in value when the apparent \npower is positive.  \nThe ADE7880 provides a status flag to signal when one of the \nxVAHR registers  is half full. Bit 4 (V AEHF) in the STATUS0  \nregister is set when Bit 30 of one of the xV AHR registers changes , \nsignifying one of these registers is half full. As the apparent \npower is always positive and the xV AHR registers are signed, the \nVA-hour registers become  half full when they incr ement from \n0x3FFFFFFF to 0x4000 0000. In terrupts attached to Bit V AEHF in \nthe STATUS0 register can be enabled by setting Bit 4 in the MASK0  \nregister. If enabl ed, the \nIRQ0  pin is set low and the status bit is \nset to 1 whenever one of the Energy Registers xV AHR becomes \nhalf full. The status bit is cleared and the IRQ0  pin is set to high \nRev. C | Page 56 of 107 \nData Sheet ADE7880\n \nRev. C | Page 57 of 107 by writing to the STATUS0 register with the corresponding bit \nset to 1. \nSetting Bit 6 (RSTREAD) of the LCYCMODE register enables a \nread-with-reset for all xV AHR accumulation registers, that is, \nthe registers are reset to 0 after a read operation. \nIntegration Time Under Steady Load \nThe discrete time sample period for the accumulation register  \nis 976.5625 ns (1.024 MHz frequency). With full-scale pure \nsinusoidal signals on the analog inputs, the average word value representing the apparent power is PMAX. If the V ATHR threshold register is set at 3, its minimum recommended value, \nthe first stage accumulator generates a pulse that is added to the \nxV AHR registers every \nsec 531 . 14\n10 024 . 12 3\n627\n\uf06d\uf03d\n\uf0b4 \uf0b4\uf0b4\nPMAX \nThe maximum value that can be stored in the xV AHR \naccumulation register before it overflows is 231 − 1 or \n0x7FFFFFFF. The integration time is calculated as \nTime = 0x7FFFFFFF × 14.531 μs = 8 hr 40 min 6 sec (46) \nApparent Energy Accumulation Modes \nThe apparent power accumulated in each accumulation register \ndepends on the configuration of Bits[5:4] (CONSEL[1:0]) in the \nACCMODE register. The various configurations are described \nin Table 19.  \nTable 19. Inputs to V A-Hour Accumulation Registers \nCONSEL[1:0] AVAHR BVAHR CVAHR \n00 AVRMS × AIRMS BVRMS × BIRMS CVRMS × CIRMS \n01 AVRMS × AIRMS BVRMS × BIRMS \nVB = VA – VC1 CVRMS × CIRMS \n10 AVRMS × AIRMS BVRMS × BIRMS CVRMS × CIRMS \n  VB = −VA − VC  \n11 AVRMS × AIRMS BVRMS × BIRMS CVRMS × CIRMS \n  VB = −VA  \n1 In a 3-phase three wire ca se (CONSEL[1:0] = 01), the ADE7880  computes the \nrms value of the line voltage between Phase A and Phase C and stores the \nresult into the BVRMS register (see the Voltage RMS in 3-Phase, 3-Wire Delta \nConfigurations section) . Consequently, the ADE7880  computes powers \nassociated with Phase B that do not ha ve physical meaning. To avoid any \nerrors in the frequency output pins (CF1, CF2, or CF3) related to the powers associated with Phase B, disable the contribution of phase B to the energy to \nfrequency converters by setting bits TERMSEL1[1] or TERMSEL2[1] or \nTERMSEL3[1] to 0 in COMPMODE register (see the Energy-to-Frequency \nConversion section). \nThe apparent power computation, in 3-wire and 4-wire delta \nconfigurations, will be incorrect, because the line to line voltages are treated as phase voltages by the IC. To get the \nequivalent wye-configuration apparent power, a scaling factor \nneeds to be applied. Refer to the Three Phase Configurations section of AN-639 Application Note , Analog Devices Energy \n(ADE) Products: Frequently Asked Questions (FAQ) , for details. \n \n Line Cycle Apparent Energy Accumulation Mode \nAs described in the Line Cycle Active Energy Accumulation \nMode section, associated with the line cycle accumulation \nmode, the energy accumulation can be synchronized to the \nvoltage channel zero crossings allowing apparent energy to be accumulated over an integral number of half line cycles. In this mode, the ADE7880  transfers the apparent energy accumulated \nin the 32-bit internal accumulation registers into the xV AHR \nregisters after an integral number of line cycles, as shown in \nFigure 83. The number of half line cycles is specified in the \nLINECYC register. \nZERO-\nCROSSING\nDETECTION\n(PHASE A)\nZERO-\nCROSSING\nDETECTION\n(PHASE B)CALIBRATION\nCONTROL\nZERO-\nCROSSING\nDETECTION\n(PHASE C)LINECYC[15:0]ZXSEL[0] IN\nLCYCMODE[7:0]\nZXSEL[1] IN\nLCYCMODE[7:0]\nZXSEL[2] IN\nLCYCMODE[7:0]\nINTERNAL\nACCUMULATOR\nTHRESHOLDAPGAIN\nVATHR34 27 26 0\n032-BIT REGISTERAVAHR[31:0]\n10193-055AIRMS\nAVRMS\n \nFigure 83. Line Cycle Apparent Energy Accumulation Mode \nThe line cycle apparent energy accumulation mode is activated \nby setting Bit 2 (LV A) in the LCYCMODE register. The apparent energy accumulated over an integer number of zero crossings is \nwritten to the xV AHR accumulation registers after the number \nof zero crossings specified in LINECYC register is detected. When using the line cycle accumulation mode, set Bit 6 (RSTREAD) of the LCYCMODE register to Logic 0 because a read with the \nreset of xVAHR registers is not available in this mode. \nPhase A, Phase B, and Phase C zero crossings are, respectively, \nincluded when counting the number of half line cycles by setting \nBits[5:3] (ZXSEL[x]) in the LCYCMODE register. Any combi-\nnation of the zero crossings from all three phases can be used for counting the zero crossing. Select only one phase at a time \nfor inclusion in the zero-crossings count during calibration. \nFor details on setting the LINECYC register and Bit 5 (LENERGY) \nin the MASK0 interrupt mask register associated with the line cycle accumulation mode, see the Line Cycle Active Energy Accumulation Mode section. \n \nADE7880  Data Sheet  \n \nPOWER FACTOR CALCULATION  \nThe ADE7880 provides a direct power factor measurement \nsimultaneously on all phases. Power factor in an ac  circuit is \ndefined as the ratio of the total active power flowing  to the load \nto the apparent power.  The absolute power factor measurement \nis defined in terms of leading or lagging referring to w hether the \ncurrent is leading or lagging the voltage waveform. When the \ncurrent is leading the voltage, the load is capacitive  and this is \ndefined as a negative power factor.  When the current is lagging \nthe voltage, the load is inductive and this defined as a positive \npower factor.  The relationship of the current to the voltage \nwaveform is illustrated in Figure 84. \nV\nIACTIVE (–)\nREACTIVE (–)PF (–)\nCAPACITIVE:\nCURRENT LEADS\nVOLTAGE\nINDUCTIVE:\nCURRENT LAGS\nVOLTAGEACTIVE (+)\nREACTIVE (–)\nPF (–)\nACTIVE (–)\nREACTIVE (+)\nPF (+)ACTIVE (+)\nREACTIVE (+)\nPF (+)θ = +60°    PF = –0.5\nθ = –60°    PF = +0.5\n10193-056 \nFigure 84. Capacitive and Inductive Loads  \nAs shown in Figure 84, the reactive power measurement is negative \nwhen the load is capacitive, and positive when the load is indu ctive.  \nThe sign of the reactive power can therefore be used to reflect  \nthe sign of the power factor. Note that the ADE7880 computes the \nfundamental reactive power, so its sign is used as the sign  of the \nabsolute power factor. If the fundamental reactive power is in no load state, then the sign of the power factor is the sign of the total active power.   \nThe mathematical definition of power factor is shown in Equation 4 7: \nPower Factor = (Sign Fundamental  Reactive Power) ×  \nPower ApparentPower Active Totalabs ) ( (47) \nAs previously mentioned, the ADE7880 provides a power factor \nmeasurement on all phases simultaneously. These readings are \nprovided into thre e 16-bit signed registers, APF (Address 0xE902)  \nfor Phase A, BPF (Address 0xE 903) for P hase B, and CPF \n(Address 0xE 904) for P hase C.  The registers are signed twos  \ncomplement register with the MSB indicating the polarity of the power factor.  Each LSB of the AP F, BP F,  and CPF registers equates \nto a weight of 2\n−15, hence the maximum register value of 0x7FFF \nequating to a power factor value of 1.  The minimum register \nvalue of 0x8000 corresponds to a power factor of − 1. If because \nof offset and gain calibrations, t he power factor is outside the − 1 \nto +1 range, the result is set at − 1 or +1 depending on the sign \nof the fundamental reactive power.  By default the instantaneous total phase active and apparent \npowers are used to calculate the power factor and the registers \nare updated at a rate of 8  kHz. The sign bit is taken from the \ninstantaneous fundamental phase reactive energy measurement on each phase.   \nIf a measurement with more averaging is  required, the ADE7880  \nprovides an option of using the line cycle accumulation measurement  \non the active and apparent energies to determine the power factor.  \nThis option provides a more stable power factor reading.  This \nmode is enabled by setting the PFMODE bit ( Bit 7) in the \nLCYCMODE register (Address 0xE702).  When this mode is \nenabled the line cycle accumulation mode must be enabled on both the active and apparent energies.  This is done by setting \nt h e  LWAT T  a n d  LV A bits in the LCYCMODE register \n(Address  0xE702).  The up date rate of the power factor \nmeasurement is now an integral number of half line cycles that can \nbe programmed  into the LINECYC register (Address 0xE60C ). For \nfull details on setting up the line cycle accumulation mode see the Line  Cycle Active Energy Accumulation Mode  and Line \nCycle Apparent Energy Accumulation Mode  sections.  \nNote that the power factor measurement is effected by the no \nload condition if it is enabled  (see the No Load Condition  \nsection ). If the apparent energy no load is true, then the power \nfactor measurement is set to 1. If the no load condition based \non total active and apparent  energies is true, the power factor \nmeasurement is set at 0.   \nThe ADE7880 also computes the power factor on the \nfundamental and harmonic components based on the \nfundamental and harmonic active, reactive and apparent \npowers. See the Harmonics Calculati ons section for details.  \nHARMONICS CALCULATIONS  \nThe ADE7880 contains  a harmonic engine that analyzes one \nphase at a time . Harmonic information is computed with a no \nattenuation  pass band of 2.8 k Hz (corresponding to a − 3 dB \nbandwidth of 3.3 k Hz) and it is specified for line frequencies \nbetween 45  Hz and 66  Hz. It is essential that the VLEVEL and \nSELFREQ registers be set properly to obtain trustable harmonic measurements. Also, the voltage signal must be above ±100 mV \npeak for the harmonic engine to function properly. See the Managing Change in Fundamental Line Frequency  section for \ndetails on managing changes in line frequency. N eutral current \ncan also be analyzed simultaneous ly with the sum of the phase \ncurrents . Figure 85 presents a synthesized diagram of the \nharmonic engine, its settings and its output registers.  \n \n \n \n \n \nRev. C | Page 58 of 107 \nData Sheet  ADE7880  \n \nHarmonics Calcuations Theory  \nConsider a nonsinusoidal ac sy stem supplied by a voltage, v(t) \nthat consumes the current i(t). Then  \nsin2 )(\n1∑∞\n==\nkkV tv (kωt + φ k) (48) \n()k\nkk tk I ti γ+ω =∑∞\n=sin2 )(\n1 \nwhere:  \nVk, Ik are rms voltage and current, respectively, of each harmonic.  \nΦk, γk are the phase delays of each harmonic.  \nω is the angular velocity at the fundamental (line) frequency f.  \nThe ADE7880 harmonics calculations are specified for line \nfrequencies between 45  Hz and 66  Hz. The phase nominal  \nvoltage used as time  base must have an amplitude greater than \n20% of full scale.  \nThe number of harmonics N that can be analyzed within the  \n2.8 kHz pass band is the whole number of 2800/f . The absolute \nmaximum number of harmonics accepted by the ADE7880 is 63.  \n\uf8fa\uf8fb\uf8f9\n\uf8ef\uf8f0\uf8ee=fN2800, N≤63  \nWhen the ADE7880 analyzes a phase, the following metering \nquantities are computed:  \n• Fundamental phase current rms: I 1  \n• Fundamental phase voltage rms: V 1 \n• RMS  of up to three  harmonics of phase current:  \nIx, Iy, Iz, x, y, z = 2, 3,…, N  \n• RMS of up to three  harmonics of phase voltage:  \nVx, Vy, Vz, x, y, z = 2, 3,…, N  \n• Fundamental phase active power  \nP1 = V 1I1cos(φ 1 − γ 1) \n• Fundamental  phase reactive power Q1 = V 1I1sin(φ 1 − γ 1) \n• Fundamental phase apparent power  \nS1 = V 1I1 \n• Power factor of the fundamental  \n11\n1SPpf=  \nActive power of up to three  harmonics:  \nPx = V xIxcos(φ x – γx), x = 2, 3,…, N  \nPy = V yIycos(φ y – γy), y = 2, 3,…, N  \nPz = V zIzcos(φ z – γz), z = 2, 3,…, N\n • Reactive power of up to three  harmonics:  \nQx = V xIxsin(φ x – γx), x = 2, 3,…, N  Qy = V yIysin(φ y – γy), y = 2, 3,…, N  \nQz = V zIzsin(φ z – γz), z = 2, 3,…, N  \n• Apparent power of up to three  harmonics:  \nSx = V xIx, x = 2, 3, …, N  \nSy = V yIy, y = 2 , 3, …, N  \nSz = V zIz, z = 2, 3, …, N  \n• Power factor of up to three  harmonics:  \nxx\nxSPpf= , x = 2, 3,…, N   \nyy\nySPpf= , y = 2, 3,…, N  \nzz\nzSPpf= , z = 2, 3,…, N  \n• Total harmonic distortion of the phase current  \n()\n12\n12\nII ITHDI−=  \n• Total harmonic distortion  of the phase voltage  \n()\n12\n12\nVV VTHDV−= \n• Harmonic distortion of up to three  harmonics on the phase \ncurrent  \n1IIHDx\nIx=\n, x = 2, 3,…, N  \n1II\nHDy\nIy=\n, y = 2, 3,…, N  \n1IIHDz\nIz=\n, z = 2, 3,…, N  \n• Harmonic distortion of up to three  harmonics on the phase \nvoltage:  \n1VVHDx\nVx=\n, x = 2, 3,…, N  \n1VV\nHDy\nVy=\n, y = 2, 3,…, N  \n1VVHDz\nVz=\n, z = 2, 3,…, N  \n \n \n \n  \nRev. C | Page 59 of 107 \nADE7880  Data Sheet  \n \nIA, VA\nIB, VB\nIC, VC\nIN, ISUMHXWATT\nHYWATT\nHZWATTFWATT\nHXVAR\nHYVAR\nHZVARFVAR\nHXVA\nHYVA\nHZVAFVA\nHXVRMS\nHYVRMS\nHZVRMSFVRMS\nHXIRMS\nHYIRMS\nHZIRMSFIRMS\nHXVHD\nHYVHD\nHZVHDVTHD\nHXIHD\nHYIHD\nHZIHDITHD\nHXPF\nHYPF\nHZPFFPF\nADE7880 HARMONIC\nCALCULATIONS\nHXVRMS\nHYVRMS\nHZVRMSHXIRMS\nHYIRMS\nHZIRMS\nIN\nRESULTSISUM\nRESULTSHXVHD\nHYVHD\nHZVHDHXIHD\nHYIHD\nHZIHD\nIN\nRESULTSISUM\nRESULTSHPHASE BITS\nHCONFIG[2,1]\nSELECT THE PHASE\nBEING MONITOREDOUTPUT REGISTERS USED WHEN ONE OF PHASES A, B, C IS ANALYZEDACTPHSEL BITS HCONFIG[9,8] SELECT\nTHE PHASE USED TO AS TIME BASE\nHX, HY, HZ REGISTERS SELECT THE\nHARMONICS TO MONITOR\nHRATE BITS HCONFIG[7:5] SELECT THE\nUPDATE RATE OF HARMONIC\nREGISTERS\nHSTIME BITS HCONFIG[4,3] SELECT\nTHE DELAY IN TRIGGERING HREADYINTERRUPT\nHRCFG BIT HCONFIG[0] SELECTS IF\nHREADY FLAG IN STATUS0 IS SET\nIMMEDIATELY OF AFTER HSTIMEOUTPUT REGISTERS\nUSED WHEN NEUTRAL\nCURRENT IS ANALYZED\n10193-057 \nFigure 85. ADE7880  Harmonic Engine Block Diagram  \nWhen the neutral current and the sum of the three phase \ncurrents represented by ISUM register are analyzed, the following metering quantities are computed for both currents : \n• RMS  of fundamental and of up to 2 harmonics or rms of \nup to three  harmonics: I\nx, Iy, Iz, x, y, z = 1,2, 3,…, N.  \n• Harmonic distortions of the analyzed harmonics . \nConfiguring the Harmonic Calculations  \nThe ADE7880 requires a time base p rovided by a phase voltage. \nBit 9 and Bit 8 (ACTPHSEL) of HCONFIG[15:0]register select \nthis phase voltage. If ACTPHSEL =  00, the phase A is used. If \nACTPHSEL =  01, the P hase B is used and if ACTPHSEL  = 10, \nthe Phase C  is used. If the phase voltage used as time base is \ndown, select another phase , and the harmonic engine continue s \nto work properly.   \nThe phase under analysis is selected by Bit 2 and Bit 1 (HPHASE)  \nof HCONFIG[ 15:0]register. If HPHASE  = 00, the P hase A is \nmonitored. If HPHASE  = 01, the P hase B is monitored and if \nHPHASE  = 10, the P hase C is monitored. If HPHASE  = 11, the \nneutral current together with the sum of the phase currents represented by ISUM register are monitored.  \nHarmonic Calculations When a P hase is Monitored  \nWhen a phase is monitored, fundamental information together \nwith information about up to three  harmonics is computed. The \nindexes of the three  additional harmonics simultaneously \nmonitored by the ADE7880 are provided by the 8 -bit registers \nHX, HY , and HZ. Simply write the index of the harmonic into the register for that harmonic to be monitored. If the second \nharmonic is monitored, write 2. If harmonic 51 is desired, write \n51. The fun damental components are always monitored, inde -\npendent of the values written into HX, HY , or HZ. Therefore, if \none of these registers is made equal to 1, the ADE7880 monitors \nthe fundamental comp onents  multiple times. T he maximum \nindex allowed in HX, HY , and HZ registers is 63. The no \nattenuation pass  band is 2.8  kHz, corresponding to a − 3 dB \nbandwidth of 3.3  kHz, thus all harmonics of frequency lower \nthan 2800 Hz are supported without attenuation.  \nThe rms of the phase voltage and phase current fundamental components are stored into FVRMS and FIRMS 24 -bit signed \nregisters. The associated data path is presented in Figure 86. \nSimilar to the rms current and voltage rms data paths presented in the Root Mean Square Measurement  section, the data path \ncontains  24-bit signed offset compensation r egisters xIRMSOS, \nxVRMSOS,  x = A, B, C for each phase quantity. The rms of the \nphase current  and phase voltage three  harmonic components \nare stored into  HXVRMS, HXIRMS, HYVRMS, HYIRMS, \nHZVRMS , and HZIRMS 24- bit signed registers. The associated \ndata path is  presented in Figure 87 and contains the following \n24-bit signed offset compensation registers: HXIRMSOS, \nHYIRMSOS, HZIRMSOS, HXVRMSOS, HYVRMSOS, and \nHZVRMSOS .  \nIt is recommended to leave the offset compensation registers at \n0, the default value.  \n \nRev. C | Page 60 of 107 \nData Sheet  ADE7880  \n \nTable 20. Harmonic E ngine Outputs When Phase A, Phase B, or Phase C is A nalyzed and the R egisters Where the V alues are S tored  \nQuantity  Definition  ADE788 0 Register \nRMS of the F undamental Component  V1, I1 FVRMS, FIRMS  \nRMS of a Harmonic Component  Vx, Ix, x = 2, 3,…,N  HXVRMS, HXIRMS  \nVy, Iy, y = 2, 3,…,N  HYVRMS, HYIRMS  \nVz, Iz, z = 2, 3,…,N  HZVRMS, HZIRMS  \nActive Power of the  Fundamental Component  P1 = V 1I1cos(φ 1 − γ 1) FWAT T  \nActive Power of a  Harmonic Component  Px = V xIxcos(φ x – γx), x = 2, 3,…, N HXWAT T  \nPy = V yIycos( φy – γy), y = 2, 3,…, N HY WAT T  \nPz = V zIzcos(φ z – γz), z = 2, 3,…, N HZWAT T  \nReactive Power of the F undamental Component  Q1 = V 1I1sin(φ 1 − γ 1) FVAR  \nReactive Power of a  Harmonic Component  Qx = V xIxsin(φ 1 − γ 1), x = 2, 3,…, N HXVAR  \nQy = V yIysin(φy – γy), y = 2, 3,…, N HYVAR  \nQz = V zIzsin(φ z – γz), z = 2, 3,…, N HZVAR  \nApparent Power of the F undamental  Component  S1 = V 1I1 FVA  \nApparent Power of a  Harmonic Component  Sx = V xIx, x = 2, 3, …, N HXVA  \nSy = V yIy, y = 2, 3, …, N HYVA  \nSz = V zIz, z = 2, 3, …, N HZVA  \nPower Factor of the F undamental  Component  \n11\n1SPpf=\n FPF \nPower Factor of a  Harmonic Component  \nxx\nxSPpf= , x = 2, 3,…,N  HXPF  \nyy\nySP\npf=\n, y = 2, 3,…,N  HYPF  \nzz\nzSPpf=\n, z = 2, 3,…,N  HZPF  \nTotal Harmonic Distortion  \n()\n12\n12\nVV VTHDV−=\n VTHD  \n()\n12\n12\nII ITHDI−=\n ITHD \nHarmonic Distortion of a Harmonic C omponent  \n1VVHDx\nVx=\n,1IIHDx\nIx=\n, x = 2, 3,…,N  HXVHD, HXIHD  \n1VVHDy\nVy=\n,1IIHDy\nIy=\n,y = 2, 3,…,N  HYVHD, HYIHD \n1VVHDz\nVz=\n, 1IIHDz\nIz=\n,z = 2, 3,…,N  HZVHD, HZIHD \n \nRev. C | Page 61 of 107 \nADE7880  Data Sheet  \n \nTable 21. Harmonic E ngine Outputs whe n Neutral C urrent and ISUM are  Analyzed and the R egisters Where the V alues are S tored  \nQuantity  Definition  ADE7880 \nRegister  \nRMS of a Harmonic Component  (Including the F undamental) of the Neutral C urrent  Ix, x = 1,  2, 3,…, N HXIRMS  \nIy, y = 1,  2, 3,…, N HYIRMS  \nIz, z = 1,  2, 3,…, N HZIRMS  \nRMS  of a Harmonic Component  (Including the F undamental) of ISUM  ISUMx, x = 1,  2, 3,…,N  HXVRMS  \nISUMy, y = 1, 2, 3,…,N  HYVRMS  \nISUMz, z = 1,  2, 3,…,N  HZVRMS  \nHarmonic Distortion of a  Harmonic Component  (Including the F undamental) of the \nNeutral Current  (Note that the HX Register Must be S et to 1 for These C alculations to be \nExecuted ) 1IIHDx\nIx=\n, \nx = 1,  2, 3,…,N  HXIHD \n1II\nHDy\nIy=\n, \ny = 1,  2, 3,…,N  HYIHD \n1IIHDz\nIz=\n, \nz = 1,  2, 3,…,N  HZIHD  \nHarmonic Distortion of a  Harmonic Component  (Including the F undamental) of ISUM . \n(Note that the HX Register Must be Set to 1 for These Calculations to be E xecuted ) \n1 ISUMISUMHDx\nISUMx=\n,  \nx = 1 , 2, 3,…,N  HXVHD  \n1 ISUMISUMHDy\nISUMy=\n,  \ny = 1,  2, 3,…,N  HYVHD  \n1 ISUMISUMHDz\nISUMz=\n,  \nz = 1,  2, 3,…,N  HZVHD \nRev. C | Page 62 of 107 \nData Sheet  ADE7880  \n \nAFIRMSOS\n27\nBFIRMSOS\n27\nCFIRMSOS\n27HPHASE BITS\nHCONFIG[2, 1] SELECT THE\nPHASE BEING MONITORED\nAFVRMSOS\n27\nBFVRMSOS\n27\nCFVRMSOS\n27HPHASE BITS\nHCONFIG[2, 1] SELECT THE\nPHASE BEING MONITOREDFUNDAMENTAL\nCOMPONENTS\nCALCULATIONSFIRMSHPHASE BITS\nHCONFIG[2, 1] SELECT THE\nGAIN BEING USED\nAPGAIN OR\nBPGAIN OR\nCPGAIN\nFVA\n2–21\nFVRMS\n10193-058 \nFigure 86. Fundamental RMS  Signal Processing\nThe active, reactive, and apparent powers of the fundamental \ncompone nt are stored into the FW ATT, FV AR , an d  F VA  2 4 -bit \nsigned registers. Figure 88 presents the associated data  path. \nThe active, reactive and apparent powers of the 3 harmonic \ncomponents are stored into the HXW ATT, HXV AR, HXV A, \nH Y WAT T, HYV AR, HYV A, HZW ATT, HZV AR , and HZV A  \n24-bit signed registers.  The HPGAIN register is a 24 -bit signed \nregister used to scale the output of the harmonic active, reactive and apparent power components, as shown in Figure 89. The \n24-bit HPGAIN  register is accessed as a 32 -bit register with the \nfour most significant bits (MSBs) padded with 0s and sign extended to 28 bits (See Figure 44 for details). HXW ATTOS, \nH Y WAT T O S ,  H Z WA TTOS, HXV AROS, HYV AROS and \nHZV AROS are 24 -bit offset compensation registers located in the active and reactive harmonic power data paths.  Figure 89 \npresents the associated data path.  \nThe power factor of the fundamental component  is stored into \nFPF 24 -bit signed register. The power factors of the three  harmonic  \ncomponents are stored into the HXPF, HYPF , and HZPF 24 -bit \nsigned registers.  \nThe total harmonic distortion ratios computed using the rms of \nthe fundamental components and the rms of the phase current and the phase voltage (see Root Mean Square Chapter for details  \nabout these measurements) are stored into the VTHD and ITHD  \n24-bit registers in 3.21 signed format. This means the ratios are \nlimited to +3.9999 and all greater re sults are clamped to it.  \n \nRev. C | Page 63 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 64 of 107 HARMONIC\nCOMPONENTS\nCALCULATIONSHXIRMSOS\n27\nHXIRMS\nHYIRMSOS\n27\nHYIRMS\nHZIRMSOS\n27\nHZIRMS\nHXVRMSOS\n27\nHXVRMS\nHYVRMSOS\n27\nHYVRMS\nHXVRMSOS\n27\nHZVRMS\n10193-059 \nFigure 87. Harmonic RMS Signal Processing FUNDAMENTAL\nCOMPONENTS\nCALCULATIONSAPGAIN AFWATTOS 22\n÷\nBPGAIN BFWATTOS 22\n÷\nCPGAIN CFWATTOS 22\n÷HPHASE BITS\nHCONFIG[2, 1] SELECT THE\nPHASE BEING MONITORED\nFWATT\nAPGAIN AFVAROS 22\n÷\nBPGAIN BFVAROS 22\n÷\nCPGAIN CFVAROS 22\n÷HPHASE BITS\nHCONFIG[2, 1] SELECT THE\nPHASE BEING MONITORED\nFVAR\n10193-060 \nFigure 88. Fundamental Active and Reactive Powers Signal Processing \nData Sheet ADE7880\n \nRev. C | Page 65 of 107 HARMONIC\nCOMPONENTS\nCALCULATIONSHPGAIN HXWATTOS 22\n÷ HXWATT\nHPGAIN HYWATTOS 22\n÷ HYWATT\nHPGAIN HZWATTOS 22\n÷ HZWATT\nHPGAIN HXVAROS 22\n÷ HXVAR\nHPGAIN HYVAROS 22\n÷ HYVAR\nHPGAIN HZVAROS 22\n÷ HZVAR\n10193-061 \nFigure 89. Harmonic Active and Reactive Powers Signal Processing  \nThe harmonic distortions of the three harmonic components \nare stored into the HXVHD, HXIHD, HYVHD, HYIHD, HZVHD, and HZIHD 24-bit registers in 3.21 signed format. This means the ratios are limited to +3.9999 and all greater \nresults are clamped to it.  \nAs a reference, Table 20 presents the ADE7880  harmonic engine \noutputs when one phase is analyzed and the registers in which \nthe outputs are stored. \nHarmonic Calculations When the Neutral is Monitored \nWhen the neutral current and the sum of phase currents are monitored, only the harmonic rms related registers are updated.  \nThe registers HX, HY and HZ identify the index of the harmonic, \nincluding the fundamental. When a phase is analyzed, the \nfundamental rms values are calculated continuously and the \nresults are stored in dedicated registers FIRMS and FVRMS. When the neutral is analyzed, the fundamental information is calculated by setting one of the harmonic index registers HX, HY or HZ to 1 and the results are stored in harmonic registers. \nThe maximum index allowed in HX, HY and HZ registers is 63. \nThe no attenuation pass band is 2.8 kHz, corresponding to a  −3 dB bandwidth of 3.3 kHz, thus all harmonics of frequency \nlower than 2800 Hz are supported without attenuation. \nHXIRMS, HYIRMS and HZIRMS registers contain the harmonic \nrms components of the neutral current and HXVRMS, HYVRMS and HZVRMS registers contain the harmonic rms components \nof ISUM. Note that in this case, the rms of the fundamental \ncomponent is not computed into FIRMS or FVRMS registers, but it is computed if one of the index registers HX, HY and HZ \nis initialized with 1.  \nIf the HX register is initialized to 1, the ADE7880  computes the \nharmonic distortions of the other harmonics identified into HY \nand HZ registers and stores them in 3.21 signed format into the HYVHD, HYIHD, HZVHD, and HZIHD 24-bit registers. The distortions of the neutral current are saved into HYIHD and HZIHD registers and the distortions of the ISUM are stored into the HYVHD and HZVHD registers. As HX is set to 1, the \nHXIHD and HXVHD registers contain 0x1FFFFF, a number \nrepresenting 1 in 3.21 signed format. \nAs a reference, Table 21 presents the ADE7880  harmonic engine \noutputs when the neutral current and ISUM are analyzed and \nthe registers in which the outputs are stored. \nConfiguring Harmonic Calculations Update Rate \nThe ADE7880  harmonic engine functions at 8 kHz rate. From \nthe moment the HCONFIG register is initialized and the \nharmonic indexes are set in the HX, HY and HZ index registers, the ADE7880  calculations take typically 750 ms to settle within \nthe specification parameters.  \nThe update rate of the harmonic engine output registers is \nmanaged by Bits[7:5] (HRATE) in HCONFIG register and is independent of the engine’s calculations rate of 8 kHz. The default \nvalue of 000 means the registers are updated every 125 μs  \n(8 kHz rate). Other update periods are: 250 μs (HRATE = 001), 1 ms (010), 16 ms (011), 128 ms (100), 512 ms (101), 1.024 sec (110). If HRATE bits are 111, then the harmonic calculations \nare disabled.  \nThe ADE7880  provides two ways to manage the harmonic \ncomputations. The first approach, enabled when Bit 0 (HRCFG) \nof HCONFIG register is cleared to its default value of 0, sets Bit \n19 (HREADY) in STATUS0 register to 1 after a certain period of time and then every time the harmonic calculations are updated at HRATE frequency. This allows an external microcontroller to access the harmonic calculations only after they have settled. \nThe time period is determined by the state of Bits[4:3] (HSTIME) \nin the HCONFIG register. The default value of 01 sets the time \nADE7880  Data Sheet  \n \nto 750 ms, the settling time of the harmonic calculations. Other \npossible values are 500  ms (HSTIME  = 00), 1 sec (10) and \n1250 ms (11).  \nThe second  approach, enabled when Bit 0 (HRCFG) of HCONFIG  \nregister is set to 1 , sets B it 19 (HREADY) in STATUS0 register \nto 1 every time the harmonic calculations are updated at the \nupdate frequency determined by HRATE bits  without waiting \nfor the harmonic calculations to settle . This allows an  external \nmicrocontroller to access the harmonic calculations immediately  \nafter they have been started. If the corresponding mask bit in \nthe MASK0 interrupt mask register is enabled, the IRQ  pin also \ngoes active low. The status bit is cleared and the pin IRQ  is set \nto high again by writing to  the STATUS0 register with the \ncorresponding bit set to 1.  \nAdditionally, the ADE7880 provides a periodical output signal \ncalled HREADY at the CF2/HREADY pin synchronous to the \nmoment the harmonic  calculations are updated in the harmonic \nregisters. This functionality is chosen if B it 2 (CF2DIS) is set to \n1 in the CONFIG register. If CF2DIS is set to 0 (default value), \nthe CF2 energy to frequency converter output is provided at \nCF2/HREADY pin. The d efault state of this signal is high. Every \ntime the harmonic registers are updated based on HRATE bits \nin HCONFIG register, the signal HREADY goes low for approx -\nimately  10 µs and then goes back high. If B it 0 (HRCFG) in the \nHCONFIG register is set to 1 , the HREADY bit in the STATUS0  \nregister is set to 1 every HRATE period right after the harmonic calculations start , and the HREADY signal toggles high, low , and \nback synchronously. If the HRCFG bit is set to 0 , the HREADY \nbit in the STATUS0  register is set t o 1 after the HSTIME period, \nand the HREADY signal toggles high, low and back synchronously.  \nThe HREADY signal allows fast access to the harmonic registers  \nwithout having to use HREADY interrupt in MASK0  register. \nIn order to facilitate the fast reading of  the registers in which \nthe harmonic calculations are stored, a special burst registers reading has been implemented in the serial interfaces. S ee the \nI\n2C Read Operation of Harmonic Calculations Registers and the \nSPI Read Operation  sections for details.  \nRecommended Approach to Managing Harmonic \nCalculations  \nThe recommended approach to  managing the ADE7880 \nharmonic calculations is the following:  \n• Set up Bit 2 (CF2DIS) in the CONFIG register. Set the \nCF2DIS bit to 1 to use the CF2/HREADY pin to signal \nwhen the harmonic calculations have settled and are updated. The high to low tr ansition of HREADY signal  \nindicates when to read the harmonic registers.  Use the \nburst reading mode to read the harmonic registers  as it is \nthe most efficient  way to read them.  \n• Choose the harmonics to be monitored by setting HX, HY and HZ appropriately.  \n• Select all the HCONFIG register bits.  • Initialize the gain registers used in the harmonic \ncalculations. Leave the offset registers to 0.  \n• Read the registers in which the harmonic information is \nstored using the burst or regular reading mode  at high to \nlow tr ansitions of CF2/HREADY pin . \nWAVEFORM SAMPLING MO DE \nThe waveform samples of the current and voltage waveform, \nthe active, reactive, and apparent power outputs are stored \nevery  125 µs (8 kHz rate) into 24 -bit signed registers that can be \naccessed through various serial ports of the ADE7880. Table 22 \nprovides a list of  registers and their descriptions.  \nTable 22. Waveform Registers List  \nRegister  Description  \nIAWV  Phase A current  \nVAWV  Phase A voltage  \nIBWV  Phase B current  \nVBWV Phase B voltage  \nICWV  Phase C current  \nVCWV Phase C voltage  \nINWV  Neutral current  \nAVA  Phase A apparent power  \nBVA  Phase B apparent power  \nCVA  Phase C apparent power  \nAWAT T  Phase A active power  \nBWAT T  Phase B active power  \nCWAT T  Phase C active powe r \nBit 17 (DREADY) in the STATUS0  register can be used to \nsignal when the registers listed in Table 22 can be read using \nI2C or SPI serial ports. An interrupt attached to the flag can be  \nenabled by setting Bit 17 (DREADY) in the  MASK0 register. (s ee \nthe Digital Signal Processor  section for more details on \nBit DREADY ). \nThe ADE7880 contain s a high speed data capture (HSDC) port \nthat is specially designed to provide fast access to the waveform \nsample registers. Read the HSDC Interface  section for more \ndetails.  \nAs stated  in the Current Waveform Gain Registers  section , the \nserial ports of the ADE7880 work on 32 -, 16-, or 8 -bit words. \nAll registers listed in Table 22 are transmitted signed extended \nfrom 24 bits to 32 bits (see Figure 45).  \nENERGY -TO-FREQUENCY CONVERSION  \nThe ADE7880 provide s three frequency output pins: CF1, CF2, \nand CF3. The CF2 pin is multiplexed with the HREADY pin of the harmonic calculations block. When HRE ADY is enabled, the  \nCF2 functionality is disabled at the pin. The CF3 pin is multiplexed  \nwith the HSCLK pin of the HSDC interface. When HSDC is enabled, the CF3 functionality is disabled at the pin. The CF1 \npin and the CF2 pin are always available. After i nitial  calibration \nat manu facturing, the manufacturer or end customer verifies \nthe energy meter calibration. One convenient way to verify the meter  calibration is to provide an output frequency pro portional to \nRev. C | Page 66 of 107 \nData Sheet  ADE7880  \n \nthe active, reactive, or apparent powers unde r steady load \ncondi tions. This output frequency can provide a simple, single -\nwire, optically  isolated interface to external calibration \nequipment. Figure 90 illustrates the energy -to-frequency \nconversion in the ADE7880.  \nThe DSP computes the instantaneous values of all phase powers: \ntotal active, fundamental active, fundamental reactive, and \napparent. The process in which the energy is sign accumulated in various xW ATTHR, xF V ARHR, and xV AHR registers has \nalready been described in the energy calculation sections: Active \nEnergy Calculation , Fundamental Reactive Energy Calculation , \nand Apparent Energy Calculation . In the energy -to-frequency \nconversion process, the instantaneous powers g enerate signals \nat the frequency output pins (CF1, CF2, and CF3). One energy -\nto-frequency converter is used for every CFx pin. Every converter \nsums certain phase powers and generates a signal proportional \nto the sum. Two sets of bits decide what powers are converted.  First, Bits[2:0] (TERMSEL1[2:0]), Bits[5:3] (TERMSEL2[2:0]), \nand Bits[8:6] (TERMSEL3[2:0]) of the COMPMODE register \ndecide which phases , or which combination of phases, are added.   \nThe TERMSEL1 bits refer to the CF1 pin, the TERMSEL2 bits refer to the CF2 pin, and the TERMSEL3 bits refer to the CF3 \npin. The TERMSELx[0] bits manage Phase A. When set to 1, \nPhase A power is included in the s um of powers at the CFx \nconverter. When cleared to 0, Phase A power is not included. The TERMSELx[1] bits manage Phase B, and the TERMSELx[2]  \nbits manage Phase C. Setting all TERMSELx bits to 1 means all 3-phase powers are added at the CFx converter. Clear ing all \nTERMSELx bits to 0 means no phase power is added and no  CF pulse is generated.  \nSecond, Bits[2: 0] (CF1SEL[2:0]), Bits[5:3] (CF2SEL[2:0]), and \nBits[8:6] (CF3SEL[2:0]) in the CFMODE register decide what \ntype of power is used at the inputs of the CF1,  CF2, and CF3 \nconverters, respectively. Table 23 shows the values that CFxSEL \ncan have: total active, apparent, fundamental active, or fundamental  \nreactive  powers . \nTable 23. CFxSEL Bits Description  \nCFxSE L Description  Registers Latched When CFxLATCH = 1  \n000 CFx signal proportional to the sum of total phase active powers  AWAT THR, BWAT THR, CWAT THR  \n001 Reserved   \n010 CFx signal proportional to the sum of phase apparent powers  AVAHR, BVAHR, CVAHR  \n011 CFx si gnal proportional to the sum of fundamental phase active \npowers   AFWATTHR, BFWATTHR, CFWATTHR  \n100 CFx signal proportional to the sum of fundamental phase reactive \npowers   AFVARHR, BFVARHR, CFVARHR  \n101 to 111  Reserved   \n \nRev. C | Page 67 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 68 of 107 By default, the TERMSELx bits are all 1 and the CF1SEL bits are \n000, the CF2SEL bits are 100, and the CF3SEL bits are 010. This means that by default, the CF1 digital-to-frequency converter produces signals proportional to the sum of all 3-phase total \nactive powers, CF2 produces signals proportional to fundamental \nreactive powers, and CF3 produces signals proportional to \napparent powers. \nSimilar to the energy accumulation process, the energy-to-\nfrequency conversion is accomplished in two stages. The first \nstage is the same stage illustrated in the energy accumulation \nsections of active, reactive and apparent powers (see Active Energy Calculation, Fundamental Reactive Energy Calculation, Apparent Energy Calculation sections). The second stage consists of the frequency divider by the CFxDEN 16-bit unsigned registers. The values of CFxDEN depend on the meter constant (MC), \nmeasured in impulses/kWh and how much energy is assigned to \none LSB of various energy registers: xW ATTHR, xFV ARHR, and so forth. Suppose a derivative of Wh [10\nn Wh] where n is a \npositive or negative integer, is desired as one LSB of xW ATTHR \nregister. Then, CFxDEN is as follows: nMCCFxDEN10 ] imp/kwh [103\n\uf0b4\uf03d  (49) \nThe derivative of wh must be chosen in such a way to obtain a \nCFxDEN register content greater than 1. If CFxDEN = 1, then the CFx pin stays active low for only 1 μs. Thus, CFxDEN register \nmust not be set to 1. The frequency converter cannot accommodate \nfractional results; the result of the division must be rounded to the nearest integer. If CFxDEN is set equal to 0, then the ADE7880  \nconsiders it to be equal to 1. \nThe CFx pulse output stays low for 80 ms if the pulse period is \nlarger than 160 ms (6.25 Hz). If the pulse period is smaller than 160 ms and CFxDEN is an even number, the duty cycle of the \npulse output is exactly 50%. If the pulse period is smaller than \n160 ms and CFxDEN is an odd number, the duty cycle of the \npulse output is  \n(1+1/ CFxDEN ) × 50% \n \nINTERNAL\nACCUMULATOR\nTHRESHOLD27\nWTHR34 27 26 0\n0CFxDENFREQ DIVIDERREVPSUMx BIT OF\nSTATUS0[31:0]\nCFx PULSE\nOUTPUTVA\nWATT\nFWATT\nFVARCFxSEL BITS IN\nCFMODETERMSELx BITS IN\nCOMPMODE\n27INSTANTANEOUS\nPHASE A\nACTIVE POWER\nINSTANTANEOUS\nPHASE B\nACTIVE POWER\nINSTANTANEOUS\nPHASE C\nACTIVE POWER\nDIGITAL SIGNAL\nPROCESSOR\n10193-062 \nFigure 90. Energy-to-Frequency Conversion \nData Sheet ADE7880\n \nRev. C | Page 69 of 107 The CFx pulse output is active low and preferably connected to \nan LED, as shown in Figure 91. \nCFx PINVDD\n10193-090 \nFigure 91. CFx Pin Recommended Connection \nBits[11:9] (CF3DIS, CF2DIS, and CF1DIS) of the CFMODE register decide if the frequency converter output is generated at the CF3, CF2, or CF1 pin. When Bit CFxDIS is set to 1 (the default value), the CFx pin is disabled and the pin stays high. When Bit CFxDIS is cleared to 0, the corresponding CFx pin output generates an active low signal.  \nBits[16:14] (CF3, CF2, CF1) in the Interrupt Mask register MASK0 \nmanage the CF3, CF2, and CF1 related interrupts. When the CFx \nbits are set, whenever a high-to-low transition at the corresponding \nfrequency converter output occurs, an interrupt IRQ0\n is triggered \nand a status bit in the STATUS0 register is set to 1. The interrupt \nis available even if the CFx output is not enabled by the CFxDIS \nbits in the CFMODE register. \nSynchronizing Energy Registers with CFx Outputs \nThe ADE7880  contains a feature that allows synchronizing the \ncontent of phase energy accumulation registers with the generation \nof a CFx pulse. When a high-to-low transition at one frequency converter output occurs, the content of all internal phase energy registers that relate to the power being output at CFx pin is latched into hour registers and then resets to 0. See Table 23 for the list \nof registers that are latched based on the CFxSEL[2:0] bits in the \nCFMODE register. All 3-phase registers are latched independent of the TERMSELx bits of the COMPMODE register. The process is shown in Figure 92 for CF1SEL[2:0] = 010 (apparent powers \ncontribute at the CF1 pin) and CFCYC = 2. \nThe CFCYC 8-bit unsigned register contains the number of \nhigh to low transitions at the frequency converter output between \ntwo consecutive latches. Avoid writing a new value into the \nCFCYC register during a high-to-low transition at any CFx pin. \nCFCYC = 2\nAVAHR, BVAHR,\nCVAHR LATCHED\nENERGY REGISTERS\nRESETAVAHR, BVAHR,\nCVAHR LATCHED\nENERGY REGISTERS\nRESETCF1 PULSE\nBASED ON\nPHASE A AND\nPHASE B\nAPPARENT\nPOWERS\n10193-064 \nFigure 92. Synchronizing AVAHR and BVAHR with CF1 \n \n  \n \n  Bits[14:12] (CF3LATCH, CF2LATCH, and CF1LATCH) of the \nCFMODE register enable this process when set to 1. When cleared to 0, the default state, no latch occurs. The process is available even if the CFx output is not enabled by the CFxDIS bits in the CFMODE register. \nEnergy Registers and CF Outputs for Various \nAccumulation Modes \nBits[1:0] (W ATTACC[1:0]) in the ACCMODE register deter-\nmine the accumulation modes of the total and fundamental active \npowers when signals proportional to the active powers are chosen at the CFx pins (the CFxSEL[2:0] bits in the CFMODE register equal 000 or 011). They also determine the accumulation modes \nof the watt-hour energy registers (AW ATTHR, BW ATTHR, \nC WAT T H R ,  A F WAT T H R ,  B F WAT T H R  a n d  C F WAT T H R ) .  When W ATTACC[1:0] = 00 (the default value), the active powers are sign accumulated in the watt-hour registers and before entering the energy-to-frequency converter. Figure 93 shows how signed \nactive power accumulation works. In this mode, the CFx pulses \nsynchronize perfectly with the active energy accumulated in xW ATTHR registers because the powers are sign accumulated \nin both data paths.  \nNEG POS POS APNOLOAD\nSIGN = POSITIVENEGNO-LOAD\nTHRESHOLDACTIVE POWERNO-LOAD\nTHRESHOLDACTIVE ENERGY\nREVAPx BIT\nIN STATUS0\nxWSIGN BIT\nIN PHSIGN\n10193-065 \nFigure 93. Active Power Signed Accumulation Mode \nWhen W ATTACC[1:0] = 01, the active powers are accumulated \nin positive only mode. When the powers are negative, the watt-hour energy registers are not accumulated. CFx pulses are generated based on signed accumulation mode. In this mode, the CFx pulses do not synchronize perfectly with the active energy \naccumulated in xW ATTHR registers because the powers are \naccumulated differently in each data path. Figure 94 shows how \npositive only active power accumulation works. \nW ATTACC[1:0] = 10 setting is reserved and the ADE7880  \nbehaves identically to the case when W ATTACC[1:0] = 00. \n   \nADE7880 Data Sheet\n \nRev. C | Page 70 of 107 When W ATTACC[1:0] = 11, the active powers are accumulated \nin absolute mode. When the powers are negative, they change sign and accumulate together with the positive power in the watt-hour registers and before entering the energy-to-frequency \nconverter. In this mode, the CFx pulses synchronize perfectly \nwith the active energy accumulated in xW ATTHR registers because the powers are accumulated in the same way in both data paths. \nFigure 95 shows how absolute active power accumulation works.  \nNEG POS POS APNOLOAD\nSIGN = POSITIVENEGNO-LOAD\nTHRESHOLDACTIVE POWERNO-LOAD\nTHRESHOLDACTIVE ENERGY\nREVAPx BIT\nIN STATUS0\nxWSIGN BIT\nIN PHSIGN\n10193-066 \nFigure 94. Active Power Positive Only Accumulation Mode \nBits[3:2] (V ARACC[1:0]) in the ACCMODE register determine the \naccumulation modes of the fundamental reactive powers when signals proportional to the fundamental reactive powers are \nchosen at the CFx pins (the CFxSEL[2:0] bits in the CFMODE \nregister equal 100). When V ARACC[1:0] = 00, the default value, the fundamental reactive powers are sign accumulated in the var-hour energy registers and before entering the energy-to-frequency converter. Figure 96 shows how signed fundamental \nreactive power accumulation works. In this mode, the CFx \npulses synchronize perfectly with the fundamental reactive energy accumulated in the xFV ARHR registers because the \npowers are sign accumulated in both data paths. \nV ARACC[1:0] = 01 setting is reserved and ADE7880 behaves \nidentically to the case when V ARACC[1:0] = 00. When V ARACC[1:0] = 10, the fundamental reactive powers are \naccumulated depending on the sign of the corresponding active power in the var-hour energy registers and before entering the \nenergy-to-frequency converter. If the fundamental active power \nis positive or considered 0 when lower than the no load threshold, \nthe fundamental reactive power is accumulated as is. If the fundamental active power is negative, the sign of the fundamental reactive power is changed for accumulation. Figure 97 shows how \nthe sign adjusted fundamental reactive power accumulation \nmode works. In this mode, the CFx pulses synchronize perfectly with the fundamental reactive energy accumulated in xFV ARHR registers because the powers are accumulated in the same way in \nboth data paths. NEG POS POS APNOLOAD\nSIGN = POSITIVENEGNO-LOAD\nTHRESHOLDACTIVE POWERNO-LOAD\nTHRESHOLDACTIVE ENERGY\nREVAPx BIT\nIN STATUS0\nxWSIGN BIT\nIN PHSIGN\n10193-067 \nFigure 95. Active Power Absolute Accumulation Mode \nNEG POS POS VARNOLOAD\nSIGN = POSITIVENEGNO-LOAD\nTHRESHOLDREACTIVE\nPOWERNO-LOAD\nTHRESHOLDREACTIVE\nENERGY\nREVRPx BIT\nIN STATUS0\nxVARSIGN BIT\nIN PHSIGN\n10193-068 \nFigure 96. Fundamental Reactive Power Signed Accumulation Mode \nWhen V ARACC[1:0] = 11, the fundamental reactive powers are \naccumulated in absolute mode. When the powers are negative, \nthey change sign and accumulate together with the positive power in the var-hour registers. CFx pulses are generated based on signed accumulation mode. In this mode, the CFx pulses do not synchronize perfectly with the fundamental reactive energy \naccumulated in x V ARHR registers because the powers are \naccumulated differently in each data path. Figure 98 shows how \nabsolute fundamental reactive power accumulation works. \nSign of Sum of Phase Powers in the CFx Data Path \nThe ADE7880  has sign detection circuitry for the sum of phase \npowers that are used in the CFx data path. As seen in the beginning \nof the Energy-to-Frequency Conversion section, the energy \naccumulation in the CFx data path is executed in two stages. Every time a sign change is detected in the energy accumulation at the end of the first stage, that is, after the energy accumulated \nData Sheet ADE7880\n \nRev. C | Page 71 of 107 into the accumulator reaches one of the WTHR, V ARTHR, or \nV ATHR thresholds, a dedicated interrupt can be triggered synchronously with the corresponding CFx pulse. The sign \nof each sum can be read in the PHSIGN register. \nPOS POS VARNOLOAD\nSIGN = POSITIVENEGNO-LOAD\nTHRESHOLDNO-LOAD\nTHRESHOLD\nNO-LOAD\nTHRESHOLDREACTIVE\nPOWER\nACTIVE\nPOWERREACTIVE\nENERGY\nREVRPx BIT\nIN STATUS0\nxVARSIGN BI T\nIN PHSIGN\n10193-069 \nFigure 97. Fundamental Reactive Power Accumulation in Sign  \nAdjusted Mode \nNEG POS POS VARNOLOAD\nSIGN = POSITIVENEGNO-LOAD\nTHRESHOLDREACTIVE POWERNO-LOAD\nTHRESHOLDREACTIVE ENERGY\nREVAPx BIT\nIN STATUS0\nxVARSIGN BIT\nIN PHSIGN\n10193-070 \nFigure 98. Fundamental Reactive Powe r Accumulation in Absolute Mode \nBit 18, Bit 13, and Bit 9 (REVPSUM3, REVPSUM2, and \nREVPSUM1, respectively) of the STATUS0 register are set to 1 when a sign change of the sum of powers in CF3, CF2, or CF1 data paths occurs. T o correlate these events with the pulses generated at the CFx pins, after a sign change occurs, \nBit REVPSUM3, Bit REVPSUM2, and Bit REVPSUM1 are set \nin the same moment in which a high-to-low transition at the \nCF3, CF2, and CF1 pin, respectively, occurs.  \nBit 8, Bit 7, and Bit 3 (SUM3SIGN, SUM2SIGN, and SUM1SIGN, \nrespectively) of the PHSIGN register are set in the same moment with Bit REVPSUM3, Bit REVPSUM2, and Bit REVPSUM1 and indicate the sign of the sum of phase powers. When cleared to \n0, the sum is positive. When set to 1, the sum is negative.  \nInterrupts attached to Bit 18, Bit 13, and Bit 9 (REVPSUM3, \nREVPSUM2, and REVPSUM1, respectively) in the STATUS0 register are enabled by setting Bit 18, Bit 13, and Bit 9 in the \nMASK0 register. If enabled, the IRQ0\n pin is set low, and the \nstatus bit is set to 1 whenever a change of sign occurs. To find \nthe phase that triggered the interrupt, the PHSIGN register is \nread immediately after reading the STATUS0 register. Next, the \nstatus bit is cleared, and the IRQ0  pin is set high again by writing  \nto the STATUS0 register with the corresponding bit set to 1. \nNO LOAD CONDITION \nThe no load condition is defined in metering equipment standards \nas occurring when the voltage is applied to the meter and no cur-\nrent flows in the current circuit. To eliminate any creep effects in the meter, the ADE7880 contains three separate no load detection \ncircuits: one related to the total active power, one related to the fundamental active and reactive powers, and one related to the apparent powers. \nNo Load Detection Based On Total Active Power and \nApparent Power \nThis no load condition uses the total active energy and the apparent \nenergy to trigger this no load condition. The apparent energy is \nproportional to the rms values of the corresponding phase current and voltage. If neither total active energy nor apparent energy are \naccumulated for a time indicated in the respective APNOLOAD \nand V ANOLOAD unsigned 16-bit registers, the no load condition is triggered, the total active energy of that phase is not accumulated \nand no CFx pulses are generated based on the total active energy. \nThe equations used to compute the APNOLOAD and \nV ANOLOAD unsigned 16-bit values are  \nPMAXWTHR YAPNOLOAD17\n16 22\uf0b4 \uf0b4\uf02d \uf03d  \nPMAXVATHR YVANOLOAD17\n16 22\uf0b4 \uf0b4\uf02d \uf03d  (50) \nwhere:  \nY is the required no load current threshold computed relative to \nfull scale. For example, if the no load threshold current is set \n10,000 times lower than full scale value, then Y = 10,000. \nWTHR and V ATHR represent values stored in the WTHR and \nV ATHR registers and are used as the thresholds in the first stage energy accumulators for active and apparent energy, respectively (see Active Energy Calculation section). PMAX = 27,059,678 = 0x19CE5DE, the instantaneous active power computed when \nthe ADC inputs are at full scale. Do not write 0xFFFF to the \nAPNOLOAD and V ANOLOAD registers. \nThe V ANOLOAD register usually contains the same value as \nthe APNOLOAD register. When APNOLOAD and VANOLOAD are set to 0x0, the no load detection circuit is disabled. If only V ANOLOAD is set to 0, then the no load condition is triggered \nADE7880  Data Sheet  \n \nbased only on the total active power being lower than APNOLOAD.  \nIn the same way, if only APNOLOAD is set to 0x0, the no load \ncondition is triggered based only on the apparent po wer being \nlower than V ANOLOAD.  \nBit 0 (NLOAD) in the STATUS1 register is set when a  no load \ncondition in one of the three phases is triggered. Bits[2:0] (NLPHASE[2:0]) in the PHNOLOAD register indicate the state of all phases relative to a no load condition  and are set simulta -\nneously with Bit NLOAD in the STATUS1 register. NLPHASE[0] \nindicates the state of Phase A, NLPHASE[1] indicates the state of Phase B, and NLPHASE[2] indicates the state of Phase C. When Bit NLPHASE[x] is cleared to 0, it means the phas e is out \nof a no load condition. When set to 1, it means the phase is in a no load condition.  \nAn interrupt attached to Bit 0 (NLOAD) in the STATUS1 register can be enabled by setting Bit 0 in the MASK1 register. \nIf enabled, the \nIRQ1  pin i s set to low, and the status bit is set \nto 1 whenever one of three phases enters or exits this no load \ncondition. To find the phase that triggered the interrupt, the \nPHNOLOAD register is read immediately after reading the \nSTATUS1 register. Next, the status  bit is cleared, and the IRQ1  \npin is set to high by writing to the STATUS1 register with the \ncorresponding bit set to 1.  \nNo Load Detection Based on Fundamental Active and \nReactive Powers  \nThis no load condition is triggered when no less si gnificant bits \nare accumulated into the fundamental active and reactive energy  \nregisters on one phase (xFW ATTHR and  x F VA R H R ,  x  = A, B ,  \nor C) for a time indicated in the respective APNOLOAD and \nV ARNOLOAD unsigned 16 -bit registers. In this case, the \nfundame ntal active and reactive energies of that phase are not \naccumulated and no CFx pulses are generated based on these \nenergies. APNOLOAD is the same no load threshold set for the \ntotal active powers. The V ARNOLOAD register usually contains \nthe same value as t he APNOLOAD register. If only APNOLOAD \nis set to 0x0, then the fundamental active power is accumulated without restriction. In the same way, if only  V ARNOLOAD is set \nto 0x0, the fundamental reactive power is accumulated without \nrestriction.  As with the APN OLOAD and V ANOLOAD registers, \ndo not write 0xFFFF to the V ARNOLOAD register.  \nBit 1 (FNLOAD) in the STATUS1 register is set when this no load condition in one of the three phases is triggered. Bits[5:3] (FNLPHASE[2:0]) in the PHNOLOAD register indicate the state of all phases relative to a no load condition and are set simultaneously with Bit FNLOAD in the STATUS1 register. FNLPHASE[0] indicates the state of Phase A, FNLPHASE[1] indicates the state of Phase B, and FNLPHASE[2] indicates the state of Phase C. When Bit FNLPHASE[x] is cleared to 0, it \nmeans the phase is out of the no load condition. When set to 1, \nit means the phase is in a no load condition.  \nAn interrupt attached to the Bit 1 (FNLOAD) in the STATUS1 \nregister can be enabled by setting Bit 1 in th e MASK1 register. If \nenabled, the \nIRQ1  pin is set low and the status bit is set to 1 whenever one of three phases enters or exits this no load condition. To find the phase that triggered the interrupt, the \nPHNOLOAD register is read immedi ately after reading the \nSTATUS1 register. Then the status bit is cleared and the \nIRQ1  \npin is set back high by writing to the STATUS1 register with the corresponding bit set to 1.  \nNo Load Detection Based on Apparent Power  \nThis no load cond ition is triggered when no less significant bits \nare accumulated into the apparent energy register on one phase \n( x VA H R ,  x  = A, B, or C) for a time ind icated by the V A NOLOAD  \nunsigned 16 -bit register. In this case, the apparent energy of that \nphase is not ac cumulated and no CFx pulses are generated based  \non this energy.  \nThe equation  used to compute the  V ANOLOAD unsigned  \n16-bit value is  \nPMAXVATHRYVANOLOAD17\n16 22××−=  (51) \nwhere:  \nY is the required no load current threshold computed relative to \nfull scale. For example, if the no load threshold current is set 10,000 times lower than full scale value, then Y=10,000.  \nV ATHR is the V ATHR register used as the threshold of the first stage energy accumulator (see Apparent Energy Calculation  \nsection ) PMAX  = 27,059,678 = 0x19CE5DE, the instantaneous \napparent power computed when t he ADC inputs are at full scale. \nWhen the V ANOLOAD register is set to 0x0, the no load \ndetection circuit is disabled.  \nBit 2 (V ANLOAD) in the STATUS1 register is set when this no \nload condition in one of the three phases is triggered. Bits[8:6] \n(V ANLPHASE[2:0]) in the PHNOLOAD register indicate the state of all phases relative to a no load condition and they are set simultaneously with Bit V ANLOAD in the STATUS1 register:  \n• Bit  VA NLPHASE[0] indicates the state of Phase A.  \n• Bit V ANLPHASE[1] indicates the state of Phase B.  \n• Bit V ANLPHASE[2] indicates the state of Phase C.  \nWhen Bit  V ANLPHASE[x] is cleared to 0, it means the phase is \nout of no load condition. When set to 1, it means the  phase is in \nno load condition.  \nAn interrupt attached to Bit 2 (V ANLOAD) in the STATUS1 \nregister is enabled by setting Bit 2 in the MASK1 register. If \nenabled, the \nIRQ1  pin is set low and the status bit is set to 1 \nwhenever one of three p hases enters or exits this no load \ncondition. To find the phase that triggered the interrupt, the \nPHNOLOAD register is read immediately after reading the \nSTATUS1 register. Next, the status bit is cleared, and the IRQ1  \npin is set to high b y writing to the STATUS1 register with the \ncorresponding bit set to 1.   \nRev. C | Page 72 of 107 \nData Sheet ADE7880\n \nRev. C | Page 73 of 107 CHECKSUM REGISTER \nThe ADE7880  has a checksum 32-bit register, CHECKSUM, that \nensures the configuration registers maintain their desired value \nduring Normal Power Mode PSM0. \nThe registers covered by this register are MASK0, MASK1, \nCOMPMODE, gain, CFMODE, CF1DEN, CF2DEN, CF3DEN, CONFIG, MMODE, ACCMODE, LCYCMODE, HSDC_CFG, \nall registers located in the DSP data memory RAM between \nAddress 0x4380 and Address 0x43BE, and another eight 8-bit reserved internal registers that always have default values. The ADE7880  computes the cyclic redundancy check (CRC) based \non the IEEE802.3 standard. The registers are introduced one-by-one into a linear feedback shift register (LFSR) based generator \nstarting with the least significant bit (as shown in Figure 99). \nThe 32-bit result is written in the CHECKSUM register. After power-up or a hardware/software reset, the CRC is computed on the default values of the registers giving a result equal to \n0xAFFA63B9. \nFigure 100 shows how the LFSR works: the MASK0, MASK1, \nCOMPMODE, Gain, CFMODE, CF1DEN, CF2DEN, CF3DEN, \nCONFIG, MMODE, ACCMODE, LCYCMODE, and HSDC_CFG \nregisters, the registers located between Address 0x4380, and Address 0x43BE and the eight 8-bit reserved internal registers form the bits [a\n2271, a2270,…, a 0] used by LFSR. Bit a 0 is the least \nsignificant bit of the first register to enter LFSR; Bit a 2271 is the \nmost significant bit of the last register to enter LFSR. The \nformulas that govern LFSR are as follows: \n\uf0b7 bi(0) = 1, i = 0, 1, 2, …, 31, the initial state of the bits that \nform the CRC. Bit b 0 is the least significant bit, and Bit b 31 \nis the most significant. \n\uf0b7 gi, i = 0, 1, 2, …, 31 are the coefficients of the generating \npolynomial defined by the IEEE802.3 standard as follows: G(x) = x32 + x26 + x23 + x22 + x16 + x12 + x11 + x10 + x8 + x7 + \nx5 + x4 + x2 + x + 1 (52) \ng0 = g 1 = g 2 = g 4 = g 5 = g 7 = 1 \ng8 = g10 = g 11 = g 12 = g 16 = g 22 = g 23 = g 26 = 1 (53) \nAll of the other g i coefficients are equal to 0. \nFB(j) = a j – 1 XOR b31(j − 1) (54) \nb0(j) = FB (j) AND g0 (55) \nbi(j) = FB(j) AND gi XOR b i – 1(j – 1), i = 1, 2, 3, ..., 31 (56) \nEquation 54, Equation 55, and Equation 56 must be repeated for \nj = 1, 2, …, 2272. The value written into the CHECKSUM register \ncontains the Bit b i(2272) , i = 0, 1, …, 31.  \nEvery time a configuration register of the ADE7880  is written or \nchanges value inadvertently, the Bit 25 (CRC) in STATUS1 register \nis set to 1 to signal CHECKSUM value has changed. If Bit 25 (CRC) \nin MASK1 register is set to 1, then the IRQ1  interrupt pin is driven \nlow and the status flag CRC in STATUS1 is set to 1. The status bit is cleared and the IRQ1\n pin is set to high by writing to the STATUS1 \nregister with the status bit set to 1. \nWhen Bit CRC in STATUS1 is set to 1 without any register being \nwritten, it can be assumed that one of the registers has changed value and therefore, the ADE7880  has changed configuration. \nThe recommended response is to initiate a hardware/software reset that sets the values of all registers to the default, including \nthe reserved ones, and then reinitialize the configuration registers. \nBit 3 of the internal configuration register at Address 0xE7E4 \ndetermines if the checksum feature is enabled or disabled. If the bit is set, which is the default state, the checksum functionality works as expected. Though the register is write protected, it is \nimportant to ensure that the bit remains set while working with \nthis feature. If for any reason the bit gets reset to 0, the checksum functionality no longer works. Resetting the chip sets the bit to \n1 again. \n2271 0\nLFSR\nGENERATORARRAY OF 2272 BITS\n10193-071 \nFigure 99. CHECKSUM Register Calculation \nb0\nLFSRFBg0 g1 g2 g31\nb1g3\nb2 b31\na2271,a2270,....,a2,a1,a0\n10193-072 \nFigure 100. LFSR Generator Used in CHECKSUM Register Calculation  \n \nADE7880  Data Sheet  \n \nINTERRUPTS  \nThe ADE7880 has two interrupt pins, IRQ0  and IRQ1. Each of the \npins is managed by a 32 -bit interrupt mask register, MASK0  and \nMASK1, respectively. To enable an interrupt, a bit in the MASKx  \nregister must be set to 1. To disable it, the bit must be cleared  \nto 0. Two 32 -bit status registers, STATUS0  and STATUS1 , are \nassociated with the interrupts. When an interrupt event occurs in the \nADE7880, the corresponding f lag in the interrupt status \nregister is set to a logic 1 (see Table 36 and Table 37). If the mask \nbit for this interrupt in the interrupt mask register is logic  1, \nthen the IRQx  logic output goes active low. The flag bits in the \ninterrupt status register are set i rrespective of the state of the mask \nbits. To determine the source of the interrupt, the MCU must  \nperform a read of the corresponding STATUSx register and  \nidentify which bit is set to 1. To erase the flag in the status register, write back to the STATUSx register with the flag  set to 1. After an \ninterrupt pin goes low, the status register is read and the source of \nthe interrupt is identified. Then , the status register is written back \nwithout any change to clear the status flag to 0. The  \nIRQx  pin \nremains low until the status flag is cancelled. \nBy default, all interrupts are disabled. However, the RSTDONE \ninterrupt is an exception. This interrupt can never be masked (disabled) and, therefore, Bit 15 (RSTDONE) in the MASK1  \nregister does not ha ve any functionality. The \nIRQ1  pin always \ngoes low , and Bit 15 (RSTDONE) in the STATUS1 register  is set \nto 1 whenever a power -up or a hardware/software reset process  \nends.  To cancel the status flag, the STATUS1 register has to be \nwritten with Bit 15 (RSTDONE) set to 1.  \nCertain interrupts are used in conjunction with other status registers. The following bits in the MASK1 register work in  \nconjunction with the status bits in the PHNOLOAD register:  \n• Bit 0 (NLOAD)  \n• Bit 1 (FNLOAD)  \n• Bit 2 (V ANLOAD)   \nThe following bits in the MASK1 register work with the status \nbits in the PHSTATUS register:  \n• Bit 16, (SAG )  \n• Bit 17 (OI)  \n• Bit 18 (OV)  \nThe following bits in the MASK1 register work with the status \nbits in the IPEAK and VPEAK registers, respectively:  \n• Bit 23  (PKI)  \n• Bit 24 (PKV)  The following bits in the MASK0 register work with the status bits in the PHSIGN register:  \n• Bits[6:8] (REV APx)  \n• Bits[10:12] (REVRPx)  \n• Bit 9, Bit 13, and Bit  18 (REVPSUMx)  \nWhen the STATUSx register is read and one of these bits is set to 1, the status register associated with the bit is immediately \nread to identify the phase that triggered the interrupt and only at that time can the STATUSx register be written back with the bit set to 1.  \nUsing the Interrupts with an MCU  \nFigure 101 shows a timing diagram that illustrates a suggested \nimplementation of the ADE7880 interrupt management using an \nMCU. At Time t 1, the IRQx  pin goes active lo w indicating that \none or more interrupt events have occurred in the ADE7880, at which point , take  the following steps:  \n1. Tie the \nIRQx  pin to a negative -edge -triggered external \ninterrupt on the MCU.  \n2. On detection of the negative edge, configure the MCU to start executing its interrupt service routine (ISR).  \n3. On entering the ISR, disable all interrupts using the global interrupt mask bit. At this point, the MCU external interrupt  \nflag can be cleared to capture interrupt events that occur \nduring the current ISR.  \n4. When the MCU interrupt flag is cleared, a read from STATUSx, the interrupt status register, is carried out. The interrupt status register content is used to determine the sour ce of the interrupt(s) and, therefore , the appropriate \naction to be taken.  \n5. The same STATUSx content is written back into the \nADE7880 to clear the status flag(s) and reset the \nIRQx  line \nto logic high (t 2).  \nIf a subsequent interrupt event occurs during the ISR (t 3), that \nevent is recorded by the MCU external interrupt flag being  \nset again.  \nOn returning from the ISR, the global interrupt mask bit is cleared (same instruction cyc le) and the external interrupt flag \nuses the MCU to jump to its ISR once again. This ensures that the MCU does not miss any external interrupts.  \nFigure 102 shows a recommended timing diagram when the \nstatus bits in the STATUSx registers work in conjunction with \nbits in other registers. When the \nIRQx  pin goes active low, the \nSTATUSx register is read , and if one of these bits is 1,  a second \nstatus register is read immediately to identify the phase that triggered the interrupt. The name, PHx, in Figure 102 denotes \none of the PHSTATUS, IPEAK, VPEAK, or PHSIGN registers. Then, STATUSx is written back to clear the status flag(s).  \n \nRev. C | Page 74 of 107 \nData Sheet  ADE7880  \n \nJUMP\nTO ISRGLOBAL\nINTERRUPT\nMASKCLEAR MCU\nINTERRUPT\nFLAGREAD\nSTATUSxJUMP\nTO ISRWRITE\nBACK\nSTATUSxISR ACTION\n(BASED ON STATUSx CONTENTS)ISR RETURN\nGLOBAL INTERRUPT\nMASK RESETMCU\nINTERRUPT\nFLAG SET\nPROGRAM\nSEQUENCEt2 t1 t3\nIRQx\n10193-073 \n \nFigure 101 . Interrupt Managemen t \nPROGRAM\nSEQUENCEIRQx\nJUMP\nTO ISRGLOBAL\nINTERRUPT\nMASKCLEAR MCU\nINTERRUPT\nFLAGREAD\nSTATUSxREAD\nPHxJUMP\nTO ISRWRITE\nBACK\nSTATUSxISR ACTION\n(BASED ON STATUSx CONTENTS)ISR RETURN\nGLOBAL INTERRUPT\nMASK RESETMCU\nINTERRUPTFLAG SET t2 t1 t3\n10193-074 \nFigure 102 . Interrupt Management when PHSTATUS, IPEAK, VPEAK , or PHSIGN Registers are Involved  \nSERIAL INTERFACES  \nThe ADE7880 has three serial port interfaces: one fu lly licensed \nI2C interface, one serial peripheral interface (SPI), and one high \nspeed data capture port (HSDC). As the SPI pins are multiplexed  \nwith some of the pins of the I2C and HSDC ports, the ADE7880 \naccept s two configurations: one using the SPI port only and one \nusing the I2C port in conjunction with the HSDC port.  \nSerial Interface Choice  \nAfter reset, the HSDC port is always disabled. Choose  between \nthe I2C and SPI port s by manipulating the SS/HSA  pin after \npower -up or after a hardware reset. If the SS/HSA  pin is kept \nhigh, then the ADE7880 uses the I2C port until a new hardware \nreset is executed.  If the SS/HSA  pin is toggled high to low three \ntimes after power -up or after a hardware reset, the ADE7880 \nuses the SPI port until a new hardware reset is executed. This \nmanipu lation of the SS/HSA  pin can be accomplished in two \nways . First, use the SS/HSA  pin of the master device (that is, the \nmicrocontroller) as a regular I/O pin and toggle it three times. \nSecond,  execute three SPI write oper ations to a location in the \naddress space that is not allocated to a specific ADE7880  register \n(for example 0xEBFF , where eight bit writes can be executed). \nThese writes allow the SS/HSA  pin to toggle three times. See the \nSPI Write Operation  section for details on the write protocol \ninvolved.  \nAfter the serial port choice is completed , it needs to be locked.  \nConsequently,  the active port remains in use until a hardware \nreset is executed in PSM0 normal mode or until a power -down. \nIf I2C is the active serial port, Bit 1 (I2C_LOCK) of the CONFIG2  \nregister must be set to 1 to lock it in. From this moment, the \nADE7880  ignore s spurious toggling of the SS pin and an even tual \nswitch into using the SPI port is no longer possible. If the SPI is \nthe active serial port, any write to the CONFIG2 register locks \nthe port. From this moment, a switch into using the I2C port is \nno longer possible. Once locked, the serial port choice is \nmaintained when the ADE7880 changes PSMx power modes.  \nThe functionality of the ADE7880 is accessible via several on -\nchip registers. The contents of these registers can be updated or read using  either the I2C or SPI interfaces. The HSDC port \nprovides the stat e of up to 16  registers representing in stantaneous \nvalues of  phase voltages and neutral currents, and active, reactive, \nand apparent powers.  \nCommunication Verification  \nThe ADE7880 includes a set of three registers that allow any \ncommu nication via I2C or SPI to be verified.  The LAST_OP \n(Address 0xEA01), LAST_ADD (Address 0xE9FE) and LAST_ RWDATA registers  record the nature, address and data \nof the last successful communication respectively. The \nLAST_RWDATA register has three separate add resses \ndepending on the length of the successful communication.  \nTable 24. LAST_RWDATA Register L ocation s \nCommunication Type  Address \n8-Bit Read/ Write 0xE7FD  \n16-B it Read/ Write 0xE9FF  \n32-B it Read/ Write 0xE5FF  \nAfter each successful communication with the ADE7880, the \naddress of the last accessed register is stored in the 16 -bit \nLAST_ADD register (Address 0xE9FE).  This is a read only \nregister that stores the value until the next successful read or write is complete.  The LAST_OP register (Address 0xEA01) \nstores the nature of the operation . That is , it indicates whether a \nread or a write was performed.  If the last operation is a write , the \nLAST_OP register  store s the value 0xCA. If the last operation is \na read, the LAST_OP register stores the value 0x35.  The \nLAST_RWDATA register stores the data that was written or read from the register.  Any unsuccessful read or write operation \nis not reflected in these registers.  \nWhen L A S T _ O P,  LAST_ADD and LAST_RWDATA  registers \nare read, their values are not stored into themselves.  \nRev. C | Page 75 of 107 \nADE7880  Data Sheet  \n \nI2C-Compatible Interface  \nThe ADE7880 supports a fully licensed I2C interface. The I2C \ninterface is imple mented as a full hardware slave. SDA is the \ndata I/O pin, and SCL is the serial clock. These two pins are \nshared with the MOSI and SCLK pins of the on -chip SPI \ninterface. The maximum serial clock frequency  supported by this \ninterface is 400 kHz.  \nThe two pi ns used for data transfer, SDA and SCL, are configured  \nin a wire -AND’ed format that allows arbitration in a multimaster  \nsystem. Note that the ADE7880 requires a minimum of 100 ns \nhold time for I2C communication. Refer to the t HD;DAT  specification  \nin Table 2. \nThe tra nsfer sequence of an I2C system consists of a master device \ninitiating a transfer by generating a start condition while the bus is idle. The master transmits t he address of the slave device and \nthe direction of the data transfer in the initial address transfer. If the slave acknowledges, the data transfer is initiated. This continues  \nuntil the master issues a stop condition, and the bus becomes idle.   I2C Write Operation  \nThe write operation using the I2C interface of the ADE7880 \ninitiate  when the master generates a start condition and consists \nin one byte representing the address of the ADE7880 followed \nby the 16 -bit address of the target register and by the value of \nthe register.  \nThe most significant seven bits of the address byte constitute \nthe address of the ADE7880 and they are equal to 0111000b. \nBit 0 of the address byte is a read/ write  bit. Because this is a \nwrite operation, it has to be cleared to 0 ; therefore, the first byte \nof the write operation is 0x70. Af ter every byte is received, the \nADE7880 generates an acknowledge. As registers can  have 8, 16, \nor 32 bits, after the last bit of the register is transmitted and the  \nADE7880 acknowledges the transfer, the master generates a stop  \ncondition. The addresses and the register content are sent with \nthe most significant bit first. See Figure 103 for details of the I2C \nwrite operation.  \nACK GENERATED\nBY ADE7880START\nACK\nACK\nACK\nACK\nACK\nACK\nACK\nSTOP\nS S 015\nSLAVE ADDRESS MOST SIGNIFICANT\n8 BITS OF REGISTER\nADDRESSLESS SIGNIFICANT\n8 BITS OF REGISTER\nADDRESSBYTE 3 (MOST\nSIGNIFICANT)\nOF REGISTERBYTE 2 OF REGISTER BYTE 1 OF REGISTER BYTE 0 (LESS\nSIGNIFICANT) OF\nREGISTER8 7 0 31 24 23 16 15 8 0 7\n1110000\n10193-075 \nFigure 103 . I2C Write Operation of a 32 -Bit Register \n \nRev. C | Page 76 of 107 \nData Sheet  ADE7880  \n \nI2C Read Operation  \nThe read operation using the I2C interface of the ADE7880 is \naccomplished i n two stages. The first stage sets the pointer to \nthe address of the register. The second stage reads the content of \nthe register.  \nAs seen in Figure 104, the first stage initiates when the master \ngenerates a start condition and consists in one byte representing \nthe address of the ADE7880 followed by the 16 -bit address of the \ntarget register. The ADE7880 acknow ledges every byte received. \nThe address byte is similar to the address byte of a write operation  \nand is equal to 0x70 ( see the I2C Write Operation  section for \ndetails). After the last byte of the register address is  sent and \nackno wledged by the ADE7880, the second stage begins with the master generating a new start condition followed by an \naddress byte. The most significant seven bits of this address byte \nconstitute the a ddress of the ADE7880, and they are equal to  \n0111000b. Bit  0 of the address byte is a read/ write  bit. Because this \nis a read operation, it must be set to 1 ; thus, the first by te of the \nread operation is 0x71. After this byte is received , the ADE7880 \ngenerates an acknowledge. Then, the ADE7880 sends the value \nof the register , and after every eight bits are received, the master \ngenerates an acknowledge. All the bytes are sent with the most \nsignificant bit first. Because  registers can have 8, 16, or 32 bits, \nafter the last bit of the register is received, the mast er does not \nacknowledge the transfer  but generates a stop condition.  \nACK GENERATED\nBY ADE7880\nACKNOWLEDGE\nGENERATED BY\nMASTERSTART\nS015\nSLAVE ADDRESS MOST SIGNIFICANT\n 8 BITS OF REGISTER\nADDRESSLESS SIGNIFICANT\n8 BITS OF REGISTER\nADDRESS8 7 0\n1110000START\nSTOPNOACK\nS S 0\nSLAVE ADDRESS BYTE 3\n(MOST SIGNIFICANT)\nOF REGISTERBYTE 2 OF\nREGISTERBYTE 1 OF\nREGISTERBYTE 0\n(LESS SIGNIFICANT)\nOF REGISTER31 24 23 16 15 8 0 7\n1110001\nACK GENERATED\nBY ADE7880ACK\nACK\nACKACKACK\nACK\nACK\n10193-076 \nFigure 104 . I2C Read Operation of a 32 -Bit Register  \nACK GENERATED\nBY ADE7880\nACKNOWLEDGE\nGENERATED BY\nMASTERSTART START\nNOACK\nSTOPS015\nSLAVE ADDRESS MOST SIGNIFICANT\n 8 BITS OF REGISTER\nADDRESSLESS SIGNIFICANT\n8 BITS OF REGISTER\nADDRESS8 7 0\n1110000\nBYTE 3\n(MOST SIGNIFICANT)\nOF REGISTER 0BYTE 0\n(LESS SIGNIFICANT)\nOF REGISTER 0BYTE 3\n(MOST SIGNIFICANT)\nOF REGISTER 1BYTE 0\n(LESS SIGNIFICANT)\nOF REGISTER nACK\nACK\nACKACKACK\nACK\nACKS0111000\nSLAVE ADDRESSS31 24\n17 0 31 24 7 0\nACK GENERATED\nBY ADE7880\n10193-077 \nFigure 105 . I2C Read Operation of n 32- Bit Harmonic Calculations Registers  \nRev. C | Page 77 of 107 \nADE7880 Data Sheet\n \nRev. C | Page 78 of 107 I2C Read Operation of Harmonic Calculations Registers \nThe registers containing the harmonic calculation results are \nlocated starting at Address 0xE880 and are all 32-bit width. They \ncan be read in two ways: one register at a time (see the I2C Read \nOperation section for details) or multiple consecutive registers \nat a time in a burst mode. This burst mode is accomplished in two stages. As seen in Figure 105, the first stage sets the pointer to the address of the register and is identical to the first stage \nexecuted when only one register is read. The second stage reads \nthe content of the registers. The second stage begins with the master generating a new start condition followed by an address byte equal to the address byte used when one single register is read, 0x71. After this byte is received, the ADE7880  generates \nan acknowledge. Then, the ADE7880 sends the value of the first \nregister located at the pointer, and after every eight bits are received, the master generates an acknowledge. All the bytes are sent with the most significant bit first. After the bytes of the first register are sent, if the master acknowledges the last byte, the ADE7880  \nincrements the pointer by one location to position it at the next register and begins to send it out byte by byte, most significant bit first. If the master acknowledges the last byte, the ADE7880  \nincrements the pointer again and begins to send data from the next register. The process continues until the master ceases to generate an acknowledge at the last byte of the register and then \ngenerates a stop condition. It is recommended to not allow \nlocations greater than 0xE89F, the last location of the harmonic \ncalculations registers. \nSPI-Compatible Interface \nThe SPI of the ADE7880  is always a slave of the communication \nand consists of four pins (with dual functions): SCLK/SCL, \nMOSI/SDA, MISO/HSD, and SS/HSA. The functions used in \nthe SPI-compatible interface are SCLK, MOSI, MISO, and SS. \nThe serial clock for a data transfer is applied at the SCLK logic \ninput. All data transfer operations synchronize to the serial \nclock. Data shifts into the ADE7880  at the MOSI logic input  \non the falling edge of SCLK and the ADE7880  samples it on  \nthe rising edge of SCLK. Data shifts out of the ADE7880  at  \nthe MISO logic output on a falling edge of SCLK and can be \nsampled by the master device on the raising edge of SCLK. The \nmost significant bit of the word is shifted in and out first. The maximum serial clock frequency supported by this interface  is 2.5 MHz. MISO stays in high impedance when no data is transmitted from the ADE7880 . See Figure 106 for details of the connection between the ADE7880  SPI and a master device \ncontaining an SPI interface. \nThe SS\n logic input is the chip select input. This input is used when \nmultiple devices share the serial bus. Drive the SS input low for \nthe entire data transfer operation. Bringing SS high during a data \ntransfer operation aborts the transfer and places the serial bus \nin a high impedance state. A new transfer can then be initiated \nby returning the SS logic input to low. However, because aborting a \ndata transfer before completion leaves the accessed register in a \nstate that cannot be guaranteed, every time a register is written, verify its value by reading it back. The protocol is similar to the \nprotocol used in I\n2C interface. \nMOSI\nMISO\nSCLKADE7880\nMOSI\nMISOSCKSPI DEVICE\nSS SS\n10193-078 \nFigure 106. Connecting ADE7880  SPI with an SPI Device \nSPI Read Operation \nThe read operation using the SPI interface of the ADE7880  \ninitiates when the master sets the SS/HSA pin low and begins \nsending one byte, representing the address of the ADE7880 , on \nthe MOSI line. The master sets data on the MOSI line starting \nwith the first high-to-low transition of SCLK. The SPI of the ADE7880  samples data on the low-to-high transitions of SCLK. \nThe most significant seven bits of the address byte can have any value, but as a good programming practice, it is recommended they be different from 0111000b, the seven bits used in the I\n2C \nprotocol. Bit 0 (read/ write ) of the address byte must be 1 for a \nread operation. Next, the master sends the 16-bit address of the register that is read. After the ADE7880  receives the last bit of \naddress of the register on a low-to-high transition of SCLK, it \nbegins to transmit its contents on the MISO line when the next \nSCLK high-to-low transition occurs; thus, the master can sample the data on a low-to-high SCLK transition. After the master \nreceives the last bit, it sets the SS\n and SCLK lines high and the \ncommunication ends. The data lines, MOSI and MISO, go into \na high impedance state. See Figure 107 for details of the SPI \nread operation. \n \nData Sheet ADE7880\n \nRev. C | Page 79 of 107 1 015 14SCLK\nMOSI\nMISO10\n31 30 1 000 0 000\nREGISTER VALUEREGISTER ADDRESSSS\n10193-079 \nFigure 107. SPI Read Operation of a 32-Bit Register \n0SCLK\nMOSI\nMISO00 0 0001SS\nREGISTER\nADDRESS\nREGISTER 0\nVALUE31 0\nREGISTER n\nVALUE31 0\n10193-080 \nFigure 108. SPI Read Operation of n 32-Bit Harmonic Calculations Registers \n \nSPI Read Operation of Harmonic Calculations Registers \nThe registers containing the harmonic calculation results are \nlocated starting at Address 0xE880 and are all 32-bit width. \nThey can be read in two ways: one register at a time (see the SPI Read Operation section for details) or multiple consecutive registers at a time in a burst mode. The burst mode initiates \nwhen the master sets the SS\n/HSA pin low and begins sending \none byte, representing the address of the ADE7880 , on the \nMOSI line. The address is the same address byte used for \nreading only one register. The master sets data on the MOSI line \nstarting with the first high-to-low transition of SCLK. The SPI of the ADE7880  samples data on the low-to-high transitions of \nSCLK. Next, the master sends the 16-bit address of the first harmonic calculations register that is read. After the ADE7880  \nreceives the last bit of the address of the register on a low-to-high transition of SCLK, it begins to transmit its contents on the MISO line when the next SCLK high-to-low transition occurs; thus, the master can sample the data on a low-to-high SCLK transition. After the master receives the last bit of the first \nregister, the ADE7880 sends the harmonic calculations register \nplaced at the next location and so forth until the master sets the SS\n and SCLK lines high and the communication ends. The data lines, MOSI and MISO, go into a high impedance state. See Figure 108 for details of the SPI read operation of harmonic \ncalculations registers. \nSPI Write Operation \nThe write operation using the SPI interface of the ADE7880  \ninitiates when the master sets the SS/HSA pin low and begins \nsending one byte representing the address of the ADE7880  on \nthe MOSI line. The master sets data on the MOSI line starting \nwith the first high-to-low transition of SCLK. The SPI of the ADE7880  samples data on the low-to-high transitions of SCLK. \nThe most significant seven bits of the address byte can have any \nvalue, but as a good programming practice, it is recommended \nthey be different from 0111000b, the seven bits used in the I\n2C \nprotocol. Bit 0 (read/ write ) of the address byte must be 0 for a \nwrite operation. Next, the master sends the 16-bit address of the register that is written and the 32-, 16-, or 8-bit value of that register without losing any SCLK cycle. After the last bit is \ntransmitted, the master sets the SS\n and SCLK lines high at the \nend of the SCLK cycle and the communication ends. The data \nlines, MOSI and MISO, go into a high impedance state. See \nFigure 109 for details of the SPI write operation.  \n \nADE7880 Data Sheet\n \nRev. C | Page 80 of 107 015 14SCLK\nMOSI10 3 1 3 0 10\n00 0 0000REGISTER ADDRESS REGISTER VALUESS\n10193-081 \nFigure 109. SPI Write Operation of a 32-Bit Register \nHSDC Interface \nThe high speed data capture (HSDC) interface is disabled after \ndefault. It can be used only if the ADE7880  is configured with an \nI2C interface. The SPI interface of ADE7880  cannot be used at \nthe same time with HSDC.  \nBit 6 (HSDCEN) in the CONFIG register activates HSDC when \nset to 1. If Bit HSDCEN is cleared to 0, the default value, the HSDC interface is disabled. Setting Bit HSDCEN to 1 when SPI is in use does not have any effect. HSDC is an interface for \nsending to an external device (usually a microprocessor or a \nDSP) up to sixteen 32-bit words. The words represent the instantaneous values of the phase currents and voltages, neutral current, and active, reactive, and apparent powers. The registers being transmitted include IAWV , V AWV , IBWV , VBWV , ICWV , \nVCWV , INWV , A V A, BV A, CV A, AW ATT, BW ATT, CW ATT, \nA F VA R ,  B F VA R ,  a nd  C F VA R .  A l l  are  2 4 - bit  re g i s te r s  t h at  are  \nsign extended to 32-bits (see Figure 45 for details).  \nHSDC can be interfaced with SPI or similar interfaces. HSDC is \nalways a master of the communication and consists of three pins: HSA, HSD, and HSCLK. HSA represents the select signal. It stays active low or high when a word is transmitted and it is \nusually connected to the select pin of the slave. HSD sends data \nto the slave and it is usually connected to the data input pin of the slave. HSCLK is the serial clock line that is generated by the ADE7880  and it is usually connected to the serial clock input of \nthe slave. Figure 110 shows the connections between the ADE7880  \nHSDC and slave devices containing an SPI interface. \nADE7880\nHSD MOSI\nHSCLK SCK\nHSA SSSPI DEVICE\n10193-082 \nFigure 110. Connecting the ADE7880  HSDC with an SPI \nThe HSDC communication is managed by the HSDC_CFG register (see Table 52). It is recommended to set the HSDC_CFG register to the desired value before enabling the port using Bit 6 (HSDCEN) in the CONFIG register. In this way, the state of various pins belonging to the HSDC port do not take levels incon-\nsistent with the desired HSDC behavior. After a hardware reset \nor after power-up, the MISO/HSD and SS\n/HSA pins are set high. \nBit 0 (HCLK) in the HSDC_CFG register determines the serial \nclock frequency of the HSDC communication. When HCLK is \n0 (the default value), the clock frequency is 8 MHz. When HCLK  is 1, the clock frequency is 4 MHz. A bit of data is transmitted for every HSCLK high-to-low transition. The slave device that receives data from HSDC samples the HSD line on the low-to-high transition of HSCLK. \nThe words can be transmitted as 32-bit packages or as 8-bit \npackages. When Bit 1 (HSIZE) in the HSDC_CFG register is 0 (the \ndefault value), the words are transmitted as 32-bit packages. When Bit HSIZE is 1, the registers are transmitted as 8-bit packages. The \nHSDC interface transmits the words MSB first. \nBit 2 (HGAP) introduces a gap of seven HSCLK cycles between \npackages when Bit 2 (HGAP) is set to 1. When Bit HGAP is cleared to 0 (the default value), no gap is introduced between \npackages and the communication time is shortest. In this case, \nHSIZE does not have any influence on the communication and a data bit is placed on the HSD line with every HSCLK high-to-\nlow transition. \nBits[4:3] (HXFER[1:0]) decide how many words are transmitted. \nWhen HXFER[1:0] is 00, the default value, then all 16 words are transmitted. When HXFER[1:0] is 01, only the words representing \nthe instantaneous values of phase and neutral currents and phase \nvoltages are transmitted in the following order: IAWV , V AWV , IBWV , VBWV , ICWV , VCWV , and one 32-bit word that is always equal to INWV . When HXFER[1:0] is 10, only the instantaneous values of phase powers are transmitted in the following order: \nAV A, BV A, CV A, AW ATT, BW ATT, CW ATT , AFV AR, BFV AR, \nand CFV AR. The value, 11, for HXFER[1:0] is reserved and \nwriting it is equivalent to writing 00, the default value. \nBit 5 (HSAPOL) determines the polarity of HSA function of the \nSS\n/HSA pin during communication. When HSAPOL is 0 (the \ndefault value), HSA is active low during the communication. This means that HSA stays high when no communication is in progress. When a communication is executed, HSA is low when the 32-bit or 8-bit packages are transferred, and it is high during \nthe gaps. When HSAPOL is 1, the HSA function of the SS\n/HSA \npin is active high during the communication. This means that \nHSA stays low when no communication is in progress. When a \ncommunication is executed, HSA is high when the 32-bit or  \n8-bit packages are transferred, and it is low during the gaps. \nBits[7:6] of the HSDC_CFG register are reserved. Any value \nwritten into these bits does not have any consequence on HSDC \nbehavior. \nData Sheet ADE7880\n \nRev. C | Page 81 of 107 Figure 111 shows the HSDC transfer protocol for HGAP = 0, \nHXFER[1:0] = 00 and HSAPOL = 0. Note that the HSDC interface sets a data bit on the HSD line every HSCLK high-to-\nlow transition and the value of Bit HSIZE is irrelevant. \nFigure 112 shows the HSDC transfer protocol for HSIZE = 0, \nHGAP = 1, HXFER[1:0] = 00, and HSAPOL = 0. Note that the \nHSDC interface introduces a seven-HSCLK cycles gap between \nevery 32-bit word.  \nFigure 113 shows the HSDC transfer protocol for HSIZE = 1, \nHGAP = 1, HXFER[1:0] = 00, and HSAPOL = 0. Note that the HSDC interface introduces a seven-HSCLK cycles gap between \nevery 8-bit word. See Table 52 for the HSDC_CFG register and descriptions for \nthe HCLK, HSIZE, HGAP , HXFER[1:0], and HSAPOL bits. Table 25 lists the time it takes to execute an HSDC data transfer for all HSDC_CFG register settings. For some settings, the \ntransfer time is less than 125 μs (8 kHz), the waveform sample \nregisters update rate. This means the HSDC port transmits data every sampling cycle. For settings in which the transfer time is greater than 125 μs, the HSDC port transmits data only in the first of two consecutive 8 kHz sampling cycles. This means it transmits registers at an effective rate of 4 kHz. \nTable 25. Communication Times for Various HSDC Settings \nHXFER[1:0] HGAP HSIZE1 HCLK Communication Time (μs) \n00 0 N/A 0 64 \n00 0 N/A 1 128 \n00 1 0 0 77.125 \n00 1 0 1 154.25 \n00 1 1 0 119.25 \n00 1 1 1 238.25 \n01 0 N/A 0 28 \n01 0 N/A 1 56 \n01 1 0 0 33.25 \n01 1 0 1 66.5 \n01 1 1 0 51.625 \n01 1 1 1 103.25 \n10 0 N/A 0 36 \n10 0 N/A 1 72 \n10 1 0 0 43 \n10 1 0 1 86 \n10 1 1 0 66.625 \n10 1 1 1 133.25 \n \n1 N/A means not applicable. \n \nHSCLK\nHSD\nHSAIAVW (32-BIT)31 0\nVAWV (32-BIT)31 0\nIBWV (32-BIT)31 0\nCFVAR (32-BIT)31 0\n10193-083 \nFigure 111. HSDC Communication for HGAP = 0, HXFER[1:0] = 00, and HSAPOL = 0; HSIZE Is Irrelevant \n \nADE7880 Data Sheet\nRev. C | Page 82 of 107 HSCLK\nHSD\nHSAIAVW (32-BIT)31 0\nVAWV (32-BIT)31 0\nIBWV (32-BIT)31 0\nCFVAR (32-BIT)31 0\n7 HCLK\nCYCLES7 HCLK\nCYCLES\n10193-084\nFig\nure 112. HSDC Communication for HSIZE = 0, HGAP = 1, HXFER[1:0] = 00, and HSAPOL = 0 \nHSCLK\nHSD\nHSAIAVW (BYTE 3)31 24\nIAVW (BYTE 2)23 16\nIAVW (BYTE 1)15 8\nCFVAR (BYTE 0)70\n7 HCLK\nCYCLES7 HCLK\nCYCLES\n10193-085\nFig\nure 113. HSDC Communication for HSIZE = 1, HGAP = 1, HXFER[1:0] = 00, and HSAPOL = 0 \nADE7880 QUICK SETUP AS ENERGY METER \nAn energy meter is usually characterized by the nominal \ncurrent I n, nominal voltage V n, nominal frequency f n, and the \nmeter constant MC. \nTo quickly s et up the ADE7880 , execute the following steps: \n1. Select the PGA gains in the phase currents, voltages an d\nn\neutral current channels: Bits[2:0] (PGA1), Bits [5:3]\n(PGA2) a\nnd Bits[8:6] (PGA3) in the Gain register .\n2. If Rogowski coils are used, enable the digital integrators in the \nphas\ne and neutral currents: Bit 0 (INTEN)set to 1 in th e\nCO\nNFIG register. Initialize the DICOEFF register to 0xFF8000 \nbefore setting the INTEN bit in the CONFIG register .\n3. If f n is between 55 Hz and 66 Hz, set Bit 14 (SEL FREQ) in\nt\nhe COMPMODE register .\n4. Initialize all the other data memory RAM registers. Writ e\nt\nhe last register in the queue three times to ensure that i ts\nva\nlue is written into the RAM.\n5. Initialize the WTHR, V ARTHR, V ATHR, VLEVEL a nd\nVN\nOM registers based on Equation 26, Equa tion 37,\nE\nquation 44, Equation 22, and Equation 42, respectively.\n6. Initialize CF1DEN, CF2DEN, and CF3DEN based on\nE\nquation 49.7. Enable the data memory RAM protection by writing 0xADt\no an internal 8-bit register located at Address 0xE7FE\nfollowed by a write of 0x80 to an internal 8-bit regist er\nlo\ncated at Address 0x E7E3.\n8. Read back all data memory RA M  registers to ensure that\nthey initialized with the desired values. If one or moreregisters did not initialize correctly, disable the protection by\nwriting 0xAD to an internal 8-bit register at Address 0xE7FE, \nfollowed by a write of 0x00 to an internal 8-bit register located at Address 0xE7E3. Reinitialize the registers, and write th\ne\nlas\nt register in the queue three times. Enable the writ e\nprote\nction by writing 0xAD to an internal 8-bit register\nlocated at Address 0xE7FE, followed by a write of 0x80 to\nan internal 8-bit register located at Address 0xE7E3.\n9. Start the DSP by setting Ru n = 1.\n10. Read the energy registers xW ATTHR, xV AHR, xFW ATTHR, \na\nnd xFV ARHR to erase their content and start energy\naccumulation from a known state.\n11. Enable the CF1, CF2, and CF3 frequency converter output s\nb\ny clearing bits 9, 10, and 11 (CF1DIS, CF2DIS, a nd\nCF3D\nIS) to 0 in the CFMODE register.\nFor a quick setup of the ADE7880  harmonic calculations, see the \nRecommended Approach to Managing Harmonic Calculations \nsection. \nData Sheet ADE7880\n \nRev. C | Page 83 of 107 LAYOUT GUIDELINES \nFigure 114 presents a basic schematic of the ADE7880  together \nwith its surrounding circuitry: decoupling capacitors at pins \nVDD, AVDD, DVDD, and REF IN/OUT , the 16.384 MHz crystal, \nand its load capacitors. The rest of the pins are dependent on the particular application and are not shown here.  \nC1\n4.7µFC2\n0.22µFC3\n4.7µFC4\n0.22µF\nC5\n0.1µFC6\n10µF\nU1\nC7\n0.1µF172\n3\n47\n8\n9\n1213\n14\n1516\n18\n2322\n19\n27\n36\n38PM0\nPM1RESET\nIAP\nIAN\nIBP\nIBNICP\nICN\nINP\nINN\nVNVAP\nVBP\nVCP\nCLKIN\nSCLK/SCLMOSI/SDA2824 265\n29\n32\n371\n10\n11\n2021NC\nADE7880ACPZ\n30\n31\n40\n25PAD\n6AGNDPAD\nDGND393433\n35C10\n4.7µF\nC820pFR1\n5MΩY1\n16.384MHz2\n1 C920pFAVDD\nDVDD\nVDD\nREF IN/OUT\nCLKOUT\nIRQ0\nIRQ1\nCF1\nCF2\nCF3/HSCLK\nMISQ/HSD\nSS/HSA\n10193-213 \nFigure 114. ADE7880  Crystal and Capacitors Selection \nFigure 115 and Figure 116 present a proposed layout of a printed \ncircuit board (PCB) with two layers that have the components \nplaced only on the top of the board. Following these layout \nguidelines helps in creating a low noise design with higher \nimmunity to EMC influences. \nThe VDD, AVDD, DVDD, and REF IN/OUT  pins have two decoupling \ncapacitors each, one of μF order and a ceramic one of 220 nF or \n100 nF. These ceramic capacitors need to be placed the closest to the ADE7880  as they decouple high frequency noises, while \nthe μF ones must be placed in close proximity. \nThe crystal load capacitors need to be placed closest to the \nADE7880 , while the crystal can be placed in close proximity. \n10193-214 \nFigure 115. ADE7880  Top Layer Printed Circuit Board \nThe exposed pad of the ADE7880  is soldered to an equivalent \npad on the PCB. The AGND and DGND traces of the ADE7880  \nare then routed directly into the PCB pad.  \nThe bottom layer is composed mainly of a ground plane \nsurrounding as much as possible the crystal traces. \n08510-088 \nFigure 116. ADE7880  Bottom Layer Printed Circuit Board \n \n    \n \n  \nADE7880  Data Sheet  \n \nCRYSTAL CIRCUIT  \nA digital clock signal of 16.384 MHz can be provided to the CLKIN  \npin of the ADE7880. Alternatively, attach a crystal of the specified  \nfrequency, as shown in Figure 117. CL 1 and CL 2 denote the capaci -\ntances of the ceramic capacitors attached to the crystal p ins, whereas  \nCP 1 and CP 2 denote the parasitic capacitances on those pins.  \nThe recommended typical value of total capacitance at each \nclock pin, CLKIN and CLKOUT, is 24 pF, which means that  \nTotal Capacitance = CP 1 + CL 1 = CP 2 + CL 2 = 24 pF  \nCrystal manufact urer data sheets specify the load capacitance \nvalue. A total capacitance of 24 pF per clock pin  is recommended;  \ntherefore, select a crystal with a 12 pF load capacitance. In \naddition, when selecting t he ceramic capacitors, CL 1 and CL 2, \nthe parasitic capaci tances, CP 1 and CP 2, on the crystal pins of \nthe IC must be taken into account. Thus, the values of CL 1 and \nCL 2 must be based on the following expression:  \nCL 1 = CL 2 = 2 × Crystal Load Capacitance  − CP 1 \nwhere CP 1 = CP 2. \nFor example, if a 12 pF crystal is cho sen and the parasitic capaci -\ntances on the clock pins are CP 1 = CP 2 = 2 pF , the ceramic capacitors  \nthat must be used in the crystal circuit are CL 1 = CL 2 = 22 pF.  The EVA L -ADE7880EBZ  evaluation board uses the crystal \nVM6 -1D11C12- TR-16.384MHZ ( maximum drive level 1  mW; \nmaximum ESR 20 Ω; load capacitance 12 pF). Select  the same \ncrystal  or a crys tal with similar specifications . Lower values of \nESR and load capacitance and higher values of drive level \ncapability of the crystal are preferable.  \nIt is also recommended that a 5  MΩ resistor be attached in \nparallel to the crystal, as shown in Figure 117.  \nCLKOUTCLKINCL2\nCP1\nGNDGND\nCL1CP2\n16.384MHz CRYSTAL 5MΩ ADE7880 IC\n10193-216 \nFigure 117 . Crystal Circuit  \nADE7880 EVA LUA TION BOARD  \nAn evaluati on board built upon the ADE7880 configuration  is \navailable . Visit www.analog.com/ ADE7880 for details.  \nDIE VERSION  \nThe r egister named version  identifies the version of the die. It is \nan 8-bit, read -only register located at Address 0xE707.  \n \nRev. C | Page 84 of 107 \nData Sheet  ADE7880  \n \nSILICON ANOMALY  \nThis anomaly list describes the known issues with the ADE7880 silicon identified by the V ersion register (Address 0xE707) being equal to 1.  \nAnalog Devices, Inc., is committed, through future silicon revisions, to continuously improve silicon functionality. Analog D evices tries \nto ensure that these future silicon revisions remain compatible with your present software/systems by implementing the recommend ed \nworkarounds outlined here.  \nADE7880 FUNCTIONALITY ISSUES  \nSilicon Rev ision \nIdentifier Chip Marking  Silicon Status  Anomaly Sheet  No. of Reported Issues  \nVersion = 1  ADE7880ACPZ Released  Rev. B 4 (er001, er002, er003, er004 ) \nFUNCTIONALITY ISSUES  \nTable 26. LAST_ADD R and LAST_RWDATA _x Register s Show Wrong Value in Burst SPI  Mode [er001, Version = 1 Silicon]  \nBackground  When any ADE7880 register is read using SPI or I2C communication, the address is stored in the LAST_ADDR register and \nthe data i s stored in the respective LAST_RWDATA_x register.  \nIssue  When the waveform registers located between Address 0xE880 and Address 0xE89F are read using burst SPI mode, the \nLAST_ADDR register contains the address of the register incremented by 1 and the LAST _RWDATA_x register contains the \ndata corresponding to the faulty address in the LAST_ADDR register. The issue is not present if the I2C communication is used.  \nWorkaround  After accessing the waveform registers in burst SPI mode, perform another read/write operation elsewhere before using \nthe communication verification registers.  \nRelated  Issues  None.  \nTable 27. To Obtain Best Accuracy Performance, Internal Setting Must Be Changed [er002, Version = 1 Silicon]  \nBackground  Internal defau lt settings provide best accuracy performance for ADE7880.  \nIssue  It was found that if a different setting is used, the accuracy performance can be improved. \nWorkaround  To enable a new setting f or this internal register, execute three consecutive write operations:  \n The first write operation is to an 8 -bit location: 0xAD is written to Address 0xE7FE.  \n The second write operation is to a 16 -bit location: 0x3BD is written to Address 0xE90C.  \n The t hird write operation is to an 8 -bit location: 0x00 is written to Address 0xE7 FE. \n The write operations must be executed consecutively without any other read/write operation in between. As a verification that the value was captured correctly, a simple 16 -bit read of Address 0xE90C shows  the 0x3BD value.  \nRelated  Issues  None.  \nTable 28. High -Pass Filter C annot b e Disabled in Phase C Voltage Data Path [er003, Version = 1 Silicon]  \nBackground  When Bit 0 (HPFEN) of the CONFIG3 register is 0, all high -pass filters (HPF) in the phase and neutral currents and phase \nvoltages data paths are disabled (see the ADE7880  data sheet for more information about the current channel HPF and \nthe voltage channel HPF ). \nIssue  The HPF in the Phase C voltage data  path remains enabled independent of the state of Bit HPFEN.  \nWorkaround  There is no workaround.  \nRelated  Issues  None.  \nRev. C | Page 85 of 107 \nADE7880  Data Sheet  \n \nTable 29. No Load Condition Does Not Function  as Defined  [er004 , Version = 1  Silicon]   \nBackground  Total active power no load uses the total active energy and the apparent energy to trigger the no load condition. If \nneither total active energy nor apparent energy are accumulated for a time indicated in the respective APNOLOAD and \nVANOLOAD unsigned , 16-bit registers, the no load condition is triggered, the total active energy of that phase is not \naccumulated and no CF pulses are generated based on the total active energy.  \n Fundamental active and react ive powers no load uses the fundamental active and reactive energies to trigger the no load \ncondition. If neither  the fundamental  active energy nor the fundamental reactive  energy are accumulated for a time \nindicated in the respective APNOLOAD and VA RNOLOA D unsigned 16 -bit registers, the no load condition is triggered, the \nfundamental active and reactive energies of that phase are not accumulated, and no CF pulses are generated based on the fundamental active and reactive energies.  \nIssue  When the total act ive energy on P hase x (x = A, B, or C) is lower than APNOLOAD and the apparent energy is above \nVANOLOAD, the no load condition is not  triggered. It was observed that although CF pu lses continue to be generated, the \nBit 0 (NLOAD) and Bits[2:0]  (NLPHASE) in STATUS1 and PHNOLOAD registers continue to be cleared to 0 indicating an out \nof no load condition, the xWATTHR register stops accumulating energy.  \n It was observed that the fundamental active energy no load functions independently of the fundamental react ive energy \nno load. If, for example, the fundamental active energy is below APNOLOAD and the fundamental reactive energy is \nabove VARNOLOAD, both energies continue to accumulate because the phase is out of no load condition. Instead, the CF \npulses, based o n the phase fundamental active energy, are not generated and the FWATTHR registers are blocked, while \nthe CF pulses, based on the fundamental reactive energy, are generated. Thus, the FVARHR registers continue to accumulate and the Bit 1 (FNLOAD) in the ST ATUS1 register and Bits[5:3] (FNLPHASE) in the PHNOLOAD register are \ncleared to 0.  \nIRQ \nWorkaround  The workaround suggested here uses  the VAN OLOAD register only to determine the no -load condition.  \n1. Clear VARNOLOAD and APNOLOAD to 0.  \n2. Set V ANOLOAD at desired value.  \n3. When the apparent energy on any one of the phases becomes less than VANOLOAD, or when it has just become larger than VANOLOAD, Bit 2 (VANLOAD) in the STATUS1 register is set to 1. The corresponding interrupt can be \nobserved via th e \nIRQ pin if the Bit 2 in MASK1 register is set to 1. The IRQ pin goes low whenever any of the phases \nenters or leaves the no -load condition.  \n4. To find the phase that triggered the interrupt, read the PHNOLOAD register imm ediately. One of the bits \nVANLPHASE [2:0] changes state, indicating that the particular phase has either entered or left no -load condition.  \n5. If the particular phase has entered no -load condition, remove the contribution of the energies of that phase  to the \nCFx output by clearing the appropriate TERMSEL_x bits of the COMPMODE register. If that particular phase has left \nno-load condition, include the contribution of the energies of that phase to the CFx output by setting the \nappropriate TERMSEL_x bits of the C OMPMODE register.  \n6. Write 1 to the VANLOAD bit of the STATUS1 register, to clear the status bit and to bring the IRQ pin high.  \n7. If the phase comes out of no-load condition, read with reset all the energy registers to flush out the unnecessa ry \nvalues in the signal path before taking further energy measurements. This can be done by reading the energy \nregisters while the RSTREAD bit (Bit 6) is set to 1 in the LCYCMODE register.  \n8. Whenever the IRQ pin goes low again, perform the actions starting from Step 3 to service the interrupt.  \nRelated  Issues  None. \nSECTION 1. ADE7880 FUNCTIONALITY ISSUES  \nReference Number  Description  Status  \ner001  The LAST_ADDR  and LAST_RWDATA_x r egisters  show  the wrong values  in burst SPI mode.  Identified  \ner002  To obtain the best accuracy performance, the internal setting must be changed.  Identified  \ner003  The high- pass filter cannot be disabled in the Phase C voltage data path . Identified  \ner004  The no load condition does not function as defined.  Identified  \nRev. C | Page 86 of 107 \nData Sheet  ADE7880  \n \nREGISTERS LIST  \nTable 30. Registers Located in DSP Data Memory RAM  \nAddress  Register \nName  R/W1  Bit Length  Bit Length During Communication\n2 Type 3 Default Value Descript ion \n0x4380  AIGAIN  R/W  24 32 ZPSE  S 0x000000  Phase A current gain adjust.  \n0x4381  AVGAIN  R/W  24 32 ZPSE  S 0x000000  Phase A voltage gain adjust.  \n0x4382  BIGAIN  R/W  24 32 ZPSE  S 0x000000  Phase B current gain adjust.  \n0x4383  BVGAIN  R/W  24 32 ZPSE  S 0x000000  Phase B voltage gain adjust.  \n0x4384  CIGAIN  R/W  24 32 ZPSE  S 0x000000  Phase C current gain adjust.  \n0x4385  CVGAIN  R/W  24 32 ZPSE  S 0x000000  Phase C voltage gain adjust.  \n0x4386  NIGAIN  R/W  24 32 ZPSE  S 0x000000  Neutral current gain adjust.   \n0x4387  Reserved  R/W  24 32 ZPSE  S 0x000000  Do not write t his location for proper operation.  \n0x4388  DICOEFF  R/W  24 32 ZPSE  S 0x0000000  Register used in the digital integrator algorithm.  \nIf the integrator is turned on, it must be set at \n0xFF8000.  In practice, it is transm itted as 0xFFF8000.  \n0x4389  APGAIN  R/W  24 32 ZPSE  S 0x000000  Phase A power gain adjust.  \n0x438A  AWATTOS  R/W  24 32 ZPSE  S 0x000000  Phase A total active power offset adjust.  \n0x438B  BPGAIN  R/W  24 32 ZPSE  S 0x000000  Phase B power gain adjust.  \n0x438C  BWATTOS  R/W  24 32 ZPSE  S 0x000000  Phase B total active power offset adjust.  \n0x438D  CPGAIN  R/W  24 32 ZPSE  S 0x000000  Phase C power gain adjust.  \n0x438E  CWATTOS  R/W  24 32 ZPSE  S 0x000000  Phase C total active power offset adjust.  \n0x438F  AIRMSOS R/W  24 32 ZPSE  S 0x000000  Phase A current rms offset.  \n0x4390  AVRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase A voltage rms offset.  \n0x4391  BIRMSOS R/W  24 32 ZPSE  S 0x000000  Phase B current rms offset.  \n0x4392  BVRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase B voltage rms offset.  \n0x4393  CIRM SOS R/W  24 32 ZPSE  S 0x000000  Phase C current rms offset.  \n0x4394  CVRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase C voltage rms offset.  \n0x4395  NIRMSOS  R/W  24 32 ZPSE  S 0x000000  Neutral current rms offset .  \n0x4396-0x4397  Reserved  N/A  N/A  N/A  N/A  0x000000  Do not w rite t hese memory locations for proper \noperation.  \n0x4398  HPGAIN  R/W  24 32 ZPSE  S 0x000000  Harmonic powers gain adjust.  \n0x4399  ISUMLVL  R/W  24 32 ZPSE  S 0x000000  Threshold used in comparison between the sum \nof phase currents and the neutral current.  \n0x439A -\n0x439E  Reserved  N/A  N/A  N/A  N/A  0x000000  Do not write t hese memory locations for proper \noperation.  \n0x439F  VLEVEL  R/W  28 32 ZP  S 0x000000 0 Register used in the algorithm that computes the \nfundamental active and reactive powers . Set this \nregister accordi ng to Equation 22 for proper \nfunctioning of fundamental powers and harmonic \ncomputations.  \n0x43A0 -\n0x43A1  Reserved  N/A  N/A  N/A  N/A  0x000000  Do not write t hese memory locations for proper \noperation.  \n0x43A2  AFWATTOS  R/W  24 32 ZPSE  S 0x000000  Phase A fundamental active power offset adjust.   \n0x43A3  BFWATTOS  R/W  24 32 ZPSE  S 0x000000  Phase B fundamental active power offset adjust.  \n0x43A4  CFWATTOS  R/W  24 32 ZPSE  S 0x000000  Phase C fundamental active power offset adjust.  \n0x43A5  AFVAROS  R/W  24 32 ZPSE  S 0x000000  Phase A fundamental reactive power offset adjust.  \n0x43A6  BFVAROS  R/W  24 32 ZPSE  S 0x000000  Phase B fundamental reactive power offset adjust.  \n0x43A7  CFVAROS  R/W  24 32 ZPSE  S 0x000000  Phase C fundamental reactive power offset adjust.  \n0x43A8  AFIRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase A fundamental current rms offset.  \n0x43A9  BFIRMSOS R/W  24 32 ZPSE  S 0x000000  Phase B fundamental current rms offset.  \n0x43AA  CFIRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase C fundamental current rms offset.  \n0x43AB  AFVRMSOS  R/W  24 32 Z PSE S 0x000000  Phase A fundamental voltage rms offset.  \n0x43AC  BFVRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase B fundamental voltage rms offset.  \n0x43AD  CFVRMSOS  R/W  24 32 ZPSE  S 0x000000  Phase C fundamental voltage rms offset.  \n0x43AE  HXWATTOS  R/W  24 32 ZPSE  S 0x000000  Active pow er offset adjust on harmonic X  \n(see Harmonics Calculations  section  for details).  \nRev. C | Page 87 of 107 \nADE7880  Data Sheet  \n \nAddress  Register \nName  R/W1  Bit Length  Bit Length During Communication\n2 Type 3 Default Value Descript ion \n0x43AF  HYWATTOS  R/W  24 32 ZPSE  S 0x000000  Active power offset adjust on harmonic Y  \n(see Harmonics Calculations  section for details).  \n0x43B0  HZWATTOS  R/W  24 32 ZPSE  S 0x000000  Active power offset adjust on harmonic Z  \n(see Harmonics Calculations  section for details).  \n0x43B1  HXVAROS  R/W  24 32 ZPSE  S 0x000000  Active power offset adjust on harmonic X  \n(see Harmonics Calculations  section for details).  \n0x43B2  HYVAROS  R/W  24 32 ZPSE  S 0x000000  Active power offset adjust on harmonic Y  \n(see Harmonics Calculations  section for details).  \n0x43B3  HZVAROS  R/W  24 32 ZPSE  S 0x000000  Active power offset adjust on harmonic Z  \n(see Harmonics Calculations  section fo r details).  \n0x43B4  HXIRMSOS  R/W  24 32 ZPSE  S 0x000000  Current rms offset on harmonic X   \n(see Harmonics Calculations  section for details).  \n0x43B5  HYIRMSOS R/W  24 32 ZPSE  S 0x000000  Current rms offset on harmonic  Y  \n(see Harmonics Calculations  section for details).  \n0x43B6  HZIRMSOS  R/W  24 32 ZPSE  S 0x000000  Current rms offset on harmonic Z   \n(see Harmonics Calculations  section f or details).  \n0x43B7  HXVRMSOS  R/W  24 32 ZPSE  S 0x000000  Voltage rms offset on harmonic X   \n(see Harmonics Calculations  section for details).  \n0x43B8  HYVRMSOS  R/W  24 32 ZPSE  S 0x000000  Voltage rms offset on harmoni c Y  \n(see Harmonics Calculations  section for details).  \n0x43B9  HZVRMSOS  R/W  24 32 ZPSE  S 0x000000  Voltage rms offset on harmonic Z   \n(see Harmonics Calculations  section for details).  \n0x43BA to \n0x43BF  Reserved  N/A  N/A  N/A  N/A  0x000000  Do not write these memory location s for proper \noperation.  \n0x43C0  AIRMS  R 24 32 ZP  S N/A  Phase A current rms value.  \n0x43C1  AVRMS  R 24 32 ZP  S N/A  Phase A voltage rms value.  \n0x43C2  BIRMS  R 24 32 ZP  S N/A  Phase B current rms value.  \n0x43C3  BVRMS  R 24 32 ZP  S N/A  Phase B voltage rms value.  \n0x43C4  CIRMS  R 24 32 ZP  S N/A  Phase C current rms value.  \n0x43C5  CVRMS  R 24 32 ZP  S N/A  Phase C voltage rms value.  \n0x43C6  NIRMS  R 24 32 ZP  S N/A  Neutral c urrent rms value.  \n0x43C7  ISUM  R 28 32 ZP  S N/A  Sum of IAWV, IBWV and ICWV registers.  \n0x43C8 \nto \n0x43FF  Reserved  N/A  N/A  N/A  N/A  N/A  Do not write t hese memory locations for proper \noperation.  \n1 R is read, and W is write.  \n2 32 ZPSE = 24- bit signed register that is transmitted as a 32 -bit word with four MSBs padded with 0s and sign extended to 28 bits. Whereas 32 ZP = 28 - bit or 24 -bit \nsigned or unsigned register that i s transmitted as a 32 -bit word with four or eight MSBs, respectively, padded with 0s.  \n3 U is unsigned register, and S is signed register in twos complement format.  \nTable 31. Internal DSP Memory RAM Regis ters \nAddress  Register \nName  R/W1 Bit \nLength  Bit Length  \nDuring \nComm unication  Type2  Default \nValue  Description  \n0xE203  Reserved  R/W  16 16 U 0x0000  Do not write t his memory location for proper \noperation.  \n0xE228  Run  R/W  16 16 U 0x0000  Run register starts and stops the DSP . See the \nDigital Signal Processor  section for more details.  \n1 R is read, and W is write.  \n2 U is unsigned register, and S is signed register in twos comp lement format.  \nRev. C | Page 88 of 107  \n \nData Sheet ADE7880\n \nRev. C | Page 89 of 107 Table 32. Billable Registers \nAddress Register \nName R/W1, 2 Bit Length\n2 Bit Length \nDuring \nCommunication2 Type2, 3 Default Value Description \n0xE400 AWATTHR R 32 32 S 0x00000000 Phase A total active energy accumulation. \n0xE401 BWATTHR R 32 32 S 0x00000000 Phase B total active energy accumulation. \n0xE402 CWATTHR R 32 32 S 0x00000000 Phase C total active energy accumulation. \n0xE403  AFWATTHR R 32 32 S 0x00000000 Phase A fundamental active energy \naccumulation. \n0xE404 BFWATTHR R 32 32 S 0x00000000 Phase B fundamental active energy \naccumulation. \n0xE405 CFWATTHR R 32 32 S 0x00000000 Phase C fundamental active energy accumulation. \n0xE406 \nto \n0xE408 Reserved R 32 32 S 0x00000000  \n0xE409  AFVARHR  R 32 32 S 0x00000000 Phase A fundamental reactive energy accumulation. \n0xE40A BFVARHR R 32 32 S 0x00000000 Phase B fundamental reactive energy \naccumulation. \n0xE40B CFVARHR R 32 32 S 0x00000000 Phase C fundamental reactive energy \naccumulation. \n0xE40C AVAHR R 32 32 S 0x00000000 Phase A apparent energy accumulation. \n0xE40D BVAHR R 32 32 S 0x00000000 Phase B apparent energy accumulation. \n0xE40E CVAHR R 32 32 S 0x00000000 Phase C apparent energy accumulation. \n \n1 R is read, and W is write. \n2 N/A is not applicable. \n3 U is unsigned register, and S is signed register in twos complement format. \nTable 33. Configuration and Power Quality Registers \nAddress Register Name R/W1 Bit \nLength Bit Length  \nDuring \nCommunication2 Type3 Default  Value\n4 Description \n0xE500 IPEAK R 32 32 U N/A Current peak register. See Figure 60 and \nTable 34 for details about its composition. \n0xE501 VPEAK R 32 32 U N/A Voltage peak register. See Figure 60 and \nTable 35 for details about its composition. \n0xE502 STATUS0 R/W 32 32 U N/A Interrupt Status Register 0. See Table 36. \n0xE503 STATUS1 R/W 32 32 U N/A Interrupt Status Register 1. See Table 37. \n0xE504  AIMAV  R 20 32 ZP U N/A Phase A current mean absolute value computed during PSM0 and PSM1 modes. \n0xE505 BIMAV R 20 32 ZP U N/A Phase B current mean absolute value computed during PSM0 and PSM1 modes. \n0xE506 CIMAV R 20 32 ZP U N/A Phase C current mean absolute value computed during PSM0 and PSM1 modes. \n0xE507 OILVL R/W 24 32 ZP U 0xFFFFFF Overcurrent threshold. \n0xE508 OVLVL R/W 24 32 ZP U 0xFFFFFF Overvoltage threshold. \n0xE509 SAGLVL R/W 24 32 ZP U 0x000000 Voltage SAG level threshold. \n0xE50A MASK0 R/W 32 32 U 0x00000000 Interrupt Enable Register 0. See Table 38. \n0xE50B MASK1 R/W 32 32 U 0x00000000 Interrupt Enable Register 1. See Table 39. \n0xE50C IAWV R 24 32 SE S N/A Instantaneous value of Phase A current. \n0xE50D IBWV R 24 32 SE S N/A Instantaneous value of Phase B current. \n0xE50E ICWV R 24 32 SE S N/A Instantaneous value of Phase C current. \n0xE50F INWV R 24 32 SE S N/A Instantaneous value of neutral current. \n0xE510 VAWV R 24 32 SE S N/A Instantaneous value of Phase A voltage. \n0xE511 VBWV R 24 32 SE S N/A Instantaneous value of Phase B voltage. \n0xE512 VCWV R 24 32 SE S N/A Instantaneous value of Phase C voltage. \nADE7880 Data Sheet\n \nRev. C | Page 90 of 107 Address Register Name R/W1 Bit \nLength Bit Length  \nDuring \nCommunication2 Type3 Default  \nValue4 Description \n0xE513 AWATT R 24 32 SE S N/A Instantaneous value of Phase A total \nactive power. \n0xE514 BWATT R 24 32 SE S N/A Instantaneous value of Phase B total active power. \n0xE515 CWATT R 24 32 SE S N/A Instantaneous value of Phase C total \nactive power. \n0xE516 to \n0xE518  Reserved R 24 32 SE S 0x000000  \n0xE519 AVA R 24 32 SE S N/A Instantaneous value of Phase A \napparent power. \n0xE51A BVA R 24 32 SE S N/A Instantaneous value of Phase B \napparent power. \n0xE51B CVA R 24 32 SE S N/A Instantaneous value of Phase C apparent power. \n0xE51F CHECKSUM R 32 32 U 0xAFFA63B9 Checksum verification. See the \nChecksum Register section for details. \n0xE520 VNOM R/W 24 32 ZP S 0x000000 Nominal phase voltage rms used in the \nalternative computation of the apparent \npower. When the VNOMxEN bit is set, the applied voltage input in the correspond-\ning phase is ignored and all corresponding \nrms voltage instances are replaced by the value in the VNOM register. \n0xE521 to \n0xE5FE Reserved      Do not write these addresses for proper operation. \n0xE5FF LAST_RWDATA32 R 32 32 U N/A Contains the data from the last successful 32-bit register communication. \n0xE600 PHSTATUS R 16 16 U N/A Phase peak register. See Table 40. \n0xE601 ANGLE0 R 16 16 U N/A Time Delay 0. See the Time Interval Between Phases section for details. \n0xE602 ANGLE1 R 16 16 U N/A Time Delay 1. See the Time Interval Between Phases section for details. \n0xE603 ANGLE2 R 16 16 U N/A Time Delay 2. See the Time Interval \nBetween Phases section for details. \n0xE604 to \n0xE607 Reserved      Do not write these addresses for proper operation. \n0xE608 PHNOLOAD R 16 16 U N/A Phase no load register. See Table 41. \n0xE609 to 0xE60B Reserved      Do not write these addresses for proper operation. \n0xE60C LINECYC R/W 16 16 U 0xFFFF Line cycle accumulation mode count. \n0xE60D ZXTOUT R/W 16 16 U 0xFFFF Zero-crossing timeout count. \n0xE60E COMPMODE R/W 16 16 U 0x01FF Computation-mode register. See Table 42. \n0xE60F Gain R/W 16 16 U 0x0000 PGA gains at ADC inputs. See Table 43. \n0xE610 CFMODE R/W 16 16 U 0x0EA0 CFx configuration register. See Table 44. \n0xE611 CF1DEN R/W 16 16 U 0x0000 CF1 denominator. \n0xE612 CF2DEN R/W 16 16 U 0x0000 CF2 denominator. \n0xE613 CF3DEN R/W 16 16 U 0x0000 CF3 denominator. \n0xE614 APHCAL R/W 10 16 ZP S 0x0000 Phase calibration of Phase A. See Table 45. \n0xE615 BPHCAL R/W 10 16 ZP S 0x0000 Phase calibration of Phase B. See Table 45. \n0xE616 CPHCAL R/W 10 16 ZP S 0x0000 Phase calibration Phase of C. See Table 45. \n0xE617 PHSIGN R 16 16 U N/A Power sign register. See Table 46. \n0xE618 CONFIG R/W 16 16 U 0x0002 ADE7880 configuration register.  See Table 47. \n0xE700 MMODE R/W 8 8 U 0x1C Measurement mode register. See Table 48. \nData Sheet ADE7880\n \nRev. C | Page 91 of 107 Address Register Name R/W1 Bit \nLength Bit Length  \nDuring \nCommunication2 Type3 Default  \nValue4 Description \n0xE701 ACCMODE R/W 8 8 U 0x80 Accumulation mode register.  \nSee Table 49. \n0xE702 LCYCMODE R/W 8 8 U 0x78 Line accumulation mode behavior.  See Table 51.  \n0xE703 PEAKCYC R/W 8 8 U 0x00 Peak detection half line cycles. \n0xE704 SAGCYC R/W 8 8 U 0x00 SAG detection half line cycles. \n0xE705 CFCYC R/W 8 8 U 0x01 Number of CF pulses between two consecutive energy latches. See the \nSynchronizing Energy Registers with CFx Outputs section. \n0xE706 HSDC_CFG R/W 8 8 U 0x00 HSDC configuration register. See Table 52. \n0xE707 Version R 8 8 U  Version of die. \n0xE7E4 Reserved R 8 8 U 0x08 This register must remain at this value \nfor checksum functionality to work. If \nthis register shows a different value while being read, reset the chip before \nworking with the checksum feature. \n0xE7FD LAST_RWDATA8 R 8 8 U N/A Contains the data from the last successful 8-bit register communication. \n0xE880 FVRMS R 24 32 S N/A The rms value of the fundamental \ncomponent of the phase voltage. \n0xE881 FIRMS R 24 32 S N/A The rms value of the fundamental \ncomponent of the phase current \n0xE882 FWATT R 24 32 S N/A The active power of the fundamental component. \n0xE883 FVAR R 24 32 S N/A The reactive power of the fundamental component. \n0xE884 FVA R 24 32 S N/A The apparent power of the fundamental component. \n0xE885 FPF R 24 32 S N/A The power factor of the fundamental \ncomponent. \n0xE886 VTHD R 24 32 S N/A Total harmonic distortion of the phase \nvoltage. \n0xE887 ITHD R 24 32 S N/A Total harmonic distortion of the phase current. \n0xE888 HXVRMS R 24 32 S N/A The rms value of the phase voltage \nharmonic X. \n0xE889 HXIRMS R 24 32 S N/A The rms value of the phase current \nharmonic X. \n0xE88A HXWATT R 24 32 S N/A The active power of the harmonic X. \n0xE88B HXVAR R 24 32 S N/A The reactive power of the harmonic X. \n0xE88C HXVA R 24 32 S N/A The apparent power of the harmonic X. \n0xE88D HXPF R 24 32 S N/A The power factor of the harmonic X. \n0xE88E HXVHD R 24 32 S N/A Harmonic distortion of the phase voltage harmonic X relative to the fundamental. \n0xE88F HXIHD R 24 32 S N/A Harmonic distortion of the phase current harmonic X relative to the fundamental. \n0xE890 HYVRMS R 24 32 S N/A The rms value of the phase voltage harmonic Y. \n0xE891 HYIRMS R 24 32 S N/A The rms value of the phase current \nharmonic Y. \n0xE892 HYWATT R 24 32 S N/A The active power of the harmonic Y. \n0xE893 HYVAR R 24 32 S N/A The reactive power of the harmonic Y. \n0xE894 HYVA R 24 32 S N/A The apparent power of the harmonic Y. \n0xE895 HYPF R 24 32 S N/A The power factor of the harmonic Y. \nADE7880 Data Sheet\n \nRev. C | Page 92 of 107 Address Register Name R/W1 Bit \nLength Bit Length  \nDuring \nCommunication2 Type3 Default  \nValue4 Description \n0xE896 HYVHD R 24 32 S N/A Harmonic distortion of the phase voltage \nharmonic Y relative to the fundamental. \n0xE897 HYIHD R 24 32 S N/A Harmonic distortion of the phase current harmonic Y relative to the fundamental. \n0xE898 HZVRMS R 24 32 S N/A The rms value of the phase voltage \nharmonic Z. \n0xE899 HZIRMS R 24 32 S N/A The rms value of the phase current \nharmonic Z. \n0xE89A HZWATT R 24 32 S N/A The active power of the harmonic Z. \n0xE89B HZVAR R 24 32 S N/A The reactive power of the harmonic Z. \n0xE89C HZVA R 24 32 S N/A The apparent power of the harmonic Z. \n0xE89D HZPF R 24 32 S N/A The power factor of the harmonic Z. \n0xE89E HZVHD R 24 32 S N/A Harmonic distortion of the phase voltage \nharmonic Z relative to the fundamental. \n0xE89F HZIHD R 24 32 S N/A Harmonic distortion of the phase current \nharmonic Z relative to the fundamental. \n0xE8A0 to 0xE8FF Reserved  24 32   Reserved. These registers are always 0. \n0xE900 HCONFIG R/W 16 16 U 0x08 Harmonic Calculations Configuration \nregister. See Table 54. \n0xE902 APF R 16 16 S N/A Phase A power factor. \n0xE903 BPF R 16 16 S N/A Phase B power factor. \n0xE904 CPF R 16 16 S N/A Phase C power factor. \n0xE905 APERIOD R 16 16 U N/A Line period on Phase A voltage. \n0xE906 BPERIOD R 16 16 U N/A Line period on Phase B voltage. \n0xE907 CPERIOD R 16 16 U N/A Line period on Phase C voltage. \n0xE908 APNOLOAD R/W 16 16 U 0x0000 No load threshold in the total/ \nfundamental active power data paths. \nDo not write 0xFFFF to this register. \n0xE909 VARNOLOAD R/W 16 16 U 0x0000 No load threshold in the total/ \nfundamental reactive power data path. \nDo not write 0xFFFF to this register. \n0xE90A VANOLOAD R/W 16 16 U 0x0000 No load threshold in the apparent power data path. Do not write 0xFFFF to \nthis register. \n0xE9FE LAST_ADD R 16 16 U N/A The address of the register successfully accessed during the last read/write \noperation. \n0xE9FF LAST_RWDATA16 R 16 16 U N/A Contains the data from the last successful \n16-bit register communication. \n0xEA00 CONFIG3 R/W 8 8 U 0x01 Configuration register. See Table 53. \n0xEA01 LAST_OP R 8 8 U N/A Indicates the type, read or write, of the last successful read/write operation. \n0xEA02 WTHR R/W 8 8 U 0x03 Threshold used in phase total/ \nfundamental active power data path. \n0xEA03 VARTHR R/W 8 8 U 0x03 Threshold used in phase total/ \nfundamental reactive power data path. \n0xEA04 VATHR R/W 8 8 U 0x03 Threshold used in phase apparent \npower data path. \n0xEA05 to \n0xEA07 Reserved  8 8   Reserved. These registers are always 0. \n0xEA08 HX R/W 8 8 U 3 Selects an index of the harmonic moni-tored by the harmonic computations. \n0xEA09 HY R/W 8 8 U 5 Selects an index of the harmonic moni-\ntored by the harmonic computations. \nData Sheet ADE7880\n \nRev. C | Page 93 of 107 Address Register Name R/W1 Bit \nLength Bit Length  \nDuring \nCommunication2 Type3 Default  \nValue4 Description \n0xEA0A HZ R/W 8 8 U 7 Selects an index of the harmonic moni-\ntored by the harmonic computations. \n0xEA0B to 0xEBFE Reserved  8 8   Reserved. These registers are always 0. \n0xEBFF Reserved  8 8   This address can be used in manipulating \nthe SS /HSA pin when SPI is chosen as \nthe active port. See the Serial Interfaces \nsection for details. \n0xEC00 LPOILVL R/W 8 8 U 0x07 Overcurrent threshold used during PSM2 mode. See Table 55 in which the \nregister is detailed. \n0xEC01 CONFIG2 R/W 8 8 U 0x00 Configuration register used during \nPSM1 mode. See Table 56. \n \n1 R is read, and W is write. \n2 32 ZP = 24- or 20-bit signed or unsigned register that is transmitted as a 32-bit word with 8 or 12 MSBs, respectively, padded  with 0s. 32 SE = 24-bit signed register that \nis transmitted as a 32-bit word sign extended to 32 bits. 16 ZP = 10-bit unsigned register that is transmitted as a 16-bit word  with six MSBs padded with 0s. \n3 U is unsigned register, and S is signed register in twos complement format. \n4 N/A is not applicable. \n \nTable 34. IPEAK Register (Address 0xE500) \nBit  Mnemonic Default Value Description \n23:0 IPEAKVAL[23:0] 0 These bits contain the peak value determined in the current channel. \n24 IPPHASE[0] 0 When this bit is set to 1, Ph ase A current generated IPEAKVAL[23:0] value. \n25 IPPHASE[1] 0 When this bit is set to 1, Ph ase B current generated IPEAKVAL[23:0] value. \n26 IPPHASE[2] 0 When this bit is set to 1, Ph ase C current generated IPEAKVAL[23:0] value. \n31:27  00000 These bits are always 0. \n \nTable 35. VPEAK Register (Address 0xE501) \nBit  Mnemonic Default Value Description \n23:0 VPEAKVAL[23:0] 0 These bits contain the peak  value determined in the voltage channel. \n24 VPPHASE[0] 0 When this bit is set to 1, Phase A voltage generated VPEAKVAL[23:0] value. \n25 VPPHASE[1] 0 When this bit is set to 1, Ph ase B voltage generated VPEAKVAL[23:0] value. \n26 VPPHASE[2] 0 When this bit is set to 1, Phase C voltage generated VPEAKVAL[23:0] value. \n31:27  00000 These bits are always 0. \n \nTable 36. STATUS0 Register (Address 0xE502) \nBit  Mnemonic Default Value Description  \n0 AEHF 0 When this bit is set to 1, it indicates that  Bit 30 of any one of the total active energy \nregisters (AWATTHR, BWATTHR, or CWATTHR) has changed.  \n1 FAEHF  0 When this bit is set to 1, it indicates that  Bit 30 of any one of the fundamental active \nenergy registers, FWATTHR, BFWATTHR, or CFWATTHR, has changed.  \n2 Reserved 0 This bit is always 0.  \n3 FREHF 0 When this bit is set to 1, it indicates that Bit 30 of any one of the fundamental \nreactive energy registers, AFVARHR, BFVARHR, or CFVARHR, has changed.  \n4 VAEHF 0 When this bit is set to 1, it indicates that Bit 30 of any one of the apparent energy registers (AVAHR, BVAHR, or CVAHR) has changed. \n5 LENERGY 0 When this bit is set to 1, in line energy accumulation mode, it indicates the end of an \nintegration over an integer number of half line cycles set in the LINECYC register.  \nADE7880 Data Sheet\n \nRev. C| Page 94 of 107 Bit  Mnemonic Default Value Description  \n6 REVAPA 0 When this bit is set to 1,  it indicates that the Phase A active power identified by Bit 6 \n(REVAPSEL) in the ACCMODE register (total  or fundamental) has changed sign. The \nsign itself is indicated in Bit 0 (AWSIG N) of the PHSIGN register (see Table 46). \n7 REVAPB 0 When this bit is set to 1, it indicates that the Phase B active power identified by Bit 6 \n(REVAPSEL) in the ACCMODE register (total  or fundamental) has changed sign. The \nsign itself is indicated in Bit 1 (BWSIG N) of the PHSIGN register (see Table 46). \n8 REVAPC 0 When this bit is set to 1,  it indicates that the Phase C active power identified by Bit 6 \n(REVAPSEL) in the ACCMODE register (total  or fundamental) has changed sign. The \nsign itself is indicated in Bit 2 (CWSIGN)  of the PHSIGN register (see Table 46).  \n9 REVPSUM1 0 When this bit is set to 1, it indicates that  the sum of all phase powers in the CF1 data \npath has changed sign. The sign itself is indicated in Bit 3 (SUM1SIGN) of the PHSIGN \nregister (see Table 46). \n10 REVFRPA 0 When this bit is set to 1, it indicates that the Phase A fundamental reactive power \nhas changed sign. The sign itself is indicated in Bit 4 (AFVARSIGN) of the PHSIGN \nregister (see Table 46).  \n11 REVFRPB 0 When this bit is set to 1, it indicates that the Phase B fundamental reactive power \nhas changed sign. The sign itself is indicated in Bit 5 (BFVARSIGN) of the PHSIGN \nregister (see Table 46).  \n12 REVFRPC 0 When this bit is set to 1, it indicates that the Phase C fundamental reactive power \nhas changed sign. The sign itself is indicated in Bit 6 (CFVARSIGN) of the PHSIGN register (see Table 46). \n13 REVPSUM2 0 When this bit is set to 1, it indicates that  the sum of all phase powers in the CF2 data \npath has changed sign. The sign itself is indicated in Bit 7 (SUM2SIGN) of the PHSIGN \nregister (see Table 46). \n14 CF1  When this bit is set to 1, it indicates a high-to-low transition has occurred at CF1 pin; \nthat is, an active low pulse has been generated. The bit is set even if the CF1 output \nis disabled by setting Bit 9 (CF1DIS) to 1 in the CFMODE register. The type of power \nused at the CF1 pin is determined by Bits [2:0] (CF1SEL[2:0]) in the CFMODE register \n(see Table 44). \n15 CF2  When this bit is set to 1, it indicates a hi gh-to-low transition has occurred at the CF2 \npin; that is, an active low pulse has been generated. The bit is set even if the CF2 \noutput is disabled by setting Bit 10 (CF2DIS) to 1 in the CFMODE register. The type of \npower used at the CF2 pin is determined by Bits[5:3] (CF2SEL[2:0]) in the CFMODE register (see Table 44). \n16 CF3  When this bit is set to 1, it indicates a high-to-low transition has occurred at CF3 pin; \nthat is, an active low pulse has been generated. The bit is set even if the CF3 output \nis disabled by setting Bit 11 (CF3DIS) to 1 in the CFMODE register. The type of power \nused at the CF3 pin is determined by Bits[8:6] (CF3SEL[2:0]) in the CFMODE register (see \nTable 44). \n17 DREADY 0 When this bit is set to 1, it indicate s that all periodical (at 8 kHz rate) DSP \ncomputations have finished. \n18 REVPSUM3 0 When this bit is set to 1, it indicates that  the sum of all phase powers in the CF3 data \npath has changed sign. The sign itself is indicated in Bit 8 (SUM3SIGN) of the PHSIGN \nregister (see Table 46). \n19 HREADY 0 When this bit is set to 1, it indicates the harmonic block output registers are updated. \nIf Bit 0 (HRCFG) in the HCONFIG register is cleared to 0, this flag is set to 1 every time \nthe harmonic block output registers are updated at a rate identified by Bits [7:5] (HRATE) in the HCONFIG register starting HSTIME (Bits [4:3] in the HCONFIG register) after the \nharmonic block setup. If Bit HRCFG is set to 1, the HREADY flag is set to 1 every time \nthe harmonic block output registers are updated at a rate identified by Bits [7:5] (HRATE) \nin the HCONFIG register, starting immediately after the harmonic block setup. \n31:18 Reserved 0 0000 0000 0000 Reserved. These bits are always 0. \n \nData Sheet  ADE7880 \n \nTable 37. STATUS1 Register (Address 0xE503)  \nBit Mnemonic  Default  Value  Description  \n0 NLOAD  0 When this bit is set to 1, it indicates that at least one phase entered no load co ndition  \ndetermined by the  total active power  and apparent power . The phase is indicated in \nBits[2:0] (NLPHASE [x]) in the PHNOLOAD register (see  Table 41.)  \n1 FNLOAD  0 When this bit is set to 1, it indicates that at least one phase entered no load condition \nbased on fundamental active and reactive powers. The phase is indicated in B its[5:3] \n(FNLPHASE[x]) in the PHNOLOAD register (see Table 41).  \n2 VANLOAD 0 When this bit is set to 1, it indicates that at least one phase entered no load \ncondition based on apparent power. The phase is indicated in Bits[8:6] \n(VANLPHASE[x]) in the PHNOLOAD register (see  Table 41).  \n3 ZXTOVA  0 When this bit is set to 1, it indicates a zero crossing on  Phase A voltage is missing.  \n4 ZXTOVB  0 When this bit is set to 1, it indicates a zero crossing on Phase B voltage is missing.  \n5 ZXTOVC  0 When this bit is set to 1, it indicates a zero crossing on Phase C voltage is missing.  \n6 ZXTOIA  0 When this bit is set to 1, it indicates a zero crossing on Phase A current is missing.  \n7 ZXTOIB  0 When this bit is set to 1, it indicates a zero crossing on Phase B current is missing.  \n8 ZXTOIC  0 When this bit is set to 1, it indicates a zero crossing on Phase C current is missing. \n9 ZXVA  0 When this bit is set to 1, it indicates a zero crossing has been detected on Phase A \nvoltage.  \n10 ZXVB  0 When this bit is set to 1, it indicates a zero crossing has been detected on Phase B voltage.  \n11 ZXVC  0 When this bit is set to 1, it indicates a zero crossing has been detected on Phase C voltage.  \n12 ZXIA  0 When this bit is set to 1, it indicates a zero crossing has been detected on Phase A current.  \n13 ZXIB  0 When this bit is set to 1, it indicates a zero crossing has been detec ted on Phase B \ncurrent.  \n14 ZXIC  0 When this bit is set to 1, it indicates a zero crossing has been detected on Phase C current.  \n15 RSTDONE  1 In case of a software reset command, Bit 7 (SWRST) is set to 1 in the CONFIG  register, \nor a transition from PSM1,  PSM2, or PSM3 to PSM0, or a hardware reset, this bit is set \nto 1 at the end of the transition process and after all registers change value to \ndefault. The  IRQ1  pin goes low to signal this moment because this interrupt cannot \nbe disabled.   \n16 SAG  0 When this bit is set to 1, it indicates one of phase voltages entered or exited a sag \nstate. The phase is  indicated by Bits[14:12] (VSPHASE [x]) in the PHSTATUS register \n(see Table 40). \n17 OI 0 When this bit is set to 1, it indicates an overcurrent event has occurred on one of the \nphases indicated by Bits[5:3] (OIPHASE [x]) in the PHSTATUS register (see Table 40). \n18 OV 0 When this bit is set to 1, it indicates an overvoltage event has occu rred on one of the \nphases indicated by Bits[11:9] (OVPHASE[x]) in the PHSTATUS register (see Table 40). \n19 SEQERR  0 When this bit is set to 1, it indicates a negative -to-positive zero crossing on Phase A \nvoltage was not followe d by a negative -to-positive zero crossing on Phase B voltage  \nbut by a negative -to-positive zero crossing on Phase C voltage.  \n20 MISMTCH  0 When this bit is set to 1, it indicates ISUMLVL INWV ISUM > − , where \nISUMLVL  is indicated in the ISUMLVL register.   \n21 Reserved  1 Reserved. This bit is always set to 1. \n22 Reserved  0 Reserved. This bit is always set to 0. \n23 PKI 0 When this bit is set to 1, it indicates that the period used to detect the peak value in \nthe current channel has ended. The IPEAK register  contains the peak value and the \nphase where the peak has been detected (see Table 34). \nRev. C| Page 95 of 107 \nADE7880 Data Sheet  \n \nBit Mnemonic  Default  Value  Description  \n24 PKV  0 When this bit is set to 1, it indicates that the period used to detect the peak value in \nthe voltage channel has ended. VPEAK register contains the peak value and the \nphase where the peak has been detected (see Table 35). \n25 CRC  0 When this bit is set to 1, it indicates the ADE7880 has computed a different \nchecksum  relative to the one computed when the Run register was set to 1.  \n31:26 Reserved  000 0000  Reserved. These bits are always 0. \nTable 38. MASK0 Register (Address 0xE50A)  \nBit  Mnemonic  Default  Value  Description  \n0 AEHF  0 When this bit is set to 1, it enables an interrupt when Bit 30 of any one of the total \nactive energy registers (AWATTHR, BWATTHR, or CWATTHR) changes.  \n1 FAEHF  0 When this bit is set to 1, it enables an interrupt when Bit 30 of any one of the funda -\nmental active energy registers (AFWATTHR, BFWATTHR, or CFWATTHR) changes.   \n2 Reserved  0 This bit does not manage any functionality.  \n3 FREHF  0 When this bit is set to 1, it enables an interrupt when Bit 30 of any one of the fundamental reactive energy registers (AFVARHR, BFVARHR, or CFVARHR) changes.\n  \n4 VAEHF  0 When this bit is set to 1, it enables an interrupt when Bit 30 of any one of the apparent energy registers (AVAHR, BVAHR, or CVAHR) changes.  \n5 LENERGY  0 When this bit is set to 1, in line energy accumulation mode, it enables an interrupt at \nthe end of an integration over an integer number of half line cycles set in the \nLINECYC register.  \n6 REVAPA  0 When this bit is set to 1, it enables an interrupt when the Phase A active power \nidentified by Bit 6 (REVAPSEL) in the ACCMODE register (total or fundamental) \nchanges sign.  \n7 REVAPB  0 When this bit is set to 1, it enables an interrupt when the Phase B active power \nidentified by Bit 6 (REVAPSEL) in the ACCMODE register (total or fundamental) changes s ign. \n8 REVAPC  0 When this bit is set to 1, it enables an interrupt when the Phase C active power \nidentified by Bit 6 (REVAPSEL) in the ACCMODE register (total or fundamental) \nchanges sign.  \n9 REVPSUM1  0 When this bit is set to 1, it enables an interrupt when the sum of all phase powers in \nthe CF1 data  path changes sign.  \n10 REV FRPA 0 When this bit is set to 1, it enables an interrupt when the Phase A fundamental \nreactive power changes sign.   \n11 REV FRPB  0 When this bit is set to 1, it enables an interrupt  when the Phase B fundamental \nreactive power changes sign.   \n12 REV FRPC  0 When this bit is set to 1, it enables an interrupt when the Phase C fundamental reactive power changes sign.\n  \n13 REVPSUM2  0 When this bit is set to 1, it enables an interrupt when t he sum of all phase powers in \nthe CF2 data  path changes sign.  \n14 CF1  When this bit is set to 1, it enables an interrupt when a high-to -low transition occurs \nat the CF1 pin, that is an active low pulse is generated. The interrupt can be enabled \neven if the CF1 output is disabled by setting Bit 9 (CF1DIS) to 1 in the CFMODE \nregister. The type of power used at the CF1 pin is determined by Bits[2:0] \n(CF1SEL [2:0] ) in the CFMODE register (see Table 44). \n15 CF2  When this bit is set  to 1, it enables an interrupt when a high -to-low transition occurs \nat CF2 pin, that is an active low pulse is generated. The interrupt may be enabled \neven if the CF2 output is disabled by setting Bit 10 (CF2DIS) to 1 in the CFMODE \nregister. The type of po wer used at the CF2 pin is determined by Bits[5:3] (CF2SEL [2:0] ) \nin the CFMODE register (see Table 44). \n16 CF3  When this bit is set to 1, it enables an interrupt when a high to low transition occurs \nat CF3 pin, that is an active low pulse is generated. The interrupt may be enabled \neven if the CF3 output is disabled by setting Bit 11 (CF3DIS) to 1 in the CFMODE register. The type of power u sed at the CF3 pin is determined by Bits[8:6] (CF3SEL [2:0] ) \nin the CFMODE register (see Table 44). \n17 DREADY  0 When this bit is set to 1, it enables an interrupt when all periodical (at 8 kHz rate) DSP computations finish.  \nRev. C| Page 96 of 107 \nData Sheet  ADE7880  \n \nBit  Mnemonic  Default  Value  Description  \n18 REVPSUM3  0 When this bit is set to 1, it enables an interrupt when the sum of all phase po wers in \nthe CF3 data  path changes sign.  \n19 HREADY  0 When this bit is set to 1, it enables an interrupt when the harmonic block output \nregisters have been updated. If B it 0 (HRCFG) in H CONFIG register is cleared to 0, the \ninterrupt is triggered every time the harmonic block output registers are updated at \na rate identified by B its [7:5] (HRATE) in HCONFIG register starting HSTIME (Bits [ 4:3] \nin HCONFIG register) after the harmonic block setup. If Bit HRCFG is set to 1, the interrupt  \nis triggered every time the harmonic block output registers are updated at a rate \nidentified by B its [7:5] (HRATE) in HCONFIG register starting immediately after the \nharmonic block setup.  \n31:19  Reserved  00 0000 0000 \n0000  Reserved. These bits do not manage any functionality.  \nTable 39. MASK1 Register (Address 0xE50B)  \nBit  Mnemonic  Default  Value  Description  \n0 NLOAD  0 When t his bit is set to 1, it enables an interrupt when at least one phase enters no \nload condition determined by the total active power  and VNOM based apparent \npower .  \n1 FNLOAD  0 When this bit is set to 1, it enables an interrupt when at least one phase enters no \nload condition based on fundamental active and reactive powers.   \n2 VANLOAD 0 When this bit is set to 1, it enables an interrupt wh en at least one phase enters no \nload condition based on apparent power.  \n3 ZXTOVA  0 When this bit is set to 1, it enables an interrupt when a zero crossing on Phase A \nvoltage is missing.  \n4 ZXTOVB  0 When this bit is set to 1, it enables an interrupt when a zero crossing on Phase B \nvoltage is missing.  \n5 ZXTOVC  0 When this bit is set to 1, it enables an interrupt when a zero crossing on Phase C voltage is missing.  \n6 ZXTOIA  0 When this bit is set to 1, it enables an interrupt when a zero crossing on Phase A  \ncurrent is missing. \n7 ZXTOIB  0 When this bit is set to 1, it enables an interrupt when a zero crossing on Phase B \ncurrent is missing. \n8 ZXTOIC  0 When this bit is set to 1, it enables an interrupt when a zero crossing on Phase C current is missing. \n9 ZXVA 0 When this bit is set to 1, it enables an interrupt when a zero crossing is detected on Phase A voltage.  \n10 ZXVB  0 When this bit is set to 1, it enables an interrupt when a zero crossing is detected on Phase B voltage.  \n11 ZXVC  0 When this bit is set to 1, it enables an interrupt when a zero crossing is detected on \nPhase C voltage.  \n12 ZXIA  0 When this bit is set to 1, it enables an interrupt when a zero crossing is detected on Phase A current.  \n13 ZXIB  0 When this bit is set to 1, it enables an interrupt when a zero crossing is detected on Phase B current.  \n14 ZXIC  0 When this bit is set to 1, it enables an interrupt when a zero crossing is detected on Phase C current.  \n15 RSTDONE  0 Because the RSTDONE interrupt cannot be disabled, this bit does not ha ve any \nfunctionality attached. It can be set to 1 or cleared to 0 without having any effect.  \n16 SAG  0 When this bit is set to 1, it enables an interrupt when one of the phase voltages \nentered or exited a sag state. The phase is indicated by Bits[14:12] (V SPHASE[x]) in \nthe PHSTATUS register (see Table 40). \n17 OI 0 When this bit is set to 1, it enables an interrupt when an overcurrent event occurs on one of the phases indicated by Bits[5:3] (OIPHASE [x]) in the PHSTATUS register \n(see Table 40). \n18 OV 0 When this bit is set to 1, it enables an interrupt when an overvoltage event occurs on one of the phases indicated by Bits[11:9] (OVPHASE [x]) in the PHSTATUS register \n(see Table  40). \nRev. C| Page 97 of 107 \nADE7880  Data Sheet  \n \nBit  Mnemonic  Default  Value  Description  \n19 SEQERR  0 When this bit is set to 1, it enables an interrupt when a negative -to-positive zero \ncrossing on Phase  A voltage is not followed by a negative -to-positive zero crossing \non Phase B voltage, but by a negative -to-positive zero crossing on P hase C voltage.  \n20 MISMTCH  0 When this bit is set to 1, it enables an interrupt when  ISUMLVL INWV ISUM > −  \nis greater than the value indicated in  ISUMLVL register.   \n22:21  Reserved  00 Reserved. These bits do not manage any functionality.  \n23 PKI 0 When t his bit is set to 1, it enables an interrupt when the period used to detect the \npeak value in the current channel has ended.  \n24 PKV  0 When this bit is set to 1, it enables an interrupt when the period used to detect the \npeak value in the voltage channel has ended.  \n25 CRC  0 When this bit is set to 1, it enables an interrupt when the latest checksum  value is \ndifferent from the c hecksum  value computed when R un register was set to 1.  \n31:26  Reserved  000 0000  Reserved. These bits do not manage any functional ity. \nTable 40. PHSTATUS Register (Address 0xE600)  \nBit  Mnemonic  Default  Value  Description  \n2:0 Reserved  000 Reserved. These bits are always 0. \n3 OIPHASE[0]  0 When this bit is set to 1, Phase A current generates  Bit 17 (OI) in the STATUS1 register . \n4 OIPHASE[1]  0 When this bit is set to 1, Phase B current generate s Bit 17 (OI) in the STATUS1 register . \n5 OIPHASE[2]  0 When this bit is set to 1, Phase C current generates  Bit 17 (OI) in the STATUS1 register . \n8:6 Reserved  000 Reserved . These bits are always 0.  \n9 OVPHASE[0]  0 When this bit is set to 1, Phase A voltage generates  Bit 18 (OV) in the STATUS1 register . \n10 OVPHASE[1]  0 When this bit is set to 1, Phase B voltage generates  Bit 18 (OV) in the STATUS1 register . \n11 OVPHASE[2]  0 When this bit is set to 1, Phase C voltage generates  Bit 18 (OV) in the STATUS1 register . \n12 VSPHASE[0]  0 0: Phase A voltage is above SAGLVL level for SAGCYC half line cycles . \n   1: Phase A voltage is below SAGLVL level for SAGCYC half line cycles.  \n   When this bit is switches from 0 to 1 or from 1 to 0 , the P hase A voltage generate s Bit 16 \n(SAG) in the STATUS1 register . \n13 VSPHASE[1]  0 0: Phase B voltage is above SAGLVL level for SAGCYC half line cycles . \n   1: Phase B voltage is below SAGLVL level fo r SAGCYC half line cycles.  \n   When this bit is switches from 0 to 1 or from 1 to 0 , the P hase B voltage generate s Bit 16 \n(SAG) in the STATUS1 register . \n14 VSPHASE[2]  0 0: Phase C voltage is above SAGLVL level for SAGCYC half line cycles  \n   1: Phase C vo ltage is below SAGLVL level for SAGCYC half line cycles  \n   When this bit is switches from 0 to 1 or from 1 to 0 , the P hase C voltage generate s Bit 16 \n(SAG) in the STATUS1 register.  \n15 Reserved  0 Reserved . This bit is always 0.  \nTable 41. PHNOLOAD Register (Address 0xE608)  \nBit  Mnemonic  Default  Value  Description  \n0 NLPHASE[0]  0 0: Phase A is out of no load condition determined by the P hase A total active power  and  \napparent power . \n   1: Phase A is in no load condition determined by phase A  total active power  and apparent \npower . Bit set together with Bit 0 (NLOAD) in the STATUS1 register . \n1 NLPHASE[1]  0 0: Phase B is out of no load condition determined by the P hase B  total active power  and \napparent power . \n   1: Phase B is in no load  condition determined by the P hase B  total active power  and \napparent power . Bit set together with Bit 0 (NLOAD) in the STATUS1 register . \n2 NLPHASE[2]  0 0: Phase C is out of no load condition determined by the P hase C  total active power  and \napparent power . \n   1: Phase C is in no load condition determined by the P hase C  total active power  and \napparent power . Bit set together with Bit 0 (NLOAD) in the STATUS1 register . \n3 FNLPHASE[0]  0 0: Phase A is out of no load condition based on fundamental active/reacti ve powers.  \n   1: Phase A is in no load condition based on fundamental active/reactive powers. This bit is set together with Bit 1 (FNLOAD) in STATUS1 .\n  \nRev. C| Page 98 of 107 \nData Sheet  ADE7880  \n \nBit  Mnemonic  Default  Value  Description  \n4 FNLPHASE[1]  0 0: Phase B is out of no load condition based on fundamental active/reactive powers.  \n   1: Phase B is in no load condition based on fundamental active/reactive powers. This bit is \nset together with Bit 1 (FNLOAD) in STATUS1 . \n5 FNLPHASE[2]  0 0: Phase C is out of no load condition based on fundamental active/reactive powers.  \n   1: Phase C is in no load condition based on fundamental active/reactive powers. This bit is \nset together with Bit 1 (FNLOAD) in STATUS1 .  \n6 VANLPHASE[0]  0 0: Phase A is out of no load condition based on apparent power.  \n   1: Phase A is in no load condition based on apparent power. Bit set together with Bit 2 \n(VANLOAD) in the STATUS1 register . \n7 VANLPHASE[1]  0 0: Phase B is out of no load condition based on apparent power.  \n   1: Phase B is in no load condition based on apparent power. Bit set together with Bit 2 \n(VANLOAD) in the STATUS1 register . \n8 VANLPHASE[2]  0 0: Phase C is out of no load condition based on apparent power.  \n   1: Phase C is in no load condition based on apparent power. Bit set together with Bit 2 \n(VANLOAD) in the STATUS1 register . \n15:9  Reserv ed 000 0000  Reserved. These bits are always 0. \nTable 42. COMPMODE Register (Address 0xE60E)  \nBit  Mnemonic  Default  Value  Description  \n0 TERMSEL1[0]  1 Setting all TERMSEL1[2:0] to 1 signifies the sum of all three phases is included i n the CF1 \noutput. Phase A is included in the CF1 outputs calculations.  \n1 TERMSEL1[1]  1 Phase B is included in the CF1 outputs calculations.  \n2 TERMSEL1[2]  1 Phase C is included in the CF1 outputs calculations.  \n3 TERMSEL2[0]  1 Setting all TERMSEL2[2:0] to  1 signifies the sum of all three phases is included in the CF2 \noutput. Phase A is included in the CF2 outputs calculations.  \n4 TERMSEL2[1]  1 Phase B is included in the CF2 outputs calculations.  \n5 TERMSEL2[2]  1 Phase C is included in the CF2 outputs calcu lations.  \n6 TERMSEL3[0]  1 Setting all TERMSEL3[2:0] to 1 signifies the sum of all three phases is included in the CF3 \noutput. Phase A is included in the CF3 outputs calculations.  \n7 TERMSEL3[1]  1 Phase B is included in the CF3 outputs calculations.  \n8 TERM SEL3[2]  1 Phase C is included in the CF3 outputs calculations.  \n10:9  ANGLESEL[1:0]  00 00: the angles between phase voltages and phase currents are measured.  \n   01: the angles between phase voltages are measured.  \n   10: the angles between phase currents a re measured.  \n   11: no angles are measured.  \n11 VNOMAEN  0 When this bit is 0, the apparent power on Phase A is computed regularly.  \n   When this bit is 1, the apparent power on Phase A is computed using the VNOM register instead  \nof regular measured rms p hase voltage. The applied Phase A voltage input is ignored, and all \nPhase A rms voltage instances are replaced by the value in the VNOM register.  \n12 VNOMBEN 0 When this bit is 0, the apparent power on Phase B is computed regularly.  \n   When this bit is 1 , the apparent power on Phase B is computed using VNOM register instead  of \nregular measured rms phase voltage. The applied Phase B voltage input is ignored, and all \nPhase B rms voltage instances are replaced by the value in the VNOM register.  \n13 VNOMCEN 0 When this bit is 0, the apparent power on Phase C is computed regularly.  \n   When this bit is 1, the apparent power on Phase C is computed using VNOM register instead  of \nregular measured rms phase voltage. The applied Phase C voltage input is ignored, an d all \nPhase C rms voltage instances are replaced by the value in the VNOM register.  \n14 SELFREQ  0 When the ADE7880 is connected to networks with fundamental frequencies between 45 Hz \nand 55 Hz , clear this bit to 0 (default value). When the ADE7880  is connected to networks with \nfundamental frequencies between 55 Hz and 66 Hz , set this bit to 1.   \n15 Reserved  0 This bit is 0 by default and  it does not manage any functionality.  \n \nRev. C| Page 99 of 107 \nADE7880  Data Sheet  \n \nTable 43. G ain Register (Address 0xE60F)  \nBit  Mnemonic  Default  Value  Description  \n2:0 PGA1[2:0]  000 Phase currents gain selection.  \n000: gain = 1.  \n001: gain = 2.  \n010: gain = 4.  \n011: gain = 8.  \n100: gain = 16.  \n101, 110, 111: reserved. When set, the ADE7880  behaves  like PGA1[2:0] = 000.  \n5:3 PGA2[2:0]  000 Neutral current gain selection.  \n   000: gain = 1.   \n   001: gain = 2.  \n   010: gain = 4.  \n   011: gain = 8.  \n   100: gain = 16.  \n   101, 110, 111: reserved. When set, the ADE7880  behaves  like PGA2[2:0] = 000.  \n8:6 PGA3[2:0]  000 Phase voltages gain sele ction.  \n000: gain = 1.  \n001: gain = 2.  \n010: gain = 4.  \n011: gain = 8.  \n100: gain = 16.  \n101, 110, 111: reserved. When set, the ADE7880  behave s like PGA3[2:0] = 000.  \n15:9  Reser ved 000 0000  Reserved. These bits do not manage any functionality.  \nTable 44. CFMODE Register (Address 0xE610)  \nBit  Mnemonic  Default  Value  Description  \n2:0 CF1SEL[2:0]  000 000: the CF1 frequency is proportional to the sum of total active powers on \neach phase identified by Bits[2:0] (TERMSEL1 [x]) in the  COMPMODE register.  \n010: the CF1 frequency is proportional to the sum of apparent powers on each phase identified by Bits[2:0] (TERMSEL1 [x]) in the  COMPMODE register.  \n011: the CF1 frequency is proportional to the sum of fundamental active \npowers on each phase identified by Bits[2:0] (TERMSEL1 [x]) in the  \nCOMPMODE register.   \n100: the CF1 frequency is proportional to the sum of fundamental reactive \npowers on each phase identified by Bits[2:0] (TERMSEL1 [x]) in the  \nCOMPMODE register.   \n001, 101, 110, 111: reserved.  \n5:3 CF2SEL[2:0]  100 000: the CF2 frequency is proportional to the sum of total active powers on each phase identified by Bits[5:3] (TERMSEL2 [x]) in the  COMPMODE register.  \n010: the CF2 frequency is proportional to the sum of apparent powers on each phase identified by Bits[5:3] (TERMSEL2 [x]) in the  COMPMODE register.  \n011:  the CF2 frequency is proportional to the sum of fundamental active \npowers on each phase identified by Bits[5:3] (TERMSEL2 [x]) in the  \nCOMPMODE register.   \n100: the CF2 frequency is proportional to the sum of fundamental reactive \npowers on each phase identified by Bits[5:3] (TERMSEL2 [x]) in the  \nCOMPMODE register.   \n001, 101,110,111 : reser ved.  \nRev. C| Page 100 of 107 \nData Sheet  ADE7880  \n \nBit  Mnemonic  Default  Value  Description  \n8:6 CF3SEL[2:0]  010 000: the CF3 frequency is proportional to the sum of total active powers on \neach phase identified by Bits[8:6] (TERMSEL3 [x]) in the  COMPMODE register.  \n010: the CF3 frequency is proportional to the sum of apparent powers on each phase identified by Bits[8:6] (TERMSEL3 [x]) in the  COMPMODE register.  \n011: CF3 frequency is proportional to the sum of fundamental active powers \non each phase identified by Bits[8:6] (TERMSEL3 [x]) in the  COMPMODE \nregister.   \n100: CF3 frequency is  proportional to the sum of fundamental reactive \npowers on each phase identified by Bits[8:6] (TERMSEL3 [x]) in the  \nCOMPMODE register.   \n001, 101,110,111 : reserved.  \n9 CF1DIS  1 When this bit is set to 1, the CF1 output is disabled. The respective digita l to \nfrequency converter remains enabled even if CF1DIS = 1.  \n   When this bit is set to 0, the CF1 output is enabled.  \n10 CF2DIS  1 When this bit is set to 1, the CF2 output is disabled. The respective digital to frequency converter remains enabled even if CF2DIS = 1.  \n   When this bit is set to 0, the CF2 output is enabled.  \n11 CF3DIS  1 When this bit is set to 1, the CF3 output is disabled. The respective digital to frequency converter remains enabled even if CF3DIS = 1.  \n   When this bit is set to 0, t he CF3 output is enabled.  \n12 CF1LATCH  0 When this bit is set to 1, the content of the corresponding energy registers is \nlatched when a CF1 pulse is generated. See the Synchronizing Energy \nRegisters with CFx Outputs  section.  \n13 CF2LATCH  0 When this bit is set to 1, the content of the corresponding energy registers is latched when a CF2 pulse is generated. See the Synchronizing Energy \nRegisters with CFx Outputs  section.  \n14 CF3LATCH  0 When this bit is set to 1, the content of the corresponding energy registers is \nlatched when a CF3 pulse is generated. See the Synchronizing Energy \nRegisters with CFx Outputs  section.  \n15 Reserved  0 Reserved. This bit does not manage any functio nality.  \nTable 45. APHCAL, BPHCAL, CPHCAL Registers (Address 0xE614, Address 0xE615, Address 0xE616)  \nBit  Mnemonic  Default  Value  Description  \n9:0 PHCALVAL  0000000000  If the current leads the voltage, these bits can vary between 0 an d 383.  \nIf the current lags the voltage, these bits can vary between 512 and 575.  \nIf the PHCALVAL bits are set with numbers between 384 and 511, the compensation behaves \nlike PHCALVAL set between 256 and 383.  \nIf the PHCALVAL bits are set with nu mbers between 5 76 and 1023, the compensation \nbehaves like PHCALVAL bits set between 384 and 511. \n15:10  Reserved  000000  Reserved. These bits do not manage any functionality.  \nTable 46. PHSIGN Register (Address 0xE617)  \nBit  Mnemonic  Default  Value  Description  \n0 AWSIGN  0 0: if the active power identified by Bit 6 (REVAPSEL) in the ACCMODE register (total of \nfundamental) on Phase A is positive.  \n1: if the active power identified by Bit 6 (REVAPSEL) in the ACCMODE register (total of \nfundamental) on Phase A is negative.  \n1 BWSIGN  0 0: if the active power identified by Bit 6 (REVAPSEL) in the ACCMODE register (total of \nfundamental) on Phase B is positive.  \n   1: if the active power identified by Bit 6 (REVAPSEL) in the ACCMODE register ( total of \nfundamental) on Phase B is negative.  \n2 CWSIGN  0 0: if the active power identified by Bit 6 (REVAPSEL) in the ACCMODE register (total of \nfundamental) on Phase C is positive.  \n   1: if the active power identified by Bit 6 (REVAPSEL) bit in the ACCM ODE register (total of \nfundamental) on Phase C is negative.  \nRev. C| Page 101 of 107 \nADE7880  Data Sheet  \n \nBit  Mnemonic  Default  Value  Description  \n3 SUM1SIGN  0 0: if the sum of all phase powers in the CF1 data  path is positive.  \n   1: if the sum of all phase powers in the CF1 data  path is negative. Phase powers in the CF1 \ndata  path are iden tified by Bits[2:0] (TERMSEL1[x]) of the COMPMODE register and by \nBits[2:0] (CF1SEL[x]) of the CFMODE register.  \n4 AFVARSIGN  0 0: if the fundamental reactive power on Phase A is positive.  \n   1: if the fundamental reactive power on Phase A is negative.  \n5 BFVARSIGN  0 0: if the fundamental reactive power on Phase B is positive.  \n   1: if the fundamental reactive power on Phase B is negative.  \n6 CFVARSIGN  0 0: if the fundamental reactive power on Phase C is positive.  \n   1: if the fundamental reactive power on Phase C is negative.  \n7 SUM2SIGN  0 0: if the sum of all phase powers in the CF2 data  path is positive.  \n   1: if the sum of all phase powers in the CF2 data  path is negative. Phase powers in the CF2 \ndata  path are identified by Bits[5:3] (TERMSEL2 [x]) of the  COMPMODE register and by \nBits[5:3] (CF2SEL [x]) of the CFMODE register.  \n8 SUM3SIGN  0 0: if the sum of all phase powers in the CF3 data  path is positive.  \n   1: if the sum of all phase powers in the CF3 data  path is negative. Phase powers in the CF3 \ndata  path are identified by Bits[8:6] (TERMSEL3 [x]) of the  COMPMODE register and by \nBits[8:6] (CF3SEL [x]) of the CFMODE register.  \n15:9  Reserved  000 0000  Reserved. These bits are always 0. \nTable 47. CONFIG Register (Address 0xE618)  \nBit  Mnemonic  Default  Value  Description  \n0 INTEN  0 This bit manages the integrators in the phase current channels.  \n   If INTEN  = 0, then the integrators in the phase current channels are always disabled.  \n   If INTEN  = 1, then the integrators in the pha se currents channels are enabled.  \n   The neutral current channel integrator is managed by Bit 3 (ININTEN ) of CONFIG3 register.  \n1 Reserved  1 Reserved. Maintain this bit  at 1 for proper operation.  \n2 CF2DIS  0 When this bit is cleared to 0, the CF2 functio nality is chosen at CF2/HREADY pin.  \n   When this bit is set to 1, the HREADY functionality is chosen at CF2/HREADY pin.  \n3 SWAP  0 When this bit is set to 1, the voltage channel outputs are swapped with the current channel \noutputs. Thus, the current channe l information is present in the voltage cha nnel registers \nand vice versa.  \n4 MOD1SHORT  0 When this bit is set to 1, the voltage channel ADCs behave as if the voltage inputs were put \nto ground.  \n5 MOD2SHORT  0 When this bit is set to 1, the current channel ADCs behave as if the voltage inputs were put \nto ground.  \n6 HSDCEN  0 When this bit is set to 1, the HSDC serial port is enabled and HSCLK functionality is chosen at \nCF3/HSCLK pin.  \n   When this bit is cleared to 0, HSDC is disabled and CF3 functionality i s chosen at CF3/HSCLK pin.  \n7 SWRST  0 When this bit is set to 1, a software reset is initiated.  \n9:8 VTOIA[1:0]  00 These bits decide what phase voltage is considered together with Phase A current in the \npower path.  \n00 = Phase A voltage.  \n01 = Phase  B voltage.  \n10 = Phase C voltage.  \n11 = reserved. When set, the ADE7880 behave s like VTOIA[1:0] = 00.  \n11:10  VTOIB[1:0]  00 These bits decide what phase voltage is considered together with Phase B current in the power path.  \n00 = Phase B voltage.  \n01 = Phase C voltage.  \n10 = Phase A voltage.  \n11 = reserved. When set, the ADE7880 behave s like VTOIB[1:0] = 00.  \nRev. C| Page 102 of 107 \nData Sheet  ADE7880  \n \nBit  Mnemonic  Default  Value  Description  \n13:12  VTOI C[1:0]  00 These bits decide what phase voltage is considered together with Phase C current in the \npower path.  \n00 = Phase C voltage.  \n01 = Phase A voltage.  \n10 = Phase B voltage.  \n11 = reserved. When set, the ADE7880 behave s like VTOIC[1:0] = 00.  \n15:14  Reserved   Reserved.  \nTable 48. MMODE Register (Address 0xE700)  \nBit  Mnemonic  Default  Value  Description  \n1:0 Reserved   Reserved.  \n2 PEAKSEL[0]  1 PEAKSEL[2:0] bit s can all be set to 1 simultaneously to allow peak detection on all three phases \nsimultaneously. If more than one PEAKSEL[2:0] bits are set to 1, then the peak measurement \nperiod indicated in the PEAKCYC register decreases accordingly because zero crossing s are \ndetected on more than one phase.  \n   When this bit is set to 1, Phase A is selected for the voltage and current peak registers.  \n3 PEAKSEL[1]  1 When this bit is set to 1, Phase B is selected for the voltage and current peak registers . \n4 PEAKSEL[2]  1 When this bit is set to 1, Phase C is selected for the voltage and current peak registers . \n7:5 Reserved  000 Reserved. These bits do not manage any functionality.  \nTable 49. ACCMODE Register (Address 0xE701)  \nBit  Mnemonic  Default  Value  Description  \n1:0 WATTACC[1:0]  00 00: signed accumulation mode of the total and fundamental active powers.  The total and \nfundamental active energy registers and the CFx pulses are generated in the same way.  \n01: positive only accumulation mode of t he total and fundamental active powers.  In this \nmode, although the total and fundamental active energy registers  are accumulated in \npositive only mode, the CFx pulses are generated in signed accumulation mode.  \n10: reserved. When set, the device behaves  like WATTACC[1:0] = 00.  \n11: absolute accumulation mode of the total and fundamental active powers.  The total and \nfundamental energy registers and the CFx pulses are generated in the same way. \n3:2 VARACC[1:0]  00 00: signed accumulation of the fundamen tal reactive powers. The fundamental reactive \nenergy registers and the CFx pulses are generated in the same way . \n01: reserved. When set, the device behaves like VARACC[1:0] = 00. \n10: the fundamental reactive power is  accumulated, depending on the s ign of the \nfundamental active power: if the active power is positive, the reactive power is acc umulated \nas is, whereas if the active power is negative, the reactive power is accumulated  with reversed \nsign.  In this mode, although the total and fundamental r eactive energy registers are \naccumulated in absolute mode, the CFx pulses are generated in signed accumulation mode.  \n11: absolute accumulation mode of the fundamental re active powers.  In this mode, \nalthough the total and fundamental reactive energy reg isters are accumulated in absolute \nmode, the CFx pulses are generated in signed accumulation mode.  \n5:4 CONSEL[1:0]  00 These bits select the inputs to the energy accumulation registers. IA’ , IB’ , and IC’ are IA, IB, and \nIC shifted resp ectively by −90°. See Table 50. \n00: 3-phase four wires with three voltage sensors.  \n01: 3-phase three wires delta connection. In this mode, BVRMS register contains the rms \nvalue of VA -VC. \n10: 3-phase four  wires with t wo voltage sensors.  \n11: 3 -phase four  wires delta connection.  \nRev. C| Page 103 of 107 \nADE7880  Data Sheet  \n \nBit  Mnemonic  Default  Value  Description  \n6 REVAPSEL  0 0: The total active power on each phase is used to trigger a bit in the STATUS0  register as \nfollows: on Phase A triggers Bit 6 (REVAPA), on Phase B triggers Bit 7 (REVAPB), and on \nPhase  C triggers Bit 8 (REVAPC).   \n   1: The fundamental active power on each phase is used to trigger a bit in the STATUS0  \nregister as follows: on Phase A triggers Bit 6 (REVAPA), on Phase B triggers Bit 7 (REVAPB), and on Phase C triggers Bit 8 (REVAP C). \n7 Reserved  1 Reserved. This  bit do es not manage any functionality.  \nTable 50. CONSEL[1:0] Bits in Energy Registers1 \nEnergy Registers CONSEL[1:0]  = 00 CONSEL[1:0]  = 01 CONSEL[1:0]  = 10 CONSEL[1:0]  = 11 \nAWATTHR, AFWATTHR  VA × IA  VA × IA  VA × IA  VA × IA  \nBWAT THR, BFWAT THR  VB × IB  VB = VA – VC  VB = −VA –  VC VB = −VA  \n  VB ×IB1 VB × IB  VB × IB  \nCWAT THR, CFWAT THR  VC × IC  VC × IC  VC × IC VC × IC  \nAVARHR, AFVARHR  VA × IA’  VA × IA’ VA × IA’  VA × IA’  \nBVARHR, BFVARHR  VB × IB’  VB = VA – VC  VB = −VA –  VC VB = −VA  \n  VB × IB’1 VB × IB’  VB × IB’  \nCVARHR , CFVARHR  VC ×IC’  VC × IC’  VC × IC’  VC × IC’  \nAVAHR  VA rms × IA rms  VA rms × IA rms  VA rms × IA rms  VA rms × IA rms  \nBVAHR  VB rms × IB rms  VB rms ×  IB rms  VB rms × IB rms  VB rms × IB rms  \n  VB = VA – VC1 VB = −VA − VC  VB = −VA  \nCVAHR  VC rms × IC rms  VC rms  × IC rms  VC rms × IC rms  VC rms × IC rms  \n1 In a 3-phase three wire case (CONSEL[1:0]  = 01), the ADE7880 computes the rms value of the line voltage between Phase  A and and Phase C and stores the result into \nBVRMS register (see the Voltage RMS in 3 -Phase, 3 -Wire Delta Configurations  section ). Consequently, the ADE7880 computes powers associated with P hase B th at do \nnot have physical meaning. To avoid any errors in the frequency output pins CF1, CF2 or CF3  related to the powers associated with Phase B , disable the contribution  of \nPhase B to the energy to frequency converters by setting bits TERMSEL1[1] , or TERMS EL2[1] , or TERMSEL3[1] to 0 in the COMPMODE register ( see the Energy -to-\nFrequency Conversion  section ). \nTable 51. LCYCMODE Register (Address 0xE702)  \nBit  Mnemonic  Default  Value  Description  \n0 LWATT  0 0: th e watt -hour accumulation registers (AWATTHR, BWATTHR, CWATTHR, AFWATTHR, \nBFWATTHR, and CFWATTHR) are placed in regular accumulation mode.  \n   1: the watt-hour accumulation registers (AWATTHR, BWATTHR, CWATTHR, AFWATTHR, \nBFWATTHR, and CFWATTHR) are placed i nto line cycle accumulation mode.  \n1 LVAR  0 0: the var-hour accumulation registers (A FVARHR, B FVARHR, and CFVARHR) are placed in regular \naccumulation mode.   \n   1: the var -hour accumulation registers (A FVARHR, B FVARHR, and CFVARHR) are placed into \nline-cycle accumulation mode.  \n2 LVA 0 0: the VA -hour accumulation registers (AVAHR, BVAHR, and CVAHR) are placed in regular \naccumulation mode.  \n   1: the VA -hour accumulation registers (AVAHR, BVAHR, and CVAHR) are placed into line -cycle \naccumulation mode.  \n3 ZXSEL[0]  1 0: Phase A is not selected for zero -crossings counts in the line cycle accumulation mode.  \n   1: Phase A is selected for zero -crossings counts in the line cycle accumulation mode. If more \nthan one phase is selected for zero -crossing detection, the accumulation time is shorten ed \naccordingly . \n4 ZXSEL[1]  1 0: Phase B is not selected for zero -crossings counts in the line cycle accumulation mode.  \n   1: Phase B is selected for zero -crossings counts in the line cycle accumulation mode.  \n5 ZXSEL[2]  1 0: Phase C is not selected for zero -crossings counts in the line cycle accumulation mode.  \n   1: Phase C is selected for zero -crossings counts in the line cycle accumulation mode.  \n6 RSTREAD  1 0: read -with -reset of all energy registers is disabled. Clear this  bit to 0 when Bits[2:0] (LWATT, \nLVAR, and LVA) are set to 1.  \n   1: enables read -with -reset of all xWATTHR, xVARHR, xVAHR, xFWATTHR, and xFVARHR registers. \nThis means a read of those registers resets them to 0.  \nRev. C| Page 104 of 107 \nData Sheet  ADE7880  \n \nBit  Mnemonic  Default  Value  Description  \n7 PFMODE  0 0: power factor calculation uses  instantaneous values of various phase powers used in its expression . \n   1: power factor calculation uses phase energies values calculated using line cycle accumulation \nmode. Bits LWATT and LVA in LCYCMODE register must be enabled for the power factors to  be \ncomputed correctly. The update rate of the power factor measurement in this case is the integral \nnumber of half line cycles that are programmed into the LINECYC register.  \nTable 52. HSDC_CFG Register (Address 0xE706)  \nBit  Mnemon ic Default  Value  Description  \n0 HCLK  0 0: HSCLK is 8 MHz.  \n   1: HSCLK is 4 MHz.  \n1 HSIZE 0 0: HSDC transmits the 32 -bit registers in 32 -bit packages, most significant bit first.  \n   1: HSDC transmits the 32 -bit registers in 8 -bit packages, most significa nt bit first.  \n2 HGAP  0 0: no gap is introduced between packages.  \n   1: a gap of seven HCLK cycles is introduced between packages.  \n4:3 HXFER[1:0]  00 00 = HSDC transmits sixteen 32 -bit words in the following order: IAWV, VAWV, IBWV,  VBWV, ICWV, \nVCWV,  INW V, AVA, BVA, CVA, AWATT, BWATT, CWATT, AFVAR, BFVAR, and CFVAR.  \n   01 = HSDC transmits seven instantaneous values of currents and voltages: IAWV, VAWV, \nIBWV, VBWV, ICWV, VCWV, and INWV.  \n   10 = HSDC transmits nine instantaneous values of phase powers:  AVA, BVA, CVA, AWATT, \nBWATT, CWATT, AFVAR, BFVAR, and CFVAR.  \n   11 = reserved. If set, the ADE7880 behave s as if HXFER[1:0] = 00.  \n5 HSAPOL  0 0: SS/has output pin i s active lo w. \n   1: SS/HSA output pin is active high.  \n7:6 Reserved  00 Reserved. These bits do not manage any functionality.  \nTable 53. CONFIG 3 Register (Address 0xE A00 ) \nBit  Mnemonic  Default  Value  Description  \n0 HPFEN  1 Whe n HPFEN = 1, then all high- pass filters in voltage and current channels are enabled. \nWhen HPFEN  = 0, then all high- pass filters are disabled.  \n1 LPFSEL  0 When LPFSEL  = 0, the LPF in the total active power data path introduces a settling time of \n650 ms. \n   When LPFSEL  = 1, the LPF in the total active power data path introduces a settling time of \n1300 ms. \n2 INSEL  0 When INSEL  = 0, the register NIRMS contains the rms value of the neutral current.  \n   When INSEL  = 1, the register NIRMS contains the rms value of ISUM, the instantaneous value \nof the sum of all 3 phase currents, IA, IB , and IC. \n3 ININT EN 0 This bit manages the integrator in the neutral current channel.  \n   If ININTEN  = 0, then the integrator in the neutral current channel is disabled.  \n   If ININTDIS  = 1, then the integrator in the neutral channel is enabled. \n   The integrators in the phase currents channels are managed by Bit 0 (INTEN) of CONFIG register.  \n4 Reserved  0 Reserved. Maintain t his bit at 0  for proper operation.  \n7:5 Reserved  000 Reserved. These bits do not manage any functionality.  \n \nRev. C| Page 105 of 107 \nADE7880  Data Sheet  \n \nTable 54. HCONFIG Register (Address 0xE 900)  \nBit  Mnemonic  Default  Value  Description  \n0 HRCFG  0 When  this bit is cleared to 0, the B it 19 (HREADY) interrupt in MASK0 register is triggered \nafter a certain delay period. The delay period is set by bits HSTIME. The update frequency \nafter the settling time is determined by bits HRATE. \n   When this bit is set to 1, the B it 19 (HREADY) interrupt in MASK0 register is triggered starting \nimmediately after the harmonic calculations block has been setup. The upd ate frequency is \ndetermined by B its HRATE.  \n2:1 HPHASE  00 These bits decide what phase or neutral is analyzed by the harmonic calculations block.  \n   00 = Phase A voltage and current . \n   01 = Phase B voltage and current . \n   10 = Phase C voltage and current . \n   11 = neutral current . \n4:3 HSTIME  01 These bits decide the delay period after which, if HRCFG bit is set to 0, Bit 19 (HREADY) in the \nSTATUS0 register is set to 1.  \n   00 = 500 ms. \n   01 = 750 ms. \n   10 = 1000 ms. \n   11 = 1250 ms. \n7:5 HRATE  000 These bits manage the update rate of the harmonic registers.  \n   000 = 125 µs (8 kHz rate).  \n   001 = 250 µs (4 kHz rate).  \n   010 = 1 ms (1 kHz rate).  \n   011 = 16 ms (62.5 Hz rate).  \n   100 = 128 ms (7.8125 Hz rate).  \n   101 = 512 ms (1.953125 Hz rate).  \n   110 = 1.024 sec (0.9765625 Hz rate).  \n   111 = harmonic calculations disabled.  \n9:8 ACTPHSEL  00 These bits select the phase voltage used as time base for harmonic calculations.  \n   00 = Phase A voltage.  \n   01 = Phase B voltage.  \n   10 = Phase C voltage.  \n   11 = reserved. If selected, phase C voltage is used.  \n15:10  Reserved  0 Reserved. These bits do not manage any functionality.  \n \nTable 55. LPOILVL Register (Address 0xEC00)  \nBit  Mnemonic  Default Value  Description  \n2:0 LPOIL[2:0]  111 Threshold is put at a value corresponding to full scale multiplied by LPOIL/8.  \n7:3 LPLINE[4:0]  00000 The measurement period is (LPLINE + 1)/50 seconds.  \n \nTable 56. CONFIG2 Register (Address 0xEC01)  \nBit  Mnemonic  Default  Value  Description  \n0 EXTREFEN  0 When this bit is 0, it signifies that the internal voltage reference is used in the ADCs.  \n   When this bit is 1, an external reference is connected to the Pin 17 REF IN/OUT . \n1 I2C_LOCK  0 When  this bit is 0, the SS/HSA pin can be toggled  three times to activate the SPI port. If I2C is the \nactive serial port, this bit must be set to 1 to lock it in. From this moment on , toggling of the SS/HSA  \npin and an eventual switch into using the SPI port is no longer possible.  If SPI is the active serial port, \nany write to CONFIG2 register locks the port. From this moment on, a switch into using I2C port is \nno longer possible. Once lock ed, the serial port choice is maintained when the ADE7880 change s \nPSMx power modes.  \n7:2 Reserved  0 Reserved. These bits do not manage any functionality.  \n \nRev. C| Page 106 of 107 \nData Sheet  ADE7880  \n \nOUTLINE DIMENSIONS \n \n05-06-20 11-A0.50\nBSC\nBOTTOM VIEW TOP VIEWPIN 1\nINDIC ATOR\nEXPOSED\nPADPIN 1\nINDIC ATOR\nSEATING\nPLANE0.05 MAX\n0.02 NOM\n0.20 REFCOPLANARITY\n0.080.30\n0.23\n0.186.10\n6.00 SQ\n5.90\n0.80\n0.75\n0.70FOR PROPER CONNECTION OF\nTHE EXPOSED PAD, REFER TO\nTHE PIN CONFIGURATION AND\nFUNCTION DESCRIPTIONS\nSECTION OF THIS DATA SHEET.0.45\n0.40\n0.350.25 MIN4.45\n4.30 SQ\n4.25\nCOMPLIANT TO JEDEC STANDARDS MO-220- WJJD .40\n1\n11 20213031\n10\n \nFigure 118 . 40 -Lead Lead Frame Chip Scale P ackage [LFCSP_WQ]  \n6 mm ×  6 mm Body, Very Very Thin Quad  \n(CP-40-10) \nDimensions shown in millimeters  \nORDERING GUIDE  \nModel1 Temperature Range  Package Description  Package Option  \nADE7880 ACPZ  −40°C to +85°C  40-Lead LFCSP_WQ  CP-40-10  \nADE7880 ACPZ -RL −40°C to +85°C  40-Lead LFCSP_WQ, 13” Tape and Reel  CP-40-10  \nEVAL -ADE7880 EBZ   Evaluation Board   \n1 Z = RoHS Compliant Part.  \n \n \n \n \n \n \n  \n \n \n \n \n \n \n \nI2C refers to a communications protocol originally developed by Philips Semiconductors (now NXP Semico nductors).  \n \n©2011 –2014  Analog Devices, Inc. All rights reserved. Trademarks and   \n registered trademarks are the property of their respective owners.  \n  D10193- 0-12/14(C)  \n \nRev. C| Page 107 of 107  \n"}]
!==============================================================================!
### Component Summary: ADE7880ACPZ-RL

**Description:**
The ADE7880ACPZ-RL is a polyphase multifunction energy metering integrated circuit (IC) designed for high-accuracy energy measurement in three-phase systems. It supports various power quality monitoring functions, including harmonic monitoring, and is compliant with multiple international standards.

**Key Specifications:**

- **Voltage Ratings:**
  - Supply Voltage (VDD): 2.4 V to 3.7 V (typical 3.3 V)
  - Reference Voltage: 1.2 V (±8%)

- **Current Ratings:**
  - Maximum Signal Levels for Analog Inputs: ±500 mV peak

- **Power Consumption:**
  - Normal Power Mode (PSM0): 25-28 mA
  - Reduced Power Mode (PSM1): 5.3-5.8 mA
  - Low Power Mode (PSM2): 0.2-0.27 mA
  - Sleep Mode (PSM3): 1.8-6 μA

- **Operating Temperature Range:**
  - Industrial Range: -40°C to +85°C

- **Package Type:**
  - 40-lead Lead Frame Chip Scale Package (LFCSP), Pb-free

- **Special Features:**
  - Highly accurate energy measurements with less than 0.1% error for active and reactive energy.
  - Supports 3-phase, 3-wire or 4-wire configurations.
  - Provides rms, active, reactive, and apparent powers, power factor, total harmonic distortion (THD), and harmonic distortion measurements.
  - Integrated digital signal processor (DSP) for signal processing.
  - Multiple serial interfaces (I2C, SPI, HSDC) for communication.
  - Built-in power quality measurements and calibration features.

- **Moisture Sensitive Level (MSL):**
  - MSL according to JEDEC J-STD-020E: Not specified in the provided data.

**Typical Applications:**
- Energy metering systems for residential, commercial, and industrial applications.
- Power quality monitoring in electrical grids.
- Solar inverters for energy production monitoring.
- Process monitoring in various industrial applications.
- Protective devices in electrical systems.

### Conclusion:
The ADE7880ACPZ-RL is a versatile and highly accurate energy metering IC suitable for a wide range of applications in energy management and power quality monitoring. Its ability to measure various electrical parameters and its compliance with international standards make it an ideal choice for modern energy metering solutions.