[{'role': 'system', 'content': 'You are a technical specialist with expertise in electronics. Your task is to analyze datasheets for electronic components and provide a concise summary of the product’s key characteristics and specifications. In addition, you need to gather textual information about the component, including its description and typical applications.Instructions:    Identify the correct component in the datasheet using the provided product code.    Summarize key parameters, including:        Voltage ratings        Current ratings        Power consumption        Operating temperature range        Package type        Special features or notes (if applicable)        Moisture Sensetive Level JEDEC J-STD-020E    Provide a short description of the component, including what it is (e.g., transistor, microcontroller, sensor) and its primary function.    Explain typical applications for the component (e.g., power management, signal processing, data storage, etc.).    Be thorough and accurate: Ensure the information corresponds specifically to the product code, as some datasheets cover multiple variants.Your goal is to create a clear and accurate technical summary that includes both key specifications and a description of what the component is used for.'}, {'role': 'user', 'content': 'Give me information about the component of RTL8304MB-CG production of REALTEK SEMICONDUCTOR CORP. from the text: \n \n           \n     \n       \n    \n         \nRTL8304MB-CG \n   \nSINGLE-CHIP 4-PORT 10/100M ETHERNET \nSWITCH CONTROLLER \n  \nDATASHEET \n(CONFIDENTIAL: Development Partners Only) \n  \n \nRev. 1.0 \n26 May 2014 \nTrack ID: JATR-8275-15 \n \n  \nRealtek Semiconductor Corp. \nNo. 2, Innovation Road II, Hsinchu Science Park, Hsinchu 300, Taiwan \nTel.: +886-3-578-0211. Fax: +886-3-577-6047 www.realtek.com\n \n\n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller ii Track ID: JATR-8275-15   Rev. 1.0\n \n \nCOPYRIGHT \n©2014 Realtek Semiconductor Corp. All rights reserve d. No part of this document may be reproduced, \ntransmitted, transcribed, stored in a retrieval system, or  translated into any language in any form or by any \nmeans without the written permission of Realtek Semiconductor Corp. \n \nDISCLAIMER \nRealtek provides this document ‘as is’, without warranty of any kind. Realtek may make improvements \nand/or changes in this document or in the product de scribed in this document at any time. This document \ncould include technical inaccura cies or typographical errors. \n \nTRADEMARKS \nRealtek is a trademark of Realtek Semiconductor Cor poration. Other names mentioned in this document \nare trademarks/registered trademarks of their respective owners. \n \nUSING THIS DOCUMENT \nThis document is intended for the software engin eer’s reference and provides detailed programming \ninformation. \nThough every effort has been made to ensure that th is document is current and accurate, more information \nmay have become available subsequent to the production of this guide.  \nREVISION HISTORY \nRevision Release Date Summary \n1.0 2014/05/26 First release. \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller iii Track ID: JATR-8275-15   Rev. 1.0\n \n \nTable of Contents \n1. GENERAL DESC RIPTION............................................................................................................ ..................................1  \n2. FEATURES.........................................................................................................................................................................2  \n3. SYSTEM APPLICATIONS............................................................................................................ ...................................3  \n4. BLOCK DIAGRAM.................................................................................................................. .........................................4  \n5. PIN ASSIGNMENTS ................................................................................................................ .........................................5  \n5.1. PIN ASSIGNMENTS DIAGRAM .......................................................................................................................................5  \n5.2. PACKAGE IDENTIFICATION ...........................................................................................................................................5  \n5.3. PIN ASSIGNMENTS TABLE ............................................................................................................................................6  \n6. PIN DESCRIPTIONS.........................................................................................................................................................7  \n6.1. PIN ASSIGNMENT CODES .............................................................................................................................................7  \n6.2. MEDIA CONNECTION PINS...........................................................................................................................................7  \n6.3. RMII  PORT MAC  INTERFACE PINS..............................................................................................................................7  \n6.4. MISCELLANEOUS PINS.................................................................................................................................................8  \n6.5. PORT LED  PINS...........................................................................................................................................................8  \n6.6. STRAPPING PINS...........................................................................................................................................................9  \n6.7. LDO  PINS..................................................................................................................................................................10  \n6.8. POWER AND GND  PINS..............................................................................................................................................10  \n7. BASIC FUNCTIONAL DESCRIPTION................................................................................................... .....................11  \n7.1. SWITCH CORE FUNCTION OVERVIEW .........................................................................................................................11  \n7.1.1. Flow Control ................................................................................................................... .....................................11  \n7.1.1.1  IEEE 802.3x Full Dupl ex Flow Control........................................................................................................................11  \n7.1.1.2  Half Duplex B ack Pressure...................................................................................................... .....................................11  \n7.1.2. Address Search, Learning, and Aging ............................................................................................ ......................12  \n7.1.3. Half Duplex Op eration.......................................................................................................... ...............................12  \n7.1.4. InterFrame Gap....................................................................................................................................................12  \n7.1.5. Illegal Frame.................................................................................................................. ......................................12  \n7.2. PHYSICAL LAYER FUNCTIONAL OVERVIEW ...............................................................................................................13  \n7.2.1. Auto-Negotiation ............................................................................................................... ...................................13  \n7.2.2. 10Base-T Tran smit Func tion..................................................................................................... ...........................13  \n7.2.3. 10Base-T Rece ive Func tion...................................................................................................... ............................13  \n7.2.4. Link Monitor................................................................................................................... ......................................13  \n7.2.5. 100Base-TX Transmit Function................................................................................................... .........................13  \n7.2.6. 100Base-TX R eceive Func tion.................................................................................................... ..........................13  \n7.2.7. Power-Down  Mode................................................................................................................ ...............................14  \n7.2.8. Crossover Detection an d Auto Correction ........................................................................................ ...................14  \n7.2.9. Polarity Detecti on and Correction .............................................................................................. .........................14  \n7.3. GENERAL FUNCTION OVERVIEW ................................................................................................................................15  \n7.3.1. Power-On Sequence .............................................................................................................. ...............................15  \n7.3.2. Setup and Con figuration.......................................................................................................................................16  \n7.3.3. Serial EEPROM  Example.......................................................................................................... ...........................17  \n7.3.3.1  EEPROM Device Operation .........................................................................................................................................17  \n7.3.3.2  EEPROM Size Se lection...............................................................................................................................................19  \n7.3.4. SMI .......................................................................................................................................................................19  \n7.3.5. RMII Port (The  4th Po rt)....................................................................................................... ...............................20  \n7.3.5.1  RMII .............................................................................................................................................................................20  \n7.3.6. Head-Of-Line Blocki ng .......................................................................................................... ..............................20  \n7.3.7. Filtering/Forwarding Rese rved Control Frame.................................................................................... ...............21  \n7.3.8. Loop Det ection ................................................................................................................. ....................................21  \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller iv Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.3.9. Reg.0.14 PHY Digital Loo pback Return to  Internal............................................................................... ..............23  \n7.3.10.  LDO for 1.0V Power Generation.................................................................................................. ...................24  \n7.3.11.  Crystal/Osc illator ............................................................................................................. ...............................24  \n8. ADVANCED FUNCTION DESCRIPTION.................................................................................................. .................25  \n8.1. VLAN  FUNCTION ......................................................................................................................................................25  \n8.1.1. VLAN Description ............................................................................................................... .................................25  \n8.1.2. Port-Based VLAN ................................................................................................................ .................................26  \n8.1.3. IEEE 802.1Q Tagged- VID Based VLAN ..............................................................................................................26  \n8.1.4. Insert/Remove/ Replace Tag...................................................................................................... ............................26  \n8.1.5. Ingress and Eg ress Rules....................................................................................................... ...............................27  \n8.2. IEEE  802.1 P REMARKING FUNCTION .........................................................................................................................27  \n8.3. QOS FUNCTION ..........................................................................................................................................................28  \n8.3.1. Bandwidth Control .............................................................................................................. .................................28  \n8.3.1.1  Output (TX) Bandw idth Control.................................................................................................. .................................28  \n8.3.1.2  Input (RX) Band width Control .....................................................................................................................................29  \n8.3.2. Priority A ssignment............................................................................................................ ..................................29  \n8.3.2.1  Queue Number Selection ......................................................................................................... .....................................29  \n8.3.2.2  Port-Based Priori ty Assignment................................................................................................. ...................................29  \n8.3.2.3  IEEE 802.1p/Q-Based Pr iority A ssignmen t........................................................................................ ..........................30  \n8.3.2.4  DSCP-Based Priori ty Assignment ................................................................................................. ...............................30  \n8.3.2.5  IP Address-Ba sed Priority...................................................................................................... .......................................30  \n8.3.2.6  Reassigned Priority............................................................................................................ ...........................................30  \n8.3.2.7  RLDP-Based Priority....................................................................................................................................................30  \n8.3.2.8  Packet Priority  Selection...................................................................................................... .........................................31  \n8.4. LOOKUP TABLE FUNCTION ........................................................................................................................................32  \n8.4.1. Function Desc ription............................................................................................................................................32  \n8.4.2. Address Search, Learning, and Aging ............................................................................................ ......................32  \n8.4.3. Lookup Tabl e Defin ition........................................................................................................ ...............................34  \n8.5. STORM FILTER FUNCTION ..........................................................................................................................................34  \n8.6. INPUT AND OUTPUT DROP FUNCTION ........................................................................................................................35  \n8.7. LED  FUNCTION ..........................................................................................................................................................36  \n8.8. ENERGY -EFFICIENT ETHERNET (EEE) .......................................................................................................................37  \n8.9. CABLE DIAGNOSIS .....................................................................................................................................................37  \n9. CHARACTERISTICS................................................................................................................ ......................................38  \n9.1. ELECTRICAL CHARACTERISTICS /MAXIMUM RATINGS ...............................................................................................38  \n9.2. OPERATING RANGE ....................................................................................................................................................38  \n9.3. DC CHARACTERISTICS ...............................................................................................................................................38  \n9.4. DIGITAL TIMING CHARACTERISTICS ..........................................................................................................................39  \n9.4.1. RMII Interf ace Ti ming.......................................................................................................... ................................39  \n9.4.1.1  RMII Ti ming.................................................................................................................................................................39  \n9.4.2. LED Timing ..................................................................................................................... .....................................39  \n9.4.3. Reception/Transmission Data Timing of SM I Interface ............................................................................ ...........40  \n9.4.4. EEPROM Auto-Load  Timing........................................................................................................ ........................41  \n10. MECHANICAL DIMENSIONS.................................................................................................................................42  \n10.1. MECHANICAL DIMENSIONS NOTES ............................................................................................................................43  \n11. ORDERING INFORMATION........................................................................................................... ........................43  \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller v Track ID: JATR-8275-15   Rev. 1.0\n \n \nList of Tables \nTABLE 1.   PIN ASSIGNMENTS TABLE ..............................................................................................................................................6  \nTABLE 2.   MEDIA CONNECTION PINS..............................................................................................................................................7  \nTABLE 3.   RMII  PORT MAC  INTERFACE PINS................................................................................................................................7  \nTABLE 4.   MISCELLANEOUS PINS...................................................................................................................................................8  \nTABLE 5.   PORT LED  PINS..............................................................................................................................................................8  \nTABLE 6.   STRAPPING PINS.............................................................................................................................................................9  \nTABLE 7.   LDO  PINS.....................................................................................................................................................................10  \nTABLE 8.   POWER AND GND  PINS................................................................................................................................................10  \nTABLE 9.   BASIC SMI  READ/WRITE CYCLES ................................................................................................................................19  \nTABLE 10. EXTENDED SMI  MANAGEMENT FRAME FORMAT ........................................................................................................19  \nTABLE 11. RESERVED ETHERNET MULTICAST ADDRESSES ...........................................................................................................21  \nTABLE 12. LOOP FRAME FORMAT .................................................................................................................................................22  \nTABLE 13. CRYSTAL AND OSCILLATOR REQUIREMENTS ...............................................................................................................24  \nTABLE 14. VLAN  TABLE ..............................................................................................................................................................25  \nTABLE 15. VLAN  ENTRY .............................................................................................................................................................25  \nTABLE 16. L2 TABLE 4-W AY HASH INDEX METHOD ....................................................................................................................33  \nTABLE 17. ELECTRICAL CHARACTERISTICS /MAXIMUM RATINGS .................................................................................................38  \nTABLE 18. OPERATING RANGE ......................................................................................................................................................38  \nTABLE 19. DC CHARACTERISTICS .................................................................................................................................................38  \nTABLE 20. RMII  TIMING ...............................................................................................................................................................39  \nTABLE 21. LED  TIMING ................................................................................................................................................................39  \nTABLE 22. SMI  TIMING .................................................................................................................................................................40  \nTABLE 23. EEPROM  AUTO-LOAD TIMING CHARACTERISTICS ....................................................................................................41  \nTABLE 24. ORDERING INFORMATION ............................................................................................................................................43  \n \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller vi Track ID: JATR-8275-15   Rev. 1.0\n \n \nList of Figures \nFIGURE 1.   BLOCK DIAGRAM ..........................................................................................................................................................4  \nFIGURE 2.   PIN ASSIGNMENTS ........................................................................................................................................................5  \nFIGURE 3.  COLLISION -BASED BACKPRESSURE SIGNAL TIMING ...................................................................................................11  \nFIGURE 4.   POWER -ON SEQUENCE ................................................................................................................................................15  \nFIGURE 5.   RESET .........................................................................................................................................................................16  \nFIGURE 6.   START AND STOP DEFINITION .....................................................................................................................................18  \nFIGURE 7.   OUTPUT ACKNOWLEDGE ............................................................................................................................................18  \nFIGURE 8.   RANDOM READ...........................................................................................................................................................18  \nFIGURE 9.   SEQUENTIAL READ.....................................................................................................................................................18  \nFIGURE 10. RMII  SIGNAL DIAGRAM .............................................................................................................................................20  \nFIGURE 11. LOOP EXAMPLE ..........................................................................................................................................................21  \nFIGURE 12. LED  AND BUZZER CONTROL SIGNAL FOR LOOP DETECTION .....................................................................................22  \nFIGURE 13. LOOP EXAMPLE 2 .......................................................................................................................................................23  \nFIGURE 14. REG. 0.14  LOOPBACK .................................................................................................................................................23  \nFIGURE 15. PACKET -SCHEDULING DIAGRAM ................................................................................................................................28  \nFIGURE 16. RTL8304MB  PRIORITY ASSIGNMENT DIAGRAM .......................................................................................................29  \nFIGURE 17. BROADCAST INPUT DROP VS . OUTPUT DROP..............................................................................................................35  \nFIGURE 18. MULTICAST INPUT DROP VS . OUTPUT DROP...............................................................................................................35  \nFIGURE 19. FLOATING AND PULL-HIGH OF LED  PINS FOR LED ...................................................................................................36  \nFIGURE 20. RECEPTION DATA TIMING OF SMI  INTERFACE ...........................................................................................................40  \nFIGURE 21. TRANSMISSION DATA TIMING OF SMI  INTERFACE .....................................................................................................40  \nFIGURE 22. EEPROM  AUTO-LOAD TIMING ..................................................................................................................................41  \n \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 1 Track ID: JATR-8275-15   Rev. 1.0\n \n \n1. General Description \nThe RTL8304MB-CG is a 4-port 10/ 100M Ethernet switch c ontroller that integrates memory, four \nMACs, and three physical layer tran sceivers for 10Base-T and 100Base-TX  operation into a single chip. \nIt supports an RMII interface for external devices to connect to the 4th MAC. The external device could \nbe a routing engine, HomePNA, Ho mePlug, or VDSL transceiver dependi ng on the application. In order \nto accomplish diagnostics in complex network syst ems, the RTL8304MB provides a loopback feature in \neach port. \n \nThe RTL8304MB supports several advan ced QoS functions with four-level priority queues to improve \nmultimedia or real-time networking applications, including: \n• Multi-priority assignment \n• Differential queue weight \n• Port-based rate limitation \n• Queue-based rate limitation \n \nThe RTL8304MB supports 16 VLAN groups. These can be configured as port-based VLANs and/or \n802.1Q tag-based VLANs. The RTL8304MB also suppo rts VLAN learning, with four Independent \nVLAN Learning (IVL) filtering databa ses. The RTL8304MB contains a 2K -entry address lookup table. A \n4-way associative hash algorithm avoids hash co llisions and maintains forwarding performance. \nMaximum packet length can be 2048 bytes. Three types of independent storm filte r are provided to filter \npacket storms, and an intelligent switch engine prevents Head-of-Li ne blocking problems. \n The RTL8304MB supports Energy-Efficient Ethernet mode (EEE; defined in IEEE 802.3az) to minimize \nsystem power consumption. Energy-Efficient Ethernet  supports Low Power Idle Mode. When Low Power \nIdle Mode is enabled, systems on both sides of the li nk can disable portions of th e functionality and save \npower during periods of  low link utilization. \n To simplify the peripheral power ci rcuit, the RTL8304MB integrates on e LDO regulator to generate 1.0V \nfrom a 3.3V input power, and needs only one external diode. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 2 Track ID: JATR-8275-15   Rev. 1.0\n \n \n2. Features \nBasic Switching Functions \n\x84 4-port switch controller with memory and \ntransceiver for 10Base-T and 100Base-TX \n\x84 Non-blocking wire-speed reception and transmission and non-head-of-line-blocking forwarding \n\x84 Complies with IEEE 802.3/802.3u auto-negotiation \n\x84 Built-in high efficiency SRAM for packet buffer, with 2K-entry  lookup table and two \n4-way associative hash algorithms \n\x84 2048 byte maximum packet length \n\x84 Flow control fully supported \n\x8b Half duplex: Back pressure flow control \n\x8b Full duplex: IEEE 802.3x flow control \n\x84 Supports RMII interface for embedded system such as set top box or TV box. \n\x8b RMII REFCLK output or input \nService Quality \n\x84 Supports high performance QoS function on \neach port \n\x8b Supports 4-level priority queues \n\x8b Weighted round robin service \n\x8b Supports strict priority \n\x8b Input/Output port bandwidth control \n\x8b Queue-based bandwidth control \n\x8b 1Q-based, Port-based, DSCP-based, IP address-based, and other types of priority assignments \n\x84 Supports IEEE 802.1p Traffic Re-marking Security and Management \n\x84 Supports reserved control frame filtering \n\x84 Supports advanced storm filtering \n\x84 Optional EEPROM interface for \nconfiguration \nVLAN Functions \n\x84 Supports up to 16 VLAN groups \n\x84 Flexible 802.1Q port/tag-based VLAN \n\x84 Supports four IVLs \n\x84 Leaky VLAN for \nunicast/multicast/broadcast/ARP packets \nPower Saving Functions \n\x84 Supports Energy-Efficient Ethernet (EEE) \nfunction (IEEE 802.3az) \n\x84 Link Down Power Saving Mode \nDiagnostic Functions \n\x84 Supports hardware loop detection function \nwith LEDs and buzzer to indicate the \nexistence of a loop \n\x84 Supports cable diagnosis (RTCT function) \n\x84 Flexible LED indicators \n\x8b RTCT status indication \n\x8b Loop status indication \n\x8b LEDs blink upon reset for LED diagnostics \nOther Features \n\x84 Optional MDI/MDIX auto crossover for \nplug-and-play \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 3 Track ID: JATR-8275-15   Rev. 1.0\n \n \n\x84 Physical layer port Polarity Detection and \nCorrection function \n\x84 Robust baseline wande r correction for \nimproved 100Base-TX performance \n\x84 25MHz crystal or 3.3V OSC input \x84 Single 3.3V power input can be transformed by integrating an LDO regulator to generate 1.0V from 3.3V via a low-cost external Diode \n\x84 Low power, 1.0/3.3V, 55nm CMOS technology \n\x84 48-pin QFN ‘Green’ package \n \n \n3. System Applications \n\x84 4-port switch (10Base-T & 100Base-TX) \n\x84 Set-top box or TV box \n  \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 4 Track ID: JATR-8275-15   Rev. 1.0\n \n \n4. Block Diagram \n \nFigure 1.   Block Diagram \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 5 Track ID: JATR-8275-15   Rev. 1.0\n \n \n5. Pin Assignments \n5.1. Pin Assignments Diagram \n \n  \nFigure 2.   Pin Assignments \n \n5.2. Package Identification \nGreen package is indicated by a ‘G’ in the location marked ‘TXXXX’ in Figure 2. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 6 Track ID: JATR-8275-15   Rev. 1.0\n \n \n5.3. Pin Assignments Table \n‘Type’ codes used in the following table: A=An alog, G=Ground, I=Input, O=Output, I/O=Input/Output, \nPU=Pin with Pull-Up Resistor, PD=Pin with Pull-Down Resistor. \nTable 1.   Pin Assignments Table \nName Pin No. Type \nTXOP[1] 1 AI/O \nTXON[1] 2 AI/O \nRXIN[1] 3 AI/O \nRXIP[1] 4 AI/O \nAV D D L  5  A P  \nDVDDL 6 P \nAV D D L  7  A P  \nRXIP[2] 8 AI/O \nRXIN[2] 9 AI/O \nTXON[2] 10 AI/O \nTXOP[2] 11 AI/O \nA VDDH 12 AP \nDUP_STA 13 I/O PD \nSPD_STA 14 I/O PD \nTXD[1]/CLK_DIR 15 I/O PD \nTXD[0]/IF_SEL[0] 16 I/O PD \nTXEN 17 I/O PD \nIF_SEL[1] 18 I/O PD \nDVDDH 19 P \nREFCLK 20 I/O PD \nCRS_DV 21 I/O PD \nRXD[0] 22 I/O PD \nRXD[1] 23 I/O PD \nDVDDL 24 P \nRMII_LINK_STA 25 I/O PD Name Pin No. Type \nINT/FCTRL_STA 26 I/O PU \nSCL/MDC 27 I/O PU \nSDA/MDIO 28 I/O PU \nRESETB 29 IPU \nLDIND/DIS_LD 30 I/O PU \nP0LED/DIS_EEE 31 I/O PD \nDVDDH 32 P \nP1LED/RMA_MODE 33 I/O PD \nP2LED/UNKOWN_MULTI 34 I/O PD \nDVDDL 35 P \nV10OUT 36 AO \nV33IN 37 AP \nA VDDHPLL 38 AP \nXO 39 O \nXI 40 I \nA VDDLPLL 41 AP \nIBREF 42 AO \nA VDDL 43 AP \nRXIP[0] 44 AI/O \nRXIN[0]] 45 AI/O \nTXON[0] 46 AI/O \nTXOP[0] 47 AI/O \nA VDDH 48 AP \nE-PAD E-PAD G \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 7 Track ID: JATR-8275-15   Rev. 1.0\n \n \n6. Pin Descriptions \n6.1. Pin Assignment Codes \nI: Input Pin AI: Analog Input Pin \nO: Output Pin AO: Analog Output Pin \nI/O: Bi-Directional Input/Output Pin AI/O : Analog Bi-Directional Input/Output Pin \nP: Digital Power Pin AP: Analog Power Pin \nG: Digital Ground Pin AG: Analog Ground Pin \nIPU: Input Pin With Pull-Up Resistor;  \n(Typical Value is about 75K Ω) OPU: Output Pin With Pull-Up Resistor;  \n(Typical Value is about 75K Ω) \nIPD: Input Pin With Pull-Down Resistor;  \n(Typical Value is about 75K Ω) OPD: Output Pin With Pull-Down Resistor;  \n(Typical Value is about 75K Ω) \nI/O PU: IPU and O PU I/O PD:IPD and O PD \n \n6.2. Media Connection Pins \nTable 2.   Media Connection Pins \nPin Name Pin No. Type Drive (mA) Description \nRXIP2/RXIN2 \nRXIP1/RXIN1 \nRXIP0/RXIN0 8, 9 \n4, 3 \n44,45 AI/O - Differential Receive Data Input. \nPort0-2 support 10Base-T, 100Base-TX. \nTXOP2/TXON2 TXOP1/TXON1 \nTXOP0/TXON0 11, 10 \n1,2 \n47, 46 AI/O - Differential Transmit Data Output. \nPort0-2 support 10Base-T, 100Base-TX. \n \n6.3. RMII Port MAC Interface Pins \nTable 3.   RMII Port MAC Interface Pins \nPin Name Pin No. Type Description Default \nRXD[1:0]  23, 22,  I/O PD Pins receive data of MAC. - \nCRS_DV 21 I PD Pin is used as CRS_DV . - \nREFCLK 20 I/O PD Pin is used as REFCLK output or input based on configuration. - \nTXD[1:0] 15, 16,  I/O PD Pins transmit data of MAC. - \nTXEN 17 I/O PD Pin is used as TXEN - \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 8 Track ID: JATR-8275-15   Rev. 1.0\n \n \nPin Name Pin No. Type Description Default \nRMII_LNK_STA 25 I PD Provides RMII port (4th port) Link Status for MAC module in real \ntime. \nThis pin sets the link status of the RMII port MAC module in real-\ntime. \n0: MAC3 is  link down \n1: MAC3 is link up 0 \n \n6.4. Miscellaneous Pins \nAs the output of the RTL8304MB is 3.3V, the seri al EEPROM and external device must be 3.3V \ncompatible. \nTable 4.   Miscellaneous Pins \nPin Name Pin No. Type Drive (mA) Description \nLDIND 30 I/O PU 10 Loop Indication Used by LED and Buzzer. \nINT 26 I/O PU 4 Setting any flag bit in the interrupt event flag register will cause this \npin to be pulled low and output logical ‘0’. Only when all flag bits in \nthe interrupt event flag register are cleared, this pin will be pulled high and output logical ‘1’. \nSCL/MDC 27 I/O PU 4 I2C Interface Clock for EEPROM Auto Load when Power On. \nAfter power on, this pin is MD C/MDIO Interface Clock for access \nregisters. \nSDA/MDIO 28 I/O PU 4 I2C Interface Data Input/Output for EEPROM Auto Load when \nPower On. \nAfter power on, this pin is MDC/MDIO Interface Data Input/Output \nfor access registers. \nRESETB 29 I PU - System Pin Reset Input. \nXI 40 AI - 25MHz Crystal Clock Input. \nThe clock tolerance is ±50ppm. \nXO 39 AO - 25MHz Crystal Clock Output Pin. \nWhen the pin of XI is using an oscillator this pin should be floating. \nIBREF 42 AO - Reference Resistor for PHY Bandgap. \nA 2.49KΩ (1%) resistor should be connected between IBREF and \nGND. \n \n6.5. Port LED Pins \nAll LED statuses are represented as activ e-low or high dependi ng on input strapping. \nThose pins that are dual-function pins are out put for LED, or input for strapping. Below are LED \ndescriptions only. \nTable 5.   Port LED Pins \nPin Name Pin No. Type Drive (mA) Description \nP0LED 31 I/O PD 10 LED for Port0 Status Indication. \nP1LED 33 I/O PD 10 LED for Port1 Status Indication. \nP2 LED 34 I/O PD 10 LED for Port2 Status Indication. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 9 Track ID: JATR-8275-15   Rev. 1.0\n \n \n6.6. Strapping Pins \nPins that are dual function pins are outputs for LED or inputs for strapping. Below are strapping \ndescriptions only. \nTable 6.   Strapping Pins \nPin Name Pin No. Type Default Description \nDISLD \n(LDIND) 30 I/O PU - Disable Loop Detection Function. \n0: Enable \n1: Disable (default) \nDIS_EEE \n(P0LED) 31 I/O PD - Disable EEE Function. \n0: Enable EEE function (default) \n1: Disable EEE function \nRMAMODE \n(P1LED) 33 I/O PD - RMA Mode Select. \n0: Mode0 is selected (default) \n01-80-c2-00-00-02 is drop and 01-80-c2-00-00-11 ~ \n01-80-c2-00-00-1F, 01-80-c2-00-00-21 packets are \nforwarded. \n1: Mode1 is selected \n01-80-c2-00-00-02 is forward and 01-80-c2-00-00-11 ~ \n01-80-c2-00-00-1F, 01-80-c2-00-00-21 packets are \ndropped. \nUNKOWN_MULTI \n(P2LED) 34 I/O PD - Enable Unknown Multicast Data Packet Drop. \n0: Forward all unknown multicast data packet (default) \n1: Drop all unknown multicast data packet (except \nIGMP/MLD and RMA packet) \nCLK_DIR \n(TXD1) 15 I/O PD - RMII Interface REFCLK Direction Select \n0: REFCLK is input 1: REFCLK outputs 50MHz clock. \nIF_SEL[0] (TXD0) 16 I/O\nPD - MAC3 Interface Select. \n00: Disable MAC3 interface(default) 01: Reserved \n10: Reserved 11: RMII interface \nIF_SEL[1] \n 18 I/O PD - MAC3 Interface Select. \n00: Disable MAC3 interface(default) \n01:Reserved 10: Reserved \n11: RMII interface \nSPD_STA  14 I/O\nPD - Force MAC3 Speed. \n0: MAC3 is 10Mbps 1: MAC3 is 100Mbps, \nDUP_STA  13 I/O\nPD - Force MAC3 Duplex. \n0: MAC3 is half duplex 1: MAC3 is full duplex \nFCTRL_STA (INT) 26 I/O\nPU - Force MAC3 Flow Control. \n0: MAC3 is disabled 1: MAC3 is enabled \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 10 Track ID: JATR-8275-15   Rev. 1.0\n \n \n6.7. LDO Pins \nTable 7.   LDO Pins \nPin Name Pin No. Type Drive (mA) Description \nV10OUT 36 AO - LDO 1.0V Output. \nV33IN 37 AP - LDO 3.3V Input. \n \n6.8. Power and GND Pins \nTable 8.   Power and GND Pins \nPin Name Pin No. Type Description \nA VDDH 12, 48 AP Analog Power 3.3V . \nA VDDL 5, 7, 43 AP Analog Power 1.0V . \nA VDDHPLL 38 AP Power 3.3V for PLL. \nA VDDLPLL 41 AP Power 1.0V for PLL. \nDVDDH 19, 32 P Digital Power 3.3V for IO Pin. \nDVDDL 6, 24, 35 P Digital Power 1.0V for Core V oltage. \nGND E-PAD G Ground for Whole Chip. \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 11 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7. Basic Functional Description \n7.1. Switch Core Function Overview \n7.1.1.  Flow Control \nThe RTL8304MB supports IEEE 802.3x full duplex flow c ontrol, force mode full duplex flow control, \nand optional half duplex backpressure. \n7.1.1.1  IEEE 802.3x Full Duplex Flow Control \nFor UTP with auto-negotiati on ability, the pause ability of full duplex flow contro l is enabled by internal \nregisters via SMI on a pe r-port basis after reset. IEEE 802.3x flow control’s ab ility is auto -negotiated \nbetween the remote device and the RTL8304MB. If the auto-negotiation result of the IEEE 802.3x pause \nability is ‘Enabled’, the full dupl ex 802.3x flow control function is en abled. Otherwise, the full duplex \nIEEE 802.3x flow control function is disabled. \n7.1.1.2  Half Duplex Back Pressure \nThere are two mechanisms for half duplex backpressure; col lision-based or carrier-based. \nCollision-Based Backpressure (Jam Mode) \nIf the buffer is ready to overflow, this mechanism will force a collision. When the link partner detects this \ncollision, the transmi ssion is rescheduled. \nThe Reschedule procedure is: \n• The RTL8304MB will drive TXEN to high and send the preamble; SFD and a 4-byte Jam signal \n(pattern is 0xAA). The RTL8304MB will then drive TXEN to low \n• When the link partner receives the Jam signal, it will feedback a 4-byte signal (pattern is CRC^0x01), \nit will then drive RXDV to low \n• The link partner waits for a random back-off time th en re-sends the packet. The timing is shown in \nFigure 3 \n \nFigure 3.  Collision-Based Backpressure Signal Timing \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 12 Track ID: JATR-8275-15   Rev. 1.0\n \n \nCarrier-Based Backpressure (Defer Mode) \nIf the buffer is about to overflow, this mechanism will send an 0xAA pattern to defer the other station’s \ntransmission. The RTL8304MB will continuously send the defer signal until the buffer overflow is \nresolved. \n7.1.2.  Address Search, Learning, and Aging \nWhen a packet is received, the RTL8304MB will use the destination MAC address and FID to index the \n2048-entry lookup table. If the indexed entry is vali d, the received packet will be forwarded to the \ncorresponding destination port. Otherwise, the R TL8304MB will broadcast the packet. This is the \n‘Address Search’. \nThe RTL8304MB then combines the source MAC address and the FID to index the 2048-entry lookup \ntable. If the entry is not in the table it will record  the source MAC address and add switching information. \nIf this is an occupied entry, it will update the entr y with new information when LRU is enabled. This is \ncalled ‘Learning’.  \nAddress aging is used to keep the contents of the address table correct in  a dynamic network topology. \nThe lookup engine will update the time stamp informa tion of an entry whenever the corresponding source \nMAC address appears. An entry will be  invalid (aged-out) if  its time stamp information is not refreshed \nby the address learning process during the aging time period. The ag ing time of the RTL8304MB is \nbetween 200 and 400 seconds. \n7.1.3.  Half Duplex Operation \nIn half duplex mode, the CSMA/CD media access method is the means by which two or more stations \nshare a common transmission medium. To transmit, a station waits (defers) fo r a quiet period on the \nmedium (that is, no other station is transmitting) and then  sends the intended message in bit-serial form. If \nthe message collides with that of another station, then each transmitting station intentionally transmits for \nan additional predefined period to ensure propagation of the collision throughout the system. The station remains silent for a random amount of time (b ackoff) before attempting to transmit again. \nWhen a transmission attempt has terminated due to a collision, it is retried until it is successful. A \ncontrolled randomization process called ‘truncated binary exponential ba ckoff’ determines the scheduling \nof the retransmissions. At the end of enforcing a co llision (jamming), the switch delays before attempting \nto retransmit the frame. The delay is an integer multiple of slot time (512 bit times). The number of slot times to delay before the n\nth retransmission attempt is chosen as a uniformly distributed random integer \n‘r’ in the range: \n0 ≤ r < 2k \nwhere: k = min (n, backoffLimit). IEEE 802.3 defines the backoffLimit as 10. \n7.1.4.  InterFrame Gap \nThe InterFrame Gap is 9.6µs for 10Mbps Ethe rnet and 960ns for 100Mbps Fast Ethernet. \n7.1.5.  Illegal Frame \nIllegal frames such as CRC error packets, runt pack ets (length < 64 bytes), and oversize packets (length > \nmaximum length), will be discarded. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 13 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.2. Physical Layer Functional Overview \n7.2.1.  Auto-Negotiation \nThe RTL8304MB obtains the states of duplex, speed, an d flow control ability for each port through the \nauto-negotiation mechanism defined in the IEEE 802.3 specifications. During auto -negotiation, each port \nadvertises its ability to its link partner and compares its ability with advertisem ents received from its link \npartner. By default, the RTL8304MB advertises full capabilities (100Full,  100Half, 10Full, 10Half) \ntogether with flow control ability. The RTL8304MB al so advertises the Energy Efficient Ethernet (EEE) \ncapability to the link partner. \n7.2.2.  10Base-T Transmit Function \nThe output 10Base-T waveform is Manchester-encoded be fore it is driven onto the network media. The \ninternal filter shapes the driven signals to reduce EMI emissions, eliminating the need for an external \nfilter. \n7.2.3.  10Base-T Receive Function \nThe Manchester decoder converts the incoming serial  stream to NRZ data when the squelch circuit \ndetects the signal level is above squelch level. \n7.2.4.  Link Monitor \nThe 10Base-T link pulse detection ci rcuit continually monitors the RXIP/RXIN pins for the presence of \nvalid link pulses. Auto-polarity is implemented to correct the detected reve rse polarity of RXIP/RXIN \nsignal pairs. \n7.2.5.  100Base-TX Transmit Function \nThe 100Base-TX transmit function performs parallel  to serial conversion, 4B/5B coding, scrambling, \nNRZ/NRZI conversion, and MLT-3 enc oding. The 5-bit serial data str eam after 4B/5B coding is then \nscrambled as defined by the TP-PMD Stream Cipher function to flatten the power spectrum energy such \nthat EMI effects are significantly reduced.  \nThe scrambled seed is based on PHY addresses and is unique for each port. After scrambling, the bit \nstream is driven into the network media in the form of MLT-3 signaling. The MLT-3 multi-level \nsignaling technology moves the power spectrum energy from high frequency to low frequency, which \nfurther reduces EMI emissions. \n7.2.6.  100Base-TX Receive Function \nThe receive path includes a receiver composed of an  adaptive equalizer and DC  restoration circuits (to \ncompensate for an incoming distorted MLT-3 signal), an MLT-3 to NRZI and NR ZI to NRZ converter to \nconvert analog signals to digital bit- stream, and a PLL circuit to clock data bits with minimum bit error \nrate. A De-scrambler, 5B/4B decoder, and serial-to- parallel conversion circu its are followed by the PLL \ncircuit. Finally, the converted parallel data is fed into the MAC. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 14 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.2.7.  Power-Down Mode \nThe RTL8304MB implements power-down mode on a per-port basis. Setti ng MII Reg.0.11 forces the \ncorresponding port of the RTL8304MB to enter powe r-down mode. This disabl es all transmit/receive \nfunctions, except SMI (Serial Management Interf ace: MDC/MDIO, also known as MII Management \nInterface). \n7.2.8.  Crossover Detection and Auto Correction \nDuring the link setup phase, the RTL8304MB checks wh ether it receives active signals on every port in \norder to determine if a connection can be established. In cases where the receiver data pin pair is \nconnected to the transmitter data pin pair of the peer device and vice versa, the RTL8304MB automatically changes its configuration and swaps rece iver/transmitter data pins as required. If a port is \nconnected to a PC or NIC with MDI-X interf ace with a crossover cable , the RTL8304MB will \nreconfigure the port to ensure proper connecti on. This replaces the DIP switch commonly used for \nreconfiguring a port on a hub or switch. \nNote: IEEE 802.3 compliant forced mode 100M ports w ith Auto-crossover have link problems with NWay \n(Auto-Negotiation) ports. It is recommended to  not use Auto-crossover for forced 100M. \n7.2.9.  Polarity Detection and Correction \nFor better noise immunity and lower interference to ambient devices, the Ethern et electrical signal on a \ntwisted-pair cable is transmitted in differential form. Th at is, the signal is transmitted on two wires in each \ndirection with inverse polar ities (+/-). If wiring on the connector is faulty, or a faulty transformer is used, \nthe two inputs to a transceiver may carry signals w ith opposite but incorrect polarities. As a direct \nconsequence, the transceive r will not work properly. \nWhen the RTL8304MB operates in 10Base-T mode, it au tomatically reverses the polarity of its two \nreceiver input pins if it detects that the polarities  of the incoming signals on the pins is incorrect. \nHowever, this feature is unnecessary when the RTL8304MB is operating in 100Base-TX mode. \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 15 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.3. General Function Overview \n7.3.1.  Power-On Sequence \nTwo power voltage types are required for RTL 8304MB normal operation, 3.3V and 1.0V. The 1.0V is \nconverted from 3.3V via the LDO of the RTL8304MB. \n• Ta is the moment when 3.3V power is higher than  2.6V (±5%). 3.3V power never falls lower than \n2.6V (±5%) after Ta \n• Tb is the moment when 1.0V power is higher than  0.71V (±10%). 1.0V power never falls lower than \n0.71V (±10%) after Tb \n• Tc is the moment when both 3.3V and 1.0V power are stable (the voltage is always in the legal \noperating range) \n• Td is the moment that the pin reset signal is de-asserted \n• Te is the moment that the RTL8304MB device is ready to be accessed by an external CPU \n \nFigure 4.   Power-On Sequence \n \nThe requirements are: \n• The time of Ta should be between 500us and 20ms \n• The sequence of Ta is always less than Tb for th e LDO of the RTL8304MB. In principle, the sequence \nof Td and Ta/Tb/Tc is also not require d. The sequence of Td > 5ms is recommended \n• The time from Te to the later of Ta/Tb/Td is the sum of the time of the EEPROM loading + 30ms. The \nEEPROM loading time varies according to the au toloaded data bytes in the serial EEPROM \n• Reset \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 16 Track ID: JATR-8275-15   Rev. 1.0\n \n \nDepending on the type of reset, the whole or just part of the RTL8304M B is initialized. There are several \nways to reset the RTL8304MB. \n• Hardware reset for the whole chip via pin RESET# or power-on \n• Soft reset for packet buffer, queue, an d MIB counter via register SoftReset \n• PHY software reset for each PHY by register reset \nHardware Reset: Power-on, or pull th e RESET# pin low for at least 1 µs. The RTL8304MB resets the \nwhole chip and after all power is rea dy and the RESET# pin is de-asserted, it gets initial values from pins \nand serial EEPROM. \nSoft Reset: The RTL8304MB does not reset the LUT, LED circuit, and all registers, and does not load \ndata from serial EEPROM and pins to registers. The packet buffer, que ue, and MIB counter will be reset. \nAfter changing the queue number via SMI (Serial Management Interface), the external device must \nperform a soft reset in orde r to update the configuration. \nPHY Software Reset: Write bit15 of Reg0 of a P HY as 1. The RTL8304MB will then reset this PHY.  \nHardware Reset\nStrap pin\nupon resetLoad EEPROM\nupon reset \nFigure 5.   Reset \n \nSome setting values for operation m odes are latched from those corresponding mode pins upon hardware \nreset. ‘Upon reset’ is defined as a short time af ter the end of a hardware reset. Other advanced \nconfiguration parameters may be latched from serial EEPROM. \n7.3.2.  Setup and Configuration \nThe RTL8304MB can be configured easily and flexibly by: \n• Hardware pins upon reset \n• Optional serial EEPROM upon reset (contact Realte k for detailed EEPROM c onfiguration settings) \n• Internal registers (including PHY registers for eac h port and global MAC registers) accessed via SMI \n(Serial Management Interface: MDC/MDIO, also known as MII Management Interface) \nThere are three methods of configuration: • Only hardware pins for normal switch applications \n• Hardware pins and serial EEPROM for advanced switch applications \n• Hardware pins and internal registers vi a SMI for applications with processor \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 17 Track ID: JATR-8275-15   Rev. 1.0\n \n \nTwo types of pins, each with internal pull-high or pull-low resistors, are used for configuration: \n• Input/Output pins used for strapping upon rese t and used as output  pins after reset \n• Input/Output pins used for strappi ng upon reset and used as LED indicat or pins after reset. The LED \nstatuses are represente d as active-low or high depending on input strapping \nPins with default value=0 are internal pull-low and use I/O pads. They can be left floating to set the input \nvalue as low, but should not be connect ed to VDD without a pull-high resistor. \nThe serial EEPROM shares two pins, SCL/MDC and SDA/MDIO, with SMI, and is optional for \nadvanced configuration. SCL/MDC a nd SDA/MDIO are tri-state during ha rdware reset (pin RESET#=0). \nThe RTL8304MB will try to automatically find the serial EEPROM upon reset. \nInternal registers can still be accessed after rese t via SMI (pin SCL/MDC and SDA/MDIO). Serial \nEEPROM signals and SMI signals must not exist at the same time. \n7.3.3.  Serial EEPROM Example \nBoth the 24LC01/02/04/08/16 and 24C01/02/04/08/16 can be used with the RTL8304MB. The interface \nis a 2-wire serial EEPROM interf ace providing 1K/2K/4K/8K/16K bits  of storage space. The EEPROM \nmust be 3.3V compatible. \n7.3.3.1  EEPROM Device Operation \nClock and Data Transitions: The SDA pin is normally pulled high with an external resistor. Data on the \nSDA pin may change only during SCL low time peri ods. Data changes during SCL high periods will \nindicate a start or stop condition as defined below. Th e SCL frequency is 200 kHz. \nStart Condition \nA high-to-low transition of SDA with SCL high is the start condition and must precede any other \ncommand. \nStop Condition \nA low-to-high transition of SDA with SCL high is a stop condition. \nAcknowledge All addresses and data are transmitted serially to  and from the EEPROM in 8-bit words. The EEPROM \nsends a zero to acknowledge that it has received each word. This happens during the ninth clock cycle. \nRandom Read A random read requires a ‘dummy’ byte write sequ ence to load in the data word address. \nSequential Read For the RTL8304MB, the sequential reads are initiated by a random a ddress read. After the EEPROM \nreceives a data word, it responds with an acknowledgement. As long  as the EEPROM receives an \nacknowledgement, it will continue to increment the data word address and clock out sequential data \nwords in series. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 18 Track ID: JATR-8275-15   Rev. 1.0\n \n \n \nFigure 6.   Start and Stop Definition \n \n \n \nFigure 7.   Output Acknowledge \n \n \n \nFigure 8.   Random Read \n \n \nSDADevice \nAddressStop\nNO ACKData n+x Data n +1 Data n\nACK R/WRead ACK ACK\nACK ACK \nFigure 9.   Sequential Read \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 19 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.3.3.2  EEPROM Size Selection \nThe RTL8304MB supports five serial EEPROM sizes —1k bits, 2k bits, 4k bits, 8k bits and 16k bits. Via \nthe auto-download operation, the RTL8304MB decides the size of the data downloaded to the RTL8304MB from the EEPROM according to the value of the 2\nnd byte data in the serial EEPROM. \nIf the 2nd byte data = 0x01, 0x02, 0x04, 0x08 or 0x16, it means the data size is 1k bits, 2k bits, 4k bits, 8k \nbits or 16k bits respecti vely. The value of the 2nd byte should accord with the actual EEPROM data size. \nFor example, the value of the 2nd byte cannot be ‘0x02’ when the 24(L)C02 is used. \n7.3.4.  SMI \nThe SMI (Serial Management Interface)  is also known as the MII Manage ment Interface, and consists of \ntwo signals (MDIO and MDC). It allows external de vices with SMI master mode (MDC is output) to \ncontrol the state of the PHY and in ternal registers (SMI slave mode: MDC is input). MDC is an input \nclock for the RTL8304MB to latch MDIO on its ri sing edge. The clock can run from DC to 2.5MHz. \nMDIO is a bi-directional connection used to write data to, or read data from the RTL8304MB. The PHY \naddress is from 0 to 7. \nTable 9.   Basic SMI Read/Write Cycles \n Preamble \n(32 bits) Start \n(2 bits) OP Code \n(2 bits) PHYAD \n(5 bits) REGAD \n(5 bits) Turn Around \n(2 bits) Data \n(16 bits) Idle \n \nRead 1……..1 01 10 A 4A3A2A1A0 R4R3R2R1R0 Z0 D 15…….D 0 Z* \nWrite 1……..1 01 01 A 4A3A2A1A0 R 4R3R2R1R0 10 D 15…….D 0 Z* \n*: High-impedance. During idle time MDIO state is determined by an external 1.5K Ω pull-up resistor. \n \nFor MDIO Manageable Device (MMD) access, the RTL8304MB supports the extended SMI format. \nTable 10. Extended SMI Management Frame Format \nFrame PRE ST OP PHYAD DEV AD TA DATA IDLE\nAddress 1…1 00 00 AAAAA EEEEE 10 AAAAAAAAAAAAAAAA Z \nWrite 1…1 00 01 AAAAA EEEEE 10 DDDDDDDDDDDDDDDD Z \nRead 1…1 00 11 AAAAA EEEEE Z0 DDDDDDD DDDDDDDDD Z \nPost-Read-Increment-Address 1…1 00 10 AAAAA EEEEE Z0 DDDDDDDDD DDDDDDD Z \n To guarantee the first successful SMI transaction afte r power-on reset, the extern al device should delay a \nfew moments before issuing the first SMI Read/Write Cycle relative to the ri sing edge of reset.  \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 20 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.3.5.  RMII Port (The 4th Port) \nThe RTL8304MB is a 3-port Fast Ethe rnet switch with one extra RMII port for specific applications. It \nintegrates embedded SRAM for packet storage, four  MACs, and three physical layer transceivers for \n10Base-T and 100Base-TX, into a single chip. \n7.3.5.1  RMII \nRMII (Reduced MII) is used in 10/100Mbps mode only. The reference clock pin of the RTL8304MB’s \nRMII can be configured to output a 50MHz clock, or be driven by an external clock source. Figure 10 \nshows the RTL8304MB output a 50MHz clock signal diagram.  \nTXENTXD [1:0]\nREFCLKRXD[1 :0]\nCRS_DVRXD [1:0]\nREFCLKTXENTXD[1:0]\nCRSDVRMII External CPU or PHY RTL8304MB\n50MHz\n \nFigure 10. RMII Signal Diagram \n \n7.3.6.  Head-Of-Line Blocking \nThe RTL8304MB incorporates a mechanism to prev ent Head-Of-Line blocking problems when flow \ncontrol is disabled. When the flow control func tion is disabled, the RTL8304MB first checks the \ndestination address of the incoming packet. If the destination por t is congested, the RTL8304MB will \ndiscard this packet to avoid bl ocking the next packet, which is  going to a non-congested port. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 21 Track ID: JATR-8275-15   Rev. 1.0\n \n \n7.3.7.  Filtering/Forwarding Reserved Control Frame \nThe RTL8304MB supports the ability to forward or drop the frames of the IEEE 802.1 specified reserved \nEthernet multicast addresses. \nTable 11. Reserved Ethernet Multicast Addresses \nB: Broadcast (Search the Look-Up Table) D: Drop \nAssignment Value Available Action \nBridge Group Address 01-80-C2-00-00-00 D, B (Default) \nIEEE Std 802.3, 1988 Ed ition, Full Duplex PAUSE \nOperation 01-80-C2-00-00-01 D (Default), B \nIEEE 802.3ad Slow_Protocols-Multicast Ad dress 01-80-C2-00-00 -02 D (Default), B \nIEEE 802.1X PAE Addr ess 01-80-C2-00-00-03 D, B (Default) \nReserved for Future Standards 01-80-C2-00-00-04~01-80-C2-00-00-0D, \n01-80-C2-00-00-0F D (Default), B \nLLDP IEEE Std 802.1AB Link Layer Discovery \nProtocol Multicast Address 01-80-C2-00-00-0E D, B (Default) \nAll LANs Bridge Management Group Address 01-80-C2-00-00-10 D (Default), B \nReserved for 01-80-C2-00-00-1x 01-80-C2-00-00-11~01-80-C2-00-00-1F D, B (Default) \nGMRP Address 01-80-C2-00-00-20 D (Default), B \nGVRP Address 01-80-C2-00-00-21 D, B (Default) \nReserved for use by Multiple Registration Protocol \n(MRP) Applications 01-80-C2-00-00-22~01-80-C2-00-00-2F D (Default), B \n802.1ag PDU CCM/LTM 01-80-C2-00-00-31~ 01-80-C2-00-00-3F D, B (Default) \n \n7.3.8.  Loop Detection \nLoops should be avoided between sw itch applications. The simplest lo op as shown below results in: \n1) Unicast frame duplication; 2) Broadcast frame multiplication; 3) Address table non-convergence. \nFrames are transmitted from Switch1 to Switch 2 via Link 1, and then returned to Switch 1 via Link 2. \n \nFigure 11. Loop Example \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 22 Track ID: JATR-8275-15   Rev. 1.0\n \n \nThe loop detect function can be enabled/disabled via strapping pin or registers. When the loop detection \nfunction is enabled, the RTL8304MB sends out a broadcast 64-byte loop frame (the frequency is \nconfigured by register) and sniffs for the sent loop frame on each port to detect whether there is a network \nloop (or bridge loop). If a loop is  detected, the RTL8304MB will driv e the external LEDs and buzzer \nalarm. \n• The LED driven by the LDIND pin will blink \n• The LEDs driven by port LED pins (see Table 5, page  8) of the ports on which the network loop is \ndetected will all blink simultaneously \n• The buzzer driven by the LDIND pin will buzz at the same frequency as the LED blinks \nBoth passive and active buzzers can be supported. Th e resonant frequency for the passive buzzer is \napproximately 2kHz. The buzzer and all LEDs will turn  on/off simultaneously. In Figure 12, T1 is the \nturned-off period and T2 is the turned-on period. T1 and T2 are equal and can be configured to 400ms or \n800ms. \n \nFigure 12. LED and Buzzer Control Signal for Loop Detection \n \nLoop status, LED, and buzzer indications can be cleared when one of the following conditions occurs. \n• Loop frame is not detected in the next loop detection period \n• The loop port links down \nThe Loop frame length is 64 bytes. Its format is shown below. \nTable 12. Loop Frame Format \n48-bit 48-bit 16-bit 16-bit 12-bit 4-bit 352-bit 16-bit \nFFFF FFFF FFFF SID 8899 2300 000 TTL 0000 CRC \n \nIn order to achieve loop detecti on, each switch device needs a unique SID (the source MAC address). If \nan EEPROM is not used, a unique SID should be assigned via SMI afte r reset. The TTL (Time-To-Live) \nfield is used to avoid a storm triggered by the loop frame. The TTL field in the loop frame will decrease \nby 1 when it passes through an RTL8304MB whose MAC a ddress is not equal to the SID of the loop \nframe. The RTL8304MB will drop a loop frame in which the TTL is the minimum value (0001 is the \nminimum value. 0000, meaning 16, is the maximum value). The initial value of the TTL field can be configured via SMI or EEPROM. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 23 Track ID: JATR-8275-15   Rev. 1.0\n \n \nIn Figure 13, device A, B, and C are in a loop. Device D connects to device B. Device D generates a loop \nframe with an initial TTL value 3 th en sends to device B. When the loop frame arrives at device C, the \nTTL value decreases to 2. It turns to 1 when the loop fr ame is transmitted to device A, and then the loop \nframe is dropped by the device A. If device D gene rates loop frames without  the TTL mechanism, the \nloop frames will cause a storm in the loop of devi ces A, B, and C. The RTL8304MB provides an option \nto assign high priority to loop frames to reduce the possibility of erroneous loop frame dropping, and \nthereby enhance loop detection.  \n \nFigure 13. Loop Example 2 \n \n7.3.9.  Reg.0.14 PHY Digital Loopba ck Return to Internal \nThe digital loopback mode of the PHY (return to in ternal MAC) may be enabled on a per-port basis by \nsetting MII Reg.0.14 to 1. In digital loopback mode, the TXD of the PHY is transferred directly to the \nRXD of the PHY, with TXEN changed to CRS_DV, a nd returns to the MAC via an internal MII. The \ndata stream coming from the MAC will not egress to the physical medium, and an incoming data stream \nfrom the network medium will be blocked in this m ode. The packets will be looped back in 10Mbps full \nduplex or 100Mbps full duplex mode. This function is especially useful for diagnostic purposes. For \nexample, a NIC can be used to send broadcast frames  into Port 0 of the RTL8304MB and set Port 1 to \nReg0.14 Loopback. The frame will be looped back to Port 0, so the received packet count can be checked to verify that the switch device is good. In this exam ple, Port 0 can be 10M or 100M, and full or half \nduplex. \n \nFigure 14. Reg. 0.14 Loopback \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 24 Track ID: JATR-8275-15   Rev. 1.0\n \n \nAs the RTL8304MB only supports digital loopback in  full duplex mode, PHY Reg.0.8 for each port will \nalways be kept on 1 when digital loopback is enab led. The digital loopback only functions on broadcast \npackets (DA=FF-FF-FF-FF-FF-FF). In loopback mode, th e link LED of the loopback port should always \nbe ON, and the Speed and Duplex LED combined to reflect the link status (100full/10full) correctly, \nregardless of what the previous st atus of this loopback port was. \n7.3.10.  LDO for 1.0V Power Generation \nThe RTL8304MB can use an internal LDO to generate  1.0V from a 3.3V power s upply. This 1.0V is used \nfor the digital core and analog receive r circuits. Do not use the LDO for ot her chips, even if the rating is \nenough.  \nDo not connect an inductor (b ead) directly between the V10OUT pin and AVDDLPLL pin. This will \nadversely affect the stability of the 1.0V power to a significant degree. Please refer to the reference design \nfor details. \n7.3.11.  Crystal/Oscillator \nWhen using a crystal, the RTL8304MB should connect  a loading capacitor from  each pin of XI and XO \nto ground. Whether using an oscillator or driving an  external 25MHz clock fr om another device, the \nexternal clock should be fed into the XI pin. The following table sh ows the requirement s of the crystal \nand oscillator. \nTable 13. Crystal and Oscillator Requirements \nNominal Frequency  25.000 MHz  \nFrequency Tolerance  ±50ppm Max.  \nTemperature Characteristics  ±50ppm in Operating Temperature Range  \nEquivalent Series Resistance of Crystal  50 Ohm Max.  \nXTALI/OSC Input Clock Jitter Tol erance (in 5KHz to 2.5MHz Range)  250ps Max.  \nDuty Cycle  40%~60%  \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 25 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8. Advanced Function Description \n8.1. VLAN Function \n8.1.1.  VLAN Description \nThe RTL8304MB supports 16 VLAN groups with the 16- entry VLAN table (see Table 14 and Table 15). \nThese can be configured as port-based VLANs and/or IEEE 802.1Q tag-based VLANs. The RTL8304MB \nsupports four IVLs, with the mapping information in  the VLAN table. The contents of the VLAN table \ncan be configured via SMI or EEPROM. Multiple ingr ess filtering and egress fi ltering options provide \nvarious VLAN admit rules for the RTL8304MB. Th e RTL8304MB also provides flexible VLAN tag \ninsert/remove function based on port and VID. \nTable 14. VLAN Table \nEntry Index VLAN ID Membership UNTAG_MSK FID \nVLAN Entry 0 VLAN ID A[11:0] VLAN ID A membership [3:0] VLAN ID A UNTAG_MSK [3:0] FID[1:0] \nVLAN Entry 1 VLAN ID B [11:0] VLAN ID B membership [3:0] VLAN ID B UNTAG_MSK [3:0] FID[1:0] \n…… …… …… …… …… \nVLAN Entry 15 VLAN ID P [11:0] VLAN ID P membership [3:0] VLAN ID P UNTAG_MSK [3:0] FID[1:0] \n \nTable 15. VLAN Entry \nField Description Bits \nVID The VLAN ID for Search. \nThe VID of the ingress packet will be compared with this field. 12 \nMBR VLAN Member Port Set. \nIf the bit in this field is ‘1’, the correspon ding port is a member port of the VLAN \nspecified by the VID field. 4 \nUNTAG SET VLAN Untag Set. \nIf the bit in this field is ‘1’, egress pack ets from the corresponding port will be VLAN-\nuntagged. 4 \nPRIORITY VID-Based Priority. \nThe priority assigned to all ingress packets of the VLAN specified by the VID field. 2 \nFID The FID is Used by Lookup Table for IVL Application. 12 \n \nThe main VLAN features of the RTL8304MB are as follows: \n• Supports up to 16 VLAN groups \n• Flexible IEEE 802.1Q port/tag-based VLAN \n• Four IVLs \n• Leaky VLAN for ARP broadcast/unicast/multicast packets \n• Leaky inter-VLAN mirror function \n• VLAN tag Insert/Remove function \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 26 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.1.2.  Port-Based VLAN \nThe 16 VLAN membership registers designed into th e RTL8304MB provide full flexibility for users to \nconfigure the member ports to associate with diff erent VLAN groups in the VLAN table. Each port can \njoin more than one VLAN group. \nPort-based VLAN mapping is the simplest implicit ma pping rule. Each ingress packet is assigned to a \nVLAN group based on the input port. It is not necessa ry to parse and inspect frames in real-time to \ndetermine their VLAN association. All the packets re ceived on a given input port will be forwarded to \nthis port’s VLAN members. The RTL8304MB supports  VLAN indexes for each port to individually \nindex this port to one of the 16 VLAN membership re gisters. A port that is not included in a VLAN’s \nmember set cannot transmit packets to this VLAN. For non-VLAN tagged frames, the RTL8304MB performs port-based VLAN. The VLAN ID associated \nwith the port-based VLAN index setting is the Port VID (PVID) of this port. The VLAN tag with the \ningress port’s PVID can be inserted (or replace the VID with a PVID for VLAN-tagged packets) into the \npacket on egress. The RTL8304MB also provides an option to admit VLAN tagged packets with a \nspecific PVID only. When IEEE 802.1Q tag-aware VL AN is enabled, the VLAN tag admit control and \nnon-PVID discard are enabled at the same time. Non- tagged packets and packets with an incorrect PVID \nwill be dropped. The RTL8304MB supports Port VID (PVID) for each port and can insert a PVID in the VLAN tag on \negress. The PVID in the inserted (or replaced) VLAN ta g on egress can indicate the source port of the \npacket. Using this function, VID information carried  in the VLAN tag will be changed to PVID. The \nRTL8304MB also provides an option to admit VLAN tagged packets with a specific  PVID only. If this \nfunction is enabled, it will drop non-tagged p ackets and packets with an incorrect PVID. \n8.1.3.  IEEE 802.1Q Tagged-VID Based VLAN \nThe RTL8304MB supports 16 VLAN entries to perform IEEE 802.1Q-tagged VID-based VLAN \nmapping. The RTL8304MB uses a 12-bit explicit identifier in the VLAN tag to associate received packets \nwith a VLAN. If the VID of a VLAN-tagged frame doe s not match any of the 16 VLAN entries, the \nRTL8304MB will drop the frame. Otherwise, the RTL8304MB compares the explicit identifier in the VLAN tag with the 16 VLAN IDs to determine the VLAN  association of this packet, and then forwards \nthis packet to the member set of this VLAN. Two VIDs  are reserved for special purposes. One of them is \nall 1’s, which is reserved and currently unused. The other is all 0’s, which indicates a priority tag. A \npriority-tagged frame should be treated as an untagged frame. \nWhen ‘802.1Q tag aware VLAN’ is enabled, the RTL8304MB performs 802.1Q tag-based VLAN \nmapping for tagged frames, but still performs port -based VLAN mapping for untagged frames. If ‘802.1Q \ntag aware VLAN’ is disabled, the RTL8304MB pe rforms only port-based VLAN mapping both on non-\ntagged and tagged frames. \n8.1.4.  Insert/Remove/Replace Tag \nThe RTL8304MB supports the VLAN Insertion/Re moval/replacing action for each port. The 802.1Q \nVLAN tags can be inserted, removed, or replaced based on the port’s setting. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 27 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.1.5.  Ingress and Egress Rules \nThe RTL8304MB provides flexible VLAN ingress and egress rules to  permit comprehensive traffic \ncontrol. The RTL8304MB can filter pack ets on ingress according to the tag condition of the packet. For a \nnormalized VLAN application and VLAN translation ap plication, each of the RTL8304MB ports can be \nindependently configured to: \n• ‘admit all frames’ \n• ‘admit only tagged frames’ \n• ‘admit only untagged frames’ \nNote: The priority tagged frame (VID=0 ) will be treated as an untagged frame. \nThe RTL8304MB also can optionally discard a frame a ssociated with a VLAN of which the ingress port \nis not in the member set. \nFor the egress filter, the RTL8304MB drops the frame if this frame belongs to a VLAN but its egress port \nis not one of the VLAN’s member ports. However, there are 5 leaky options to provide exceptions for \nspecial applications. \n• ‘Unicast leaky VLAN’ enables inte r-VLAN unicast packet forwarding. That is, if the layer 2 lookup \ntable search has a hit, then the unicast packet wi ll be forwarded to the egre ss port, ignoring the egress \nrule \n• ‘Multicast leaky VLAN’ enables inter-VLAN multicas t packet forwarding. Packets may be flooded to \nall the multicast address group member sets, ignoring the VLAN member set domain limitation \n• ‘Broadcast leaky VLAN’ enables inter-VLAN broad cast packet forwarding. Packets may be flooded \nto all the other ports, ignoring the VLAN member set domain limitation \n• ‘ARP leaky VLAN’ enables broadcasting of ARP pack ets to all other ports, ignoring the egress rule \n• ‘Inter-VLAN mirror function’ enab les the inter-VLAN mirror func tion, ignoring the VLAN member \nset domain limitation. The default value is ‘Enable the inter-VLAN mirror’ \n \n8.2. IEEE 802.1p Remarking Function \nThe RTL8304MB provides IEEE 802.1p Remarking abilit y. Each port can enable  or disable IEEE 802.1p \nRemarking ability. \nIn addition, there is a RTL 8304MB global IEEE 802.1p Remarking Tabl e. When one port enables 802.1p \nRemarking ability, 2-bit priority (not QID) determin ed by the RTL8304MB is ma pped to 3-bit priority \naccording to the 1p Remarking Table. If the port’s 1p remarking function is enabled, transmitting VLAN tagged packets will have the 1Q \nVLAN tag’s Priority field replaced w ith the 3-bit 1p remarking Priority. \nWhen the VLAN tags are inserted to non-tagged packets, the inserted tag’s priority will accord with the 1p remarking table, even if the port’s 1p remarking function is disabled. When the VLAN tag is replaced on tagged packets and the 1p remarking function is disabled, the VLAN tag’s VID will be replaced but \nthe priority will not change. For a VLAN-tagged packet, the VID and 3-bit priority can be replaced by the \nRTL8304MB independently. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 28 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.3. QoS Function \n8.3.1.  Bandwidth Control \n8.3.1.1  Output (TX) Bandwidth Control \nThe RTL8304MB supports MIN-MAX packet scheduling. \nPacket scheduling offers three modes: \n• Type I leaky bucket, which specifies the average ra te of one queue (see Figure 15; only Q2 and Q3 \nhave leaky bucket, Q0 and Q1 do not). The queue rate can be configured from 0kbps to the line rate in \nsteps of 64kbps \n• Weighted Round Robin (WRR), which decides which queue  is selected in one slot time to guarantee \nthe minimal packet rate of one queue \n• Port bandwidth control (type II leak y bucket) to control the bandwidth of the whole port. The port rate \ncan be configured from 0kbps to the line rate in steps of 64kbps \nIn addition, the RTL8304MB can select one of the two sets of packet-sch eduling configurations according \nto the packet-scheduling mode. Figure 15 show s the RTL8304MB packet-scheduling diagram. \n \nFigure 15. Packet-Scheduling Diagram \n \nWeighted Round Robin (WRR) \nWRR adds weighting on the basis of Round Robin; for example, assume Q3:Q2:Q1:Q0: 4:3:2:1, then the \ntransmit order will be: \nQ0-> \nQ1->Q1-> Q2->Q2->Q2-> Q3->Q3->Q3->Q3-> \nWRR guarantees a minimal packet rate for one queue only. If there is strict priority (only in Q2 and Q3) and W RR at the same time, the queue with strict priority has \nhigher priority than WRR. When the scheduler scans queues, queues with strict priority are scanned first, \nand then the other queues are scanned according to WRR.  If there is more than  one queue with strict \npriority, the queue with the bigger QID has higher priority. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 29 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.3.1.2  Input (RX) Bandwidth Control \nInput bandwidth control limits the in put bandwidth. When input traffic is more than the RX Bandwidth \nparameter, this port will either send out a ‘pause ON’ frame, or dr op the input packet  depending on flow \ncontrol status. The input bandwidth ca n also be configured from 0kbps to the line rate in steps of 64kbps. \n8.3.2.  Priority Assignment \nPriority assignment specifies the priority of a received packet according to various rules. The \nRTL8304MB can recognize the QoS priority information of incoming packets to give a different egress service priority. \nThe RTL8304MB identifies the priority of packets ba sed on several types of QoS priority information: \n• Port-based priority \n• IEEE 802.1p/Q VLAN Priority Tag \n• DSCP Priority field \n• IP Address \n• Reassigned priority \n• RLDP priority \nBelow is a block diagram of  the priority assignment. \n \nFigure 16. RTL8304MB Priority Assignment Diagram \n \n8.3.2.1  Queue Number Selection \nIn the RTL8304MB, the output queue number can be se t. All ports follow a global configuration. The \nmaximum number of output queues per port is 4. Af ter changing the queue number via SMI (Serial \nManagement Interface), the external device must perfor m a soft reset in order to  update the configuration. \n8.3.2.2  Port-Based Priority Assignment \nEach physical port is assigned a 2-bit priority level. Packets received from a high-priority port are sent to \nthe high-priority queu e of the destination port. Port-based priority can be di sabled by register setting. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 30 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.3.2.3  IEEE 802.1p/Q-Based Priority Assignment \nIn IEEE 802.1Q-based priority assi gnment, when a packet is VLAN-ta gged or priority-tagged, the 3-bit \npriority is specified by tag. When a packet is untagged, the 802.1Q-based priority is assigned to the \ndefault 2-bit priority information of  a physical port. So, each port must  provide a defau lt 2-bit priority \n(every received packet must be as signed a 2-bit 1Q-Based Priority). When the priority comes from a \npacket, the 1Q-based priority is  acquired by mapping 3-bit tag prior ity to 2-bit priority though an \nRTL8304MB 1Q-based Priority Mapping Table. The 1Q-based priority can be disabled. \n8.3.2.4  DSCP-Based Priority Assignment \nDSCP (Differentiated Services Code Point)-based prio rity assignment maps the DS CP of an IP packet to \n2-bit priority information through a DSCP to priority table, as DSCP is only in the IP packet. A non-IP \npacket (such as a Layer 2 frame, ARP, etc) will ge t a NULL instead of a 2-bit priority. For an IPv6 IP \nheader, DSCP-based priority assignment acquires the DS CP value according to the class of IPv6 header.  \nIn the RTL8304MB, DSCP-based priority assignment provides a DSCP to Priority Table of all DSCP \nvalue. If the DSCP of a packet is  not matched in the table, the DSCP -based priority is 2’b00. The DSCP-\nbased priority can be disabled by register.  \n8.3.2.5  IP Address-Based Priority \nWhen IP-based priority is enabled, any incoming pack ets with source or destination IP address equal to \nthe configuration in register IP Priority Address [A] and IP Priority Mask [A], or  IP Priority Address [B] \nand IP Priority Mask [B] will be set to a 2-bit priority. \nIP priority [A] and IP priority [B] may be enabled or disabled independently. IP address-based priority \ncan be enabled or disabled  by the control register. \n8.3.2.6  Reassigned Priority \nRTL8304MB can reassign the priority mainly according to the packets’ DMAC information. This \nfunction is used to differentiate the priority of th e Layer 2 control packet, broadcast packet, multicast \npacket, unicast packet, and so on. \n8.3.2.7  RLDP-Based Priority \nTo support the loop detection effectively, the RTL8304MB provides the RLDP-based priority assignment. When it is enabled, the pre-defined pr iority will be assigned to all RLDP packets. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 31 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.3.2.8  Packet Priority Selection \nAs one received packet may simultaneously support several priority assignme nt mechanisms, e.g., Port-\nBased Priority, 1Q-Based Priority, DSCP-Based Priori ty, it may get several di fferent priority values. \n• RLDP-based priority has the highest priority \n• If RLDP-based priority is disabled, the final priority is equal to the reassigned priority \n• If RLDP-based priority and reassigned priority is disa bled, the final priority is  equal to the IP address \npriority \n• If RLDP-based priority, reassigned priority and IP address priority  are disabled, the following rules \nare used to decide a final priority for the other five types of priority \nThere is a 2-bit register for each of the three types of priority that represent the weight of the priority. The \nhigher value in the register indicates a higher weight for the priority. If mo re than one of the three types of \npriority is the same, the final prior ity will be the one of the three types,  whose priority value is greatest. \nQueue Priority Mapping \nThe 2-bit priority has four numbers; however, every port has at most four output queues, so every port \nneeds a User Priority to Traffic Class Mapping Table to  map the priority to QID. A set of Traffic Class \nMapping Tables is provided for each port independen tly. There is a mechanis m to prevent a problem \ncaused by mapping the traffic to an unused queue. Fo r example, when a port’s queue number is 2, the \nqueue 2 and queue 3 are not used and mapping the traffic to queue 2 or queue 3 will cause the system to \ncrash. In the mechanism, traffic mapped to the unused  queue will be forced to the highest used queue \n(queue 2 in a 3-queue case, queue 1 in a 2-queue case, queue 0 in a 1-queue case). In the example, the traffic mapped to a port’s queue 2 or que ue 3 will be forwarded to queue 1. \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 32 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.4. Lookup Table Function \n8.4.1.  Function Description \n• 2048-entry lookup table (LUT) \n• 4-way entry for each entry index \n• Supports LRU (Least Recently Used) function for lookup table learning \n8.4.2.  Address Search, Learning, and Aging \nReceived packets are forwarded according to the info rmation learned or written into the LUT. When a \npacket is received, the RTL8304MB tries to retrieve learned info rmation and assign a forwarding \ndestination port to the packet. \nThe 48-bit destination MAC address (DA) of the received  packet and the 2-bit FID are used to calculate a \n9-bit index value. The hash algorithm uses all 48 bits of the MAC a ddress and 2 bits of the FID. The hash \nalgorithm is shown below. Index 0 = MAC4 ^ MAC11 ^ MAC18 ^ MAC25 ^ MAC32 Index1 = MAC3 ^ MAC10 ^ MAC17 ^ MAC24 ^ MAC47 \nIndex2 = MAC2 ^ MAC9 ^ MAC16 ^ MAC39 ^ MAC46 \nIndex3 = MAC1 ^ MAC8 ^ MAC31 ^ MAC38 ^ MAC45 Index4 = FID1 ^ MAC0 ^ MAC 23 ^ MAC30 ^ MAC37 ^ MAC44 \nIndex5 = FID0 ^ MAC15 ^ MAC 22 ^ MAC29 ^ MAC36 ^ MAC43 \nIndex6 = MAC7 ^ MAC14 ^ MAC21 ^ MAC28 ^ MAC35 ^ MAC42 Index7 = MAC6 ^ MAC13 ^ MAC20 ^ MAC27 ^ MAC34 ^ MAC41 Index8 = MAC5 ^ MAC12 ^ MAC19 ^ MAC26 ^ MAC33 ^ MAC40 As the 9-bit MAC addresses, MAC[13:15] and MAC[0:5] , are not stored in the LUT entries, these MAC \naddress bits should be cal culated from the index information via the following method when the hash \nalgorithm is selected. MAC0 = Index4 ^ FID1 ^ MAC23 ^ MAC30 ^ MAC37 ^ MAC44 MAC1 = Index3 ^ MAC8 ^ MAC31 ^ MAC38 ^ MAC45 MAC2 = Index2 ^ MAC9 ^ MAC16 ^ MAC39 ^ MAC46 MAC3 = Index1 ^ MAC10 ^ MAC17 ^ MAC24 ^ MAC47 MAC4 = Index0 ^ MAC11 ^ MAC18 ^ MAC25 ^ MAC32 MAC5 = Index8 ^ MAC12 ^ MAC19 ^ MAC26 ^ MAC33 ^ MAC40 MAC13 = Index7 ^ MAC6 ^ MAC2 0 ^ MAC27 ^ MAC34 ^ MAC41 \nMAC14 = Index6 ^ MAC7 ^ MAC2 1 ^ MAC28 ^ MAC35 ^ MAC42 \nMAC15 = Index5 ^ FID0 ^ MAC22 ^ MAC29 ^ MAC36 ^ MAC43 \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 33 Track ID: JATR-8275-15   Rev. 1.0\n \n \nThe hashed index key is used to locate a matching LUT entry. There are 4 entr ies sharing one index key \n(Table 16). This is called a 4-way hash. It is helpful to minimize address collisions in the address learning \nprocess. The address search engine compares the DA p acket with the data in 4 entries, from entry 3 to \nentry 0. The final forwarding destina tion is abstracted from the first matching entry. If the address search \nfails to return a matching LUT entry, the p acket will be flooded to appropriate ports. \nTable 16. L2 Table 4-Way Hash Index Method \nIndex Entry 0 Entry 1 Entry 2 Entry 3 \n0x00 MAC Addr 0 MAC Addr 1 MAC Addr 2 MAC Addr 3 \n0x01 MAC Addr 4 MAC Addr 5 MAC Addr 6 MAC Addr 7 \n0x02 MAC Addr 8 MAC Addr 9 MAC Addr 10 MAC Addr 11 \n… … … … … \n0x1FE MAC Addr 2040 MAC Addr 2041 MAC Addr 2042 MAC Addr 2043 \n0x1FF MAC Addr 2044 MAC Addr 2045 MAC Addr2046 MAC Addr 2047 \n \nAddress learning is the gathering pro cess and storing of information from received packets for the future \npurpose of forwarding frames addresse d to the receiving port.  The information includes the source MAC \naddress (SA) and the receiving port. As with the hash  algorithm, an address search is used in address \nlearning. The SA of the received packet is used to calculate th e entry index. The receiving port \ninformation and the aging timer of the first matching entry will be updated when an address is learned. If \nthere is no matching entry, the pack et’s information will be ‘learned’ into the first empty entry. The SA \nwill not be learned when all of the 4 entries are occ upied. The address learning process can be disabled on \na per-port basis via register setting. For unicast packet learning & search, and multicast packet search, the RTL 8304MB applies the same 4-\nway hash algorithm. Address aging is used to  keep the contents of the learned address table updated in a dynamic network \ntopology. The look-up engine will upda te the aging timer of an entr y whenever the corresponding SA \nappears. An entry will be invalid (aged out) if its aging timer is not refreshed by the address learning \nprocess during the aging time period. The aging time of the RTL8304MB is between 200 and 400 \nseconds. The RTL8304MB also supports a fast aging f unction that is used to age all dynamic entries \nwithin 1ms. \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 34 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.4.3.  Lookup Table Definition \nIn traditional switch learning, if a MAC address hash co llision occurs then the later MAC address in the \ncollision will not be learned into  the lookup table. The LRU function attempts to resolve this problem. \nWhen Enable LRU = 0b1, then the LRU function is enabled. If the Source MAC address of the incoming \npacket encounters a hash collision during the learning process and when the 4-way entries are all occupied, then the switch will learn the address in one of the 4-way entries using the LRU aging timer. \nThe criteria for selecting the entry to over-write is comparing via the aging timer and choosing the oldest \nentry. If the aging timer of the 4 en tries are the same, then the entry with the highest Entry_Address[1:0] \nvalue is selected to be over-written. \n \n8.5. Storm Filter Function \nThe RTL8304MB can effectively c ontrol four-types of broadcast st orms; those caused by broadcast \npackets, multicast packets, unknown multicast packets, and unknown DA unicast packets.  \nNote: Broadcast packets discussed here are packets whose DA is ff-ff-ff-ff-ff-ff. \nMulticast packets include all multi cast packets and only unknown multi cast packets, which are those \nwhose DA is a multicast address,  but excluding 01-80-C2-00-00-xx. \nAn unknown DA unicast packet is a packet whose DA is  a unicast address and is not found in the lookup \ntable of the switch. The RTL8304MB can configure a storm filter rate for th ese four packet types, and the rate unit can be \nconfigured as packet-based or byte-based via registers. The storm filter rate limits the packet forwarding \nrate to less than the rate threshold. \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 35 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.6. Input and Output Drop Function \nIf some destination ports are blocking, or the buffe r is full, the frames to these ports will be dropped. \nThere are two types of drop: \n• Input Drop: Drop the frame directly . Do not forward to any port \n• Output Drop: Forward only to non-blocking ports \nFor the RTL8304MB, the dropping of broadcast, multicast, and unknown DA frames can be controlled \nindependently. \nRX: Port 0\nFull\nInput Drop1. Broadcast packet from Port 0 .\n2 . Buffer of Port3 is full, others are not full .\nFull\nOutput Drop  3  123 2 1 RX : Port 0\n \nFigure 17. Broadcast Input Drop vs. Output Drop \n \nFull1 . Multicast packet from Port 0 .\n2 . Buffer of Port3 is full, Port 1 is not full .\nFull12 3 3 2 1\nOutput Drop Input DropRX: Port 0 RX: Port 0\n \nFigure 18. Multicast Input Drop vs. Output Drop \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 36 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.7. LED Function \nThe RTL8304MB provides flexible LED functions for diagnostics. The LEDs can be configured to \nindicate the link information (li nk, activity, speed, duplex), and collis ion & loop detection information.  \nThe parallel LED for each port indica tes the port’s link information when  loop-detection is  disabled or no \nloop condition occurs. If the loop is detect ed on a port, the parallel LED will blink. \nAll LED statuses are represented as activ e-low or high dependi ng on input strapping. \nLED_BLINK_TIME determines the LED blinking period for activity and collision via register (0: 32ms \nand 1: 128ms). \nSome LED pins are dual function pi ns: input operation for configuration upon reset, and output operation \nfor LED after reset. If th e pin input is floating upon reset, the pi n output is active high after reset. \nOtherwise, if the pin input is pulled high upon rese t, the pin output is active low after reset. \nFigure 19 shows example circuits for LEDs. T ypical values for pull- down resistors are 10K Ω. \n \n  \nFigure 19. Floating and Pull-High of LED Pins for LED \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 37 Track ID: JATR-8275-15   Rev. 1.0\n \n \n8.8. Energy-Efficient Ethernet (EEE) \nThe RTL8304MB supports Energy-Efficient Ethernet (EEE) function as define d in IEEE 802.3az. The \nEEE function implements the Low Power Idle (LPI) mode at 100Mbps operation to save power during \nperiods of low link utilization. In Low Power Idle m ode, devices on both sides of  the link disable portions \nof the functionality to lo wer the power consumption. \nAt the transmitter side, the RTL8304MB port 0~2 can automatically enter or quit LPI mode based on \ntheir transmission loading. When a port’s EEE function is enabled, the transmission loading is monitored \nin real time. If the transmission loading is lower th an a preset threshold, this port’s transmission circuit \nwill enter LPI mode during the idle period. When ther e are packets to be transmitted, this port wakes up \nand quits LPI mode. \nThere are two types of wake-up: \n• Packets in a high priority  queue or a control packet (e.g., a PAUSE frame). These can wake up the \nport immediately \n• Packet in a low priority queue that reach a preset  number. A port in LPI mode can be woken up by low \npriority packets when the number of the cumulated low priority packets exceeds the preset threshold \nor a delay timer expires \nAt the receiver side, each embedded PHY of the R TL8304MB will automatically respond to the request \nfrom the link partner to enter or quit the LPI mode. \nThe EEE ability for 100Base-TX on each side of a link should be exchanged via auto-negotiation. Auto-\nnegotiation is mandatory when EEE is enabled. Th e MDIO Manageable Device (MMD), defined in \nIEEE 802.3, Clause 45, should also be supported, as th e EEE register is located in the MMD of each \nPHY. \nThe RTL8304MB also supports EEE at 10Mbps opera tion by reducing the transmit amplitude (10Base-\nTe). 10Base-Te is fully interoperable with 10Base- T PHYs over 100m of Category 5 or better cable. \nThe EEE function for each port is enabled by default and can be disabled inde pendently via strapping pin, \nregisters, or EEPRO M configurations. \n \n8.9. Cable Diagnosis \nThe RTL8304MB physical layer trans ceivers use DSP technology to impl ement the Realtek Cable Tester \n(RTCT) feature for cable diagnosis. The RTCT feat ure can detect short, open, or normal in both \ndifferential pair signal runs.  \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 38 Track ID: JATR-8275-15   Rev. 1.0\n \n \n9. Characteristics \n9.1. Electrical Characteristics/Maximum Ratings \nWARNING: Maximum ratings are limits beyond which permanent damage may be caused to the device \nor which may affect device reliability. All voltage s are specified referen ce to GND unless otherwise \nspecified. \nTable 17. Electrical Characteristics/Maximum Ratings \nParameter Min Max Units \nDVDDH, A VDDH, A VDDHPLL Supply Referenced to GND GND-0.3 +3.63 V \nDVDDL, A VDDL, A VDDLPLL Supply Referenced to GND GND-0.3 +1.10 V \n \n9.2. Operating Range \nTable 18. Operating Range \nParameter Min Max Units \nStorage Temperature -55 +150 °C \nAmbient Operating Temperature (Ta) 0 +70 °C \n3.3V Vcc Supply V oltage Range (DVDDH, A VDDH, A VDDHPLL) 3.13 3.47 V \n1.0V Vcc Supply V oltage Range (DVDDL, A VDDL, A VDDLPLL) 0.95 1.05 V \n \n9.3. DC Characteristics \nTable 19. DC Characteristics \nParameter SYM Condition Min Typical Max Units \nTTL Input High V oltage V ih - 2.0 - - V \nTTL Input Low V oltage V il - - - 0.8 V \nTTL Input Current I in - -10 - 10 µA \nTTL Input Capacitance C in - - 3 - pF \nOutput High V oltage V oh - 2.25 - - V \nOutput Low V oltage V ol - - - 0.4 V \nOutput Three State \nLeakage Current |IOZ| - - - 10 µA \nPower Supply Current for 1.0V Icc 10Base-T, idle 10Base-T, Peak continuous 100% utilization \n100Base-TX, idle 100Base-TX, Peak continuous 100% utilization\nLink down - - \n- - \n- 32 \n33 \n62 \n62 \n32 - \n- \n- - \n- mA \nPower Supply Current for 3.3V Icc 10Base-T, idle 10Base-T, Peak continuous 100% utilization \n100Base-TX, idle \n100Base-TX, Peak continuous 100% utilization\nLink down - \n- \n- \n- \n- 23 \n60 \n68 68 \n23 - \n- \n- \n- \n- mA \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 39 Track ID: JATR-8275-15   Rev. 1.0\n \n \nParameter SYM Condition Min Typical Max Units \nTotal Power Consumption \nfor All Ports PS 10Base-T, idle \n10Base-T, Peak continuous 100% utilization \n100Base-TX, idle 100Base-TX, Peak continuous 100% utilization\nLink down - - \n- - \n- 108 231 \n287 287 \n108 - \n- \n- - \n- mW \nNote: All power supply currents are measured under the following conditions: 1. DVDDL=AVDDL=AVDDHPLL=1.0V; DVDDH=AVDDH=AVDDHPLL=3.3V . 2. Room temperature. \n3. The EEE and Green features are disabled. 4. All LEDs are in low-active mode. 5. LDO power is not included. \n \n9.4. Digital Timing Characteristics \n9.4.1.  RMII Interface Timing \n9.4.1.1  RMII Timing \nTable 20. RMII Timing \nParameter SYM Description I/O Min Type Max Units \nREFCLK Tcyc REFCLK clock cycle time I/O 20+50 \nppm 20  \nppm 20-50 \nppm ns \nTXD[1:0], TXEN \nSetup Time TOS TXD[1:0], TXEN to REFCLK rising \nedge setup time O 4 - - ns \nTXD[1:0], TXEN \nHold Time TOH TXD[1:0], TXEN to REFCLK rising \nedge hold time O 2 - - ns \nRXD[1:0],CRSDV \nSetup Time TIS RXD[1:0], CRSDV to REFCLK \nrising edge setup time I 4 - - ns \nRXD[1:0], CRSDV \nHold Time TIH RXD[1:0], CRSDV to REFCLK \nrising edge hold time I 2 - - ns \n \n9.4.2.  LED Timing \nTable 21. LED Timing \nParameter SYM Condition Min Typical Max Units \nLED On Time tLEDon LED Blinking to Indicate Link Information 32 - 128 ms \nLED Off Time tLEDoff LED Blinking to Indicate Link Information 32 - 128 ms \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 40 Track ID: JATR-8275-15   Rev. 1.0\n \n \n9.4.3.  Reception/Transmission Data Timing of SMI Interface \n \nFigure 20. Reception Data Timing of SMI Interface \n \n \n \nFigure 21. Transmission Data Timing of SMI Interface \n \nTable 22. SMI Timing \nParameter SYM Description I/O Min Type Max Units \nMDC T cyc MDC Clock Cycle I 400 - - ns \nMDIO Input Setup Time T IS MDIO to MDC Rising Edge Setup Time I 50 - - ns \nMDIO Input Hold Time T IH MDIO to MDC Rising Edge Hold Time I 10 - - ns \nMDIO Output Delay Time T D MDIO to MDC Rising Edge Output Delay O 2 - 10 ns \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 41 Track ID: JATR-8275-15   Rev. 1.0\n \n \n9.4.4.  EEPROM Auto-Load Timing \n \nFigure 22. EEPROM Auto-Load Timing \n \nTable 23. EEPROM Auto-Loa d Timing Characteristics \nSymbol Description Min Typical Max Units \nt1 SCL High Time - 2.52 - µs \nt2 SCL Low Time - 2.52 - µs \nt3 START Condition Setup Time - 2.52 - µs \nt4 START Condition Hold Time - 2.52 - µs \nt5 Data In Hold Time 0 - - ns \nt6 Data In Setup Time 100 - - ns \nt7 Data Output Hold Time - 1.28 - µs \nt8 STOP Condition Setup Time - 2.52 - µs \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 42 Track ID: JATR-8275-15   Rev. 1.0\n \n \n10. Mechanical Dimensions \n \n \n \n           \n     \n       \n   RTL8304MB \nDatasheet \n \nSingle-Chip 4-Port 10/100Mbps Ethernet Switch Controller 43 Track ID: JATR-8275-15   Rev. 1.0\n \n \n10.1. Mechanical Dimensions Notes \nSymbol Dimension in mm Dimension in inch \n Min Nom Max Min Nom Max \nA 0.75 0.85 1.00 0.030 0.034 0.039  \nA1 0.00 0.02 0.05 0.000  0.001 0.002 \nA3 0.20 REF 0.008 REF \nb 0.15 0.20 0.25 0.006 0.008 0.010 \nD/E 6.00BSC 0.236BSC \nD2/E2 4.15 4.4 4.65 0.163 0.173 0.183 \ne 0.40BSC 0.016BSC \nL 0.30  0.40  0.50  0.012  0.016  0.020  \nNote 1: CONTROLLING DIME NSION: MILLIMETER (mm). \nNote 2: REFERENCE DOCUMENT: JEDEC MO-220. \n \n  \n11. Ordering Information \nTable 24. Ordering Information \nPart Number Package Status \nRTL8304MB-CG 48-Pin QFN in ‘Green’ Package (RoHS Compliant)  \nNote: See page 5 for package identification. \n   \n  \n   \n \nRealtek Semiconductor Corp. \nHeadquarters No. 2, Innovation Road II Hsinchu Science Park, Hsinchu 300, Taiwan Tel.: +886-3-578-0211. Fax: +886-3-577-6047 www.realtek.com \n'}]
!==============================================================================!
### Component Summary: RTL8304MB-CG

**Description:**
The RTL8304MB-CG is a single-chip 4-port 10/100Mbps Ethernet switch controller designed by Realtek Semiconductor Corp. It integrates memory, four MACs, and three physical layer transceivers for 10Base-T and 100Base-TX operation. The device supports an RMII interface for external devices and includes advanced features for Quality of Service (QoS), VLAN support, and energy-efficient operation.

**Key Specifications:**

- **Voltage Ratings:**
  - Supply Voltage (DVDDH, AVDDH, AVDDHPLL): 3.3V (±5%)
  - Supply Voltage (DVDDL, AVDDL, AVDDLPLL): 1.0V (±5%)

- **Current Ratings:**
  - Power Supply Current for 1.0V: 
    - 10Base-T: 32 mA (idle), 62 mA (peak)
    - 100Base-TX: 33 mA (idle), 68 mA (peak)
  - Power Supply Current for 3.3V: 
    - 10Base-T: 23 mA (idle), 60 mA (peak)
    - 100Base-TX: 23 mA (idle), 68 mA (peak)

- **Power Consumption:**
  - Total Power Consumption: 
    - 108 mW (10Base-T idle)
    - 287 mW (100Base-TX peak)

- **Operating Temperature Range:**
  - Ambient Operating Temperature: 0°C to 70°C
  - Storage Temperature: -55°C to 150°C

- **Package Type:**
  - 48-pin QFN (Green package, RoHS compliant)

- **Special Features:**
  - Supports Energy-Efficient Ethernet (EEE) mode (IEEE 802.3az)
  - Integrated LDO regulator for 1.0V generation from 3.3V
  - Advanced QoS functions with four-level priority queues
  - VLAN support for up to 16 groups with 802.1Q tagging
  - Loop detection and cable diagnostics capabilities

- **Moisture Sensitive Level (MSL):**
  - MSL according to JEDEC J-STD-020E: Not specified in the provided text.

### Typical Applications:
The RTL8304MB-CG is typically used in:
- **Networking Equipment:** Such as Ethernet switches and routers.
- **Consumer Electronics:** Including set-top boxes and TV boxes that require Ethernet connectivity.
- **Industrial Applications:** Where reliable and efficient data transmission is necessary.
- **Home Networking:** For connecting multiple devices in a home network environment.

### Conclusion:
The RTL8304MB-CG is a versatile and efficient Ethernet switch controller suitable for various applications requiring reliable network connectivity and advanced features like QoS and VLAN support. Its integration of multiple functionalities into a single chip helps reduce system complexity and improve performance in networking solutions.